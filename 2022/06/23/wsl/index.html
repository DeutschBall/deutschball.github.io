<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Cascadia Code:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"dustball.top","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":-1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="WSL2 Windows Subsystem for Linux,在windows上运行的linux子系统 前一段时间一直在用WSL kali+vscode+python3,做pwn的题目还有linux上的逆向题.确实比用vmware开一个虚拟机方便一万倍 但是对wsl的了解也就仅限于一些简单的命令比如ls等等,对于子系统和主系统的网络关系,以及子系统的其他用法,没有了解过 现在想了解一">
<meta property="og:type" content="article">
<meta property="og:title" content="WSL2">
<meta property="og:url" content="http://dustball.top/2022/06/23/wsl/index.html">
<meta property="og:site_name" content="dustland">
<meta property="og:description" content="WSL2 Windows Subsystem for Linux,在windows上运行的linux子系统 前一段时间一直在用WSL kali+vscode+python3,做pwn的题目还有linux上的逆向题.确实比用vmware开一个虚拟机方便一万倍 但是对wsl的了解也就仅限于一些简单的命令比如ls等等,对于子系统和主系统的网络关系,以及子系统的其他用法,没有了解过 现在想了解一">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-06-23T14:44:00.000Z">
<meta property="article:modified_time" content="2024-09-02T15:13:16.011Z">
<meta property="article:author" content="dustball">
<meta property="article:tag" content="linux">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://dustball.top/2022/06/23/wsl/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>WSL2 | dustland</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">dustland</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">dustball in dustland</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/deutschball" class="github-corner" title="Follow me on GayHub" aria-label="Follow me on GayHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://dustball.top/2022/06/23/wsl/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/DeutschBall/picbed/main/dustball.png">
      <meta itemprop="name" content="dustball">
      <meta itemprop="description" content="dustland">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dustland">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          WSL2
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2022-06-23 22:44:00" itemprop="dateCreated datePublished" datetime="2022-06-23T22:44:00+08:00">2022-06-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-09-02 23:13:16" itemprop="dateModified" datetime="2024-09-02T23:13:16+08:00">2024-09-02</time>
              </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="wsl2">WSL2</h1>
<p>Windows Subsystem for Linux,在windows上运行的linux子系统</p>
<p>前一段时间一直在用WSL
kali+vscode+python3,做pwn的题目还有linux上的逆向题.确实比用vmware开一个虚拟机方便一万倍</p>
<p>但是对wsl的了解也就仅限于一些简单的命令比如<code>ls</code>等等,对于子系统和主系统的网络关系,以及子系统的其他用法,没有了解过</p>
<p>现在想了解一下子系统的结构,怎么用子系统完成操作系统的课程实验(编译内核,系统调用,内核模块,设备驱动)</p>
<p>以及如何修改子系统的各种设置,比如防火墙,与主机的网络关系,网络发现等</p>
<p>随性更新...</p>
<h2 id="安装卸载wsl">安装/卸载wsl</h2>
<h3 id="安装wsl">安装wsl</h3>
<p>后面的实验都是基于WSL2已经安装完成,kali子系统已经能够在终端上运行了.安装wsl可以去微软官网(这部分已经被翻译过了),要添加windows功能</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220622193653802.png"
alt="image-20220622193653802" />
<figcaption aria-hidden="true">image-20220622193653802</figcaption>
</figure>
<p>具体参考<a
target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/windows/wsl/basic-commands">WSL
的基本命令 | Microsoft Docs</a></p>
<p>在微软应用市场上可以下载各种linux系统,比如ubuntu18.04和ubuntu20.04,kali,debian等等</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220622191626686.png"
alt="image-20220622191626686" />
<figcaption aria-hidden="true">image-20220622191626686</figcaption>
</figure>
<p>更方便的方法是在命令行上</p>
<p><strong>查看本机已安装子系统</strong></p>
<p><code>wsl -l</code></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\<span class="number">86135</span>\Desktop\pwn&gt; wsl <span class="literal">-l</span></span><br><span class="line">适用于 Linux 的 Windows 子系统分发版:</span><br><span class="line">kali<span class="literal">-linux</span> (默认)</span><br><span class="line">Ubuntu</span><br></pre></td></tr></table></figure>
<p><strong>查看可以安装的子系统</strong></p>
<p><code>wsl -l -o</code></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\<span class="number">86135</span>\Desktop\pwn&gt; wsl <span class="literal">-l</span> <span class="literal">-o</span></span><br><span class="line">以下是可安装的有效分发的列表。</span><br><span class="line">请使用“wsl <span class="literal">--install</span> <span class="literal">-d</span> &lt;分发&gt;”安装。</span><br><span class="line"></span><br><span class="line">NAME            FRIENDLY NAME</span><br><span class="line">Ubuntu          Ubuntu</span><br><span class="line">Debian          Debian GNU/Linux</span><br><span class="line">kali<span class="literal">-linux</span>      Kali Linux Rolling</span><br><span class="line">openS<span class="built_in">USE-42</span>     openSUSE Leap <span class="number">42</span></span><br><span class="line">SLES<span class="literal">-12</span>         SUSE Linux Enterprise Server v12</span><br><span class="line">Ubuntu<span class="literal">-16</span>.<span class="number">04</span>    Ubuntu <span class="number">16.04</span> LTS</span><br><span class="line">Ubuntu<span class="literal">-18</span>.<span class="number">04</span>    Ubuntu <span class="number">18.04</span> LTS</span><br><span class="line">Ubuntu<span class="literal">-20</span>.<span class="number">04</span>    Ubuntu <span class="number">20.04</span> LTS</span><br></pre></td></tr></table></figure>
<p><strong>设置默认的wsl</strong></p>
<p><code>wsl --set-default &lt;子系统名&gt;</code></p>
<p>在powershell中使用wsl命令时,有一个默认使用的子系统,比如我现在默认使用kali-linux,当终端上直接输入wsl时默认唤醒kali-linux,而不是ubuntu</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\86135\Desktop\pwn&gt; wsl --set-default ubuntu</span><br><span class="line">PS C:\Users\86135\Desktop\pwn&gt; wsl -l</span><br><span class="line">适用于 Linux 的 Windows 子系统分发版:</span><br><span class="line">Ubuntu (默认)</span><br><span class="line">kali-linux</span><br><span class="line">PS C:\Users\86135\Desktop\pwn&gt; wsl --set-default kali-linux</span><br><span class="line">PS C:\Users\86135\Desktop\pwn&gt; wsl -l</span><br><span class="line">适用于 Linux 的 Windows 子系统分发版:</span><br><span class="line">kali-linux (默认)</span><br><span class="line">Ubuntu</span><br></pre></td></tr></table></figure>
<h3 id="卸载子系统">卸载子系统</h3>
<p>在微软应用商店里是木法卸载子系统的,在终端上行</p>
<p><code>wsl --unregister &lt;子系统名&gt;</code></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\<span class="number">86135</span>\Desktop\pwn&gt; wsl <span class="literal">--unregister</span> ubuntu</span><br><span class="line">正在注销...</span><br><span class="line"><span class="built_in">PS</span> C:\Users\<span class="number">86135</span>\Desktop\pwn&gt; wsl <span class="literal">-l</span></span><br><span class="line">适用于 Linux 的 Windows 子系统分发版:</span><br><span class="line">kali<span class="literal">-linux</span> (默认)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>三炮!</p>
<p>出去!</p>
</blockquote>
<h2 id="唤醒关闭wsl">唤醒/关闭wsl</h2>
<h3 id="选择唤醒哪一个子系统">选择唤醒哪一个子系统</h3>
<p><code>wsl -d &lt;子系统名&gt;</code></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\<span class="number">86135</span>\Desktop\pwn&gt; wsl <span class="literal">-d</span> ubuntu</span><br><span class="line">ubuntu@Executor:/mnt/c/Users/<span class="number">86135</span>/Desktop/pwn<span class="variable">$</span></span><br></pre></td></tr></table></figure>
<h3 id="选择登录用户">选择登录用户</h3>
<p><code>wsl -u &lt;用户名&gt;</code></p>
<p>比如可以选择使用root登录系统,也可以使用普通用户登录系统.</p>
<p>只要是从powershell上唤醒子系统,不需要输入登录密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\86135\Desktop\pwn&gt; wsl -u root</span><br><span class="line">┏━(Message from Kali developers)</span><br><span class="line">┃</span><br><span class="line">┃ This is a minimal installation of Kali Linux, you likely</span><br><span class="line">┃ want to install supplementary tools. Learn how:</span><br><span class="line">┃ ⇒ https://www.kali.org/docs/troubleshooting/common-minimum-setup/</span><br><span class="line">┃</span><br><span class="line">┗━(Run: “touch ~/.hushlogin” to hide this message)</span><br><span class="line">┌──(root㉿Executor)-[/mnt/c/Users/86135/Desktop/pwn]</span><br><span class="line">└─# exit</span><br><span class="line">logout</span><br><span class="line">PS C:\Users\86135\Desktop\pwn&gt; wsl -u kali</span><br><span class="line">┏━(Message from Kali developers)</span><br><span class="line">┃</span><br><span class="line">┃ This is a minimal installation of Kali Linux, you likely</span><br><span class="line">┃ want to install supplementary tools. Learn how:</span><br><span class="line">┃ ⇒ https://www.kali.org/docs/troubleshooting/common-minimum-setup/</span><br><span class="line">┃</span><br><span class="line">┗━(Run: “touch ~/.hushlogin” to hide this message)</span><br></pre></td></tr></table></figure>
<h3 id="设置默认登录用户">设置默认登录用户</h3>
<p>kali的默认登录用户是普通用户,权限有限.现在想要将默认登录用户改成root,如此不需要su或者sudo再输入密码</p>
<p><code>&lt;子系统名&gt; config --default-user &lt;用户名&gt;</code></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\<span class="number">86135</span>\Desktop\pwn&gt; kali config <span class="literal">--default-user</span> root</span><br><span class="line"><span class="built_in">PS</span> C:\Users\<span class="number">86135</span>\Desktop\pwn&gt; kali</span><br><span class="line">┏━(Message from Kali developers)</span><br><span class="line">┃</span><br><span class="line">┃ This is a minimal installation of Kali Linux, you likely</span><br><span class="line">┃ want to install supplementary tools. Learn how:</span><br><span class="line">┃ ⇒ https://www.kali.org/docs/troubleshooting/common<span class="literal">-minimum-setup</span>/</span><br><span class="line">┃</span><br><span class="line">┗━(Run: “touch ~/.hushlogin” to hide this message)</span><br><span class="line">┌──(root㉿Executor)-[~]</span><br><span class="line">└─<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<h3
id="查看子系统内核版本wsl---status">查看子系统内核版本<code>wsl --status</code></h3>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\<span class="number">86135</span>\Desktop\pwn&gt; wsl <span class="literal">--status</span></span><br><span class="line">默认分发：kali<span class="literal">-linux</span></span><br><span class="line">默认版本：<span class="number">2</span></span><br><span class="line"></span><br><span class="line">适用于 Linux 的 Windows 子系统最后更新于 <span class="number">2022</span>/<span class="number">4</span>/<span class="number">21</span></span><br><span class="line">适用于 Linux 的 Windows 子系统内核可以使用“wsl <span class="literal">--update</span>”手动更新，但由于你的系统设置，无法进行自动更新。</span><br><span class="line"> 若要接收自动内核更新，请启用 Windows 更新设置:“在更新 Windows 时接收其他 Microsoft 产品的更新”。</span><br><span class="line"> 有关详细信息，请访问https://aka.ms/wsl2kernel。</span><br><span class="line">Windows 更新已暂停。</span><br><span class="line"></span><br><span class="line">内核版本： <span class="number">5.10</span>.<span class="number">102.1</span></span><br></pre></td></tr></table></figure>
<h3 id="子系统关机">子系统关机</h3>
<p>关闭子系统所在的终端并不会关闭wsl,它会在后台运行,因此下一次打开wsl的时候会发现开启的很快.</p>
<p>在powershell上使用<code>wsl --shutdown</code>就可以关闭所有在后台运行的子系统</p>
<p>如果不想关闭所有后台子系统,只停止其中的某一个,可以<code>wsl --terminate &lt;子系统名&gt;</code></p>
<h2 id="工作目录">工作目录</h2>
<h3 id="windows下wsl的位置">windows下wsl的位置</h3>
<p><code>\\wsl.localhost\kali-linux</code></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> Microsoft.PowerShell.Core\FileSystem::\\wsl.localhost\kali<span class="literal">-linux</span>&gt; <span class="built_in">pwd</span></span><br><span class="line"></span><br><span class="line">Path</span><br><span class="line"><span class="literal">----</span></span><br><span class="line">Microsoft.PowerShell.Core\FileSystem::\\wsl.localhost\kali<span class="literal">-linux</span></span><br></pre></td></tr></table></figure>
<p>这到底是个啥地方呢?前面怎么好长一坨,FileSystem后面还有俩冒号</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\<span class="number">86135</span>&gt; <span class="built_in">cd</span> \\wsl.localhost\kali<span class="literal">-linux</span></span><br><span class="line"><span class="built_in">PS</span> Microsoft.PowerShell.Core\FileSystem::\\wsl.localhost\kali<span class="literal">-linux</span>&gt;</span><br></pre></td></tr></table></figure>
<p>如果在这个目录下面,想使用cd ..退到爹目录,接着说找不到爹目录</p>
<p>实际上可以直接用explorer访问wsl的文件系统</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220716105512580.png"
alt="image-20220716105512580" />
<figcaption aria-hidden="true">image-20220716105512580</figcaption>
</figure>
<h3 id="wsl上windows的位置">wsl上windows的位置</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿Executor)-[/mnt/c/Users/86135/Desktop/pwn]</span><br><span class="line">└─# <span class="built_in">pwd</span></span><br><span class="line">/mnt/c/Users/86135/Desktop/pwn</span><br></pre></td></tr></table></figure>
<p>即windows的根目录在wsl上为<code>/mnt/</code></p>
<p>比如桌面就是<code>/mnt/c/Users/86135/Desktop/</code></p>
<p>D盘就是<code>/mnt/d/</code></p>
<h2 id="共享环境变量">共享环境变量</h2>
<p>在wsl上可以调用windows的环境变量中的应用程序</p>
<p>不同于windows终端的是,wsl上调用win的应用需要.exe后缀</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿Executor)-[~]</span><br><span class="line">└─# ipconfig</span><br><span class="line">-bash: ipconfig: <span class="built_in">command</span> not found</span><br><span class="line"></span><br><span class="line">┌──(root㉿Executor)-[~]</span><br><span class="line">└─# ipconfig.exe</span><br><span class="line"></span><br><span class="line">Windows IP 配置</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">以太网适配器 以太网:</span><br><span class="line"></span><br><span class="line">   媒体状态  . . . . . . . . . . . . : 媒体已断开连接</span><br><span class="line">   ...</span><br></pre></td></tr></table></figure>
<p>也可以用wsl打开主系统中已经添加到环境变量的窗口应用程序</p>
<p>也可以在wsl上调用主系统的cmd,切换到主系统的cmd终端</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿Executor)-[~]</span><br><span class="line">└─# cmd.exe</span><br><span class="line"><span class="string">&#x27;\\wsl.localhost\kali-linux\root&#x27;</span></span><br><span class="line">用作为当前目录的以上路径启动了 CMD.EXE。</span><br><span class="line">UNC 路径不受支持。默认值设为 Windows 目录。</span><br><span class="line">Microsoft Windows [版本 10.0.22000.675]</span><br><span class="line">(c) Microsoft Corporation。保留所有权利。</span><br><span class="line"></span><br><span class="line">C:\Windows&gt;</span><br></pre></td></tr></table></figure>
<p>至于两个系统的终端怎么怎么联系.</p>
<p>这都是茴香豆的n种写法,不会有人闲的让终端之间踢皮球吧</p>
<p>并且还有设置开关这些功能,我寻思多多益善吧,不冲突关他干啥呢</p>
<h2 id="wsl执行linux命令">wsl执行linux命令</h2>
<p>正常情况下,linux上的可执行程序.elf或者.out,在windows上是没法执行的.同理win上的.exe也无法在linux上执行</p>
<p>而wsl就提供了一种在windows上执行linux可执行目标文件的方法</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">用法: wsl.exe [参数] [选项...] [命令行]</span><br><span class="line"></span><br><span class="line">运行 Linux 二进制文件的参数:</span><br><span class="line"></span><br><span class="line">    如果未提供命令行，wsl.exe 将启动默认 shell。</span><br><span class="line"></span><br><span class="line">    --exec, -e &lt;命令行&gt;</span><br><span class="line">        在不使用默认 Linux Shell 的情况下执行指定的命令。</span><br><span class="line"></span><br><span class="line">    --</span><br><span class="line">        按原样传递其余命令行。</span><br></pre></td></tr></table></figure>
<p>比如</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\86135\Desktop\pwn&gt; ls -l</span><br><span class="line">Get-ChildItem : 缺少参数“LiteralPath”的某个参数。请指定一个类型为“System.String[]”的参数，然后再试一次。</span><br><span class="line">所在位置 行:1 字符: 4</span><br><span class="line">+ ls -l</span><br><span class="line">+    ~~</span><br><span class="line">    + CategoryInfo          : InvalidArgument: (:) [Get-ChildItem]，ParameterBindingException</span><br><span class="line">    + FullyQualifiedErrorId : MissingArgument,Microsoft.PowerShell.Commands.GetChildItemCommand</span><br><span class="line"></span><br><span class="line">PS C:\Users\86135\Desktop\pwn&gt; wsl ls -l</span><br><span class="line">total 108</span><br><span class="line">drwxrwxrwx 1 kali kali  4096 Jun  2 19:52 CGfsb</span><br><span class="line">drwxrwxrwx 1 kali kali  4096 May 19 23:14 cgpwn</span><br><span class="line">drwxrwxrwx 1 kali kali  4096 Jun 20 09:55 dice_game</span><br><span class="line">drwxrwxrwx 1 kali kali  4096 Jun 19 23:09 forgot</span><br><span class="line">drwxrwxrwx 1 kali kali  4096 May 11 17:45 get_shell</span><br><span class="line">drwxrwxrwx 1 kali kali  4096 May 20 09:28 guess_num</span><br><span class="line">drwxrwxrwx 1 kali kali  4096 May 11 09:51 hello_pwn</span><br><span class="line">drwxrwxrwx 1 kali kali  4096 May 20 08:45 int_overflow</span><br><span class="line">drwxrwxrwx 1 kali kali  4096 May 11 17:38 level0</span><br><span class="line">drwxrwxrwx 1 kali kali  4096 May 11 21:08 level2</span><br><span class="line">drwxrwxrwx 1 kali kali  4096 Jun  3 16:27 level3</span><br><span class="line">drwxrwxrwx 1 kali kali  4096 Jun 21 10:30 mytest</span><br><span class="line">-rwxrwxrwx 1 kali kali 84286 Jun  3 16:10 pwn.md</span><br><span class="line">drwxrwxrwx 1 kali kali  4096 Jun 19 23:38 reactor</span><br><span class="line">drwxrwxrwx 1 kali kali  4096 Jun 20 00:28 realtime</span><br><span class="line">drwxrwxrwx 1 kali kali  4096 Jun 20 10:06 stack2</span><br><span class="line">drwxrwxrwx 1 kali kali  4096 Jun  3 10:56 string</span><br><span class="line">drwxrwxrwx 1 kali kali  4096 May 29 16:03 testPIE</span><br></pre></td></tr></table></figure>
<p>在输入<code>wsl ls -l</code>命令之后终端等了好长时间去了,推测是启动子系统去了.</p>
<p>估计这个过程就是在子系统上运行了<code>ls -l</code>命令之后,将结果反馈给powershell,然后powershell打印到屏幕上</p>
<h2 id="高级配置">高级配置</h2>
<p>wsl上两个配置文件<code>wsl.conf</code> <code>.wslconfig</code></p>
<p>微软给出的这两个文件的描述</p>
<blockquote>
<p><strong>wsl.conf</strong></p>
<ul>
<li>作为 unix 文件存储在 <code>/etc</code> 分发目录中。</li>
<li>用于按分布配置设置。
在此文件中配置的设置将仅应用于包含存储此文件的目录的特定 Linux
分发版。</li>
<li>可用于版本、WSL 1 或 WSL 2 运行的分发版。</li>
<li>若要访问已安装的发行版的 <code>/etc</code>
目录，请使用发行版的命令行和 <code>cd /</code> 访问根目录，然后使用
<code>ls</code> 列出文件或使用 <code>explorer.exe .</code> 在 Windows
文件资源管理器中查看。 目录路径应如下所示：
<code>/etc/wsl.conf</code></li>
</ul>
<p><strong>.wslconfig</strong></p>
<ul>
<li>存储在 <code>%UserProfile%</code> 目录中。</li>
<li>用于全局配置作为 WSL 2 版本运行的所有已安装 Linux
分发版的设置。</li>
<li>仅适用于 <strong>WSL 2 运行的分发</strong>版。 作为 WSL 1
运行的分发版不会受到此配置的影响，因为它们未作为虚拟机运行。</li>
<li>要访问 <code>%UserProfile%</code> 目录，请在 PowerShell 中使用
<code>cd ~</code> 访问主目录（通常是用户配置文件
<code>C:\Users\&lt;UserName&gt;</code>），或者可以打开 Windows
文件资源管理器并在地址栏中输入 <code>%UserProfile%</code>。
目录路径应如下所示：
<code>C:\Users\&lt;UserName&gt;\.wslconfig</code></li>
</ul>
</blockquote>
<p>这两个文件在默认情况下是不存在的,只有我们需要修改wsl的参数时,才需要在相应位置建立这么一个文件.</p>
<p><code>wsl</code>再启动时就会考虑这些文件里的规定了</p>
<p><code>wsl.conf</code>放在子系统里</p>
<p><code>.wslconfig</code>放在主系统里.</p>
<p>在使用wmware的时候,我们可以自由决定虚拟机占用多大内存,最多使用多少个处理器,这就是<code>.wslconfig</code>的作用</p>
<p>在修改之前,首先在wsl上观察一下处理器数量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿Executor)-[/mnt/c/Users/86135]</span><br><span class="line">└─# <span class="built_in">cat</span> /proc/cpuinfo | grep name | <span class="built_in">cut</span> -f2 -d: | <span class="built_in">uniq</span> -c</span><br><span class="line">     16  11th Gen Intel(R) Core(TM) i7-11800H @ 2.30GHz</span><br></pre></td></tr></table></figure>
<p>wsl显示有16个,现在修改<code>.wslconfig</code>给他改成8个</p>
<p>观察一下总内存大小</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿Executor)-[/mnt/c/Users/86135]</span><br><span class="line">└─# <span class="built_in">cat</span> /proc/meminfo | grep MemTotal</span><br><span class="line">MemTotal:       16262436 kB</span><br></pre></td></tr></table></figure>
<p>现在修改<code>.wslconfig</code>文件,调整上面两个值</p>
<p><code>C:\Users\86135\.wslconfig</code></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Settings apply across all Linux distros running on WSL 2</span></span><br><span class="line">[<span class="type">wsl2</span>]			<span class="comment">#正文第一行必须是[wsl2]这种标记</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Limits VM memory to use no more than 4 GB, this can be set as whole numbers using GB or MB</span></span><br><span class="line">memory=<span class="number">4</span>GB 	<span class="comment">#限制内存最大4G</span></span><br><span class="line">	</span><br><span class="line"><span class="comment"># Sets the VM to use two virtual processors</span></span><br><span class="line">processors=<span class="number">8</span>		<span class="comment">#设置8个处理器</span></span><br></pre></td></tr></table></figure>
<p>调整后保存,子系统重启,再打印观察</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿Executor)-[~]</span><br><span class="line">└─# <span class="built_in">cat</span> /proc/meminfo | grep MemTotal</span><br><span class="line">MemTotal:        4017200 kB</span><br><span class="line"></span><br><span class="line">┌──(root㉿Executor)-[~]</span><br><span class="line">└─# <span class="built_in">cat</span> /proc/cpuinfo | grep name | <span class="built_in">cut</span> -f2 -d: | <span class="built_in">uniq</span> -c</span><br><span class="line">      8  11th Gen Intel(R) Core(TM) i7-11800H @ 2.30GHz</span><br></pre></td></tr></table></figure>
<p>发现刚才的修改确实奏效了</p>
<h2 id="换下载源">换下载源</h2>
<p>首先备份原来的源</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿Executor)-[~]</span><br><span class="line">└─# <span class="built_in">mv</span> /etc/apt/sources.list /etc/apt/sources.list.bak</span><br></pre></td></tr></table></figure>
<p>将该文件修改为阿里云的源</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">deb https://mirrors.aliyun.com/kali kali-rolling main non-free contrib</span><br><span class="line">deb-src https://mirrors.aliyun.com/kali kali-rolling main non-free contrib</span><br></pre></td></tr></table></figure>
<p>修改之后可以<code>apt update</code>看看成功没</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿Executor)-[~]</span><br><span class="line">└─# vim /etc/apt/sources.list</span><br><span class="line"></span><br><span class="line">┌──(root㉿Executor)-[~]</span><br><span class="line">└─# apt update</span><br><span class="line">Get:1 https://mirrors.aliyun.com/kali kali-rolling InRelease [30.6 kB]</span><br><span class="line">Get:2 https://mirrors.aliyun.com/kali kali-rolling/main Sources [14.7 MB]</span><br><span class="line">Get:3 https://mirrors.aliyun.com/kali kali-rolling/non-free Sources [128 kB]</span><br><span class="line">Get:4 https://mirrors.aliyun.com/kali kali-rolling/contrib Sources [73.1 kB]</span><br><span class="line">Get:5 https://mirrors.aliyun.com/kali kali-rolling/main amd64 Packages [18.4 MB]</span><br><span class="line">Get:6 https://mirrors.aliyun.com/kali kali-rolling/non-free amd64 Packages [213 kB]</span><br><span class="line">Get:7 https://mirrors.aliyun.com/kali kali-rolling/contrib amd64 Packages [116 kB]</span><br><span class="line">Fetched 33.6 MB <span class="keyword">in</span> 22s (1,505 kB/s)</span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree... Done</span><br><span class="line">Reading state information... Done</span><br><span class="line">257 packages can be upgraded. Run <span class="string">&#x27;apt list --upgradable&#x27;</span> to see them.</span><br></pre></td></tr></table></figure>
<h2 id="设置代理">设置代理</h2>
<p>找个好地方<code>vim bash_profile</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export http_proxy=http://172.25.144.1:7891/</span><br><span class="line">export https_proxy=http://172.25.144.1:7891/</span><br></pre></td></tr></table></figure>
<p>这里172.25.144.1是我windows本机的wsl网卡地址,这玩意儿可以在<code>/etc/resolv.conf</code>查看</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿Executor)-[/home]</span><br><span class="line">└─# cat /etc/resolv.conf</span><br><span class="line"># This file was automatically generated by WSL. To stop automatic generation of this file, add the following entry to /etc/wsl.conf:</span><br><span class="line"># [network]</span><br><span class="line"># generateResolvConf = false</span><br><span class="line">nameserver 172.25.144.1</span><br></pre></td></tr></table></figure>
<p>端口号为啥是7891呢,因为我本机clash在7891上开的代理端口</p>
<p>注意clash开允许局域网,系统代理</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/picbed/main/image-20240321233234943.png"
alt="image-20240321233234943" />
<figcaption aria-hidden="true">image-20240321233234943</figcaption>
</figure>
<p>写完了bash_profile之后保存退出,然后<code>source bash_profile</code></p>
<p><strong>这样对于本终端就已经更换了代理,重新开机或者打开其他终端都没有此设置</strong></p>
<h2 id="wsl迁移">wsl迁移</h2>
<p>kali-linux迁移前的C卷大小</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220716102545759.png"
alt="image-20220716102545759" />
<figcaption aria-hidden="true">image-20220716102545759</figcaption>
</figure>
<p>由于我想为kali安装一个xfce桌面,KDE桌面很大,又要剥削压迫C卷,于是就像把wsl搬到D卷</p>
<p>先用安装了python3的ubuntu20.04LTS做了一个实验,结果迁移后的ubuntu还是有python3的,这意味着以前的修改都会保留</p>
<p>kali-linux迁移过程:</p>
<h3 id="wsl关机">1.wsl关机</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl --shutdown</span><br></pre></td></tr></table></figure>
<h3 id="选好目的地">2.选好目的地</h3>
<p>我将D:,加一个wsl父目录是因为,同父目录下还有D:,将powershell的当前工作目录调整到D:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> D:\wsl\kali&gt; <span class="built_in">pwd</span></span><br><span class="line"></span><br><span class="line">Path</span><br><span class="line"><span class="literal">----</span></span><br><span class="line">D:\wsl\kali</span><br></pre></td></tr></table></figure>
<h3 id="选择需要导出的子系统">3.选择需要导出的子系统</h3>
<p>使用<code>wsl -l</code>指令列出所有已经注册的子系统名</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> D:\wsl\kali&gt; wsl <span class="literal">-l</span></span><br><span class="line">适用于 Linux 的 Windows 子系统分发版:</span><br><span class="line">kali<span class="literal">-linux</span> (默认)</span><br><span class="line">ubuntu</span><br></pre></td></tr></table></figure>
<h3 id="导出kali-linux.tar">4.导出<code>kali-linux.tar</code></h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl --export &lt;子系统名&gt; &lt;tar包路径&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS D:\wsl\kali&gt; wsl --export kali-linux ./kali.tar</span><br></pre></td></tr></table></figure>
<p>本条命令的意义是,将名为kali-linux的子系统,导出到当前工作目录下的kali.tar中</p>
<h3
id="卸载本来安装在c卷的kali-linux">5.卸载本来安装在C卷的kali-linux</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl --unregister &lt;子系统名&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS D:\wsl\kali&gt; wsl --unregister kali-linux</span><br><span class="line">正在注销...</span><br></pre></td></tr></table></figure>
<h3 id="导入迁移到d卷的kali-linux">6.导入迁移到D卷的kali-linux</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wsl --import &lt;子系统名&gt; &lt;子系统安装路径&gt; &lt;tar包路径&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> D:\wsl\kali&gt; wsl <span class="literal">--import</span> kali<span class="literal">-linux</span> . ./kali.tar</span><br></pre></td></tr></table></figure>
<p>本条命令的意义是,从当前目录的kali.tar包导入子系统到当前目录,子系统名叫kali-linux</p>
<h3 id="验证导出成功">7.验证导出成功</h3>
<p>终端启动kali成功</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220716103913136.png"
alt="image-20220716103913136" />
<figcaption aria-hidden="true">image-20220716103913136</figcaption>
</figure>
<p>虽然迁移kali只给C省出了3G的磁盘空间...</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220716103955718.png"
alt="image-20220716103955718" />
<figcaption aria-hidden="true">image-20220716103955718</figcaption>
</figure>
<p>但是可以放心安装桌面了</p>
<h2 id="安装桌面">安装桌面</h2>
<p>在此之前需要保证wsl升级到wsl2,换下载源到阿里云(如果梯子流量管够忽略)</p>
<h3 id="安装win-kex">安装Win-KeX</h3>
<blockquote>
<p>Win-KeX是windows为kali专门提供的桌面体验,具有以下功能</p>
<ul>
<li>窗口模式：在专用窗口中启动Kali Linux桌面</li>
<li>无缝模式：在Windows和Kali应用程序和菜单之间共享Windows桌面</li>
<li>声音支持</li>
<li>无特权和根会话支持</li>
<li>共享剪贴板，可在Kali Linux和Windows应用之间进行剪切和粘贴支持</li>
<li>多会话支持：根窗口和非私有窗口以及无缝会话同时进行</li>
</ul>
</blockquote>
<p>安装之前先<code>apt update</code>更新一下</p>
<p>之后安装Win-KeX</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install -y kali-win-kex</span><br></pre></td></tr></table></figure>
<p>安装可能很慢...但是速度是百度云盘两倍(比烂是吧)</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220716104931612.png"
alt="image-20220716104931612" />
<figcaption aria-hidden="true">image-20220716104931612</figcaption>
</figure>
<p>安装完成后在kali上使用kex命令,输入一些密码之后,就可以使用xfce桌面了</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220716114030667.png"
alt="image-20220716114030667" />
<figcaption aria-hidden="true">image-20220716114030667</figcaption>
</figure>
<p>在kex中使用F8键可以选择桌面以windows窗口运行还是全屏运行,</p>
<p>全屏时就和真的kali系统没有区别了,所有键鼠命令都会被kali捕获,不会发往windows</p>
<p>F8的fullscreen可以设置窗口或者全屏模式</p>
<h2 id="完整everything">完整everything</h2>
<p>一开始安装的子系统只是最小安装,只安装了一个系统,各种武器都没有安装</p>
<p>kali子系统完整安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install kali-linux-everything</span><br></pre></td></tr></table></figure>
<p>大约有20个G,还是在学校wifi环境下安装吧,使用流量划不来</p>
<h2 id="idawsl远程调试">ida+wsl远程调试</h2>
<p>终于会动态调试了</p>
<p>但是windows上的IDA似乎只能用local windows
debugger,其他的各种各样的设置看了就烦</p>
<p>今天终于不厌其烦试了试IDA+remote linux debugger在ida上调试elf文件</p>
<p>终于调通了</p>
<p>需要ida,wsl</p>
<h3 id="remote-linux-debugger">remote linux debugger</h3>
<p>win11+wsl kali+ida</p>
<p><code>IDA-&lt;version&gt;/dbgsrv/</code>这个目录下面有调试需要使用的文件</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220901163211166.png"
alt="image-20220901163211166" />
<figcaption aria-hidden="true">image-20220901163211166</figcaption>
</figure>
<p>如果要使用linux远程调试elf文件,需要linux_server和linux_server64两个文件,把他俩复制到kali的文件系统中去</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿Executor)-[/home/kali]</span><br><span class="line">└─# ls -l | grep linux</span><br><span class="line">-rwxrwxrwx 1 root root 783792 Jan  1  2021 linux_server</span><br><span class="line">-rwxrwxrwx 1 root root 735376 Jan  1  2021 linux_server64</span><br></pre></td></tr></table></figure>
<p>cd 到该目录下,修改其权限</p>
<p>可以使用--help看linux_server的用法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 linux_server</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿Executor)-[/home/kali]</span><br><span class="line">└─# ./linux_server --help</span><br><span class="line">IDA Linux 32-bit remote debug server(ST) v7.5.26. Hex-Rays (c) 2004-2020</span><br><span class="line">Usage: linux_server [options]</span><br><span class="line">  -p ...  (--port-number ...) Port number</span><br><span class="line">  -i ...  (--ip-address ...) IP address to bind to (default to any)</span><br><span class="line">  -s      (--use-tls) Use TLS</span><br><span class="line">  -c ...  (--certchain-file ...) TLS certificate chain file</span><br><span class="line">  -k ...  (--privkey-file ...) TLS private key file</span><br><span class="line">  -v      (--verbose) Verbose mode</span><br><span class="line">  -P ...  (--password ...) Password</span><br><span class="line">  -k      (--on-broken-connection-keep-session) Keep debugger session alive when connection breaks</span><br><span class="line">  -K      (--on-stop-kill-process) Kill debuggee when closing session</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>执行linux_server</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿Executor)-[/home/kali]</span><br><span class="line">└─# ./linux_server</span><br><span class="line">IDA Linux 32-bit remote debug server(ST) v7.5.26. Hex-Rays (c) 2004-2020</span><br><span class="line">Listening on 0.0.0.0:23946...</span><br></pre></td></tr></table></figure>
<p>此时kali已经在监听其23946端口了</p>
<p>现在用ida打开一个32位elf程序,F9或者点击Debugger下拉菜单,选择调试器Remote
Linux debugger</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220901163954709.png"
alt="image-20220901163954709" />
<figcaption aria-hidden="true">image-20220901163954709</figcaption>
</figure>
<p>然后调试运行(ida默认也是访问远程主机的23946端口,如果不是则这里肯定联不通,ida会让重新设置端口的)</p>
<p>必然会报错找不到输入文件,</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220901164111650.png"
alt="image-20220901164111650" />
<figcaption aria-hidden="true">image-20220901164111650</figcaption>
</figure>
<p>一看报错信息,原来输入文件是从远程linux上找的,当然找不到</p>
<p>OK之后ida提供了替代方案</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220901164214375.png"
alt="image-20220901164214375" />
<figcaption aria-hidden="true">image-20220901164214375</figcaption>
</figure>
<p>点这个Use
found就可以使用本机的<code>C:\Users\86135\Desktop\malloc\main</code>作为输入文件了</p>
<p>但是调试界面刚出来又没了,原来是忘记下断点了</p>
<p>在main函数(或者其他地方)下断点,然后重新调试运行,可以调试了</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220901164532437.png"
alt="image-20220901164532437" />
<figcaption aria-hidden="true">image-20220901164532437</figcaption>
</figure>
<p>甚至可以使用F5反汇编,显然是linux上的光棍儿gdb做不到的</p>
<h3 id="remote-gbd-debugger">remote gbd debugger</h3>
<p>既然linux上也有gdb,那么是不是也可以用远程gdb调试呢?确实能调通,安一个gdbserver剩下的随便拾到拾到就行了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install gdbserver</span><br></pre></td></tr></table></figure>
<p>/usr/src/WSL2-Linux-Kernel-linux-msft-wsl-5.15.137.3/arch/x86/boot/bzImage</p>
<h2 id="编译内核">编译内核</h2>
<p>如果用普通的linux内核直接编译,然后给wsl换这个普通内核,这样wsl起不来</p>
<p>编译wsl内核需要有专门的config文件</p>
<p>内核源码可以用原版的,比如到这里下载<a
target="_blank" rel="noopener" href="https://mirrors.edge.kernel.org/pub/linux/kernel/v5.x/">Index of
/pub/linux/kernel/v5.x/</a></p>
<p>以5.8.13为例,</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://mirrors.edge.kernel.org/pub/linux/kernel/v5.x/linux-5.8.13.tar.gz</span><br><span class="line">tar -xzf linux-5.8.13.tar.gz</span><br><span class="line">cd linux-5.8.13</span><br></pre></td></tr></table></figure>
<p>然后在内核源码的根目录下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir Microsoft</span><br><span class="line">cd Microsoft</span><br><span class="line">vim config-wsl</span><br></pre></td></tr></table></figure>
<p>这玩意儿可以抄<a
target="_blank" rel="noopener" href="https://github.com/xieyubo/WSL2-Linux-Kernel/blob/wsl-xyb-port-5.8.y-latest/Microsoft/config-wsl">WSL2-Linux-Kernel/Microsoft/config-wsl
at wsl-xyb-port-5.8.y-latest · xieyubo/WSL2-Linux-Kernel ·
GitHub</a>,注意版本,5.8的内核就得抄5.8的config_wsl,直接复制粘贴</p>
<p>可以修改其中的<code>CONFIG_LOCALVERSION</code>,改成自定义内核名称后缀</p>
<p>完事之后退到内核源码根目录下</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make KCONIFG_CONFIG=./Microsoft/config-wsl -j`<span class="built_in">nproc</span>`</span><br></pre></td></tr></table></figure>
<p>编译完了之后会生成./arch/x86/boot/bzImage,这就是可以引导的内核</p>
<p>可以安装头文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make modules_install</span><br></pre></td></tr></table></figure>
<h2 id="更换内核">更换内核</h2>
<h3 id="默认配置">默认配置</h3>
<p>如果没有在~/.wslconfig中修改内核位置,那么可以这样整:</p>
<p>编译内核完成后,将生成的bzImage可引导镜像放到本机的<code>C:\Windows\System32\lxss\tools</code>这个位置</p>
<p><code>wsl --shutdown</code></p>
<p>在<code>C:\Windows\System32\lxss\tools</code>中,将之前的内核镜像kernel改个名,比如oldkernel</p>
<p>然后将刚搬过来的bzImage改成kernel</p>
<p>重启wsl</p>
<p><code>uname -a</code>查看当前内核版本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿Executor)-[/home/dustball/kernelROP/mydev]</span><br><span class="line">└─# uname -a</span><br><span class="line">Linux Executor 5.8.13-dustland #1 SMP Sun Mar 24 13:56:15 CST 2024 x86_64 GNU/Linux</span><br></pre></td></tr></table></figure>
<h3 id="指定kernel位置">指定kernel位置</h3>
<p>比如在windows的<code>~/.wslconfig</code>中这样写</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Settings apply across all Linux distros running on WSL 2</span></span><br><span class="line">[wsl2]</span><br><span class="line">kernel=C:\\opt\\kernel</span><br><span class="line"><span class="comment"># Limits VM memory to use no more than 4 GB, this can be set as whole numbers using GB or MB</span></span><br><span class="line">memory=4GB      <span class="comment">#限制内存最大4G</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Sets the VM to use two virtual processors</span></span><br><span class="line">processors=8            <span class="comment">#设置8个处理器</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># vmSwitch=vEthernet</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># networkingMode=bridged</span></span><br><span class="line"><span class="comment"># vmSwitch=WSL</span></span><br><span class="line"><span class="comment"># ipv6=true</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>这就指定了wsl内核使用<code>c:\\opt\\kernel</code></p>
<h2 id="编译内核模块">编译内核模块</h2>
<p>需要更滑内核</p>
<p>编译内核模块需要内核头文件,</p>
<p>如果已经编译过wsl内核,并且<code>make modules_install &amp;&amp; make install</code>,那么就可以直接编译内核模块了</p>
<p>如果没有编译过内核,需要先编译内核</p>
<p>假设内核模块hello.c这样写</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hello.c</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/init.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/kernel.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/moduleparam.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">MODULE_LICENSE(<span class="string">&quot;GPL&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> __init <span class="title function_">mod_init</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    printk(KERN_ALERT <span class="string">&quot;Hello world\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> __exit <span class="title function_">mod_exit</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    printk(KERN_ALERT <span class="string">&quot;Goodbye\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module_init(mod_init);</span><br><span class="line">module_exit(mod_exit);</span><br></pre></td></tr></table></figure>
<p>它的Makefile这样写</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Makefile</span></span><br><span class="line">KDIR = /lib/modules/5.15.137.3/</span><br><span class="line">TARGETNAME = hello</span><br><span class="line">OBJ        = <span class="variable">$(TARGETNAME)</span>.o</span><br><span class="line">MODULE     = <span class="variable">$(TARGETNAME)</span>.ko</span><br><span class="line">obj-m += <span class="variable">$(OBJ)</span></span><br><span class="line"></span><br><span class="line"><span class="section">all:</span></span><br><span class="line">		make -j <span class="variable">$(nproc)</span> -C <span class="variable">$(KDIR)</span>/build M=<span class="variable">$(PWD)</span> modules</span><br><span class="line"></span><br><span class="line"><span class="section">install:</span></span><br><span class="line">		@modprobe -r <span class="variable">$(TARGETNAME)</span></span><br><span class="line">		@install <span class="variable">$(MODULE)</span> <span class="variable">$(KDIR)</span>3/kernel/drivers/hid</span><br><span class="line">		@depmod</span><br><span class="line">		@modprobe <span class="variable">$(TARGETNAME)</span></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">		make -C <span class="variable">$(KDIR)</span>/build M=<span class="variable">$(PWD)</span> clean</span><br></pre></td></tr></table></figure>
<p>KDIR这个自己写,通常是<code>/lib/modules/$(shell uname -r)</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure>
<p>之后在当前目录下生成hello.ko</p>
<p>加载到内核</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insmod hello.ko</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/linux/" rel="tag"># linux</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/06/20/xctf-pwn-%E9%AB%98%E6%89%8B%E6%9D%91/" rel="prev" title="xctf攻防世界-pwn-高手村">
      <i class="fa fa-chevron-left"></i> xctf攻防世界-pwn-高手村
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/07/07/%E8%B0%83%E8%AF%95/" rel="next" title="binarybook-chapter1-调试">
      binarybook-chapter1-调试 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#wsl2"><span class="nav-number">1.</span> <span class="nav-text">WSL2</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E5%8D%B8%E8%BD%BDwsl"><span class="nav-number">1.1.</span> <span class="nav-text">安装&#x2F;卸载wsl</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85wsl"><span class="nav-number">1.1.1.</span> <span class="nav-text">安装wsl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%B8%E8%BD%BD%E5%AD%90%E7%B3%BB%E7%BB%9F"><span class="nav-number">1.1.2.</span> <span class="nav-text">卸载子系统</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%94%A4%E9%86%92%E5%85%B3%E9%97%ADwsl"><span class="nav-number">1.2.</span> <span class="nav-text">唤醒&#x2F;关闭wsl</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%89%E6%8B%A9%E5%94%A4%E9%86%92%E5%93%AA%E4%B8%80%E4%B8%AA%E5%AD%90%E7%B3%BB%E7%BB%9F"><span class="nav-number">1.2.1.</span> <span class="nav-text">选择唤醒哪一个子系统</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%89%E6%8B%A9%E7%99%BB%E5%BD%95%E7%94%A8%E6%88%B7"><span class="nav-number">1.2.2.</span> <span class="nav-text">选择登录用户</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E9%BB%98%E8%AE%A4%E7%99%BB%E5%BD%95%E7%94%A8%E6%88%B7"><span class="nav-number">1.2.3.</span> <span class="nav-text">设置默认登录用户</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E5%AD%90%E7%B3%BB%E7%BB%9F%E5%86%85%E6%A0%B8%E7%89%88%E6%9C%ACwsl---status"><span class="nav-number">1.2.4.</span> <span class="nav-text">查看子系统内核版本wsl --status</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%90%E7%B3%BB%E7%BB%9F%E5%85%B3%E6%9C%BA"><span class="nav-number">1.2.5.</span> <span class="nav-text">子系统关机</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E7%9B%AE%E5%BD%95"><span class="nav-number">1.3.</span> <span class="nav-text">工作目录</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#windows%E4%B8%8Bwsl%E7%9A%84%E4%BD%8D%E7%BD%AE"><span class="nav-number">1.3.1.</span> <span class="nav-text">windows下wsl的位置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#wsl%E4%B8%8Awindows%E7%9A%84%E4%BD%8D%E7%BD%AE"><span class="nav-number">1.3.2.</span> <span class="nav-text">wsl上windows的位置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B1%E4%BA%AB%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="nav-number">1.4.</span> <span class="nav-text">共享环境变量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#wsl%E6%89%A7%E8%A1%8Clinux%E5%91%BD%E4%BB%A4"><span class="nav-number">1.5.</span> <span class="nav-text">wsl执行linux命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE"><span class="nav-number">1.6.</span> <span class="nav-text">高级配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8D%A2%E4%B8%8B%E8%BD%BD%E6%BA%90"><span class="nav-number">1.7.</span> <span class="nav-text">换下载源</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86"><span class="nav-number">1.8.</span> <span class="nav-text">设置代理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#wsl%E8%BF%81%E7%A7%BB"><span class="nav-number">1.9.</span> <span class="nav-text">wsl迁移</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#wsl%E5%85%B3%E6%9C%BA"><span class="nav-number">1.9.1.</span> <span class="nav-text">1.wsl关机</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%89%E5%A5%BD%E7%9B%AE%E7%9A%84%E5%9C%B0"><span class="nav-number">1.9.2.</span> <span class="nav-text">2.选好目的地</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%89%E6%8B%A9%E9%9C%80%E8%A6%81%E5%AF%BC%E5%87%BA%E7%9A%84%E5%AD%90%E7%B3%BB%E7%BB%9F"><span class="nav-number">1.9.3.</span> <span class="nav-text">3.选择需要导出的子系统</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%BC%E5%87%BAkali-linux.tar"><span class="nav-number">1.9.4.</span> <span class="nav-text">4.导出kali-linux.tar</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%B8%E8%BD%BD%E6%9C%AC%E6%9D%A5%E5%AE%89%E8%A3%85%E5%9C%A8c%E5%8D%B7%E7%9A%84kali-linux"><span class="nav-number">1.9.5.</span> <span class="nav-text">5.卸载本来安装在C卷的kali-linux</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%BC%E5%85%A5%E8%BF%81%E7%A7%BB%E5%88%B0d%E5%8D%B7%E7%9A%84kali-linux"><span class="nav-number">1.9.6.</span> <span class="nav-text">6.导入迁移到D卷的kali-linux</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81%E5%AF%BC%E5%87%BA%E6%88%90%E5%8A%9F"><span class="nav-number">1.9.7.</span> <span class="nav-text">7.验证导出成功</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E6%A1%8C%E9%9D%A2"><span class="nav-number">1.10.</span> <span class="nav-text">安装桌面</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85win-kex"><span class="nav-number">1.10.1.</span> <span class="nav-text">安装Win-KeX</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%8C%E6%95%B4everything"><span class="nav-number">1.11.</span> <span class="nav-text">完整everything</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#idawsl%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95"><span class="nav-number">1.12.</span> <span class="nav-text">ida+wsl远程调试</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#remote-linux-debugger"><span class="nav-number">1.12.1.</span> <span class="nav-text">remote linux debugger</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#remote-gbd-debugger"><span class="nav-number">1.12.2.</span> <span class="nav-text">remote gbd debugger</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BC%96%E8%AF%91%E5%86%85%E6%A0%B8"><span class="nav-number">1.13.</span> <span class="nav-text">编译内核</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9B%B4%E6%8D%A2%E5%86%85%E6%A0%B8"><span class="nav-number">1.14.</span> <span class="nav-text">更换内核</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE"><span class="nav-number">1.14.1.</span> <span class="nav-text">默认配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%87%E5%AE%9Akernel%E4%BD%8D%E7%BD%AE"><span class="nav-number">1.14.2.</span> <span class="nav-text">指定kernel位置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BC%96%E8%AF%91%E5%86%85%E6%A0%B8%E6%A8%A1%E5%9D%97"><span class="nav-number">1.15.</span> <span class="nav-text">编译内核模块</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="dustball"
      src="https://raw.githubusercontent.com/DeutschBall/picbed/main/dustball.png">
  <p class="site-author-name" itemprop="name">dustball</p>
  <div class="site-description" itemprop="description">dustland</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">78</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">30</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">dustball</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        
<div class="busuanzi-count">
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/pjax/pjax.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  
  <script data-pjax>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>




  
<script src="/js/local-search.js"></script>











<script data-pjax>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'dark',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


    <div id="pjax">
  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
          load: ['[tex]/mhchem'],
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
          packages: {'[+]': ['mhchem']},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

    </div>
</body>
</html>
