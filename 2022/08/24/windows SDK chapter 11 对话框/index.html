<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Cascadia Code:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"deutschball.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"万一找到了呢","hits_empty":"你说的 ${query} 我怎么找不着呢 ","hits_stats":"找到了 ${hits} 个结果，用时 ${time} 毫秒"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":-1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="windows SDK chapter 11 对话框 模态对话框 模态对话框指对话框存在时不能操作父窗口,必须关闭模态对话框才能和父窗口进行交互 如果是普通的模态对话框,此时还可以到其他应用程序. 如果是系统的模态对话框,则整个操作系统都会被这一个模态对话框锁住,必须关了系统模态对话框才可以干别的 因为父窗口过程直接将控制转移给了对话框函数,啥时候对话框函数返回即对话框关闭,控制才能还">
<meta property="og:type" content="article">
<meta property="og:title" content="win32程序设计-chapter11 对话框">
<meta property="og:url" content="http://deutschball.github.io/2022/08/24/windows%20SDK%20chapter%2011%20%E5%AF%B9%E8%AF%9D%E6%A1%86/index.html">
<meta property="og:site_name" content="dustland">
<meta property="og:description" content="windows SDK chapter 11 对话框 模态对话框 模态对话框指对话框存在时不能操作父窗口,必须关闭模态对话框才能和父窗口进行交互 如果是普通的模态对话框,此时还可以到其他应用程序. 如果是系统的模态对话框,则整个操作系统都会被这一个模态对话框锁住,必须关了系统模态对话框才可以干别的 因为父窗口过程直接将控制转移给了对话框函数,啥时候对话框函数返回即对话框关闭,控制才能还">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-08-24T09:00:00.000Z">
<meta property="article:modified_time" content="2022-08-24T09:54:27.801Z">
<meta property="article:author" content="dustball">
<meta property="article:tag" content="windows程序设计">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://deutschball.github.io/2022/08/24/windows%20SDK%20chapter%2011%20%E5%AF%B9%E8%AF%9D%E6%A1%86/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>win32程序设计-chapter11 对话框 | dustland</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">dustland</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">dustball in dustland</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container"></div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="algolia-results">
  <div id="algolia-stats"></div>
  <div id="algolia-hits"></div>
  <div id="algolia-pagination" class="algolia-pagination"></div>
</div>

      
    </div>
  </div>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/deutschball" class="github-corner" title="Follow me on GayHub" aria-label="Follow me on GayHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://deutschball.github.io/2022/08/24/windows%20SDK%20chapter%2011%20%E5%AF%B9%E8%AF%9D%E6%A1%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/DeutschBall/picbed/main/dustball.png">
      <meta itemprop="name" content="dustball">
      <meta itemprop="description" content="dustland">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dustland">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          win32程序设计-chapter11 对话框
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-08-24 17:00:00 / Modified: 17:54:27" itemprop="dateCreated datePublished" datetime="2022-08-24T17:00:00+08:00">2022-08-24</time>
            </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="windows-sdk-chapter-11-对话框">windows SDK chapter 11
对话框</h1>
<h2 id="模态对话框">模态对话框</h2>
<p>模态对话框指对话框存在时不能操作父窗口,必须关闭模态对话框才能和父窗口进行交互</p>
<p>如果是普通的模态对话框,此时还可以到其他应用程序.</p>
<p>如果是系统的模态对话框,则整个操作系统都会被这一个模态对话框锁住,必须关了系统模态对话框才可以干别的</p>
<p>因为父窗口过程直接将控制转移给了对话框函数,啥时候对话框函数返回即对话框关闭,控制才能还给父窗口</p>
<h3 id="about1">About1</h3>
<p>主窗口过程WndProc在处理菜单消息时有一个创建对话框的情况,即点选ID_APP_ABOUT对应的菜单</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> WM_COMMAND :</span><br><span class="line">     <span class="keyword">switch</span> (LOWORD (wParam))</span><br><span class="line">     &#123;</span><br><span class="line">     <span class="keyword">case</span> IDM_APP_ABOUT :</span><br><span class="line">          DialogBox (hInstance, TEXT (<span class="string">&quot;AboutBox&quot;</span>), hwnd, AboutDlgProc) ;<span class="comment">//创建对话框,使用AboutBox资源</span></span><br><span class="line">          <span class="keyword">break</span> ;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> <span class="number">0</span> ;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">DialogBoxA</span><span class="params">(</span></span><br><span class="line"><span class="params">  [in, optional]  hInstance,<span class="comment">//exe句柄</span></span></span><br><span class="line"><span class="params">  [in]            lpTemplate,<span class="comment">//对话框模板,可以加载资源</span></span></span><br><span class="line"><span class="params">  [in, optional]  hWndParent,<span class="comment">//父窗口句柄</span></span></span><br><span class="line"><span class="params">  [in, optional]  lpDialogFunc<span class="comment">//对话框过程函数</span></span></span><br><span class="line"><span class="params">)</span>;</span><br></pre></td></tr></table></figure>
<p>该函数会一直等到lpDialogFunc回调函数中调用EndDialog才会结束执行,将控制还给WndProc,</p>
<p>这意味在对话框起来之后,主窗口啥也干不了,除非把对话框扬了.</p>
<p>创建对话框的过程:</p>
<blockquote>
<p>DialogBox宏用<a
target="_blank" rel="noopener" href="https://baike.baidu.com/item/CreateWindowEx/6376090">CreateWindowEx</a>函数创建对话框。DialogBox函数然后把一个<a
target="_blank" rel="noopener" href="https://baike.baidu.com/item/WM_INITDIALOG/1904851">WM_INITDIALOG</a>消息（和一个WM_SETFONT消息，如果模板指定DS_SETFONT类型）传递到对话框过程。不管模板是否指定WS_VISIBLE类型，函数显示对话框，并且使拥有该对话框的窗口（也称属主窗口）失效，且为对话框启动它本身的<a
target="_blank" rel="noopener" href="https://baike.baidu.com/item/消息循环">消息循环</a>来检索和传递消息。</p>
<p>当对话框应用程序调用<a
target="_blank" rel="noopener" href="https://baike.baidu.com/item/EndDialog/6370746">EndDialog</a>函数时，DialogBox函数清除对话框户止消息循环，使属主窗口生效（如果以前有效），且返回函数EndDialog调用中的nReSUlt参数。</p>
</blockquote>
<p>对话框过程</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">BOOL CALLBACK <span class="title function_">AboutDlgProc</span> <span class="params">(HWND hDlg, UINT message, </span></span><br><span class="line"><span class="params">                            WPARAM wParam, LPARAM lParam)</span><span class="comment">//hDlg持有自己的对话框句柄</span></span><br><span class="line">&#123;</span><br><span class="line">     <span class="keyword">switch</span> (message)</span><br><span class="line">     &#123;</span><br><span class="line">     <span class="keyword">case</span> WM_INITDIALOG :</span><br><span class="line">          <span class="keyword">return</span> TRUE ;</span><br><span class="line">          </span><br><span class="line">     <span class="keyword">case</span> WM_COMMAND :</span><br><span class="line">          <span class="keyword">switch</span> (LOWORD (wParam))</span><br><span class="line">          &#123;</span><br><span class="line">          <span class="keyword">case</span> IDOK :</span><br><span class="line">          <span class="keyword">case</span> IDCANCEL :<span class="comment">//然而该对话框没有取消按钮,只有一个OK按钮,可以使用Esc键触发IDCANCLE</span></span><br><span class="line">               EndDialog (hDlg, <span class="number">0</span>) ;<span class="comment">//结束对话框</span></span><br><span class="line">               <span class="keyword">return</span> TRUE ;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">break</span> ;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> FALSE ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">BOOL <span class="title function_">EndDialog</span><span class="params">(</span></span><br><span class="line"><span class="params">  [in] HWND    hDlg,<span class="comment">//需要结束的对话框句柄</span></span></span><br><span class="line"><span class="params">  [in] INT_PTR nResult<span class="comment">//返回值,主窗口可以根据该值与对话框进行交互</span></span></span><br><span class="line"><span class="params">)</span>;</span><br></pre></td></tr></table></figure>
<p>使用DialogBox创建的对话框必须使用EndDialog制死</p>
<p>EndDialog函数是在对话框窗口过程中调用的,并且只能用于结束对话框过程</p>
<p>EndDialog中指定的返回值就是DialogBox函数的返回值</p>
<h4 id="设计对话框">设计对话框</h4>
<p>visual studio添加对话框资源,可以交互式设计对话框</p>
<p>rc文件中</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ABOUTBOX DIALOGEX <span class="number">32</span>, <span class="number">32</span>, <span class="number">180</span>, <span class="number">102</span>		<span class="comment">//名字(用于索引该对话框) 对话框类型 左上角横坐标,左上角纵坐标,宽度,高度</span></span><br><span class="line">STYLE DS_SETFONT | WS_POPUP | WS_THICKFRAME		<span class="comment">//风格	对话框有字,弹出,薄框架</span></span><br><span class="line">FONT <span class="number">8</span>, <span class="string">&quot;MS Sans Serif&quot;</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0x0</span>	<span class="comment">//字号8	字体	,balabala</span></span><br><span class="line">BEGIN	<span class="comment">//对话框主题开始</span></span><br><span class="line">    DEFPUSHBUTTON   <span class="string">&quot;OK&quot;</span>,IDOK,<span class="number">66</span>,<span class="number">81</span>,<span class="number">50</span>,<span class="number">14</span>	<span class="comment">//一个默认按钮,ID是IDOK,上有字样&quot;OK&quot; 左上角(66,81) 宽50,高14</span></span><br><span class="line">    ICON            <span class="string">&quot;ABOUT1&quot;</span>,IDC_STATIC,<span class="number">7</span>,<span class="number">7</span>,<span class="number">20</span>,<span class="number">20</span>	<span class="comment">//图标,名称&quot;ABOUT1&quot; ID是IDC_STATIC,左上角(7,7),宽高20(对于ICON来说该宽高无意义)</span></span><br><span class="line">    CTEXT           <span class="string">&quot;dialog&quot;</span>,IDC_STATIC,<span class="number">40</span>,<span class="number">12</span>,<span class="number">100</span>,<span class="number">8</span>	<span class="comment">//文字</span></span><br><span class="line">    CTEXT           <span class="string">&quot;dustball&quot;</span>,IDC_STATIC,<span class="number">7</span>,<span class="number">40</span>,<span class="number">166</span>,<span class="number">8</span></span><br><span class="line">    CTEXT           <span class="string">&quot;(c) dustball, 2022&quot;</span>,IDC_STATIC,<span class="number">7</span>,<span class="number">52</span>,<span class="number">166</span>,<span class="number">8</span></span><br><span class="line">END		<span class="comment">//对话框主题结束</span></span><br></pre></td></tr></table></figure>
<p>这里所有数值的单位都不是像素,而是对话框所用字体的宽的四分之一高的八分之一,具体怎么算的不重要,交互式设计不需要闷头算他娘的</p>
<p>BEGIN和END之间是对话框子窗口控件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">控件类型 &quot;文本&quot;,id,左坐标,上坐标,宽度,高度,控件风格</span><br></pre></td></tr></table></figure>
<p>控件风格比如WS_CHILD,SS_CENTER,WS_VISIBLE</p>
<h4 id="对话框过程">对话框过程</h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BOOL CALLBACK <span class="title function_">AboutDlgProc</span> <span class="params">(HWND hDlg, UINT message,WPARAM wParam, LPARAM lParam)</span>;</span><br></pre></td></tr></table></figure>
<p>一个返回真假的回调函数,有四个参数,对话框句柄,消息,w参和l参</p>
<p>对比窗口过程和对话框过程</p>
<table>
<colgroup>
<col style="width: 12%" />
<col style="width: 57%" />
<col style="width: 29%" />
</colgroup>
<thead>
<tr>
<th></th>
<th>对话框过程</th>
<th>窗口过程</th>
</tr>
</thead>
<tbody>
<tr>
<td>返回值</td>
<td>BOOL</td>
<td>LRESULT</td>
</tr>
<tr>
<td>DefWindowProc</td>
<td>不会调用,只会返回TRUE</td>
<td>处理不了的消息调用DefWindowProc</td>
</tr>
<tr>
<td>处理消息</td>
<td>不需要处理WM_PAINT,WM_DESTORY<br />不会收到WM_CREATE,<br />有专门消息WM_INITDIALOG<br />只需要处理WM_COMMAND</td>
<td></td>
</tr>
</tbody>
</table>
<p>当对话框中按下按钮时,这个按钮回向它的父窗口,也就是这个对话框,发送WM_COMMAND消息,wParam是控件ID</p>
<h3 id="about2">About2</h3>
<h4 id="资源脚本">资源脚本</h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">ABOUTBOX DIALOG DISCARDABLE  <span class="number">32</span>, <span class="number">32</span>, <span class="number">200</span>, <span class="number">234</span>	<span class="comment">//名叫ABOUTBOX</span></span><br><span class="line">STYLE DS_MODALFRAME | WS_POPUP | WS_CAPTION</span><br><span class="line">FONT <span class="number">8</span>, <span class="string">&quot;MS Sans Serif&quot;</span></span><br><span class="line">BEGIN</span><br><span class="line">    ICON            <span class="string">&quot;ABOUT2&quot;</span>,IDC_STATIC,<span class="number">7</span>,<span class="number">7</span>,<span class="number">20</span>,<span class="number">20</span></span><br><span class="line">    CTEXT           <span class="string">&quot;About2&quot;</span>,IDC_STATIC,<span class="number">57</span>,<span class="number">12</span>,<span class="number">86</span>,<span class="number">8</span></span><br><span class="line">    CTEXT           <span class="string">&quot;About Box Demo Program&quot;</span>,IDC_STATIC,<span class="number">7</span>,<span class="number">40</span>,<span class="number">186</span>,<span class="number">8</span></span><br><span class="line">    LTEXT           <span class="string">&quot;&quot;</span>,IDC_PAINT,<span class="number">114</span>,<span class="number">67</span>,<span class="number">72</span>,<span class="number">72</span>			<span class="comment">//预览块</span></span><br><span class="line">    GROUPBOX        <span class="string">&quot;&amp;Color&quot;</span>,IDC_STATIC,<span class="number">7</span>,<span class="number">60</span>,<span class="number">84</span>,<span class="number">143</span></span><br><span class="line">    RADIOBUTTON     <span class="string">&quot;&amp;Black&quot;</span>,IDC_BLACK,<span class="number">16</span>,<span class="number">76</span>,<span class="number">64</span>,<span class="number">8</span>,WS_GROUP | WS_TABSTOP<span class="comment">//单选组开始,tab键停留位置,使用tab键可以更换当前对话框内的焦点.同一组内按钮可以使用上下左右键调整选择</span></span><br><span class="line">    RADIOBUTTON     <span class="string">&quot;B&amp;lue&quot;</span>,IDC_BLUE,<span class="number">16</span>,<span class="number">92</span>,<span class="number">64</span>,<span class="number">8</span></span><br><span class="line">    RADIOBUTTON     <span class="string">&quot;&amp;Green&quot;</span>,IDC_GREEN,<span class="number">16</span>,<span class="number">108</span>,<span class="number">64</span>,<span class="number">8</span></span><br><span class="line">    RADIOBUTTON     <span class="string">&quot;Cya&amp;n&quot;</span>,IDC_CYAN,<span class="number">16</span>,<span class="number">124</span>,<span class="number">64</span>,<span class="number">8</span></span><br><span class="line">    RADIOBUTTON     <span class="string">&quot;&amp;Red&quot;</span>,IDC_RED,<span class="number">16</span>,<span class="number">140</span>,<span class="number">64</span>,<span class="number">8</span></span><br><span class="line">    RADIOBUTTON     <span class="string">&quot;&amp;Magenta&quot;</span>,IDC_MAGENTA,<span class="number">16</span>,<span class="number">156</span>,<span class="number">64</span>,<span class="number">8</span></span><br><span class="line">    RADIOBUTTON     <span class="string">&quot;&amp;Yellow&quot;</span>,IDC_YELLOW,<span class="number">16</span>,<span class="number">172</span>,<span class="number">64</span>,<span class="number">8</span></span><br><span class="line">    RADIOBUTTON     <span class="string">&quot;&amp;White&quot;</span>,IDC_WHITE,<span class="number">16</span>,<span class="number">188</span>,<span class="number">64</span>,<span class="number">8</span></span><br><span class="line">    GROUPBOX        <span class="string">&quot;&amp;Figure&quot;</span>,IDC_STATIC,<span class="number">109</span>,<span class="number">156</span>,<span class="number">84</span>,<span class="number">46</span>,WS_GROUP</span><br><span class="line">    RADIOBUTTON     <span class="string">&quot;Rec&amp;tangle&quot;</span>,IDC_RECT,<span class="number">116</span>,<span class="number">172</span>,<span class="number">65</span>,<span class="number">8</span>,WS_GROUP | WS_TABSTOP</span><br><span class="line">    RADIOBUTTON     <span class="string">&quot;&amp;Ellipse&quot;</span>,IDC_ELLIPSE,<span class="number">116</span>,<span class="number">188</span>,<span class="number">64</span>,<span class="number">8</span></span><br><span class="line">    DEFPUSHBUTTON   <span class="string">&quot;OK&quot;</span>,IDOK,<span class="number">35</span>,<span class="number">212</span>,<span class="number">50</span>,<span class="number">14</span>,WS_GROUP</span><br><span class="line">    PUSHBUTTON      <span class="string">&quot;Cancel&quot;</span>,IDCANCEL,<span class="number">113</span>,<span class="number">212</span>,<span class="number">50</span>,<span class="number">14</span>,WS_GROUP</span><br><span class="line">END</span><br></pre></td></tr></table></figure>
<h4 id="全局变量">全局变量</h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> iCurrentColor = IDC_BLACK;  <span class="comment">//当前颜色</span></span><br><span class="line"><span class="type">int</span>    iCurrentFigure = IDC_RECT ;<span class="comment">//当前形状</span></span><br></pre></td></tr></table></figure>
<p>这两个变量决定着预览框和主窗口如何绘制.</p>
<p>通过对话框修改</p>
<h4 id="父窗口过程">父窗口过程</h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">LRESULT CALLBACK <span class="title function_">WndProc</span> <span class="params">(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)</span></span><br><span class="line">&#123;</span><br><span class="line">     <span class="type">static</span> HINSTANCE hInstance ;</span><br><span class="line">     PAINTSTRUCT      ps ;</span><br><span class="line">     </span><br><span class="line">     <span class="keyword">switch</span> (message)</span><br><span class="line">     &#123;</span><br><span class="line">     <span class="keyword">case</span> WM_CREATE:</span><br><span class="line">          hInstance = ((LPCREATESTRUCT) lParam)-&gt;hInstance ;</span><br><span class="line">          <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">          </span><br><span class="line">     <span class="keyword">case</span> WM_COMMAND:</span><br><span class="line">          <span class="keyword">switch</span> (LOWORD (wParam))</span><br><span class="line">          &#123;</span><br><span class="line">          <span class="keyword">case</span> IDM_APP_ABOUT:</span><br><span class="line">               <span class="keyword">if</span> (DialogBox (hInstance, TEXT (<span class="string">&quot;AboutBox&quot;</span>), hwnd, AboutDlgProc))</span><br><span class="line">                    InvalidateRect (hwnd, <span class="literal">NULL</span>, TRUE) ;</span><br><span class="line">               <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">break</span> ;</span><br><span class="line">          </span><br><span class="line">     <span class="keyword">case</span> WM_PAINT:</span><br><span class="line">          BeginPaint (hwnd, &amp;ps) ;</span><br><span class="line">          EndPaint (hwnd, &amp;ps) ;</span><br><span class="line">               </span><br><span class="line">          PaintWindow (hwnd, iCurrentColor, iCurrentFigure) ;</span><br><span class="line">          <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">               </span><br><span class="line">     <span class="keyword">case</span> WM_DESTROY:</span><br><span class="line">          PostQuitMessage (<span class="number">0</span>) ;</span><br><span class="line">          <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> DefWindowProc (hwnd, message, wParam, lParam) ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="paintwindow">PaintWindow</h4>
<p>使用iColor颜色和iFigure形状绘制hwnd指向的窗口</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">PaintWindow</span> <span class="params">(HWND hwnd, <span class="type">int</span> iColor, <span class="type">int</span> iFigure)</span><span class="comment">//根据指定颜色和形状绘制窗口</span></span><br><span class="line">&#123;</span><br><span class="line">     <span class="type">static</span> COLORREF crColor[<span class="number">8</span>] = &#123; RGB (  <span class="number">0</span>,   <span class="number">0</span>, <span class="number">0</span>), RGB (  <span class="number">0</span>,   <span class="number">0</span>, <span class="number">255</span>),</span><br><span class="line">                                    RGB (  <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>), RGB (  <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>),</span><br><span class="line">                                    RGB (<span class="number">255</span>,   <span class="number">0</span>, <span class="number">0</span>), RGB (<span class="number">255</span>,   <span class="number">0</span>, <span class="number">255</span>),</span><br><span class="line">                                    RGB (<span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>), RGB (<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>) &#125; ;<span class="comment">//颜色列表</span></span><br><span class="line"></span><br><span class="line">     HBRUSH          hBrush ;</span><br><span class="line">     HDC             hdc ;</span><br><span class="line">     RECT            rect ;</span><br><span class="line">     </span><br><span class="line">     hdc = GetDC (hwnd) ;</span><br><span class="line">     GetClientRect (hwnd, &amp;rect) ;</span><br><span class="line">     hBrush = CreateSolidBrush (crColor[iColor - IDC_BLACK]) ;<span class="comment">//iColor是当前正在使用的颜色</span></span><br><span class="line">     hBrush = (HBRUSH) SelectObject (hdc, hBrush) ;</span><br><span class="line">     </span><br><span class="line">     <span class="keyword">if</span> (iFigure == IDC_RECT)<span class="comment">//绘制矩形</span></span><br><span class="line">          Rectangle (hdc, rect.left, rect.top, rect.right, rect.bottom) ;</span><br><span class="line">     <span class="keyword">else</span><span class="comment">//绘制扁瓜蛋</span></span><br><span class="line">          Ellipse   (hdc, rect.left, rect.top, rect.right, rect.bottom) ;</span><br><span class="line">     </span><br><span class="line">     DeleteObject (SelectObject (hdc, hBrush)) ;</span><br><span class="line">     ReleaseDC (hwnd, hdc) ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="对话框过程-1">对话框过程</h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">BOOL CALLBACK <span class="title function_">AboutDlgProc</span> <span class="params">(HWND hDlg, UINT message, </span></span><br><span class="line"><span class="params">                            WPARAM wParam, LPARAM lParam)</span></span><br><span class="line">&#123;</span><br><span class="line">     <span class="type">static</span> HWND hCtrlBlock ;<span class="comment">//预览块句柄</span></span><br><span class="line">     <span class="type">static</span> <span class="type">int</span>  iColor, iFigure ;</span><br><span class="line">     </span><br><span class="line">     <span class="keyword">switch</span> (message)</span><br><span class="line">     &#123;</span><br><span class="line">     <span class="keyword">case</span> WM_INITDIALOG:</span><br><span class="line">          iColor  = iCurrentColor ;<span class="comment">//获取当前颜色</span></span><br><span class="line">          iFigure = iCurrentFigure ;</span><br><span class="line">          </span><br><span class="line">          CheckRadioButton (hDlg, IDC_BLACK, IDC_WHITE,   iColor) ;<span class="comment">//第一个颜色和最后一个颜色,其间的宏定义都算,这一些选项中有且只有一个处于被选中状态</span></span><br><span class="line">          CheckRadioButton (hDlg, IDC_RECT,  IDC_ELLIPSE, iFigure) ;</span><br><span class="line">          </span><br><span class="line">          hCtrlBlock = GetDlgItem (hDlg, IDC_PAINT) ;<span class="comment">//获取预览块句柄</span></span><br><span class="line">          </span><br><span class="line">          SetFocus (GetDlgItem (hDlg, iColor)) ;<span class="comment">//iColor就是选中颜色按钮的句柄,将焦点让给该按钮</span></span><br><span class="line">          <span class="keyword">return</span> FALSE ;</span><br><span class="line">          </span><br><span class="line">     <span class="keyword">case</span> WM_COMMAND:</span><br><span class="line">          <span class="keyword">switch</span> (LOWORD (wParam))</span><br><span class="line">          &#123;</span><br><span class="line">          <span class="keyword">case</span> IDOK:<span class="comment">//点选了确认键,需要修改设置了</span></span><br><span class="line">               iCurrentColor  = iColor ;</span><br><span class="line">               iCurrentFigure = iFigure ;<span class="comment">//修改当前设置</span></span><br><span class="line">               EndDialog (hDlg, TRUE) ;</span><br><span class="line">               <span class="keyword">return</span> TRUE ;</span><br><span class="line">               </span><br><span class="line">          <span class="keyword">case</span> IDCANCEL:</span><br><span class="line">               EndDialog (hDlg, FALSE) ;</span><br><span class="line">               <span class="keyword">return</span> TRUE ;</span><br><span class="line">               </span><br><span class="line">          <span class="keyword">case</span> IDC_BLACK:</span><br><span class="line">          <span class="keyword">case</span> IDC_RED:</span><br><span class="line">          <span class="keyword">case</span> IDC_GREEN:</span><br><span class="line">          <span class="keyword">case</span> IDC_YELLOW:</span><br><span class="line">          <span class="keyword">case</span> IDC_BLUE:</span><br><span class="line">          <span class="keyword">case</span> IDC_MAGENTA:</span><br><span class="line">          <span class="keyword">case</span> IDC_CYAN:</span><br><span class="line">          <span class="keyword">case</span> IDC_WHITE:</span><br><span class="line">               iColor = LOWORD (wParam) ;<span class="comment">//LOWORD(wParam)携带控件ID</span></span><br><span class="line">               CheckRadioButton (hDlg, IDC_BLACK, IDC_WHITE, LOWORD (wParam)) ;<span class="comment">//根据鼠标点选改变单选按钮状态</span></span><br><span class="line">               PaintTheBlock (hCtrlBlock, iColor, iFigure) ;<span class="comment">//Block是预览块,实时根据选择改变,提供预览功能</span></span><br><span class="line">               <span class="keyword">return</span> TRUE ;</span><br><span class="line">               </span><br><span class="line">          <span class="keyword">case</span> IDC_RECT:</span><br><span class="line">          <span class="keyword">case</span> IDC_ELLIPSE:</span><br><span class="line">               iFigure = LOWORD (wParam) ;<span class="comment">//更新图形状态</span></span><br><span class="line">               CheckRadioButton (hDlg, IDC_RECT, IDC_ELLIPSE, LOWORD (wParam)) ;</span><br><span class="line">               PaintTheBlock (hCtrlBlock, iColor, iFigure) ;<span class="comment">//立刻重绘预览块</span></span><br><span class="line">               <span class="keyword">return</span> TRUE ;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">break</span> ;</span><br><span class="line">          </span><br><span class="line">     <span class="keyword">case</span> WM_PAINT:</span><br><span class="line">          PaintTheBlock (hCtrlBlock, iColor, iFigure) ;<span class="comment">//重绘时只需要关注预览块</span></span><br><span class="line">          <span class="keyword">break</span> ;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> FALSE ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="painttheblock">PaintTheBlock</h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">PaintTheBlock</span> <span class="params">(HWND hCtrl, <span class="type">int</span> iColor, <span class="type">int</span> iFigure)</span></span><br><span class="line">&#123;</span><br><span class="line">     InvalidateRect (hCtrl, <span class="literal">NULL</span>, TRUE) ;<span class="comment">//hCtrl句柄控制的客户去全都失效</span></span><br><span class="line">     UpdateWindow (hCtrl) ;<span class="comment">//重绘hCtrl</span></span><br><span class="line">     PaintWindow (hCtrl, iColor, iFigure) ;<span class="comment">//根据hCtrl和iColor指定的风格重绘</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="回顾父子通信方式">回顾父子通信方式</h4>
<p>父窗口就只负责主窗口客户区的颜色和图形绘制,对话框负责调这个颜色和图形</p>
<p>父窗口和对话框如何进行通信的?或者说对话框是如何通知父窗口用新样式绘图的呢?</p>
<p>关键在于两个对父过程和对话框过程都可见的全局变量,对话框使用这两个变量间接通知父窗口</p>
<p>并且在对话框关闭之后,父窗口会立刻重绘,这就使得颜色样式更新显得没有延迟</p>
<p>父窗口中,关闭对话框之后的立刻更新:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> IDM_APP_ABOUT:</span><br><span class="line">     <span class="keyword">if</span> (DialogBox (hInstance, TEXT (<span class="string">&quot;AboutBox&quot;</span>), hwnd, AboutDlgProc))<span class="comment">//如果DialogBox返回值1说明确实有修改,需要重绘,否则不需要重绘</span></span><br><span class="line">          InvalidateRect (hwnd, <span class="literal">NULL</span>, TRUE) ;</span><br></pre></td></tr></table></figure>
<h4 id="避免使用全局变量">避免使用全局变量</h4>
<p>正当我感觉使用全局变量间接实现父子通信,这个设计合情合理,甚至有点巧妙时,人家又说,这是low
B方法.</p>
<p>书上给的方法是,定义一个结构体</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> iColor, iFigure;</span><br><span class="line">&#125;ABOUTBOX_DATA;</span><br></pre></td></tr></table></figure>
<p>这个结构体就记录了对话框能够使用的变量</p>
<p>在WndProc中用这样一个结构体指针传递给DialogBoxParam,即带参数的对话框函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">INT_PTR <span class="title function_">DialogBoxParamA</span><span class="params">(</span></span><br><span class="line"><span class="params">  [in, optional] HINSTANCE hInstance,<span class="comment">//应用程序实例句柄</span></span></span><br><span class="line"><span class="params">  [in]           LPCSTR    lpTemplateName,<span class="comment">//对话框id</span></span></span><br><span class="line"><span class="params">  [in, optional] HWND      hWndParent,<span class="comment">//父窗口</span></span></span><br><span class="line"><span class="params">  [in, optional] DLGPROC   lpDialogFunc,<span class="comment">//对话框过程</span></span></span><br><span class="line"><span class="params">  [in]           LPARAM    dwInitParam<span class="comment">//参数</span></span></span><br><span class="line"><span class="params">)</span>;</span><br></pre></td></tr></table></figure>
<p>dwInitParam这个参数将会作为对话框WM_INITDIALOG消息的lParam参数传递给对话框过程,也就是把WndProc函数栈变量的地址交给了对话框过程AboutDlgProc,使得对话框过程函数可以操作WndProc的函数栈</p>
<p>AboutDlgProc中有两个关于ABOUTBOX_DATA结构体的变量,一个是指针类型,保管WndProc用WM_INITDIALOG消息的lParam参数指定的指针,用于向WndProc打报告</p>
<p>另一个是AboutDlgProc函数栈下的局部变量,这个是对话框过程自娱自乐用的,打报告的时候只需要拷贝该局部变量的情况</p>
<p>修改后的About2</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*------------------------------------------</span></span><br><span class="line"><span class="comment">   ABOUT2.C -- About Box Demo Program No. 2</span></span><br><span class="line"><span class="comment">               (c) Charles Petzold, 1998</span></span><br><span class="line"><span class="comment">  ------------------------------------------*/</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;resource.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span><span class="comment">//结构体定义</span></span><br><span class="line">    <span class="type">int</span> iColor, iFigure;</span><br><span class="line">&#125;ABOUTBOX_DATA;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">LRESULT CALLBACK <span class="title function_">WndProc</span>      <span class="params">(HWND, UINT, WPARAM, LPARAM)</span> ;</span><br><span class="line">BOOL    CALLBACK <span class="title function_">AboutDlgProc</span> <span class="params">(HWND, UINT, WPARAM, LPARAM)</span> ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> WINAPI <span class="title function_">WinMain</span> <span class="params">(HINSTANCE hInstance, HINSTANCE hPrevInstance,</span></span><br><span class="line"><span class="params">                    PSTR szCmdLine, <span class="type">int</span> iCmdShow)</span></span><br><span class="line">&#123;</span><br><span class="line">     <span class="type">static</span> TCHAR szAppName[] = TEXT (<span class="string">&quot;About2&quot;</span>) ;</span><br><span class="line">     MSG          msg ;</span><br><span class="line">     HWND         hwnd ;</span><br><span class="line">     WNDCLASS     wndclass ;</span><br><span class="line">     </span><br><span class="line">     wndclass.style         = CS_HREDRAW | CS_VREDRAW ;</span><br><span class="line">     wndclass.lpfnWndProc   = WndProc ;</span><br><span class="line">     wndclass.cbClsExtra    = <span class="number">0</span> ;</span><br><span class="line">     wndclass.cbWndExtra    = <span class="number">0</span> ;</span><br><span class="line">     wndclass.hInstance     = hInstance ;</span><br><span class="line">     wndclass.hIcon         = LoadIcon (hInstance, szAppName) ;</span><br><span class="line">     wndclass.hCursor       = LoadCursor (<span class="literal">NULL</span>, IDC_ARROW) ;</span><br><span class="line">     wndclass.hbrBackground = (HBRUSH) GetStockObject (WHITE_BRUSH) ;</span><br><span class="line">     wndclass.lpszMenuName  = szAppName ;</span><br><span class="line">     wndclass.lpszClassName = szAppName ;</span><br><span class="line">     </span><br><span class="line">     <span class="keyword">if</span> (!RegisterClass (&amp;wndclass))</span><br><span class="line">     &#123;</span><br><span class="line">          MessageBox (<span class="literal">NULL</span>, TEXT (<span class="string">&quot;This program requires Windows NT!&quot;</span>),</span><br><span class="line">                      szAppName, MB_ICONERROR) ;</span><br><span class="line">          <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">     &#125;</span><br><span class="line">     </span><br><span class="line">     hwnd = CreateWindow (szAppName, TEXT (<span class="string">&quot;About Box Demo Program&quot;</span>),</span><br><span class="line">                          WS_OVERLAPPEDWINDOW,</span><br><span class="line">                          CW_USEDEFAULT, CW_USEDEFAULT,</span><br><span class="line">                          CW_USEDEFAULT, CW_USEDEFAULT,</span><br><span class="line">                          <span class="literal">NULL</span>, <span class="literal">NULL</span>, hInstance, <span class="literal">NULL</span>) ;</span><br><span class="line">     </span><br><span class="line">     ShowWindow (hwnd, iCmdShow) ;</span><br><span class="line">     UpdateWindow (hwnd) ; </span><br><span class="line">     </span><br><span class="line">     <span class="keyword">while</span> (GetMessage (&amp;msg, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>))</span><br><span class="line">     &#123;</span><br><span class="line">          TranslateMessage (&amp;msg) ;</span><br><span class="line">          DispatchMessage (&amp;msg) ;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> msg.wParam ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">PaintWindow</span> <span class="params">(HWND hwnd, <span class="type">int</span> iColor, <span class="type">int</span> iFigure)</span></span><br><span class="line">&#123;</span><br><span class="line">     <span class="type">static</span> COLORREF crColor[<span class="number">8</span>] = &#123; RGB (  <span class="number">0</span>,   <span class="number">0</span>, <span class="number">0</span>), RGB (  <span class="number">0</span>,   <span class="number">0</span>, <span class="number">255</span>),</span><br><span class="line">                                    RGB (  <span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>), RGB (  <span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>),</span><br><span class="line">                                    RGB (<span class="number">255</span>,   <span class="number">0</span>, <span class="number">0</span>), RGB (<span class="number">255</span>,   <span class="number">0</span>, <span class="number">255</span>),</span><br><span class="line">                                    RGB (<span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>), RGB (<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>) &#125; ;</span><br><span class="line"></span><br><span class="line">     HBRUSH          hBrush ;</span><br><span class="line">     HDC             hdc ;</span><br><span class="line">     RECT            rect ;</span><br><span class="line">     </span><br><span class="line">     hdc = GetDC (hwnd) ;</span><br><span class="line">     GetClientRect (hwnd, &amp;rect) ;</span><br><span class="line">     hBrush = CreateSolidBrush (crColor[iColor - IDC_BLACK]) ;</span><br><span class="line">     hBrush = (HBRUSH) SelectObject (hdc, hBrush) ;</span><br><span class="line">     </span><br><span class="line">     <span class="keyword">if</span> (iFigure == IDC_RECT)</span><br><span class="line">          Rectangle (hdc, rect.left, rect.top, rect.right, rect.bottom) ;</span><br><span class="line">     <span class="keyword">else</span></span><br><span class="line">          Ellipse   (hdc, rect.left, rect.top, rect.right, rect.bottom) ;</span><br><span class="line">     </span><br><span class="line">     DeleteObject (SelectObject (hdc, hBrush)) ;</span><br><span class="line">     ReleaseDC (hwnd, hdc) ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">PaintTheBlock</span> <span class="params">(HWND hCtrl, <span class="type">int</span> iColor, <span class="type">int</span> iFigure)</span></span><br><span class="line">&#123;</span><br><span class="line">     InvalidateRect (hCtrl, <span class="literal">NULL</span>, TRUE) ;</span><br><span class="line">     UpdateWindow (hCtrl) ;</span><br><span class="line">     PaintWindow (hCtrl, iColor, iFigure) ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LRESULT CALLBACK <span class="title function_">WndProc</span> <span class="params">(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)</span></span><br><span class="line">&#123;</span><br><span class="line">     <span class="type">static</span> HINSTANCE hInstance ;<span class="comment">//应用程序实例句柄</span></span><br><span class="line">     <span class="type">static</span> PAINTSTRUCT      ps ;</span><br><span class="line">     <span class="type">static</span> ABOUTBOX_DATA ad;<span class="comment">//父窗口绘图依据</span></span><br><span class="line"></span><br><span class="line">     <span class="keyword">switch</span> (message)</span><br><span class="line">     &#123;</span><br><span class="line">     <span class="keyword">case</span> WM_CREATE:</span><br><span class="line">          hInstance = ((LPCREATESTRUCT) lParam)-&gt;hInstance ;</span><br><span class="line">          <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">          </span><br><span class="line">     <span class="keyword">case</span> WM_COMMAND:</span><br><span class="line">          <span class="keyword">switch</span> (LOWORD (wParam))</span><br><span class="line">          &#123;</span><br><span class="line">          <span class="keyword">case</span> IDM_APP_ABOUT:</span><br><span class="line">               <span class="keyword">if</span> (DialogBoxParam (hInstance, TEXT (<span class="string">&quot;AboutBox&quot;</span>), hwnd, AboutDlgProc,&amp;ad))<span class="comment">//ad地址交给子窗口,使其可以跨函数栈帧修改ad值</span></span><br><span class="line">                    InvalidateRect (hwnd, <span class="literal">NULL</span>, TRUE) ;</span><br><span class="line">               <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">break</span> ;</span><br><span class="line">          </span><br><span class="line">     <span class="keyword">case</span> WM_PAINT:</span><br><span class="line">          BeginPaint (hwnd, &amp;ps) ;</span><br><span class="line">          EndPaint (hwnd, &amp;ps) ;</span><br><span class="line">               </span><br><span class="line">          PaintWindow (hwnd, ad.iColor, ad.iFigure) ;<span class="comment">//根据当前颜色当前形状绘图</span></span><br><span class="line">          <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">               </span><br><span class="line">     <span class="keyword">case</span> WM_DESTROY:</span><br><span class="line">          PostQuitMessage (<span class="number">0</span>) ;</span><br><span class="line">          <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> DefWindowProc (hwnd, message, wParam, lParam) ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">BOOL CALLBACK <span class="title function_">AboutDlgProc</span> <span class="params">(HWND hDlg, UINT message, </span></span><br><span class="line"><span class="params">                            WPARAM wParam, LPARAM lParam)</span></span><br><span class="line">&#123;</span><br><span class="line">     <span class="type">static</span> HWND hCtrlBlock ;</span><br><span class="line">     <span class="type">static</span> ABOUTBOX_DATA ad,*pad;</span><br><span class="line">     <span class="keyword">switch</span> (message)</span><br><span class="line">     &#123;</span><br><span class="line">     <span class="keyword">case</span> WM_INITDIALOG:</span><br><span class="line">         pad = (ABOUTBOX_DATA*)lParam;<span class="comment">//pad用于承接父窗口传递的指针</span></span><br><span class="line">         ad = *pad;<span class="comment">//ad是本函数绘图依据,不到万不得已不使用*pad指针</span></span><br><span class="line"></span><br><span class="line">          </span><br><span class="line">          CheckRadioButton (hDlg, IDC_BLACK, IDC_WHITE,   ad.iColor) ;<span class="comment">//第一个颜色和最后一个颜色,其间的宏定义都算,这一些选项中有且只有一个处于被选中状态</span></span><br><span class="line">          CheckRadioButton (hDlg, IDC_RECT,  IDC_ELLIPSE, ad.iFigure) ;</span><br><span class="line">          </span><br><span class="line">          hCtrlBlock = GetDlgItem (hDlg, IDC_PAINT) ;<span class="comment">//预览块矿建</span></span><br><span class="line">          </span><br><span class="line">          SetFocus (GetDlgItem (hDlg, ad.iColor)) ;</span><br><span class="line">          <span class="keyword">return</span> FALSE ;</span><br><span class="line">          </span><br><span class="line">     <span class="keyword">case</span> WM_COMMAND:</span><br><span class="line">          <span class="keyword">switch</span> (LOWORD (wParam))</span><br><span class="line">          &#123;</span><br><span class="line">          <span class="keyword">case</span> IDOK:<span class="comment">//点选了确认键,需要修改设置了</span></span><br><span class="line">              *pad = ad;</span><br><span class="line">               EndDialog (hDlg, TRUE) ;</span><br><span class="line">               <span class="keyword">return</span> TRUE ;</span><br><span class="line">               </span><br><span class="line">          <span class="keyword">case</span> IDCANCEL:</span><br><span class="line">               EndDialog (hDlg, FALSE) ;</span><br><span class="line">               <span class="keyword">return</span> TRUE ;</span><br><span class="line">               </span><br><span class="line">          <span class="keyword">case</span> IDC_BLACK:</span><br><span class="line">          <span class="keyword">case</span> IDC_RED:</span><br><span class="line">          <span class="keyword">case</span> IDC_GREEN:</span><br><span class="line">          <span class="keyword">case</span> IDC_YELLOW:</span><br><span class="line">          <span class="keyword">case</span> IDC_BLUE:</span><br><span class="line">          <span class="keyword">case</span> IDC_MAGENTA:</span><br><span class="line">          <span class="keyword">case</span> IDC_CYAN:</span><br><span class="line">          <span class="keyword">case</span> IDC_WHITE:</span><br><span class="line">               ad.iColor = LOWORD (wParam) ;<span class="comment">//LOWORD(wParam)携带控件ID</span></span><br><span class="line">               CheckRadioButton (hDlg, IDC_BLACK, IDC_WHITE, LOWORD (wParam)) ;</span><br><span class="line">               PaintTheBlock (hCtrlBlock, ad.iColor,ad.iFigure ) ;<span class="comment">//Block是预览块,实时根据选择改变,提供预览功能</span></span><br><span class="line">               <span class="keyword">return</span> TRUE ;</span><br><span class="line">               </span><br><span class="line">          <span class="keyword">case</span> IDC_RECT:</span><br><span class="line">          <span class="keyword">case</span> IDC_ELLIPSE:</span><br><span class="line">               ad.iFigure = LOWORD (wParam) ;</span><br><span class="line">               CheckRadioButton (hDlg, IDC_RECT, IDC_ELLIPSE, LOWORD (wParam)) ;</span><br><span class="line">               PaintTheBlock (hCtrlBlock, ad.iColor, ad.iFigure) ;</span><br><span class="line">               <span class="keyword">return</span> TRUE ;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">break</span> ;</span><br><span class="line">          </span><br><span class="line">     <span class="keyword">case</span> WM_PAINT:</span><br><span class="line">          PaintTheBlock (hCtrlBlock, ad.iColor, ad.iFigure) ;</span><br><span class="line">          <span class="keyword">break</span> ;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> FALSE ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="回顾单选互斥的实现">回顾单选互斥的实现</h4>
<p>之前实现单选互斥,需要维护一组按钮的状态,当新按钮按下之前,先得把原来按下的按钮扣起来,在按下新按钮.</p>
<p>而现在只需要</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CheckRadioButton(hDlg,idFirst,idLast,idCheck);</span><br></pre></td></tr></table></figure>
<p>意思是,在hDlg对话框中,编号属于<code>[idFirst,idLast]</code>这个范围的单选按钮都是互斥的,idCheck决定按下哪一个.</p>
<p>这就要求从idFirst到idLast是连号的,idCheck属于这个范围</p>
<h3 id="about3">About3</h3>
<p>自定义对话框控件</p>
<h4 id="资源脚本-1">资源脚本</h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ABOUTBOX DIALOG DISCARDABLE  <span class="number">32</span>, <span class="number">32</span>, <span class="number">180</span>, <span class="number">100</span></span><br><span class="line">STYLE DS_MODALFRAME | WS_POPUP</span><br><span class="line">FONT <span class="number">8</span>, <span class="string">&quot;MS Sans Serif&quot;</span></span><br><span class="line">BEGIN</span><br><span class="line">    CONTROL         <span class="string">&quot;OK&quot;</span>,IDOK,<span class="string">&quot;EllipPush&quot;</span>,WS_GROUP | WS_TABSTOP,<span class="number">73</span>,<span class="number">79</span>,<span class="number">32</span>,<span class="number">14</span><span class="comment">//自定义控件,ID=IDOK,类名=&quot;EllipPush&quot;</span></span><br><span class="line">    ICON            <span class="string">&quot;ABOUT3&quot;</span>,IDC_STATIC,<span class="number">7</span>,<span class="number">7</span>,<span class="number">20</span>,<span class="number">20</span></span><br><span class="line">    CTEXT           <span class="string">&quot;About3&quot;</span>,IDC_STATIC,<span class="number">40</span>,<span class="number">12</span>,<span class="number">100</span>,<span class="number">8</span></span><br><span class="line">    CTEXT           <span class="string">&quot;About Box Demo Program&quot;</span>,IDC_STATIC,<span class="number">7</span>,<span class="number">40</span>,<span class="number">166</span>,<span class="number">8</span></span><br><span class="line">    CTEXT           <span class="string">&quot;(c) Charles Petzold, 1998&quot;</span>,IDC_STATIC,<span class="number">7</span>,<span class="number">52</span>,<span class="number">166</span>,<span class="number">8</span></span><br><span class="line">END</span><br></pre></td></tr></table></figure>
<p>这里的类名就是注册窗口类时的类名,决定从该类创建的实例的属性</p>
<h4 id="自定义控件过程函数">自定义控件过程函数</h4>
<p>创建自定义控件类的时候需要注册其过程函数,其中WM_PAINT决定了该自定义控件类的外观</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">LRESULT CALLBACK <span class="title function_">EllipPushWndProc</span> <span class="params">(HWND hwnd, UINT message, <span class="comment">//自定义按钮类行为</span></span></span><br><span class="line"><span class="params">                                   WPARAM wParam, LPARAM lParam)</span></span><br><span class="line">&#123;</span><br><span class="line">     TCHAR       szText[<span class="number">40</span>] ;</span><br><span class="line">     HBRUSH      hBrush ;</span><br><span class="line">     HDC         hdc ;</span><br><span class="line">     PAINTSTRUCT ps ;</span><br><span class="line">     RECT        rect ;</span><br><span class="line">     </span><br><span class="line">     <span class="keyword">switch</span> (message)</span><br><span class="line">     &#123;</span><br><span class="line">     <span class="keyword">case</span> WM_PAINT :<span class="comment">//绘图行为</span></span><br><span class="line">          GetClientRect (hwnd, &amp;rect) ;</span><br><span class="line">          GetWindowText (hwnd, szText, lstrlen(szText)) ;<span class="comment">//获取本子窗口的描述文字,写到szText数组里,即&quot;OK&quot;字样</span></span><br><span class="line">          </span><br><span class="line">          hdc = BeginPaint (hwnd, &amp;ps) ;</span><br><span class="line">          </span><br><span class="line">          hBrush = CreateSolidBrush (GetSysColor (COLOR_WINDOW)) ;</span><br><span class="line">          hBrush = (HBRUSH) SelectObject (hdc, hBrush) ;</span><br><span class="line">          SetBkColor (hdc, GetSysColor (COLOR_WINDOW)) ;</span><br><span class="line">          SetTextColor (hdc, GetSysColor (COLOR_WINDOWTEXT)) ;</span><br><span class="line">          </span><br><span class="line">          Ellipse (hdc, rect.left, rect.top, rect.right, rect.bottom) ;<span class="comment">//绘制椭圆</span></span><br><span class="line">          DrawText (hdc, szText, <span class="number">-1</span>, &amp;rect,<span class="comment">//椭圆中心写字</span></span><br><span class="line">                    DT_SINGLELINE | DT_CENTER | DT_VCENTER) ;</span><br><span class="line">          </span><br><span class="line">          DeleteObject (SelectObject (hdc, hBrush)) ;</span><br><span class="line">          </span><br><span class="line">          EndPaint (hwnd, &amp;ps) ;</span><br><span class="line">          <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">          </span><br><span class="line">     <span class="keyword">case</span> WM_KEYUP :</span><br><span class="line">          <span class="keyword">if</span> (wParam != VK_SPACE)<span class="comment">//按下空格键相当于按下鼠标左键,其他键忽略,交给DefWindowProc处理</span></span><br><span class="line">               <span class="keyword">break</span> ;</span><br><span class="line">                                             <span class="comment">// fall through</span></span><br><span class="line">     <span class="keyword">case</span> WM_LBUTTONUP :</span><br><span class="line">          SendMessage (GetParent (hwnd), WM_COMMAND,<span class="comment">//向父窗口即对话框发送WM_COMMAND消息,消息内容是本按钮的id</span></span><br><span class="line">               GetWindowLong (hwnd, GWL_ID), (LPARAM) hwnd) ;</span><br><span class="line">          <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> DefWindowProc (hwnd, message, wParam, lParam) ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="非模态对话框">非模态对话框</h2>
<p>非模态对话框就是可以不理会对话框内容继续和父窗口交互</p>
<p>一般Ctrl+F召唤的查找框就是非模态的</p>
<p>使用CreateDialogA函数创建非模态对话框</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">CreateDialogA</span><span class="params">(</span></span><br><span class="line"><span class="params">  [in, optional]  hInstance,</span></span><br><span class="line"><span class="params">  [in]            lpName,<span class="comment">//对话框类名,或者类句柄</span></span></span><br><span class="line"><span class="params">  [in, optional]  hWndParent,<span class="comment">//父窗口句柄</span></span></span><br><span class="line"><span class="params">  [in, optional]  lpDialogFunc<span class="comment">//对话框回调函数</span></span></span><br><span class="line"><span class="params">)</span>;</span><br></pre></td></tr></table></figure>
<h3 id="colors">COLORS</h3>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">LRESULT CALLBACK <span class="title function_">WndProc</span><span class="params">(HWND, UINT, WPARAM, LPARAM)</span>;</span><br><span class="line">BOOL    CALLBACK <span class="title function_">ColorScrDlg</span><span class="params">(HWND, UINT, WPARAM, LPARAM)</span>;</span><br><span class="line"></span><br><span class="line">HWND hDlgModeless;	<span class="comment">//非模态对话框的全局句柄,对任意函数可见,</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> WINAPI <span class="title function_">WinMain</span><span class="params">(HINSTANCE hInstance, HINSTANCE hPrevInstance,</span></span><br><span class="line"><span class="params">	PSTR szCmdLine, <span class="type">int</span> iCmdShow)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">static</span> TCHAR szAppName[] = TEXT(<span class="string">&quot;Colors2&quot;</span>);</span><br><span class="line">	HWND         hwnd;</span><br><span class="line">	MSG          msg;</span><br><span class="line">	WNDCLASS     wndclass;</span><br><span class="line"></span><br><span class="line">	wndclass.style = CS_HREDRAW | CS_VREDRAW;</span><br><span class="line">	wndclass.lpfnWndProc = WndProc;</span><br><span class="line">	wndclass.cbClsExtra = <span class="number">0</span>;</span><br><span class="line">	wndclass.cbWndExtra = <span class="number">0</span>;</span><br><span class="line">	wndclass.hInstance = hInstance;</span><br><span class="line">	wndclass.hIcon = LoadIcon(<span class="literal">NULL</span>, IDI_APPLICATION);</span><br><span class="line">	wndclass.hCursor = LoadCursor(<span class="literal">NULL</span>, IDC_ARROW);</span><br><span class="line">	wndclass.hbrBackground = CreateSolidBrush(<span class="number">0L</span>);</span><br><span class="line">	wndclass.lpszMenuName = <span class="literal">NULL</span>;</span><br><span class="line">	wndclass.lpszClassName = szAppName;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!RegisterClass(&amp;wndclass))</span><br><span class="line">	&#123;</span><br><span class="line">		MessageBox(<span class="literal">NULL</span>, TEXT(<span class="string">&quot;This program requires Windows NT!&quot;</span>),</span><br><span class="line">			szAppName, MB_ICONERROR);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	hwnd = CreateWindow(</span><br><span class="line">		szAppName, TEXT(<span class="string">&quot;Color Scroll&quot;</span>),</span><br><span class="line">		WS_OVERLAPPEDWINDOW | WS_CLIPCHILDREN,<span class="comment">//不擦除子窗口的情况下,重绘父窗口</span></span><br><span class="line">		CW_USEDEFAULT, CW_USEDEFAULT,</span><br><span class="line">		CW_USEDEFAULT, CW_USEDEFAULT,</span><br><span class="line">		<span class="literal">NULL</span>, <span class="literal">NULL</span>, hInstance, <span class="literal">NULL</span></span><br><span class="line">	);</span><br><span class="line"></span><br><span class="line">	ShowWindow(hwnd, iCmdShow);</span><br><span class="line">	UpdateWindow(hwnd);</span><br><span class="line"></span><br><span class="line">	hDlgModeless = CreateDialog(hInstance, TEXT(<span class="string">&quot;ColorScrDlg&quot;</span>), hwnd, ColorScrDlg);<span class="comment">//在winMain中创建非模态对话框,使用字符串索引资源,注册非模态对话框过程ColorScrDlg</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (GetMessage(&amp;msg, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (hDlgModeless == <span class="number">0</span> || !IsDialogMessage(hDlgModeless, &amp;msg))</span><br><span class="line">		&#123;</span><br><span class="line">			TranslateMessage(&amp;msg);</span><br><span class="line">			DispatchMessage(&amp;msg);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> msg.wParam;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LRESULT CALLBACK <span class="title function_">WndProc</span><span class="params">(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">switch</span> (message)</span><br><span class="line">	&#123;</span><br><span class="line">	<span class="keyword">case</span> WM_DESTROY:</span><br><span class="line">		DeleteObject((HGDIOBJ)SetClassLong(hwnd, GCL_HBRBACKGROUND,(LONG)GetStockObject(WHITE_BRUSH)));<span class="comment">//删除注册窗口类时创建的逻辑画刷,避免内存泄漏</span></span><br><span class="line">		PostQuitMessage(<span class="number">0</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> DefWindowProc(hwnd, message, wParam, lParam);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">BOOL CALLBACK <span class="title function_">ColorScrDlg</span><span class="params">(HWND hDlg, UINT message,</span></span><br><span class="line"><span class="params">	WPARAM wParam, LPARAM lParam)</span><span class="comment">//对话框过程回调</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">static</span> <span class="type">int</span> iColor[<span class="number">3</span>];</span><br><span class="line">	HWND       hwndParent, hCtrl;</span><br><span class="line">	<span class="type">int</span>        iCtrlID, iIndex;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">switch</span> (message)</span><br><span class="line">	&#123;</span><br><span class="line">	<span class="keyword">case</span> WM_INITDIALOG:<span class="comment">//初始化对话框</span></span><br><span class="line">		<span class="keyword">for</span> (iCtrlID = <span class="number">10</span>; iCtrlID &lt; <span class="number">13</span>; iCtrlID++)<span class="comment">//三个滚动条的ID分别是10,11,12</span></span><br><span class="line">		&#123;</span><br><span class="line">			hCtrl = GetDlgItem(hDlg, iCtrlID);<span class="comment">//获取hDlg句柄对应的对话框上,ID是iCtrlID的控件的句柄,即滚动条控件的句柄</span></span><br><span class="line">			SetScrollRange(hCtrl, SB_CTL, <span class="number">0</span>, <span class="number">255</span>, FALSE);<span class="comment">//设置滚动条范围0到255,恰好是RGB值的范围</span></span><br><span class="line">			SetScrollPos(hCtrl, SB_CTL, <span class="number">0</span>, FALSE);<span class="comment">//设置滑块初始位置在0上</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> TRUE;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">case</span> WM_VSCROLL:</span><br><span class="line">		hCtrl = (HWND)lParam;<span class="comment">//是三个滚动条中的哪一个产生的消息</span></span><br><span class="line">		iCtrlID = GetWindowLong(hCtrl, GWL_ID);<span class="comment">//获取id</span></span><br><span class="line">		iIndex = iCtrlID - <span class="number">10</span>;<span class="comment">//转换成0,1,2下标//该下标用于索引iColor数组,iColor[0]表示红色色度条//同时iColor[0]值也表示了该条上的滑块位置</span></span><br><span class="line">		hwndParent = GetParent(hDlg);<span class="comment">//获取父窗口也就是主窗口句柄</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">switch</span> (LOWORD(wParam))</span><br><span class="line">		&#123;</span><br><span class="line">		<span class="keyword">case</span> SB_PAGEDOWN:</span><br><span class="line">			iColor[iIndex] += <span class="number">15</span>;        <span class="comment">// fall through//一页是滚动15+1个单位,但是最大不能超过255个单位</span></span><br><span class="line">		<span class="keyword">case</span> SB_LINEDOWN:</span><br><span class="line">			iColor[iIndex] = min(<span class="number">255</span>, iColor[iIndex] + <span class="number">1</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> SB_PAGEUP:</span><br><span class="line">			iColor[iIndex] -= <span class="number">15</span>;        <span class="comment">// fall through</span></span><br><span class="line">		<span class="keyword">case</span> SB_LINEUP:</span><br><span class="line">			iColor[iIndex] = max(<span class="number">0</span>, iColor[iIndex] - <span class="number">1</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> SB_TOP:</span><br><span class="line">			iColor[iIndex] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> SB_BOTTOM:</span><br><span class="line">			iColor[iIndex] = <span class="number">255</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> SB_THUMBPOSITION:</span><br><span class="line">		<span class="keyword">case</span> SB_THUMBTRACK:<span class="comment">//拖动滑块</span></span><br><span class="line">			iColor[iIndex] = HIWORD(wParam);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="keyword">return</span> FALSE;</span><br><span class="line">		&#125;</span><br><span class="line">		SetScrollPos(hCtrl, SB_CTL, iColor[iIndex], TRUE);<span class="comment">//设置滑块位置</span></span><br><span class="line">		SetDlgItemInt(hDlg, iCtrlID + <span class="number">3</span>, iColor[iIndex], FALSE);<span class="comment">//设置对话框控件文本,也就是表明当前色度的数值</span></span><br><span class="line">							<span class="comment">//+3是将滚动条号转化为其上的解释性文字的id</span></span><br><span class="line"></span><br><span class="line">		DeleteObject((HGDIOBJ)SetClassLong(hwndParent, GCL_HBRBACKGROUND,<span class="comment">//删除旧背景颜色</span></span><br><span class="line">			(LONG)CreateSolidBrush(RGB(iColor[<span class="number">0</span>], iColor[<span class="number">1</span>], iColor[<span class="number">2</span>]))));<span class="comment">//更新新背景颜色</span></span><br><span class="line"></span><br><span class="line">		InvalidateRect(hwndParent, <span class="literal">NULL</span>, TRUE);<span class="comment">//父窗口全部失效,立刻通知重绘</span></span><br><span class="line">		<span class="keyword">return</span> TRUE;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="对话框资源">对话框资源</h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">COLORSCRDLG DIALOG DISCARDABLE  <span class="number">16</span>, <span class="number">16</span>, <span class="number">120</span>, <span class="number">141</span>	<span class="comment">//对话框名叫&quot;COLORSCRDLG&quot;</span></span><br><span class="line">STYLE DS_MODALFRAME | WS_POPUP | WS_VISIBLE | WS_CAPTION	<span class="comment">//非模态,弹出,可见,有标题</span></span><br><span class="line">CAPTION <span class="string">&quot;Color Scroll Scrollbars&quot;</span>		<span class="comment">//对话框标题</span></span><br><span class="line">FONT <span class="number">8</span>, <span class="string">&quot;MS Sans Serif&quot;</span>	<span class="comment">//字号字体</span></span><br><span class="line">BEGIN</span><br><span class="line">    CTEXT           <span class="string">&quot;&amp;Red&quot;</span>,IDC_STATIC,<span class="number">8</span>,<span class="number">8</span>,<span class="number">24</span>,<span class="number">8</span>,NOT WS_GROUP	<span class="comment">//滚动条两头的解释性文字,没有逻辑作用</span></span><br><span class="line">    SCROLLBAR       <span class="number">10</span>,<span class="number">8</span>,<span class="number">20</span>,<span class="number">24</span>,<span class="number">100</span>,SBS_VERT | WS_TABSTOP	<span class="comment">//滚动条,	数值方向滚动,制表停留</span></span><br><span class="line">    CTEXT           <span class="string">&quot;0&quot;</span>,<span class="number">13</span>,<span class="number">8</span>,<span class="number">124</span>,<span class="number">24</span>,<span class="number">8</span>,NOT WS_GROUP</span><br><span class="line">    CTEXT           <span class="string">&quot;&amp;Green&quot;</span>,IDC_STATIC,<span class="number">48</span>,<span class="number">8</span>,<span class="number">24</span>,<span class="number">8</span>,NOT WS_GROUP</span><br><span class="line">    SCROLLBAR       <span class="number">11</span>,<span class="number">48</span>,<span class="number">20</span>,<span class="number">24</span>,<span class="number">100</span>,SBS_VERT | WS_TABSTOP</span><br><span class="line">    CTEXT           <span class="string">&quot;0&quot;</span>,<span class="number">14</span>,<span class="number">48</span>,<span class="number">124</span>,<span class="number">24</span>,<span class="number">8</span>,NOT WS_GROUP</span><br><span class="line">    CTEXT           <span class="string">&quot;&amp;Blue&quot;</span>,IDC_STATIC,<span class="number">89</span>,<span class="number">8</span>,<span class="number">24</span>,<span class="number">8</span>,NOT WS_GROUP</span><br><span class="line">    SCROLLBAR       <span class="number">12</span>,<span class="number">89</span>,<span class="number">20</span>,<span class="number">24</span>,<span class="number">100</span>,SBS_VERT | WS_TABSTOP</span><br><span class="line">    CTEXT           <span class="string">&quot;0&quot;</span>,<span class="number">15</span>,<span class="number">89</span>,<span class="number">124</span>,<span class="number">24</span>,<span class="number">8</span>,NOT WS_GROUP</span><br><span class="line">END</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="createdialog和dialogbox">CreateDialog和DialogBox</h4>
<p>CreateDialog创建非模态对话框的参数和DialogBox创建模态对话框的参数一模一样</p>
<p>两个函数的区别是是否持有控制</p>
<p>DialogBox调用之后控制会从父窗口过程函数转移给对话框过程函数,返回值是一个数</p>
<p>但是CreateDialog会立刻返回对话框的句柄,不会持有控制.</p>
<p>之所以CreateDialog需要返回句柄,是因为非模态对话框的父窗口是可以动的,它可能需要使用对话框句柄</p>
<h4 id="新消息循环">新消息循环</h4>
<p>非模态对话框的消息要进入WinMain中的消息循环,相当于一个子窗口,需要WinMain消息循环分拣派发消息</p>
<blockquote>
<p>但是模态对话框的消息不需要,因为当模态对话框或者的时候,本程序的消息指定都是发往模态对话框的</p>
</blockquote>
<p>考虑非模态对话框的WinMain消息循环就应该:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (GetMessage (&amp;msg, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>))</span><br><span class="line">&#123;</span><br><span class="line">     <span class="keyword">if</span> (hDlgModeless == <span class="number">0</span> || !IsDialogMessage (hDlgModeless, &amp;msg))<span class="comment">//如果没有非模态对话框句柄或者该消息不是非模态对话框的才往下走</span></span><br><span class="line">     &#123;</span><br><span class="line">          TranslateMessage (&amp;msg) ;</span><br><span class="line">          DispatchMessage  (&amp;msg) ;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>IsDialogMessage不止会判断该消息是不是非模态对话框的,并且会把是非模态对话框的消息发送</p>
<p>hDlgModeless是一个对WinMain和对话框过程都可见的全局变量,为啥要对WndProc也可见呢?</p>
<p>得想办法该关闭非模态对话框的时候就得关上吧,这个关闭怎么才能让WinMain知道?</p>
<p>修改hDlgModeless值为NULL,</p>
<p>谁来修改?WndProc吗?WndProc只负责父窗口的逻辑,关于非模态对话框它不管</p>
<p>因此需要非模态对话框自己决定关闭hDlgModeless</p>
<h3 id="colors3但是摆大烂">COLORS3,但是摆大烂</h3>
<p>windows甚至把专门调色的对话框都准备好了</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;commdlg.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> WINAPI <span class="title function_">WinMain</span> <span class="params">(HINSTANCE hInstance, HINSTANCE hPrevInstance,</span></span><br><span class="line"><span class="params">                    PSTR szCmdLine, <span class="type">int</span> iCmdShow)</span></span><br><span class="line">&#123;</span><br><span class="line">     <span class="type">static</span> CHOOSECOLOR cc ;</span><br><span class="line">     <span class="type">static</span> COLORREF    crCustColors[<span class="number">16</span>] ;</span><br><span class="line">     cc.lStructSize    = <span class="keyword">sizeof</span> (CHOOSECOLOR) ;</span><br><span class="line">     cc.hwndOwner      = <span class="literal">NULL</span> ;</span><br><span class="line">     cc.hInstance      = <span class="literal">NULL</span> ;</span><br><span class="line">     cc.rgbResult      = RGB (<span class="number">0x80</span>, <span class="number">0x80</span>, <span class="number">0x80</span>) ;</span><br><span class="line">     cc.lpCustColors   = crCustColors ;</span><br><span class="line">     cc.Flags          = CC_RGBINIT | CC_FULLOPEN ;</span><br><span class="line">     cc.lCustData      = <span class="number">0</span> ;</span><br><span class="line">     cc.lpfnHook       = <span class="literal">NULL</span> ;</span><br><span class="line">     cc.lpTemplateName = <span class="literal">NULL</span> ;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">return</span> ChooseColor(&amp;cc) ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>就这么几行实现了一个调色的功能</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220824160618978.png"
alt="image-20220824160618978" />
<figcaption aria-hidden="true">image-20220824160618978</figcaption>
</figure>
<p>在老版本的windows绘图上,就是用的这个调色板,比如windows7上的</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220824160851851.png"
alt="这不win7调色板吗,几天没见,这么拉了" />
<figcaption
aria-hidden="true">这不win7调色板吗,几天没见,这么拉了</figcaption>
</figure>
<p>实际上是调用<code>ChooseColor(&amp;cc)</code>函数完成的,只需要给这个函数传递一个CHOOSECOLOR指针,就可以使用面板交互方式调制颜色了</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">tagCHOOSECOLORW</span> &#123;</span></span><br><span class="line">  DWORD        lStructSize;<span class="comment">//本结构体大小,冗余量</span></span><br><span class="line">  HWND         hwndOwner;<span class="comment">//调用ChooseColor函数产生的对话框的父窗口</span></span><br><span class="line">  HWND         hInstance;<span class="comment">//应用程序实例</span></span><br><span class="line">  COLORREF     rgbResult;<span class="comment">//RGB值,初始化一开始显式的颜色值</span></span><br><span class="line">  COLORREF     *lpCustColors;<span class="comment">//16色值,灰度,用于LowB电脑</span></span><br><span class="line">  DWORD        Flags;<span class="comment">//样式</span></span><br><span class="line">  LPARAM       lCustData;<span class="comment">//钩子过程参数</span></span><br><span class="line">  LPCCHOOKPROC lpfnHook;<span class="comment">//钩子回调函数,需要Flags上置起CC_ENABLEHOOK标志</span></span><br><span class="line">  LPCWSTR      lpTemplateName;<span class="comment">//类名称或者ID</span></span><br><span class="line">  LPEDITMENU   lpEditInfo;</span><br><span class="line">&#125; CHOOSECOLORW, *LPCHOOSECOLORW;</span><br></pre></td></tr></table></figure>
<h3 id="hexcalc">HEXCALC</h3>
<p>不到150行源代码实现一个16进制计算器</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">LRESULT CALLBACK <span class="title function_">WndProc</span> <span class="params">(HWND, UINT, WPARAM, LPARAM)</span> ;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> WINAPI <span class="title function_">WinMain</span> <span class="params">(HINSTANCE hInstance, HINSTANCE hPrevInstance,</span></span><br><span class="line"><span class="params">                    PSTR szCmdLine, <span class="type">int</span> iCmdShow)</span></span><br><span class="line">&#123;</span><br><span class="line">     <span class="type">static</span> TCHAR szAppName[] = TEXT (<span class="string">&quot;HexCalc&quot;</span>) ;</span><br><span class="line">     HWND         hwnd ;</span><br><span class="line">     MSG          msg ;</span><br><span class="line">     WNDCLASS     wndclass ;</span><br><span class="line">     </span><br><span class="line">     wndclass.style         = CS_HREDRAW | CS_VREDRAW;</span><br><span class="line">     wndclass.lpfnWndProc   = WndProc ;</span><br><span class="line">     wndclass.cbClsExtra    = <span class="number">0</span> ;</span><br><span class="line">     wndclass.cbWndExtra    = DLGWINDOWEXTRA ;    <span class="comment">// Note!//30bytes</span></span><br><span class="line">     wndclass.hInstance     = hInstance ;</span><br><span class="line">     wndclass.hIcon         = LoadIcon (hInstance, szAppName) ;</span><br><span class="line">     wndclass.hCursor       = LoadCursor (<span class="literal">NULL</span>, IDC_ARROW) ;</span><br><span class="line">     wndclass.hbrBackground = (HBRUSH) (COLOR_BTNFACE + <span class="number">1</span>) ;</span><br><span class="line">     wndclass.lpszMenuName  = <span class="literal">NULL</span> ;</span><br><span class="line">     wndclass.lpszClassName = szAppName ;</span><br><span class="line">     </span><br><span class="line">     <span class="keyword">if</span> (!RegisterClass (&amp;wndclass))</span><br><span class="line">     &#123;</span><br><span class="line">          MessageBox (<span class="literal">NULL</span>, TEXT (<span class="string">&quot;This program requires Windows NT!&quot;</span>),</span><br><span class="line">                      szAppName, MB_ICONERROR) ;</span><br><span class="line">          <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">     &#125;</span><br><span class="line">     </span><br><span class="line">     hwnd = CreateDialog (hInstance, szAppName, <span class="number">0</span>, <span class="literal">NULL</span>) ;<span class="comment">//创建非模态对话框</span></span><br><span class="line">     </span><br><span class="line">     ShowWindow (hwnd, iCmdShow) ;<span class="comment">//把对话框作为窗口</span></span><br><span class="line">     </span><br><span class="line">     <span class="keyword">while</span> (GetMessage (&amp;msg, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>))</span><br><span class="line">     &#123;</span><br><span class="line">          TranslateMessage (&amp;msg) ;</span><br><span class="line">          DispatchMessage (&amp;msg) ;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> msg.wParam ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">ShowNumber</span> <span class="params">(HWND hwnd, UINT iNumber)</span></span><br><span class="line">&#123;</span><br><span class="line">     TCHAR szBuffer[<span class="number">20</span>] ;</span><br><span class="line"></span><br><span class="line">     wsprintf (szBuffer, TEXT (<span class="string">&quot;%X&quot;</span>), iNumber) ;</span><br><span class="line">     SetDlgItemText (hwnd, VK_ESCAPE, szBuffer) ;<span class="comment">//设置VK_ESCAPE控件的描述字</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DWORD <span class="title function_">CalcIt</span> <span class="params">(UINT iFirstNum, <span class="type">int</span> iOperation, UINT iNum)</span></span><br><span class="line">&#123;</span><br><span class="line">     <span class="keyword">switch</span> (iOperation)</span><br><span class="line">     &#123;</span><br><span class="line">     <span class="keyword">case</span> <span class="string">&#x27;=&#x27;</span>: <span class="keyword">return</span> iNum ;</span><br><span class="line">     <span class="keyword">case</span> <span class="string">&#x27;+&#x27;</span>: <span class="keyword">return</span> iFirstNum +  iNum ;</span><br><span class="line">     <span class="keyword">case</span> <span class="string">&#x27;-&#x27;</span>: <span class="keyword">return</span> iFirstNum -  iNum ;</span><br><span class="line">     <span class="keyword">case</span> <span class="string">&#x27;*&#x27;</span>: <span class="keyword">return</span> iFirstNum *  iNum ;</span><br><span class="line">     <span class="keyword">case</span> <span class="string">&#x27;&amp;&#x27;</span>: <span class="keyword">return</span> iFirstNum &amp;  iNum ;</span><br><span class="line">     <span class="keyword">case</span> <span class="string">&#x27;|&#x27;</span>: <span class="keyword">return</span> iFirstNum |  iNum ;</span><br><span class="line">     <span class="keyword">case</span> <span class="string">&#x27;^&#x27;</span>: <span class="keyword">return</span> iFirstNum ^  iNum ;</span><br><span class="line">     <span class="keyword">case</span> <span class="string">&#x27;&lt;&#x27;</span>: <span class="keyword">return</span> iFirstNum &lt;&lt; iNum ;</span><br><span class="line">     <span class="keyword">case</span> <span class="string">&#x27;&gt;&#x27;</span>: <span class="keyword">return</span> iFirstNum &gt;&gt; iNum ;</span><br><span class="line">     <span class="keyword">case</span> <span class="string">&#x27;/&#x27;</span>: <span class="keyword">return</span> iNum ? iFirstNum / iNum: MAXDWORD ;</span><br><span class="line">     <span class="keyword">case</span> <span class="string">&#x27;%&#x27;</span>: <span class="keyword">return</span> iNum ? iFirstNum % iNum: MAXDWORD ;</span><br><span class="line">     <span class="keyword">default</span> : <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LRESULT CALLBACK <span class="title function_">WndProc</span> <span class="params">(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)</span></span><br><span class="line">&#123;</span><br><span class="line">     <span class="type">static</span> BOOL  bNewNumber = TRUE ;</span><br><span class="line">     <span class="type">static</span> <span class="type">int</span>   iOperation = <span class="string">&#x27;=&#x27;</span> ;</span><br><span class="line">     <span class="type">static</span> UINT  iNumber, iFirstNum ;</span><br><span class="line">     HWND         hButton ;</span><br><span class="line">     </span><br><span class="line">     <span class="keyword">switch</span> (message)</span><br><span class="line">     &#123;</span><br><span class="line">     <span class="keyword">case</span> WM_KEYDOWN:                   <span class="comment">// left arrow --&gt; backspace</span></span><br><span class="line">          <span class="keyword">if</span> (wParam != VK_LEFT)</span><br><span class="line">               <span class="keyword">break</span> ;</span><br><span class="line">          wParam = VK_BACK ;</span><br><span class="line">                                        <span class="comment">// fall through</span></span><br><span class="line">     <span class="keyword">case</span> WM_CHAR:</span><br><span class="line">          <span class="keyword">if</span> ((wParam = (WPARAM) CharUpper ((TCHAR *) wParam)) == VK_RETURN)</span><br><span class="line">               wParam = <span class="string">&#x27;=&#x27;</span> ;</span><br><span class="line">          </span><br><span class="line">          <span class="keyword">if</span> (hButton = GetDlgItem (hwnd, wParam))<span class="comment">//字符消息的wParam就是字符的ASCII码,而对话框脚本中我们也把按钮的ID设置成了对应字符的ASCII码</span></span><br><span class="line">          &#123;</span><br><span class="line">               SendMessage (hButton, BM_SETSTATE, <span class="number">1</span>, <span class="number">0</span>) ;<span class="comment">//按下状态</span></span><br><span class="line">               Sleep (<span class="number">100</span>) ;<span class="comment">//按下状态持续0.1秒,让人能看见</span></span><br><span class="line">               SendMessage (hButton, BM_SETSTATE, <span class="number">0</span>, <span class="number">0</span>) ;<span class="comment">//起来</span></span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">          &#123;</span><br><span class="line">               MessageBeep (<span class="number">0</span>) ;<span class="comment">//没点到按钮就叫唤</span></span><br><span class="line">               <span class="keyword">break</span> ;</span><br><span class="line">          &#125;</span><br><span class="line">                                        <span class="comment">// fall through</span></span><br><span class="line">     <span class="keyword">case</span> WM_COMMAND:</span><br><span class="line">          SetFocus (hwnd) ;</span><br><span class="line">          </span><br><span class="line">          <span class="keyword">if</span> (LOWORD (wParam) == VK_BACK)         <span class="comment">// backspace</span></span><br><span class="line">               ShowNumber (hwnd, iNumber /= <span class="number">16</span>) ;<span class="comment">//16进制数右移一位</span></span><br><span class="line">          </span><br><span class="line">          <span class="keyword">else</span> <span class="keyword">if</span> (LOWORD (wParam) == VK_ESCAPE)  <span class="comment">// escape</span></span><br><span class="line">               ShowNumber (hwnd, iNumber = <span class="number">0</span>) ;</span><br><span class="line">          </span><br><span class="line">          <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">isxdigit</span> (LOWORD (wParam)))    <span class="comment">// hex digit//判断是否是16进制数,0-9,A-F</span></span><br><span class="line">          &#123;</span><br><span class="line">               <span class="keyword">if</span> (bNewNumber)<span class="comment">//如果是新的计算局面</span></span><br><span class="line">               &#123;</span><br><span class="line">                    iFirstNum = iNumber ;<span class="comment">//第一个操作数置为iNumber</span></span><br><span class="line">                    iNumber = <span class="number">0</span> ;<span class="comment">//第二个操作数尚未到来,虚位以待</span></span><br><span class="line">               &#125;</span><br><span class="line">               bNewNumber = FALSE ;<span class="comment">//置局面混乱</span></span><br><span class="line">               </span><br><span class="line">               <span class="keyword">if</span> (iNumber &lt;= MAXDWORD &gt;&gt; <span class="number">4</span>)</span><br><span class="line">                    ShowNumber (hwnd, iNumber = <span class="number">16</span> * iNumber + wParam -</span><br><span class="line">                    (<span class="built_in">isdigit</span> (wParam) ? <span class="string">&#x27;0&#x27;</span>: <span class="string">&#x27;A&#x27;</span> - <span class="number">10</span>)) ;</span><br><span class="line">               <span class="keyword">else</span></span><br><span class="line">                    MessageBeep (<span class="number">0</span>) ;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span>                                    <span class="comment">// operation</span></span><br><span class="line">          &#123;</span><br><span class="line">               <span class="keyword">if</span> (!bNewNumber)<span class="comment">//如果不是16进制数,即不是操作数,那就是操作符了</span></span><br><span class="line">                    ShowNumber (hwnd, iNumber =CalcIt (iFirstNum, iOperation, iNumber)) ;</span><br><span class="line">               bNewNumber = TRUE ;</span><br><span class="line">               iOperation = LOWORD (wParam) ;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">          </span><br><span class="line">     <span class="keyword">case</span> WM_DESTROY:</span><br><span class="line">          PostQuitMessage (<span class="number">0</span>) ;</span><br><span class="line">          <span class="keyword">return</span> <span class="number">0</span> ;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> DefWindowProc (hwnd, message, wParam, lParam) ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="窗口额外">窗口额外</h4>
<p>cbClsExtra
：windows程序为每一个窗口设计类管理一个WNDCLASS结构。在应用程序注册一个窗口类的时候，可以让windows分配一定字节空间的内存，这部分内存成为类的附件内存，有属于这个窗口类的所有窗口共享，类附件内存信息用于存储窗口类的附加信息。windows系统将这部分内存初始化为0，因此我们经常设置此参数为0.</p>
<p>cbWndExtra
:windows程序为每一个窗口管理一个内部数据结构，在注册窗口类的时候，系统可以为每一个窗口分配一定的字节数的附加内存空间，称为窗口附件内存。应用程序可使用这部分内存存储窗口特有的数据，windows系统把这部分内存初始化为0.</p>
<h4 id="hexcalc.dlg">HEXCALC.DLG</h4>
<p>这个文件不在rc文件中,而是独立成文件,然后被包含进入RC文件</p>
<p>为啥不能直接放到RC里呢?因为visual studio没有添加对话框资源的选项</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220824165419486.png"
alt="image-20220824165419486" />
<figcaption aria-hidden="true">image-20220824165419486</figcaption>
</figure>
<p>这个对话框脚本是手打的,然后在资源脚本RC中导入:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3</span> TEXTINCLUDE DISCARDABLE </span><br><span class="line">BEGIN</span><br><span class="line">    <span class="string">&quot;#include &quot;</span><span class="string">&quot;hexcalc.dlg&quot;</span><span class="string">&quot;\r\n&quot;</span></span><br><span class="line">    <span class="string">&quot;\0&quot;</span></span><br><span class="line">END</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*---------------------------</span></span><br><span class="line"><span class="comment">   HEXCALC.DLG dialog script</span></span><br><span class="line"><span class="comment">  ---------------------------*/</span></span><br><span class="line"></span><br><span class="line">HexCalc DIALOG <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">102</span>, <span class="number">122</span></span><br><span class="line">STYLE WS_OVERLAPPED | WS_CAPTION | WS_SYSMENU | WS_MINIMIZEBOX<span class="comment">//层叠,标题,系统菜单,最小方框</span></span><br><span class="line">CLASS <span class="string">&quot;HexCalc&quot;</span><span class="comment">//类名HexCalc</span></span><br><span class="line">CAPTION <span class="string">&quot;Hex Calculator&quot;</span></span><br><span class="line">&#123;</span><br><span class="line">     PUSHBUTTON <span class="string">&quot;D&quot;</span>,       <span class="number">68</span>,  <span class="number">8</span>,  <span class="number">24</span>, <span class="number">14</span>, <span class="number">14</span><span class="comment">//按钮 &quot;D&quot;,字符68位置(8,24)宽高14</span></span><br><span class="line">     PUSHBUTTON <span class="string">&quot;A&quot;</span>,       <span class="number">65</span>,  <span class="number">8</span>,  <span class="number">40</span>, <span class="number">14</span>, <span class="number">14</span></span><br><span class="line">     PUSHBUTTON <span class="string">&quot;7&quot;</span>,       <span class="number">55</span>,  <span class="number">8</span>,  <span class="number">56</span>, <span class="number">14</span>, <span class="number">14</span></span><br><span class="line">     PUSHBUTTON <span class="string">&quot;4&quot;</span>,       <span class="number">52</span>,  <span class="number">8</span>,  <span class="number">72</span>, <span class="number">14</span>, <span class="number">14</span></span><br><span class="line">     PUSHBUTTON <span class="string">&quot;1&quot;</span>,       <span class="number">49</span>,  <span class="number">8</span>,  <span class="number">88</span>, <span class="number">14</span>, <span class="number">14</span></span><br><span class="line">     PUSHBUTTON <span class="string">&quot;0&quot;</span>,       <span class="number">48</span>,  <span class="number">8</span>, <span class="number">104</span>, <span class="number">14</span>, <span class="number">14</span></span><br><span class="line">     PUSHBUTTON <span class="string">&quot;0&quot;</span>,       <span class="number">27</span>, <span class="number">26</span>,   <span class="number">4</span>, <span class="number">50</span>, <span class="number">14</span></span><br><span class="line">     PUSHBUTTON <span class="string">&quot;E&quot;</span>,       <span class="number">69</span>, <span class="number">26</span>,  <span class="number">24</span>, <span class="number">14</span>, <span class="number">14</span></span><br><span class="line">     PUSHBUTTON <span class="string">&quot;B&quot;</span>,       <span class="number">66</span>, <span class="number">26</span>,  <span class="number">40</span>, <span class="number">14</span>, <span class="number">14</span></span><br><span class="line">     PUSHBUTTON <span class="string">&quot;8&quot;</span>,       <span class="number">56</span>, <span class="number">26</span>,  <span class="number">56</span>, <span class="number">14</span>, <span class="number">14</span></span><br><span class="line">     PUSHBUTTON <span class="string">&quot;5&quot;</span>,       <span class="number">53</span>, <span class="number">26</span>,  <span class="number">72</span>, <span class="number">14</span>, <span class="number">14</span></span><br><span class="line">     PUSHBUTTON <span class="string">&quot;2&quot;</span>,       <span class="number">50</span>, <span class="number">26</span>,  <span class="number">88</span>, <span class="number">14</span>, <span class="number">14</span></span><br><span class="line">     PUSHBUTTON <span class="string">&quot;Back&quot;</span>,     <span class="number">8</span>, <span class="number">26</span>, <span class="number">104</span>, <span class="number">32</span>, <span class="number">14</span></span><br><span class="line">     PUSHBUTTON <span class="string">&quot;C&quot;</span>,       <span class="number">67</span>, <span class="number">44</span>,  <span class="number">40</span>, <span class="number">14</span>, <span class="number">14</span></span><br><span class="line">     PUSHBUTTON <span class="string">&quot;F&quot;</span>,       <span class="number">70</span>, <span class="number">44</span>,  <span class="number">24</span>, <span class="number">14</span>, <span class="number">14</span></span><br><span class="line">     PUSHBUTTON <span class="string">&quot;9&quot;</span>,       <span class="number">57</span>, <span class="number">44</span>,  <span class="number">56</span>, <span class="number">14</span>, <span class="number">14</span></span><br><span class="line">     PUSHBUTTON <span class="string">&quot;6&quot;</span>,       <span class="number">54</span>, <span class="number">44</span>,  <span class="number">72</span>, <span class="number">14</span>, <span class="number">14</span></span><br><span class="line">     PUSHBUTTON <span class="string">&quot;3&quot;</span>,       <span class="number">51</span>, <span class="number">44</span>,  <span class="number">88</span>, <span class="number">14</span>, <span class="number">14</span></span><br><span class="line">     PUSHBUTTON <span class="string">&quot;+&quot;</span>,       <span class="number">43</span>, <span class="number">62</span>,  <span class="number">24</span>, <span class="number">14</span>, <span class="number">14</span></span><br><span class="line">     PUSHBUTTON <span class="string">&quot;-&quot;</span>,       <span class="number">45</span>, <span class="number">62</span>,  <span class="number">40</span>, <span class="number">14</span>, <span class="number">14</span></span><br><span class="line">     PUSHBUTTON <span class="string">&quot;*&quot;</span>,       <span class="number">42</span>, <span class="number">62</span>,  <span class="number">56</span>, <span class="number">14</span>, <span class="number">14</span></span><br><span class="line">     PUSHBUTTON <span class="string">&quot;/&quot;</span>,       <span class="number">47</span>, <span class="number">62</span>,  <span class="number">72</span>, <span class="number">14</span>, <span class="number">14</span></span><br><span class="line">     PUSHBUTTON <span class="string">&quot;%&quot;</span>,       <span class="number">37</span>, <span class="number">62</span>,  <span class="number">88</span>, <span class="number">14</span>, <span class="number">14</span></span><br><span class="line">     PUSHBUTTON <span class="string">&quot;Equals&quot;</span>,  <span class="number">61</span>, <span class="number">62</span>, <span class="number">104</span>, <span class="number">32</span>, <span class="number">14</span></span><br><span class="line">     PUSHBUTTON <span class="string">&quot;&amp;&amp;&quot;</span>,      <span class="number">38</span>, <span class="number">80</span>,  <span class="number">24</span>, <span class="number">14</span>, <span class="number">14</span></span><br><span class="line">     PUSHBUTTON <span class="string">&quot;|&quot;</span>,      <span class="number">124</span>, <span class="number">80</span>,  <span class="number">40</span>, <span class="number">14</span>, <span class="number">14</span></span><br><span class="line">     PUSHBUTTON <span class="string">&quot;^&quot;</span>,       <span class="number">94</span>, <span class="number">80</span>,  <span class="number">56</span>, <span class="number">14</span>, <span class="number">14</span></span><br><span class="line">     PUSHBUTTON <span class="string">&quot;&lt;&quot;</span>,       <span class="number">60</span>, <span class="number">80</span>,  <span class="number">72</span>, <span class="number">14</span>, <span class="number">14</span></span><br><span class="line">     PUSHBUTTON <span class="string">&quot;&gt;&quot;</span>,       <span class="number">62</span>, <span class="number">80</span>,  <span class="number">88</span>, <span class="number">14</span>, <span class="number">14</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>全是按钮的对话框,但是没有定义动作,我们需要给每个按钮按下之后的效果编程</p>
<p>这个怎么实现的呢?</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> WM_CHAR:</span><br><span class="line">     <span class="keyword">if</span> ((wParam = (WPARAM) CharUpper ((TCHAR *) wParam)) == VK_RETURN)</span><br><span class="line">          wParam = <span class="string">&#x27;=&#x27;</span> ;</span><br><span class="line">     </span><br><span class="line">     <span class="keyword">if</span> (hButton = GetDlgItem (hwnd, wParam))<span class="comment">//字符消息的wParam就是字符的ASCII码,而对话框脚本中我们也把按钮的ID设置成了对应字符的ASCII码</span></span><br><span class="line">     &#123;</span><br><span class="line">          SendMessage (hButton, BM_SETSTATE, <span class="number">1</span>, <span class="number">0</span>) ;<span class="comment">//按下状态</span></span><br><span class="line">          Sleep (<span class="number">100</span>) ;<span class="comment">//按下状态持续0.1秒,让人能看见,知道自己按下去了</span></span><br><span class="line">          SendMessage (hButton, BM_SETSTATE, <span class="number">0</span>, <span class="number">0</span>) ;<span class="comment">//起来</span></span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">else</span></span><br><span class="line">     &#123;</span><br><span class="line">          MessageBeep (<span class="number">0</span>) ;<span class="comment">//没点到按钮就叫唤</span></span><br><span class="line">          <span class="keyword">break</span> ;</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>
<p>对话框脚本中故意设置按钮id和ASCII字符编码相同,因此非常方便</p>
<h2 id="对话框模板">对话框模板</h2>
<p>在COLORS3中,我们已经看到摆烂的力量,像调色板这种对话框模板再来一万个也不多</p>
<p>比如查找替换对话框</p>
<p>这些预定义好的对话框模板,都是以一个函数传递一个结构体指针创建的,这些结构体在commdlg.h中</p>
<p>用啥查啥的文档吧</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/windows%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/" rel="tag"># windows程序设计</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/08/23/windows%20SDK%20chapter%2010%20%E8%8F%9C%E5%8D%95%E4%B8%8E%E8%B5%84%E6%BA%90/" rel="prev" title="win32程序设计-chapter10 菜单">
      <i class="fa fa-chevron-left"></i> win32程序设计-chapter10 菜单
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/08/25/%E8%99%9A%E6%8B%9F%E7%A1%AC%E7%9B%98vhd/" rel="next" title="x86汇编语言 chapter 4 虚拟磁盘">
      x86汇编语言 chapter 4 虚拟磁盘 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#windows-sdk-chapter-11-%E5%AF%B9%E8%AF%9D%E6%A1%86"><span class="nav-number">1.</span> <span class="nav-text">windows SDK chapter 11
对话框</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A8%A1%E6%80%81%E5%AF%B9%E8%AF%9D%E6%A1%86"><span class="nav-number">1.1.</span> <span class="nav-text">模态对话框</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#about1"><span class="nav-number">1.1.1.</span> <span class="nav-text">About1</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%BE%E8%AE%A1%E5%AF%B9%E8%AF%9D%E6%A1%86"><span class="nav-number">1.1.1.1.</span> <span class="nav-text">设计对话框</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AF%B9%E8%AF%9D%E6%A1%86%E8%BF%87%E7%A8%8B"><span class="nav-number">1.1.1.2.</span> <span class="nav-text">对话框过程</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#about2"><span class="nav-number">1.1.2.</span> <span class="nav-text">About2</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B5%84%E6%BA%90%E8%84%9A%E6%9C%AC"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">资源脚本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F"><span class="nav-number">1.1.2.2.</span> <span class="nav-text">全局变量</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%88%B6%E7%AA%97%E5%8F%A3%E8%BF%87%E7%A8%8B"><span class="nav-number">1.1.2.3.</span> <span class="nav-text">父窗口过程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#paintwindow"><span class="nav-number">1.1.2.4.</span> <span class="nav-text">PaintWindow</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AF%B9%E8%AF%9D%E6%A1%86%E8%BF%87%E7%A8%8B-1"><span class="nav-number">1.1.2.5.</span> <span class="nav-text">对话框过程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#painttheblock"><span class="nav-number">1.1.2.6.</span> <span class="nav-text">PaintTheBlock</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9B%9E%E9%A1%BE%E7%88%B6%E5%AD%90%E9%80%9A%E4%BF%A1%E6%96%B9%E5%BC%8F"><span class="nav-number">1.1.2.7.</span> <span class="nav-text">回顾父子通信方式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%81%BF%E5%85%8D%E4%BD%BF%E7%94%A8%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F"><span class="nav-number">1.1.2.8.</span> <span class="nav-text">避免使用全局变量</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9B%9E%E9%A1%BE%E5%8D%95%E9%80%89%E4%BA%92%E6%96%A5%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="nav-number">1.1.2.9.</span> <span class="nav-text">回顾单选互斥的实现</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#about3"><span class="nav-number">1.1.3.</span> <span class="nav-text">About3</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B5%84%E6%BA%90%E8%84%9A%E6%9C%AC-1"><span class="nav-number">1.1.3.1.</span> <span class="nav-text">资源脚本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6%E8%BF%87%E7%A8%8B%E5%87%BD%E6%95%B0"><span class="nav-number">1.1.3.2.</span> <span class="nav-text">自定义控件过程函数</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9D%9E%E6%A8%A1%E6%80%81%E5%AF%B9%E8%AF%9D%E6%A1%86"><span class="nav-number">1.2.</span> <span class="nav-text">非模态对话框</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#colors"><span class="nav-number">1.2.1.</span> <span class="nav-text">COLORS</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AF%B9%E8%AF%9D%E6%A1%86%E8%B5%84%E6%BA%90"><span class="nav-number">1.2.1.1.</span> <span class="nav-text">对话框资源</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#createdialog%E5%92%8Cdialogbox"><span class="nav-number">1.2.1.2.</span> <span class="nav-text">CreateDialog和DialogBox</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%B0%E6%B6%88%E6%81%AF%E5%BE%AA%E7%8E%AF"><span class="nav-number">1.2.1.3.</span> <span class="nav-text">新消息循环</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#colors3%E4%BD%86%E6%98%AF%E6%91%86%E5%A4%A7%E7%83%82"><span class="nav-number">1.2.2.</span> <span class="nav-text">COLORS3,但是摆大烂</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#hexcalc"><span class="nav-number">1.2.3.</span> <span class="nav-text">HEXCALC</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AA%97%E5%8F%A3%E9%A2%9D%E5%A4%96"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">窗口额外</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#hexcalc.dlg"><span class="nav-number">1.2.3.2.</span> <span class="nav-text">HEXCALC.DLG</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%B9%E8%AF%9D%E6%A1%86%E6%A8%A1%E6%9D%BF"><span class="nav-number">1.3.</span> <span class="nav-text">对话框模板</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="dustball"
      src="https://raw.githubusercontent.com/DeutschBall/picbed/main/dustball.png">
  <p class="site-author-name" itemprop="name">dustball</p>
  <div class="site-description" itemprop="description">dustland</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">37</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">dustball</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        
<div class="busuanzi-count">
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/pjax/pjax.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  
  <script data-pjax>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>




  
<script src="//cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js"></script>
<script src="//cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js"></script>
<script src="/js/algolia-search.js"></script>












<script data-pjax>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'dark',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


    <div id="pjax">
  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
          load: ['[tex]/mhchem'],
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
          packages: {'[+]': ['mhchem']},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

    </div>
</body>
</html>
