<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Cascadia Code:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"deutschball.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":-1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="windows SDK chapter 21 动态链接库 库的类型            库类型 拓展名 作用 举例 使用时期 是否链接进入可执行目标文件     对象库(静态库) .lib .obj目标模块集合 LIBC.lib 开发时 是   导入库 .lib 链接器使用它解析函数调用 kernel32.lib 开发时">
<meta property="og:type" content="article">
<meta property="og:title" content="win32程序设计-chapter21 动态链接库与消息钩取">
<meta property="og:url" content="http://deutschball.github.io/2022/08/20/windows%20SDK%20chapter%2021%20%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93/index.html">
<meta property="og:site_name" content="dustland">
<meta property="og:description" content="windows SDK chapter 21 动态链接库 库的类型            库类型 拓展名 作用 举例 使用时期 是否链接进入可执行目标文件     对象库(静态库) .lib .obj目标模块集合 LIBC.lib 开发时 是   导入库 .lib 链接器使用它解析函数调用 kernel32.lib 开发时">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-08-20T01:40:00.000Z">
<meta property="article:modified_time" content="2022-08-20T08:34:30.554Z">
<meta property="article:author" content="dustball">
<meta property="article:tag" content="windows程序设计">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://deutschball.github.io/2022/08/20/windows%20SDK%20chapter%2021%20%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>win32程序设计-chapter21 动态链接库与消息钩取 | dustland</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">dustland</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">dustball in dustland</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/deutschball" class="github-corner" title="Follow me on GayHub" aria-label="Follow me on GayHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://deutschball.github.io/2022/08/20/windows%20SDK%20chapter%2021%20%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/DeutschBall/picbed/main/dustball.png">
      <meta itemprop="name" content="dustball">
      <meta itemprop="description" content="dustland">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dustland">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          win32程序设计-chapter21 动态链接库与消息钩取
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-08-20 09:40:00 / Modified: 16:34:30" itemprop="dateCreated datePublished" datetime="2022-08-20T09:40:00+08:00">2022-08-20</time>
            </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="windows-sdk-chapter-21-动态链接库">windows SDK chapter 21
动态链接库</h1>
<h2 id="库的类型">库的类型</h2>
<table>
<colgroup>
<col style="width: 15%" />
<col style="width: 6%" />
<col style="width: 26%" />
<col style="width: 13%" />
<col style="width: 8%" />
<col style="width: 28%" />
</colgroup>
<thead>
<tr>
<th>库类型</th>
<th>拓展名</th>
<th>作用</th>
<th>举例</th>
<th>使用时期</th>
<th>是否链接进入可执行目标文件</th>
</tr>
</thead>
<tbody>
<tr>
<td>对象库(静态库)</td>
<td>.lib</td>
<td>.obj目标模块集合</td>
<td>LIBC.lib</td>
<td>开发时</td>
<td>是</td>
</tr>
<tr>
<td>导入库</td>
<td>.lib</td>
<td>链接器使用它解析函数调用</td>
<td>kernel32.lib</td>
<td>开发时</td>
<td>是</td>
</tr>
<tr>
<td>动态链接库</td>
<td>.dll</td>
<td>运行时提供支持</td>
<td>kernel32.dll</td>
<td>运行时</td>
<td>否</td>
</tr>
</tbody>
</table>
<h2 id="库的位置">库的位置</h2>
<p>类似于头文件的搜索顺序,当一个exe程序需要dll支持的时候,windows搜索dll也是有顺序的,编译链接时不需要指定动态库位置</p>
<p>1.exe文件同在的目录</p>
<p>2.shell的当前目录(pwd)</p>
<p>3.windows系统目录,即C://Windows/system32文件夹</p>
<p>4.windows目录,即C://Windows文件夹</p>
<p>5.DOS环境下PATH环境变量</p>
<p>如果在某一步找到则不再继续寻找</p>
<h2 id="visual-c和visual-studio">Visual C++和Visual Studio</h2>
<p>由于这本书年代比较久远,当时的集成开发环境还是VC++,而现在win11上装一个兼容的VC++都不容易了</p>
<p>VC++中的"workspace"对应到VS上就是解决方案"solution"</p>
<p>一个工作区/解决方案
下面可以建立多个项目,一个项目对应一个应用程序或者一个DLL</p>
<h2 id="linux上的链接与库">Linux上的链接与库</h2>
<p>此部分在CSAPP-chapter -7链接已经学过,在此只回顾一下GNU GCC命令</p>
<h3 id="预编译">预编译</h3>
<p>预编译,将源文件.c或者.cpp的宏定义展开成.i文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cpp main.c &gt; main.i</span><br></pre></td></tr></table></figure>
<blockquote>
<p>需要输出重定向到main.i,否则cpp命令默认输出到屏幕</p>
</blockquote>
<h3 id="汇编">汇编</h3>
<p>汇编,将源文件汇编成汇编语言文件.s</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc main.c -S</span><br></pre></td></tr></table></figure>
<h3 id="编译">编译</h3>
<p>编译,将源文件编译成可重定位目标文件.o</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc main.c -c -o main.o</span><br></pre></td></tr></table></figure>
<h3 id="链接">链接</h3>
<p>将多个可重定位目标模块链接成可执行目标模块.out</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc main.o func.o -o main.out</span><br></pre></td></tr></table></figure>
<h3 id="创建静态库">创建静态库</h3>
<p>将一个或多个可重定位目标模块.o,创建成静态库.a(归档文件)</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ar rcs libmain.a main.o</span><br></pre></td></tr></table></figure>
<h3 id="创建动态库">创建动态库</h3>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -shared -fPIC main.c -o main.so</span><br></pre></td></tr></table></figure>
<h2 id="visual-studio-创建使用库">Visual Studio 创建使用库</h2>
<p>Microsoft Visual Studio 2022</p>
<h3 id="静态库的使用">静态库的使用</h3>
<h4 id="创建静态库-1">创建静态库</h4>
<h5 id="新建空白解决方案">1.新建空白解决方案</h5>
<p>(在VC++上"解决方案"叫做workspace工作区)</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220721155939293.png"
alt="image-20220721155939293" />
<figcaption aria-hidden="true">image-20220721155939293</figcaption>
</figure>
<h5 id="配置新项目">2.配置新"项目"</h5>
<p>解决方案名称就叫做"MATHTOOLS"吧,</p>
<p>一个解决方案可以包含多个项目,但是新建解决方案时也是通过"新建项目"选项卡实现的</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220721160058473.png"
alt="image-20220721160058473" />
<figcaption aria-hidden="true">image-20220721160058473</figcaption>
</figure>
<h5 id="新建静态库工程">3.新建静态库工程</h5>
<p>在"解决方案资源管理器"中(视图-&gt;解决方案资源管理器或者Ctrl+Alt+L唤醒),</p>
<p>在"解决方案'MATHTOOLS'(0个项目)"上右键-&gt;新建项目</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220721160318596.png"
alt="image-20220721160318596" />
<figcaption aria-hidden="true">image-20220721160318596</figcaption>
</figure>
<h5
id="在添加新项目搜索框中搜索静态库">4.在添加新项目搜索框中搜索"静态库"</h5>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220721160358962.png"
alt="image-20220721160358962" />
<figcaption aria-hidden="true">image-20220721160358962</figcaption>
</figure>
<h5 id="配置静态库项目">5.配置静态库项目</h5>
<p>起个名,然后创建</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220721160433974.png"
alt="image-20220721160433974" />
<figcaption aria-hidden="true">image-20220721160433974</figcaption>
</figure>
<h5
id="建立静态库项目之后的解决方案资源管理器">6.建立静态库项目之后的解决方案资源管理器</h5>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220721160547138.png"
alt="image-20220721160547138" />
<figcaption aria-hidden="true">image-20220721160547138</figcaption>
</figure>
<p>有一些vs自动帮我们生成的文件,比如<code>pch.h,framework.h,pch.cpp,MATHLIB.cpp</code></p>
<p>然而这些都是可有可无的</p>
<h5 id="不使用预编译头">7.不使用预编译头</h5>
<p>在解决方案资源管理器-&gt;MATHLIB项目 上右键,属性</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220721160748513.png"
alt="image-20220721160748513" />
<figcaption aria-hidden="true">image-20220721160748513</figcaption>
</figure>
<p>在弹出的属性页中将陪着和平台都改成所有的</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220721160818483.png"
alt="image-20220721160818483" />
<figcaption aria-hidden="true">image-20220721160818483</figcaption>
</figure>
<p>然后配置属性-&gt;C/C++-&gt;预编译头-&gt;不使用预编译头</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220721160906154.png"
alt="image-20220721160906154" />
<figcaption aria-hidden="true">image-20220721160906154</figcaption>
</figure>
<h5 id="新建mathlib.h和mathlib.cpp">8.新建MathLib.h和MathLib.cpp</h5>
<p>删掉头文件和源文件中vs帮我们建立好的文件,然后在头文件和源文件夹下面分别新建MathLib.h和MathLib.cpp</p>
<p><code>MathLib.h</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">	<span class="type">double</span> x;</span><br><span class="line">	<span class="type">double</span> y;</span><br><span class="line">	<span class="built_in">Point</span>(<span class="type">const</span> <span class="type">double</span> &amp;x,<span class="type">const</span> <span class="type">double</span> &amp;y);</span><br><span class="line">	<span class="built_in">Point</span>();</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">setCoordinate</span><span class="params">(<span class="type">const</span> <span class="type">double</span>&amp; x, <span class="type">const</span> <span class="type">double</span>&amp; y)</span></span>;</span><br><span class="line">	<span class="function"><span class="type">double</span>&amp; <span class="title">X</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="type">double</span>&amp; <span class="title">Y</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="type">const</span> <span class="type">double</span> <span class="title">getEuclidianDistance</span><span class="params">(<span class="type">const</span> Point&amp; p)</span><span class="type">const</span></span>;</span><br><span class="line">	<span class="function"><span class="type">const</span> <span class="type">double</span> <span class="title">getManHatonDistance</span><span class="params">(<span class="type">const</span> Point&amp; p)</span><span class="type">const</span></span>;</span><br><span class="line">	<span class="function"><span class="type">double</span> <span class="title">getSlope</span><span class="params">(<span class="type">const</span> Point&amp; p)</span><span class="type">const</span></span>;</span><br><span class="line">	<span class="keyword">friend</span> std::ostream&amp; <span class="keyword">operator</span>&lt;&lt;(std::ostream&amp; os, <span class="type">const</span> Point&amp; p);</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Line</span> &#123;</span><br><span class="line">	Point a;</span><br><span class="line">	Point b;</span><br><span class="line">	<span class="built_in">Line</span>();</span><br><span class="line">	<span class="built_in">Line</span>(<span class="type">const</span> Point&amp; a, <span class="type">const</span> Point&amp; b);</span><br><span class="line">	<span class="function"><span class="type">double</span> <span class="title">length</span><span class="params">()</span><span class="type">const</span></span>;</span><br><span class="line">	<span class="function">Point &amp;<span class="title">A</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function">Point &amp;<span class="title">B</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="type">double</span> <span class="title">getSlope</span><span class="params">()</span><span class="type">const</span></span>;</span><br><span class="line">	<span class="keyword">friend</span> std::ostream&amp; <span class="keyword">operator</span>&lt;&lt;(std::ostream&amp; os, <span class="type">const</span> Line&amp; l);</span><br><span class="line">	<span class="function"><span class="type">bool</span> <span class="title">isParallel</span><span class="params">(<span class="type">const</span> Line &amp;l)</span><span class="type">const</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>MathLib.cpp</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;MathLib.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">Point::<span class="built_in">Point</span>(<span class="type">const</span> <span class="type">double</span>&amp; x, <span class="type">const</span> <span class="type">double</span>&amp; y) &#123;</span><br><span class="line">	<span class="keyword">this</span>-&gt;x = x;</span><br><span class="line">	<span class="keyword">this</span>-&gt;y = y;</span><br><span class="line">	&#125;</span><br><span class="line">Point::<span class="built_in">Point</span>() &#123;</span><br><span class="line">	<span class="keyword">this</span>-&gt;x = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">this</span>-&gt;y = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Point::setCoordinate</span><span class="params">(<span class="type">const</span> <span class="type">double</span>&amp; x, <span class="type">const</span> <span class="type">double</span>&amp; y)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>-&gt;x = x;</span><br><span class="line">	<span class="keyword">this</span>-&gt;y = y;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="function"><span class="type">double</span>&amp; <span class="title">Point::X</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">this</span>-&gt;x;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="function"><span class="type">double</span>&amp; <span class="title">Point::Y</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">this</span>-&gt;y;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="function"><span class="type">const</span> <span class="type">double</span> <span class="title">Point::getEuclidianDistance</span><span class="params">(<span class="type">const</span> Point&amp; p)</span><span class="type">const</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">sqrt</span>(<span class="number">1.0</span>*(x - p.x) * (x - p.x) + (y - p.y) * (y - p.y));</span><br><span class="line">	&#125;</span><br><span class="line"><span class="function"><span class="type">const</span> <span class="type">double</span> <span class="title">Point::getManHatonDistance</span><span class="params">(<span class="type">const</span> Point&amp; p)</span> <span class="type">const</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">abs</span>(x - p.x) + <span class="built_in">abs</span>(y - p.y);</span><br><span class="line">	&#125;</span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">Point::getSlope</span><span class="params">(<span class="type">const</span> Point&amp; p)</span> <span class="type">const</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1.0</span>*(y - p.y) / (x - p.x);</span><br><span class="line">	&#125;</span><br><span class="line">std::ostream&amp; <span class="keyword">operator</span>&lt;&lt;(std::ostream&amp; os, <span class="type">const</span> Point&amp; p) &#123;</span><br><span class="line">	os &lt;&lt; <span class="string">&quot;(&quot;</span> &lt;&lt; p.x &lt;&lt; <span class="string">&quot;,&quot;</span> &lt;&lt; p.y &lt;&lt; <span class="string">&quot;)&quot;</span>;</span><br><span class="line">	<span class="keyword">return</span> os;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">	Line::<span class="built_in">Line</span>() &#123;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	Line::<span class="built_in">Line</span>(<span class="type">const</span> Point&amp; a, <span class="type">const</span> Point&amp; b) &#123;</span><br><span class="line">		<span class="keyword">this</span>-&gt;a = a;</span><br><span class="line">		<span class="keyword">this</span>-&gt;b = b;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">double</span> <span class="title">Line::length</span><span class="params">()</span><span class="type">const</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> a.<span class="built_in">getEuclidianDistance</span>(b);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">Point&amp; <span class="title">Line::A</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> a;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">Point&amp; <span class="title">Line::B</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> b;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">double</span> <span class="title">Line::getSlope</span><span class="params">()</span><span class="type">const</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> a.<span class="built_in">getSlope</span>(b);</span><br><span class="line">	&#125;</span><br><span class="line">	std::ostream&amp; <span class="keyword">operator</span>&lt;&lt;(std::ostream&amp; os, <span class="type">const</span> Line&amp; l )&#123;</span><br><span class="line">		os &lt;&lt; <span class="string">&quot;[&quot;</span> &lt;&lt; l.a &lt;&lt; <span class="string">&quot;;&quot;</span> &lt;&lt; l.b &lt;&lt; <span class="string">&quot;]&quot;</span>;</span><br><span class="line">		<span class="keyword">return</span> os;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">bool</span> <span class="title">Line::isParallel</span><span class="params">(<span class="type">const</span> Line&amp; l)</span><span class="type">const</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">abs</span>(<span class="built_in">getSlope</span>() - l.<span class="built_in">getSlope</span>()) &lt; <span class="number">0.001</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="重新生成解决方案">9.重新生成解决方案</h5>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220721164200557.png"
alt="image-20220721164200557" />
<figcaption aria-hidden="true">image-20220721164200557</figcaption>
</figure>
<p>如果生成成功</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220721164221010.png"
alt="image-20220721164221010" />
<figcaption aria-hidden="true">image-20220721164221010</figcaption>
</figure>
<h4 id="链接静态库">链接静态库</h4>
<h5 id="往解决方案中添加新项目">1.往解决方案中添加新项目</h5>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220721164306283.png"
alt="image-20220721164306283" />
<figcaption aria-hidden="true">image-20220721164306283</figcaption>
</figure>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220721164320309.png"
alt="image-20220721164320309" />
<figcaption aria-hidden="true">image-20220721164320309</figcaption>
</figure>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220721164341661.png"
alt="image-20220721164341661" />
<figcaption aria-hidden="true">image-20220721164341661</figcaption>
</figure>
<p>新项目名叫MATHTEST</p>
<h5 id="添加引用">2.添加引用</h5>
<p>此步的作用是</p>
<ol type="1">
<li>在链接A时，自动带上 b.lib，debug/release能够自动区分</li>
<li>当B项目有变化时，若编译A项目前先编译B项目</li>
</ol>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220721170149106.png"
alt="image-20220721170149106" />
<figcaption aria-hidden="true">image-20220721170149106</figcaption>
</figure>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220721170201234.png"
alt="image-20220721170201234" />
<figcaption aria-hidden="true">image-20220721170201234</figcaption>
</figure>
<h5 id="修改包含目录">3.修改包含目录</h5>
<p>此步的作用是给<code>#include "MathLib.h"</code>找到包含路径,即MathLib.h在哪里</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220721170408179.png"
alt="image-20220721170408179" />
<figcaption aria-hidden="true">image-20220721170408179</figcaption>
</figure>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220721170458649.png"
alt="image-20220721170458649" />
<figcaption aria-hidden="true">image-20220721170458649</figcaption>
</figure>
<p>到此MATHTEST中的源文件就能找到需要包含的MathLib.h头文件在哪里,链接器也能知道MathLib.lib在哪里了</p>
<h5 id="测试静态库">4.测试静态库</h5>
<p>在MATHTEST项目中新建一个源文件(或者利用自动创建的MATHTEST.cpp)</p>
<p>随便写点测试静态库的东西</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;MathLib.h&quot;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">Point <span class="title">A1</span><span class="params">(<span class="number">2</span>, <span class="number">4</span>)</span></span>;</span><br><span class="line">    <span class="function">Point <span class="title">B1</span><span class="params">(<span class="number">4</span>, <span class="number">8</span>)</span></span>;</span><br><span class="line">    <span class="function">Point <span class="title">A2</span><span class="params">(<span class="number">5</span>, <span class="number">10</span>)</span></span>;</span><br><span class="line">    <span class="function">Point <span class="title">B2</span><span class="params">(<span class="number">15</span>, <span class="number">29</span>)</span></span>;</span><br><span class="line">    <span class="function">Line <span class="title">L1</span><span class="params">(A1, B1)</span></span>;</span><br><span class="line">    <span class="function">Line <span class="title">L2</span><span class="params">(A2, B2)</span></span>;</span><br><span class="line">    cout &lt;&lt; L<span class="number">1.</span><span class="built_in">isParallel</span>(L2)&lt;&lt;endl;</span><br><span class="line">    cout &lt;&lt; A<span class="number">1.</span><span class="built_in">getEuclidianDistance</span>(B1) &lt;&lt; <span class="string">&quot;  &quot;</span> &lt;&lt; L<span class="number">1.l</span>ength() &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; A1 &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; L1 &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后将MATHTEST项目设置为启动项目(如果让MATHLIB库项目作为启动项目根本起不来)</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220721171411117.png"
alt="image-20220721171411117" />
<figcaption aria-hidden="true">image-20220721171411117</figcaption>
</figure>
<p>然后Ctrl+F5开始运行(不调试)</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220721171456970.png"
alt="image-20220721171456970" />
<figcaption aria-hidden="true">image-20220721171456970</figcaption>
</figure>
<h4 id="解决方案的结构">解决方案的结构</h4>
<p>可以在解决方案根目录下面,终端上用<code>tree /f</code>命令打印整个结构</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E6%A0%B9%E7%9B%AE%E5%BD%95.png"
alt="解决方案根目录" />
<figcaption aria-hidden="true">解决方案根目录</figcaption>
</figure>
<h3 id="动态库的使用">动态库的使用</h3>
<h4 id="创建动态库-1">创建动态库</h4>
<h5 id="建立空白解决方案">1.建立空白解决方案</h5>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220721182820966.png"
alt="image-20220721182820966" />
<figcaption aria-hidden="true">image-20220721182820966</figcaption>
</figure>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220721182929764.png"
alt="image-20220721182929764" />
<figcaption aria-hidden="true">image-20220721182929764</figcaption>
</figure>
<h5 id="建立动态库项目">2.建立动态库项目</h5>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220721182953735.png"
alt="image-20220721182953735" />
<figcaption aria-hidden="true">image-20220721182953735</figcaption>
</figure>
<p>具有导出项的动态库</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220721183016050.png"
alt="image-20220721183016050" />
<figcaption aria-hidden="true">image-20220721183016050</figcaption>
</figure>
<p>项目名称MATHDLL</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220721183052585.png"
alt="image-20220721183052585" />
<figcaption aria-hidden="true">image-20220721183052585</figcaption>
</figure>
<p>属性页设置不使用预编译头</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220721183151901.png"
alt="image-20220721183151901" />
<figcaption aria-hidden="true">image-20220721183151901</figcaption>
</figure>
<p>删除掉多余的pch等自动生成的文件之后,解决方案资源管理器是这样的</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220721183358281.png"
alt="image-20220721183358281" />
<figcaption aria-hidden="true">image-20220721183358281</figcaption>
</figure>
<h5
id="充实头文件mathdll.h和原文件mathdll.cpp">3.充实头文件MATHDLL.h和原文件MATHDLL.cpp</h5>
<p>自动生成的MATHDLL.h中有一个实用的宏定义<code>MATHDLL_API</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 下列 ifdef 块是创建使从 DLL 导出更简单的</span></span><br><span class="line"><span class="comment">// 宏的标准方法。此 DLL 中的所有文件都是用命令行上定义的 MATHDLL_EXPORTS</span></span><br><span class="line"><span class="comment">// 符号编译的。在使用此 DLL 的</span></span><br><span class="line"><span class="comment">// 任何项目上不应定义此符号。这样，源文件中包含此文件的任何其他项目都会将</span></span><br><span class="line"><span class="comment">// MATHDLL_API 函数视为是从 DLL 导入的，而此 DLL 则将用此宏定义的</span></span><br><span class="line"><span class="comment">// 符号视为是被导出的。</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> MATHDLL_EXPORTS</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MATHDLL_API __declspec(dllexport)</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MATHDLL_API __declspec(dllimport)</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 此类是从 dll 导出的</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MATHDLL_API</span> <span class="title">CMATHDLL</span> &#123;</span></span><br><span class="line">public:</span><br><span class="line">	CMATHDLL(<span class="type">void</span>);</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此处添加方法。</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> MATHDLL_API <span class="type">int</span> nMATHDLL;</span><br><span class="line"></span><br><span class="line">MATHDLL_API <span class="type">int</span> <span class="title function_">fnMATHDLL</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>MATHDLL_API</code>这个宏定义,对于DLL库的头文件来说被翻译为<code>__declspec(dllexport)</code>,</p>
<p>而对于包含该头文件的其他项目的源文件来说被翻译为<code>__declspec(dllimport)</code></p>
<p>关于<code>__declspec(dllexport)</code>干了啥事,现在不想知道,只需要知道导出函数时必须</p>
<p><code>MATHDLL.h</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 下列 ifdef 块是创建使从 DLL 导出更简单的</span></span><br><span class="line"><span class="comment">// 宏的标准方法。此 DLL 中的所有文件都是用命令行上定义的 MATHDLL_EXPORTS</span></span><br><span class="line"><span class="comment">// 符号编译的。在使用此 DLL 的</span></span><br><span class="line"><span class="comment">// 任何项目上不应定义此符号。这样，源文件中包含此文件的任何其他项目都会将</span></span><br><span class="line"><span class="comment">// MATHDLL_API 函数视为是从 DLL 导入的，而此 DLL 则将用此宏定义的</span></span><br><span class="line"><span class="comment">// 符号视为是被导出的。</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> MATHDLL_EXPORTS</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MATHDLL_API __declspec(dllexport)</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MATHDLL_API __declspec(dllimport)</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MATHDLL_API</span> <span class="title">Point</span> &#123;</span><span class="comment">//使用MATHDLL_API修饰意思是导出类</span></span><br><span class="line">	<span class="type">double</span> x;</span><br><span class="line">	<span class="type">double</span> y;</span><br><span class="line">	Point(<span class="type">const</span> <span class="type">double</span>&amp; x, <span class="type">const</span> <span class="type">double</span>&amp; y);</span><br><span class="line">	Point();</span><br><span class="line">	<span class="type">void</span> <span class="title function_">setCoordinate</span><span class="params">(<span class="type">const</span> <span class="type">double</span>&amp; x, <span class="type">const</span> <span class="type">double</span>&amp; y)</span>;</span><br><span class="line">	<span class="type">double</span>&amp; <span class="title function_">X</span><span class="params">()</span>;</span><br><span class="line">	<span class="type">double</span>&amp; <span class="title function_">Y</span><span class="params">()</span>;</span><br><span class="line">	<span class="type">const</span> <span class="type">double</span> <span class="title function_">getEuclidianDistance</span><span class="params">(<span class="type">const</span> Point&amp; p)</span><span class="type">const</span>;</span><br><span class="line">	<span class="type">const</span> <span class="type">double</span> <span class="title function_">getManHatonDistance</span><span class="params">(<span class="type">const</span> Point&amp; p)</span><span class="type">const</span>;</span><br><span class="line">	<span class="type">double</span> <span class="title function_">getSlope</span><span class="params">(<span class="type">const</span> Point&amp; p)</span><span class="type">const</span>;</span><br><span class="line">	friend <span class="built_in">std</span>::ostream&amp; operator&lt;&lt;(<span class="built_in">std</span>::ostream&amp; os, <span class="type">const</span> Point&amp; p);</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MATHDLL_API</span> <span class="title">Line</span> &#123;</span></span><br><span class="line">	Point a;</span><br><span class="line">	Point b;</span><br><span class="line">	Line();</span><br><span class="line">	Line(<span class="type">const</span> Point&amp; a, <span class="type">const</span> Point&amp; b);</span><br><span class="line">	<span class="type">double</span> <span class="title function_">length</span><span class="params">()</span><span class="type">const</span>;</span><br><span class="line">	Point&amp; <span class="title function_">A</span><span class="params">()</span>;</span><br><span class="line">	Point&amp; <span class="title function_">B</span><span class="params">()</span>;</span><br><span class="line">	<span class="type">double</span> <span class="title function_">getSlope</span><span class="params">()</span><span class="type">const</span>;</span><br><span class="line">	friend <span class="built_in">std</span>::ostream&amp; operator&lt;&lt;(<span class="built_in">std</span>::ostream&amp; os, <span class="type">const</span> Line&amp; l);</span><br><span class="line">	<span class="type">bool</span> <span class="title function_">isParallel</span><span class="params">(<span class="type">const</span> Line&amp; l)</span><span class="type">const</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//extern MATHDLL_API int nMATHDLL;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//MATHDLL_API int fnMATHDLL(void);</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>MATHDLL.cpp</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;MATHDLL.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">Point::Point(<span class="type">const</span> <span class="type">double</span>&amp; x, <span class="type">const</span> <span class="type">double</span>&amp; y) &#123;</span><br><span class="line">	this-&gt;x = x;</span><br><span class="line">	this-&gt;y = y;</span><br><span class="line">&#125;</span><br><span class="line">Point::Point() &#123;</span><br><span class="line">	this-&gt;x = <span class="number">0</span>;</span><br><span class="line">	this-&gt;y = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">Point::setCoordinate</span><span class="params">(<span class="type">const</span> <span class="type">double</span>&amp; x, <span class="type">const</span> <span class="type">double</span>&amp; y)</span> &#123;</span><br><span class="line">	this-&gt;x = x;</span><br><span class="line">	this-&gt;y = y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">double</span>&amp; <span class="title function_">Point::X</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> this-&gt;x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">double</span>&amp; <span class="title function_">Point::Y</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> this-&gt;y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> <span class="title function_">Point::getEuclidianDistance</span><span class="params">(<span class="type">const</span> Point&amp; p)</span><span class="type">const</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">sqrt</span>(<span class="number">1.0</span> * (x - p.x) * (x - p.x) + (y - p.y) * (y - p.y));</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> <span class="title function_">Point::getManHatonDistance</span><span class="params">(<span class="type">const</span> Point&amp; p)</span> <span class="type">const</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">abs</span>(x - p.x) + <span class="built_in">abs</span>(y - p.y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">double</span> <span class="title function_">Point::getSlope</span><span class="params">(<span class="type">const</span> Point&amp; p)</span> <span class="type">const</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1.0</span> * (y - p.y) / (x - p.x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">std</span>::ostream&amp; operator&lt;&lt;(<span class="built_in">std</span>::ostream&amp; os, <span class="type">const</span> Point&amp; p) &#123;</span><br><span class="line">	os &lt;&lt; <span class="string">&quot;(&quot;</span> &lt;&lt; p.x &lt;&lt; <span class="string">&quot;,&quot;</span> &lt;&lt; p.y &lt;&lt; <span class="string">&quot;)&quot;</span>;</span><br><span class="line">	<span class="keyword">return</span> os;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Line::Line() &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">Line::Line(<span class="type">const</span> Point&amp; a, <span class="type">const</span> Point&amp; b) &#123;</span><br><span class="line">	this-&gt;a = a;</span><br><span class="line">	this-&gt;b = b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">double</span> <span class="title function_">Line::length</span><span class="params">()</span><span class="type">const</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> a.getEuclidianDistance(b);</span><br><span class="line">&#125;</span><br><span class="line">Point&amp; <span class="title function_">Line::A</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line">Point&amp; <span class="title function_">Line::B</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">double</span> <span class="title function_">Line::getSlope</span><span class="params">()</span><span class="type">const</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> a.getSlope(b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">std</span>::ostream&amp; operator&lt;&lt;(<span class="built_in">std</span>::ostream&amp; os, <span class="type">const</span> Line&amp; l) &#123;</span><br><span class="line">	os &lt;&lt; <span class="string">&quot;[&quot;</span> &lt;&lt; l.a &lt;&lt; <span class="string">&quot;;&quot;</span> &lt;&lt; l.b &lt;&lt; <span class="string">&quot;]&quot;</span>;</span><br><span class="line">	<span class="keyword">return</span> os;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">bool</span> <span class="title function_">Line::isParallel</span><span class="params">(<span class="type">const</span> Line&amp; l)</span><span class="type">const</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">abs</span>(getSlope() - l.getSlope()) &lt; <span class="number">0.001</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>dllMain.cpp</code>保持原样不用管</p>
<p>此时重新生成解决方案没有错误,则动态库创建完毕了</p>
<p>此时在<code>MATHTOOLS/debug/</code>下面生成四个文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\86135\Desktop\testDLL\MATHTOOLS\Debug&gt; <span class="built_in">ls</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    目录: C:\Users\86135\Desktop\testDLL\MATHTOOLS\Debug</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                 LastWriteTime         Length Name</span><br><span class="line">----                 -------------         ------ ----</span><br><span class="line">-a----         2022/7/21     19:01          52736 MATHDLL.dll</span><br><span class="line">-a----         2022/7/21     19:01           3532 MATHDLL.exp</span><br><span class="line">-a----         2022/7/21     19:01           6308 MATHDLL.lib</span><br><span class="line">-a----         2022/7/21     19:01        1200128 MATHDLL.pdb</span><br></pre></td></tr></table></figure>
<p>有动态库dll这不足为奇,我们要的就是它</p>
<p>有pdb数据库也不足为奇,调试时用的符号就存在这个数据库里</p>
<p>那exp和lib是来干啥的?留作后话</p>
<p>到此动态库创建完毕,下面新建测试项目</p>
<h4 id="链接动态库">链接动态库</h4>
<p>链接一个动态库好麻烦,需要三个东西</p>
<p>1.包含头文件路径</p>
<p>2.lib导入库的路径</p>
<p>3.dll本尊的路径</p>
<p>其中头文件在编译的时候给一个符号,lib是一个药引子,它干了啥事留作后话</p>
<h5 id="新建控制台测试项目">1.新建控制台测试项目</h5>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220721190552713.png"
alt="image-20220721190552713" />
<figcaption aria-hidden="true">image-20220721190552713</figcaption>
</figure>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220721190612424.png"
alt="image-20220721190612424" />
<figcaption aria-hidden="true">image-20220721190612424</figcaption>
</figure>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220721190626516.png"
alt="image-20220721190626516" />
<figcaption aria-hidden="true">image-20220721190626516</figcaption>
</figure>
<h5 id="添加引用-1">2.添加引用</h5>
<p>在MATHTEST的引用上添加引用,作用同静态库时的用法,即将lib文件链接进入exe文件</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220721190715859.png"
alt="image-20220721190715859" />
<figcaption aria-hidden="true">image-20220721190715859</figcaption>
</figure>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220721190737071.png"
alt="image-20220721190737071" />
<figcaption aria-hidden="true">image-20220721190737071</figcaption>
</figure>
<p>此步的作用是添加dll库文件本身的路径</p>
<h5 id="添加头文件包含路径">3.添加头文件包含路径</h5>
<p>头文件的作用是提供符号引用,只是提供引用的作用,没有其他作用了,不用想太多</p>
<blockquote>
<p>有时甚至不包含头文件只链接对应源文件也不会链接报错,警告罢了</p>
</blockquote>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220721190917081.png"
alt="image-20220721190917081" />
<figcaption aria-hidden="true">image-20220721190917081</figcaption>
</figure>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220721190857128.png"
alt="image-20220721190857128" />
<figcaption aria-hidden="true">image-20220721190857128</figcaption>
</figure>
<h5 id="添加导入库lib文件路径">4.添加导入库(lib文件)路径</h5>
<p>此处需要在链接器-&gt;输入-&gt;附加依赖项 还有
链接器-&gt;常规-&gt;附加库目录两个地方进行添加</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220721191127957.png"
alt="image-20220721191127957" />
<figcaption aria-hidden="true">image-20220721191127957</figcaption>
</figure>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/test/master/image-20220721192104087.png"
alt="image-20220721192104087" />
<figcaption aria-hidden="true">image-20220721192104087</figcaption>
</figure>
<p>到此程序就可以运行了</p>
<h3 id="obj-.lib-.dll"><code>.obj-&gt;.lib-&gt;.dll</code></h3>
<p>两种库的制作过程中,都有.lib文件,但是静态库中.lib是最终产品,动态库中.lib是一个药引子导入库</p>
<h2 id="msvc创建使用库">MSVC创建使用库</h2>
<p>用Vscode打开一个文件夹作为工作目录,然后在本文件夹下面写EDRLIB.C和EDRLIB.H,EDRTEST.C</p>
<h3 id="制作动态库">制作动态库</h3>
<p>首先在本目录下面编写<code>EDRLIB.H,EDRLIB.C</code>两个源代码文件</p>
<p><code>EDRLIB.H</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cplusplus <span class="comment">//防止C++的命名重整,使得本库文件可以被C和C++程序使用</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXPORT extern <span class="string">&quot;C&quot;</span> __declspec(dllexport)</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXPORT __declspec(dllexport)</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">EXPORT BOOL CALLBACK <span class="title function_">EdrCenterTextA</span><span class="params">(HDC,PRECT,PCSTR)</span>;</span><br><span class="line">EXPORT BOOL CALLBACK <span class="title function_">EdrCenterTextW</span><span class="params">(HDC,PRECT,PCWSTR)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> UNICODE</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EdrCenterText EdrCenterTextW</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EdrCenterText EdrCenterTextA</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<p><code>EDRLIB.C</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;EDRLIB.H&quot;</span></span></span><br><span class="line"></span><br><span class="line">LRESULT CALLBACK <span class="title function_">WndProc</span><span class="params">(HWND, UINT, WPARAM, LPARAM)</span>;</span><br><span class="line"><span class="type">int</span> WINAPI <span class="title function_">WinMain</span><span class="params">(HINSTANCE hInstance, HINSTANCE hPrevInstance, PSTR szCmdLine, <span class="type">int</span> iCmdShow)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">static</span> TCHAR szAppName[] = TEXT(<span class="string">&quot;StrProg&quot;</span>);</span><br><span class="line">    HWND hwnd;</span><br><span class="line">    MSG msg;</span><br><span class="line"></span><br><span class="line">    WNDCLASS wndclass;</span><br><span class="line">    wndclass.style = CS_HREDRAW | CS_VREDRAW;</span><br><span class="line">    wndclass.lpfnWndProc = WndProc;</span><br><span class="line">    wndclass.cbClsExtra = <span class="number">0</span>;</span><br><span class="line">    wndclass.cbWndExtra = <span class="number">0</span>;</span><br><span class="line">    wndclass.hInstance = hInstance;</span><br><span class="line">    wndclass.hIcon = LoadIcon(<span class="literal">NULL</span>, IDI_APPLICATION);</span><br><span class="line">    wndclass.hCursor = LoadCursor(<span class="literal">NULL</span>, IDC_ARROW);</span><br><span class="line">    wndclass.hbrBackground = (HBRUSH)GetStockObject(WHITE_BRUSH);</span><br><span class="line">    wndclass.lpszMenuName = <span class="literal">NULL</span>;</span><br><span class="line">    wndclass.lpszClassName = szAppName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!RegisterClass(&amp;wndclass))</span><br><span class="line">    &#123;</span><br><span class="line">        MessageBox(<span class="literal">NULL</span>, TEXT(<span class="string">&quot;requires Windows NT&quot;</span>), szAppName, MB_ICONERROR);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    hwnd = CreateWindow(</span><br><span class="line">        szAppName,</span><br><span class="line">        TEXT(<span class="string">&quot;DLL Demonstrate Program&quot;</span>),</span><br><span class="line">        WS_OVERLAPPEDWINDOW,</span><br><span class="line">        CW_USEDEFAULT,</span><br><span class="line">        CW_USEDEFAULT,</span><br><span class="line">        CW_USEDEFAULT,</span><br><span class="line">        CW_USEDEFAULT,</span><br><span class="line">        <span class="literal">NULL</span>,</span><br><span class="line">        <span class="literal">NULL</span>,</span><br><span class="line">        hInstance,</span><br><span class="line">        <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    ShowWindow(hwnd, iCmdShow);</span><br><span class="line">    UpdateWindow(hwnd);</span><br><span class="line">    <span class="keyword">while</span> (GetMessage(&amp;msg, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        TranslateMessage(&amp;msg);</span><br><span class="line">        DispatchMessage(&amp;msg);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> msg.wParam;</span><br><span class="line">&#125;</span><br><span class="line">LRESULT CALLBACK <span class="title function_">WndProc</span><span class="params">(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)</span></span><br><span class="line">&#123;</span><br><span class="line">    HDC hdc;</span><br><span class="line">    PAINTSTRUCT ps;</span><br><span class="line">    RECT rect;</span><br><span class="line">    <span class="keyword">switch</span> (message)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> WM_PAINT:</span><br><span class="line">        hdc = BeginPaint(hwnd, &amp;ps);</span><br><span class="line">        GetClientRect(hwnd, &amp;rect);</span><br><span class="line">        EdrCenterText(hdc, &amp;rect, TEXT(<span class="string">&quot;in DLLLLLLLer&quot;</span>));</span><br><span class="line">        EndPaint(hwnd, &amp;ps);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">case</span> WM_DESTROY:</span><br><span class="line">        PostQuitMessage(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> DefWindowProc(hwnd, message, wParam, lParam);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用MSVC编译链接制作动态库</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cl /c EDRLIB.C</span><br><span class="line">link /dll EDRLIB.obj user32.lib kernel32.lib gdi32.lib</span><br></pre></td></tr></table></figure>
<p>到此本目录下面就生成了dll动态库文件和lib导入库文件</p>
<h3 id="链接导入库">链接导入库</h3>
<p>编写测试程序<code>EDRTEST.C</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;EDRLIB.H&quot;</span></span></span><br><span class="line"></span><br><span class="line">LRESULT CALLBACK <span class="title function_">WndProc</span><span class="params">(HWND, UINT, WPARAM, LPARAM)</span>;</span><br><span class="line"><span class="type">int</span> WINAPI <span class="title function_">WinMain</span><span class="params">(HINSTANCE hInstance, HINSTANCE hPrevInstance, PSTR szCmdLine, <span class="type">int</span> iCmdShow)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">static</span> TCHAR szAppName[] = TEXT(<span class="string">&quot;StrProg&quot;</span>);</span><br><span class="line">    HWND hwnd;</span><br><span class="line">    MSG msg;</span><br><span class="line"></span><br><span class="line">    WNDCLASS wndclass;</span><br><span class="line">    wndclass.style = CS_HREDRAW | CS_VREDRAW;</span><br><span class="line">    wndclass.lpfnWndProc = WndProc;</span><br><span class="line">    wndclass.cbClsExtra = <span class="number">0</span>;</span><br><span class="line">    wndclass.cbWndExtra = <span class="number">0</span>;</span><br><span class="line">    wndclass.hInstance = hInstance;</span><br><span class="line">    wndclass.hIcon = LoadIcon(<span class="literal">NULL</span>, IDI_APPLICATION);</span><br><span class="line">    wndclass.hCursor = LoadCursor(<span class="literal">NULL</span>, IDC_ARROW);</span><br><span class="line">    wndclass.hbrBackground = (HBRUSH)GetStockObject(WHITE_BRUSH);</span><br><span class="line">    wndclass.lpszMenuName = <span class="literal">NULL</span>;</span><br><span class="line">    wndclass.lpszClassName = szAppName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!RegisterClass(&amp;wndclass))</span><br><span class="line">    &#123;</span><br><span class="line">        MessageBox(<span class="literal">NULL</span>, TEXT(<span class="string">&quot;requires Windows NT&quot;</span>), szAppName, MB_ICONERROR);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    hwnd = CreateWindow(</span><br><span class="line">        szAppName,</span><br><span class="line">        TEXT(<span class="string">&quot;DLL Demonstrate Program&quot;</span>),</span><br><span class="line">        WS_OVERLAPPEDWINDOW,</span><br><span class="line">        CW_USEDEFAULT,</span><br><span class="line">        CW_USEDEFAULT,</span><br><span class="line">        CW_USEDEFAULT,</span><br><span class="line">        CW_USEDEFAULT,</span><br><span class="line">        <span class="literal">NULL</span>,</span><br><span class="line">        <span class="literal">NULL</span>,</span><br><span class="line">        hInstance,</span><br><span class="line">        <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    ShowWindow(hwnd, iCmdShow);</span><br><span class="line">    UpdateWindow(hwnd);</span><br><span class="line">    <span class="keyword">while</span> (GetMessage(&amp;msg, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        TranslateMessage(&amp;msg);</span><br><span class="line">        DispatchMessage(&amp;msg);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> msg.wParam;</span><br><span class="line">&#125;</span><br><span class="line">LRESULT CALLBACK <span class="title function_">WndProc</span><span class="params">(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)</span></span><br><span class="line">&#123;</span><br><span class="line">    HDC hdc;</span><br><span class="line">    PAINTSTRUCT ps;</span><br><span class="line">    RECT rect;</span><br><span class="line">    <span class="keyword">switch</span> (message)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> WM_PAINT:</span><br><span class="line">        hdc = BeginPaint(hwnd, &amp;ps);</span><br><span class="line">        GetClientRect(hwnd, &amp;rect);</span><br><span class="line">        EdrCenterText(hdc, &amp;rect, TEXT(<span class="string">&quot;in DLLLLLLLer&quot;</span>));</span><br><span class="line">        EndPaint(hwnd, &amp;ps);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">case</span> WM_DESTROY:</span><br><span class="line">        PostQuitMessage(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> DefWindowProc(hwnd, message, wParam, lParam);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>MSVC编译链接导入库</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cl /c EDRTEST.c</span><br><span class="line">link EDRTEST.obj EDRLIB.lib kernel32.lib user32.lib gdi32.lib</span><br></pre></td></tr></table></figure>
<h3 id="运行时使用动态库">运行时使用动态库</h3>
<p>由于EDRTEST.exe和EDRLIB.dll在同一目录下,因此装载器可以找到EDRLIB.dll,直接运行即可</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220819155710984.png"
alt="image-20220819155710984" />
<figcaption aria-hidden="true">image-20220819155710984</figcaption>
</figure>
<h2 id="tdm-gcc创建使用库">TDM-GCC创建使用库</h2>
<p>我电脑上这个TDM-GCC来自于Dev-Cpp,把TDM-GCC的bin目录添加到环境变量path即可在终端上使用</p>
<p>文件都不变</p>
<h3 id="制作动态库-1">制作动态库</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -shared EDRLIB.C -o EDRLIB.dll -luser32 -lgdi32 -lkernel32 </span><br></pre></td></tr></table></figure>
<p>然而这一步完成之后只生成了dll动态库文件,没有生成lib导入库文件</p>
<h3 id="链接动态库-1">链接动态库</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc EDRTEST.C -o EDRTEST.exe -lkernel32 -lgdi32 -luser32 -L./ -lEDRLIB ;执行在当前目录下寻找库文件,库文件名EDRLIB</span><br></pre></td></tr></table></figure>
<h3 id="运行时使用动态库-1">运行时使用动态库</h3>
<p>dll和exe同目录,可以直接运行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./EDRTEST.exe</span><br></pre></td></tr></table></figure>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220819161937488.png"
alt="image-20220819161937488" />
<figcaption aria-hidden="true">image-20220819161937488</figcaption>
</figure>
<p>效果和MSVC相同</p>
<p>如果把MSVC形成的exe和TDM-GCC形成的dll放在同一目录则运行报错,反过来也这样,总之就是谁的exe就得有谁的dll支持</p>
<h2 id="dllmain">DllMain</h2>
<p>Dll文件也可以有入口点,DllMain函数,该函数会在Dll被装载或者卸载等等各时期被调用</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> WINAPI <span class="title function_">DllMain</span><span class="params">(HINSTANCE hInstance,DWORD fdwReason,PVOID pvReserved)</span>;</span><br></pre></td></tr></table></figure>
<h3 id="参数意义">参数意义</h3>
<p>hInstance是本DLL模块的句柄,实际上是本模块加载进入进程地址空间中的基地址</p>
<p>fdwReason本DllMain函数被调用的原因</p>
<table>
<colgroup>
<col style="width: 29%" />
<col style="width: 70%" />
</colgroup>
<thead>
<tr>
<th style="text-align: left;">值</th>
<th style="text-align: left;">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td
style="text-align: left;"><strong>DLL_PROCESS_ATTACH</strong>(1)</td>
<td style="text-align: left;">由于进程启动或调用 <a
target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya"><strong>LoadLibrary</strong></a>，DLL
正在加载到当前进程的虚拟地址空间中。 DLL
可以使用此机会初始化任何实例数据，或使用 <a
target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/windows/desktop/api/processthreadsapi/nf-processthreadsapi-tlsalloc"><strong>TlsAlloc</strong></a>
函数分配线程本地存储 (TLS) 索引。 <em>lpvReserved</em>
参数指示是静态还是动态加载 DLL。</td>
</tr>
<tr>
<td
style="text-align: left;"><strong>DLL_PROCESS_DETACH</strong>(0)</td>
<td style="text-align: left;">DLL
正在从调用进程的虚拟地址空间中卸载，因为它加载失败，或者引用计数已达到零，
(进程每次调用 <a
target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary"><strong>LoadLibrary</strong></a>)
时，都会终止或调用 <a
target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya"><strong>FreeLibrary</strong></a>
。 <em>lpvReserved</em> 参数指示是否由于 <a
target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary"><strong>FreeLibrary</strong></a>
调用、加载失败或进程终止而卸载 DLL。 DLL 可以使用此机会调用 <a
target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/windows/desktop/api/processthreadsapi/nf-processthreadsapi-tlsfree"><strong>TlsFree</strong></a>
函数，以释放使用 <a
target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/windows/desktop/api/processthreadsapi/nf-processthreadsapi-tlsalloc"><strong>TlsAlloc</strong></a>
分配的任何 TLS 索引，并释放任何线程本地数据。 请注意，接收
<strong>DLL_PROCESS_DETACH</strong> 通知的线程不一定是接收
<strong>DLL_PROCESS_ATTACH通知的</strong> 线程。</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DLL_THREAD_ATTACH</strong>(2)</td>
<td style="text-align: left;">当前进程正在创建新线程。
发生这种情况时，系统会调用当前附加到进程的所有 DLL 的入口点函数。
调用是在新线程的上下文中进行的。 DLL 可以使用此机会初始化线程的 TLS 槽。
使用 <strong>DLL_PROCESS_ATTACH</strong> 调用 DLL
入口点函数的线程不会使用 <strong>DLL_THREAD_ATTACH</strong> 调用 DLL
入口点函数。 请注意，DLL 的入口点函数仅由进程加载 DLL
后创建的线程调用此值。 使用 <a
target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya"><strong>LoadLibrary</strong></a>
加载 DLL 时，现有线程不会调用新加载 DLL 的入口点函数。</td>
</tr>
<tr>
<td style="text-align: left;"><strong>DLL_THREAD_DETACH</strong>(3)</td>
<td style="text-align: left;">线程已干净退出。 如果 DLL 已存储指向 TLS
槽中已分配内存的指针，则应使用此机会释放内存。
系统使用此值调用当前加载的所有 DLL 的入口点函数。
调用是在退出线程的上下文中进行的。</td>
</tr>
</tbody>
</table>
<p>pvReserved尚未使用</p>
<h3 id="分拣消息">分拣消息</h3>
<p>DllMain的调用,和窗口过程函数WndProc的调用方式很像,</p>
<p>WndProc调用时,message参数记录消息类型.</p>
<p>DllMain调用时,fdwReason记录调用原因</p>
<p>因此DllMain中可以根据调用原因的不同,设计不同的处理过程</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">BOOL WINAPI <span class="title function_">DllMain</span><span class="params">(</span></span><br><span class="line"><span class="params">    HINSTANCE hinstDLL,  <span class="comment">// handle to DLL module</span></span></span><br><span class="line"><span class="params">    DWORD fdwReason,     <span class="comment">// reason for calling function</span></span></span><br><span class="line"><span class="params">    LPVOID lpReserved )</span>  <span class="comment">// reserved</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Perform actions based on the reason for calling.</span></span><br><span class="line">    <span class="keyword">switch</span>( fdwReason ) </span><br><span class="line">    &#123; </span><br><span class="line">        <span class="keyword">case</span> DLL_PROCESS_ATTACH:</span><br><span class="line">         <span class="comment">// Initialize once for each new process.</span></span><br><span class="line">         <span class="comment">// Return FALSE to fail DLL load.</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> DLL_THREAD_ATTACH:</span><br><span class="line">         <span class="comment">// Do thread-specific initialization.</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> DLL_THREAD_DETACH:</span><br><span class="line">         <span class="comment">// Do thread-specific cleanup.</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> DLL_PROCESS_DETACH:</span><br><span class="line">         <span class="comment">// Perform any necessary cleanup.</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> TRUE;  <span class="comment">// Successful DLL_PROCESS_ATTACH.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="windows消息钩取dll注入">Windows消息钩取(Dll注入)</h2>
<p>学习windows程序设计有一段时间了,我就知道了一个事,即消息会从操作系统的消息队列分发到应用程序的消息队列.比如键盘按下之后操作系统首先捕捉该消息,然后看看焦点窗口是谁,再把这个消息发给焦点窗口.</p>
<p>而消息钩取就发生在这个消息分发的过程中,钩子程序可以监视从操作系统消息队列发往应用程序消息队列的所有消息</p>
<h3 id="windows消息流">windows消息流</h3>
<p>当发生键盘按下的时间时,WM_KEYDOWN消息首先被添加到操作系统消息队列</p>
<p>操作系统判断是哪个应用程序发生的事件,然后从自己的消息队列中取出这个消息添加到对应应用程序的消息队列</p>
<p>应用程序的消息循环不停地从自己的消息队列中取出消息并调用相应的事件处理程序(即窗口过程)</p>
<blockquote>
<p>这里窗口过程是回调形式的,因为同一个应用程序可以有多个窗口,自然可以有多个窗口过程,消息循环中的<code>DispatchMessage(&amp;msg);</code>可以决定将消息发往哪个窗口过程</p>
</blockquote>
<p>消息钩取发生在消息从OS消息队列到应用消息队列的路上</p>
<figure>
<img
src="https://raw.githubusercontent.com/DeutschBall/DeutschBall/main/image-20220819173944182.png"
alt="image-20220819173944182" />
<figcaption aria-hidden="true">image-20220819173944182</figcaption>
</figure>
<h3 id="setwindowshookex数注册钩子">SetWindowsHookEx数注册钩子</h3>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">HHOOK <span class="title function_">SetWindowsHookEx</span><span class="params">(</span></span><br><span class="line"><span class="params">   <span class="type">int</span> idHook,   <span class="comment">//hook type</span></span></span><br><span class="line"><span class="params">   HOOKPROC lpfn,  <span class="comment">//hook procedure</span></span></span><br><span class="line"><span class="params">   HINSTANCE hMod,  <span class="comment">//hook procedure所属的DLL句柄</span></span></span><br><span class="line"><span class="params">   DWORD dwThreadId <span class="comment">//将要挂钩的目标线程ID</span></span></span><br><span class="line"><span class="params">)</span>;</span><br></pre></td></tr></table></figure>
<h4 id="参数意义-1">参数意义</h4>
<h5 id="idhook">idHook</h5>
<p>钩子类型,决定钩子的类型和范围</p>
<figure>
<img
src="https://github.com/DeutschBall/DeutschBall/blob/main/20191231092715762.png?raw=true"
alt="img" />
<figcaption aria-hidden="true">img</figcaption>
</figure>
<h5 id="lpfn">lpfn</h5>
<p>钩子过程函数,需要存在于某个DLL内部</p>
<p>该函数是一个回调函数,有固定的参数,返回值要求</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">LRESULT CALLBACK HookProc<span class="comment">//程序员对于钩子过程的名字还是有支配权的</span></span><br><span class="line">(</span><br><span class="line">  <span class="type">int</span> nCode,<span class="comment">//钩子代码,一种代码对应一种情况,钩子过程可以根据情况就事论事</span></span><br><span class="line">  WPARAM wParam,<span class="comment">//两个附属参数都是nCode的更详细信息,nCode确定了wParam才有意义</span></span><br><span class="line">  LPARAM lParam,</span><br><span class="line">);<span class="comment">//返回值一般直接写返回CallNextHookEx的返回值就行了,根WndProc返回DefWndProc差不多</span></span><br></pre></td></tr></table></figure>
<p>这里(nCode,wParam,lParam)的消息组合起始和WndProc中的(message,wParam,lParam)很像</p>
<p>nCode/message指定消息类型,wParam和lParam是具体的解释</p>
<h5 id="hmod">hMod</h5>
<p>钩子函数所在实例的句柄,即lpfn所在的DLL句柄</p>
<p>如果是本地钩子,并且钩子就写在本程序中,那么hMod可以是本程序实例句柄,此时lpfn注册的函数也在本程序中,编译之后一运行,程序和钩子都在同一个进程地址空间,钩子可以猥琐欲为</p>
<p>然而远程钩子,即这个进程钩取那个进程消息这种,就一定需要把钩子放在dll中,然后指望操作系统把这个dll,注入到远程进程的地址空间中了</p>
<h5 id="dwthreadid">dwThreadId</h5>
<p>挂钩的线程ID</p>
<p>若该值为0则全局钩子,影响所有进程</p>
<h4 id="返回值">返回值</h4>
<p>HHOOK类型,即钩子句柄,钩子实际上也是一种内核数据结构,通过HHOOK句柄可以索引到该钩子</p>
<p>SetWindowsHookEx如果调用成功则返回其注册的钩子,方便后来使用完毕后删除钩子</p>
<h3 id="unhookwindowshookex删除钩子">UnhookWindowsHookEx删除钩子</h3>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">BOOL <span class="title function_">UnhookWindowsHookEx</span><span class="params">(</span></span><br><span class="line"><span class="params">  [in] HHOOK hhk</span></span><br><span class="line"><span class="params">)</span>;</span><br></pre></td></tr></table></figure>
<p>只需要一个钩子句柄HHOOK,这个值是SetWindowsHookEx的返回值,即可注销这次SetWindowsHookEx注册的钩子</p>
<h3 id="钩链">钩链</h3>
<p>每调用一次SetWindowsHookEx就会注册一层钩子,调用多了就形成一条钩链,</p>
<p>最新注册的钩子<strong>最先</strong>截获消息</p>
<p>当前钩子回调函数处理完成之后调用CallNextHookEx将消息传递给钩链上下一个钩子回调函数进行处理</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">LRESULT CALLBACK <span class="title function_">HookProc</span><span class="params">(<span class="type">int</span> nCode,WPARAM wParam,LPARAM lParam)</span>&#123;<span class="comment">//钩子过程,回调函数</span></span><br><span class="line">	...</span><br><span class="line">    <span class="keyword">return</span> CallNextHookEx(g_hHook,nCode,wParam,lParam);<span class="comment">//轮到下一个钩子了,如果这里不再调用下一个钩子则一般情况下钩链到此为止(但是就有那特殊情况)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="钩取notepad.exe键盘消息">钩取notepad.exe键盘消息</h3>
<p>当钩子和CPU架构不同的时候容易死机,死了n次得到的规律,64位的电脑上就老实编译64位程序,开64位notepad做实验吧</p>
<h4 id="钩子模块keyhook.dll">钩子模块KeyHook.dll</h4>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEF_PROCESS_NAME <span class="string">&quot;notepad.exe&quot;</span></span></span><br><span class="line"></span><br><span class="line">HINSTANCE g_hInstance = <span class="literal">NULL</span>;</span><br><span class="line">HHOOK g_hHook = <span class="literal">NULL</span>;<span class="comment">//钩子句柄,由本模块自己维护</span></span><br><span class="line">HWND g_hWnd = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">BOOL WINAPI <span class="title function_">DllMain</span><span class="params">(HINSTANCE hInstDLL, DWORD dwReason, LPVOID lpvReserved)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">switch</span> (dwReason)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> DLL_PROCESS_ATTACH:<span class="comment">//如果是因为进程附加则g_hInstance获取hInstDLL值</span></span><br><span class="line">        g_hInstance = hInstDLL;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> DLL_PROCESS_DETACH:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">LRESULT CALLBACK <span class="title function_">KeyBoardProc</span><span class="params">(<span class="type">int</span> nCode,WPARAM wParam,LPARAM lParam)</span>&#123;<span class="comment">//钩子过程,回调函数</span></span><br><span class="line">    <span class="type">char</span> szPath[MAX_PATH]=&#123;<span class="number">0</span>,&#125;;</span><br><span class="line">    <span class="type">char</span> *p=<span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">if</span>(nCode=<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!(lParam&amp;<span class="number">0x80000000</span>))&#123;</span><br><span class="line">            GetModuleFileNameA(<span class="literal">NULL</span>,szPath,MAX_PATH);</span><br><span class="line">            p=<span class="built_in">strrchr</span>(szPath,<span class="string">&#x27;\\&#x27;</span>);</span><br><span class="line">            <span class="keyword">if</span>(!_stricmp(p+<span class="number">1</span>,DEF_PROCESS_NAME))<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> CallNextHookEx(g_hHook,nCode,wParam,lParam);<span class="comment">//轮到狗链上的下一个钩子了</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cplusplus <span class="comment">//防止C++的命名重整,使得本库文件可以被C和C++程序使用</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXPORT extern <span class="string">&quot;C&quot;</span> __declspec(dllexport)</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EXPORT __declspec(dllexport)</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">EXPORT <span class="type">void</span> <span class="title function_">HookStart</span><span class="params">()</span>&#123;<span class="comment">//导出函数,启动钩子</span></span><br><span class="line">    g_hHook=SetWindowsHookEx(WH_KEYBOARD,KeyBoardProc,g_hInstance,<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">EXPORT <span class="type">void</span> <span class="title function_">HookStop</span><span class="params">()</span>&#123;<span class="comment">//导出函数,停止钩子</span></span><br><span class="line">    <span class="keyword">if</span>(g_hHook)&#123;</span><br><span class="line">        UnhookWindowsHookEx(g_hHook);</span><br><span class="line">        g_hHook=<span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc KeyHook.cpp -shared -o KeyHook.dll</span><br></pre></td></tr></table></figure>
<p>本模块导出了两个函数,注册和注销钩子</p>
<p>HookStart设置钩子类型为键盘型,并且注册了钩子过程回调函数KeyBoardProc,设置本模块为钩子所在模块,钩最后一个参数为0表明本钩子模块将被注入所有进程的地址空间</p>
<p>关键在于钩子过程回调函数KeyBoardProc,这个回调函数的返回值,参数个数,类型,意义,都是有固定要求的,除了函数名可以随便写</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">LRESULT CALLBACK <span class="title function_">KeyBoardProc</span><span class="params">(<span class="type">int</span> nCode,WPARAM wParam,LPARAM lParam)</span>&#123;<span class="comment">//钩子过程,回调函数</span></span><br><span class="line">    <span class="type">char</span> szPath[MAX_PATH]=&#123;<span class="number">0</span>,&#125;;</span><br><span class="line">    <span class="type">char</span> *p=<span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">if</span>(nCode==<span class="number">0</span>)&#123;<span class="comment">//当nCode=时对应键盘消息</span></span><br><span class="line">        <span class="keyword">if</span>(!(lParam&amp;<span class="number">0x80000000</span>))&#123;</span><br><span class="line">            GetModuleFileNameA(<span class="literal">NULL</span>,szPath,MAX_PATH);</span><br><span class="line">            p=<span class="built_in">strrchr</span>(szPath,<span class="string">&#x27;\\&#x27;</span>);<span class="comment">//返回szpath中最后一次出现&#x27;\&#x27;的位置</span></span><br><span class="line">            <span class="keyword">if</span>(!_stricmp(p+<span class="number">1</span>,DEF_PROCESS_NAME))<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> CallNextHookEx(g_hHook,nCode,wParam,lParam);<span class="comment">//轮到下一个钩链了</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>当GetMessage或者PeekMessage被调用时或者键盘消息发生时(WM_KEYUP,WM_KEYDOWN),操作系统会调用KeyBoardProc函数</p>
<blockquote>
<p>这个函数叫啥无所谓,KeyBoardProc,HookProc等等,只要是SetWindowsEx把他注册上就行</p>
</blockquote>
<p>对于键盘类型的钩子,其nCode有两种</p>
<p>HC_ACTION(0)和HC_NOREMOVE(3)</p>
<p>当nCode=HC_ACTION,此时wParam和lParam携带击键信息,和击键消息时的作用差不多</p>
<p>当nCode=HC_NOREMOVE,此时wParam和lParam携带击键信息,并且该消息尚未被从应用程序消息队列中移除</p>
<p>wParam是虚拟键编码</p>
<p>lParam</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Bits</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">0-15</td>
<td style="text-align: left;">重复击键次数</td>
</tr>
<tr>
<td style="text-align: left;">16-23</td>
<td style="text-align: left;">OEM扫描码,基本用不到了</td>
</tr>
<tr>
<td style="text-align: left;">24</td>
<td style="text-align: left;">是否为拓展键</td>
</tr>
<tr>
<td style="text-align: left;">25-28</td>
<td style="text-align: left;">保留</td>
</tr>
<tr>
<td style="text-align: left;">29</td>
<td style="text-align: left;">如果Alt按下则为1</td>
</tr>
<tr>
<td style="text-align: left;">30</td>
<td style="text-align: left;">本键的先前状态,如果先前按下则为1</td>
</tr>
<tr>
<td style="text-align: left;">31</td>
<td style="text-align: left;">本键状态,如果正在按下则为0</td>
</tr>
</tbody>
</table>
</blockquote>
<h5 id="ifncode0">if(nCode==0)</h5>
<p>例子中首先判断nCode==0,这就确定了lParam和wParam代表的意义</p>
<h5 id="iflparam0x80000000">if(!(lParam&amp;0x80000000))</h5>
<p>然后判断lParam的第31位是否是0,如果是0即对应键正在按下,则通过判断</p>
<h5
id="getmodulefilenameanullszpathmax_path">GetModuleFileNameA(NULL,szPath,MAX_PATH);</h5>
<p>本函数用于获取本进程已经加载的模块的完整路径名</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DWORD <span class="title function_">GetModuleFileNameA</span><span class="params">(</span></span><br><span class="line"><span class="params">  [in, optional] HMODULE hModule,</span></span><br><span class="line"><span class="params">  [out]          LPSTR   lpFilename,</span></span><br><span class="line"><span class="params">  [in]           DWORD   nSize</span></span><br><span class="line"><span class="params">)</span>;</span><br></pre></td></tr></table></figure>
<p>hModule指定一个本进程已经加载的模块,如果是NULL则返回当前exe应用程序的完整路径</p>
<p>lpFilename用于承载本函数返回的路径的缓冲区</p>
<p>nSize指定lpFilename的大小,防止缓冲区溢出</p>
<p>本例子中这样写<code>GetModuleFileNameA(NULL,szPath,MAX_PATH);</code></p>
<p>意思就是获取当前exe程序完整路径,放到szPath字符串数组中,该路径最长不能超过MAX_PATH长度</p>
<h5 id="pstrrchrszpath"><code>p=strrchr(szPath,'\\')</code></h5>
<p>strrchr用于返回szPath字符串中最后一次出现<code>\</code>字符的指针位置</p>
<blockquote>
<p>这里写了两个斜杠,第一个斜杠是转义的意思</p>
</blockquote>
<h5
id="if_stricmpp1def_process_name">if(!_stricmp(p+1,DEF_PROCESS_NAME))</h5>
<p>stricmp相对于strcmp来说不区分字母大小写</p>
<p>这里DEF_PROCESS_NAME宏定义为"notepad.exe"</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> DEF_PROCESS_NAME <span class="string">&quot;notepad.exe&quot;</span></span></span><br></pre></td></tr></table></figure>
<p>即这里判断了刚才返回的本exe文件的名称是否是"notepad.exe"</p>
<p>如果是则返回1,那么该键盘消息就在钩链上中止了,无法到达notepad应用程序的消息队列了,自然表现为无法获取键盘输入</p>
<blockquote>
<p>这里钩子函数明明在KeyHook.dll中,那么怎么获取"本exe文件的名称"呢?</p>
<p>这是因为后来本dll文件会被操作系统强行注入exe进程的地址空间</p>
</blockquote>
<p>前面进行了三次判断,要求</p>
<p>nCode==1表示键盘消息</p>
<p>lParam最高位为0表示键按下</p>
<p>当前应用程序名叫"notepad.exe"</p>
<p>如果有一次不满足则</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> CallNextHookEx(g_hHook,nCode,wParam,lParam);</span><br></pre></td></tr></table></figure>
<p>如果都满足则不再继续钩子,直接返回1</p>
<h4 id="hookmain.exe">HookMain.exe</h4>
<p>钩子以dll模块的形式打包,HookMain.exe相当于一个注射器,只要HookMain.exe以运行,钩子模块就会被注入所有进程的地址空间.</p>
<p>钩子自己判断了当前注入的进程,是不是notepad进程,如果是则中断键盘消息的传送,否则继续传递键盘消息</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;conio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEF_DLL_NAME <span class="string">&quot;KeyHook.dll&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEF_HOOKSTART <span class="string">&quot;HookStart&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DEF_HOOKSTOP <span class="string">&quot;HookStop&quot;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">void</span> <span class="params">(*PFN_HOOKSTART)</span><span class="params">()</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">void</span> <span class="params">(*PFN_HOOKSTOP)</span><span class="params">()</span>;</span><br><span class="line">PFN_HOOKSTART HookStart = <span class="literal">NULL</span>;</span><br><span class="line">PFN_HOOKSTOP HookStop = <span class="literal">NULL</span>;</span><br><span class="line">HMODULE hDll = <span class="literal">NULL</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    hDll = LoadLibraryA(DEF_DLL_NAME);</span><br><span class="line"></span><br><span class="line">    HookStart = (PFN_HOOKSTART)GetProcAddress(hDll, DEF_HOOKSTART);</span><br><span class="line">    HookStop = (PFN_HOOKSTOP)GetProcAddress(hDll, DEF_HOOKSTOP);</span><br><span class="line"></span><br><span class="line">    HookStart();<span class="comment">//注册钩子</span></span><br><span class="line">    getchar();<span class="comment">//如果不输入则钩子一直起作用</span></span><br><span class="line">    HookStop();</span><br><span class="line">    FreeLibrary(hDll);<span class="comment">//注销钩子</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc HookMain.cpp -o HookMain.exe </span><br></pre></td></tr></table></figure>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/windows%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/" rel="tag"># windows程序设计</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/08/19/lib%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E8%A7%A3%E6%9E%90/" rel="prev" title="程序员的自我修养 chapter 9 LIB">
      <i class="fa fa-chevron-left"></i> 程序员的自我修养 chapter 9 LIB
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/08/23/windows%20SDK%20chapter%2010%20%E8%8F%9C%E5%8D%95%E4%B8%8E%E8%B5%84%E6%BA%90/" rel="next" title="win32程序设计-chapter10 菜单">
      win32程序设计-chapter10 菜单 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#windows-sdk-chapter-21-%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93"><span class="nav-number">1.</span> <span class="nav-text">windows SDK chapter 21
动态链接库</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BA%93%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.1.</span> <span class="nav-text">库的类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BA%93%E7%9A%84%E4%BD%8D%E7%BD%AE"><span class="nav-number">1.2.</span> <span class="nav-text">库的位置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#visual-c%E5%92%8Cvisual-studio"><span class="nav-number">1.3.</span> <span class="nav-text">Visual C++和Visual Studio</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#linux%E4%B8%8A%E7%9A%84%E9%93%BE%E6%8E%A5%E4%B8%8E%E5%BA%93"><span class="nav-number">1.4.</span> <span class="nav-text">Linux上的链接与库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A2%84%E7%BC%96%E8%AF%91"><span class="nav-number">1.4.1.</span> <span class="nav-text">预编译</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B1%87%E7%BC%96"><span class="nav-number">1.4.2.</span> <span class="nav-text">汇编</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%AF%91"><span class="nav-number">1.4.3.</span> <span class="nav-text">编译</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%93%BE%E6%8E%A5"><span class="nav-number">1.4.4.</span> <span class="nav-text">链接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E9%9D%99%E6%80%81%E5%BA%93"><span class="nav-number">1.4.5.</span> <span class="nav-text">创建静态库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%8A%A8%E6%80%81%E5%BA%93"><span class="nav-number">1.4.6.</span> <span class="nav-text">创建动态库</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#visual-studio-%E5%88%9B%E5%BB%BA%E4%BD%BF%E7%94%A8%E5%BA%93"><span class="nav-number">1.5.</span> <span class="nav-text">Visual Studio 创建使用库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-number">1.5.1.</span> <span class="nav-text">静态库的使用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E9%9D%99%E6%80%81%E5%BA%93-1"><span class="nav-number">1.5.1.1.</span> <span class="nav-text">创建静态库</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%96%B0%E5%BB%BA%E7%A9%BA%E7%99%BD%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-number">1.5.1.1.1.</span> <span class="nav-text">1.新建空白解决方案</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%B0%E9%A1%B9%E7%9B%AE"><span class="nav-number">1.5.1.1.2.</span> <span class="nav-text">2.配置新&quot;项目&quot;</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%96%B0%E5%BB%BA%E9%9D%99%E6%80%81%E5%BA%93%E5%B7%A5%E7%A8%8B"><span class="nav-number">1.5.1.1.3.</span> <span class="nav-text">3.新建静态库工程</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9C%A8%E6%B7%BB%E5%8A%A0%E6%96%B0%E9%A1%B9%E7%9B%AE%E6%90%9C%E7%B4%A2%E6%A1%86%E4%B8%AD%E6%90%9C%E7%B4%A2%E9%9D%99%E6%80%81%E5%BA%93"><span class="nav-number">1.5.1.1.4.</span> <span class="nav-text">4.在添加新项目搜索框中搜索&quot;静态库&quot;</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E9%9D%99%E6%80%81%E5%BA%93%E9%A1%B9%E7%9B%AE"><span class="nav-number">1.5.1.1.5.</span> <span class="nav-text">5.配置静态库项目</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%BB%BA%E7%AB%8B%E9%9D%99%E6%80%81%E5%BA%93%E9%A1%B9%E7%9B%AE%E4%B9%8B%E5%90%8E%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86%E5%99%A8"><span class="nav-number">1.5.1.1.6.</span> <span class="nav-text">6.建立静态库项目之后的解决方案资源管理器</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%B8%8D%E4%BD%BF%E7%94%A8%E9%A2%84%E7%BC%96%E8%AF%91%E5%A4%B4"><span class="nav-number">1.5.1.1.7.</span> <span class="nav-text">7.不使用预编译头</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%96%B0%E5%BB%BAmathlib.h%E5%92%8Cmathlib.cpp"><span class="nav-number">1.5.1.1.8.</span> <span class="nav-text">8.新建MathLib.h和MathLib.cpp</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%87%8D%E6%96%B0%E7%94%9F%E6%88%90%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-number">1.5.1.1.9.</span> <span class="nav-text">9.重新生成解决方案</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%93%BE%E6%8E%A5%E9%9D%99%E6%80%81%E5%BA%93"><span class="nav-number">1.5.1.2.</span> <span class="nav-text">链接静态库</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%BE%80%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E4%B8%AD%E6%B7%BB%E5%8A%A0%E6%96%B0%E9%A1%B9%E7%9B%AE"><span class="nav-number">1.5.1.2.1.</span> <span class="nav-text">1.往解决方案中添加新项目</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E5%BC%95%E7%94%A8"><span class="nav-number">1.5.1.2.2.</span> <span class="nav-text">2.添加引用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E5%8C%85%E5%90%AB%E7%9B%AE%E5%BD%95"><span class="nav-number">1.5.1.2.3.</span> <span class="nav-text">3.修改包含目录</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E9%9D%99%E6%80%81%E5%BA%93"><span class="nav-number">1.5.1.2.4.</span> <span class="nav-text">4.测试静态库</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E7%9A%84%E7%BB%93%E6%9E%84"><span class="nav-number">1.5.1.3.</span> <span class="nav-text">解决方案的结构</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-number">1.5.2.</span> <span class="nav-text">动态库的使用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%8A%A8%E6%80%81%E5%BA%93-1"><span class="nav-number">1.5.2.1.</span> <span class="nav-text">创建动态库</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%BB%BA%E7%AB%8B%E7%A9%BA%E7%99%BD%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-number">1.5.2.1.1.</span> <span class="nav-text">1.建立空白解决方案</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%BB%BA%E7%AB%8B%E5%8A%A8%E6%80%81%E5%BA%93%E9%A1%B9%E7%9B%AE"><span class="nav-number">1.5.2.1.2.</span> <span class="nav-text">2.建立动态库项目</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%85%E5%AE%9E%E5%A4%B4%E6%96%87%E4%BB%B6mathdll.h%E5%92%8C%E5%8E%9F%E6%96%87%E4%BB%B6mathdll.cpp"><span class="nav-number">1.5.2.1.3.</span> <span class="nav-text">3.充实头文件MATHDLL.h和原文件MATHDLL.cpp</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%93%BE%E6%8E%A5%E5%8A%A8%E6%80%81%E5%BA%93"><span class="nav-number">1.5.2.2.</span> <span class="nav-text">链接动态库</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%96%B0%E5%BB%BA%E6%8E%A7%E5%88%B6%E5%8F%B0%E6%B5%8B%E8%AF%95%E9%A1%B9%E7%9B%AE"><span class="nav-number">1.5.2.2.1.</span> <span class="nav-text">1.新建控制台测试项目</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E5%BC%95%E7%94%A8-1"><span class="nav-number">1.5.2.2.2.</span> <span class="nav-text">2.添加引用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E5%A4%B4%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E8%B7%AF%E5%BE%84"><span class="nav-number">1.5.2.2.3.</span> <span class="nav-text">3.添加头文件包含路径</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E5%AF%BC%E5%85%A5%E5%BA%93lib%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84"><span class="nav-number">1.5.2.2.4.</span> <span class="nav-text">4.添加导入库(lib文件)路径</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#obj-.lib-.dll"><span class="nav-number">1.5.3.</span> <span class="nav-text">.obj-&gt;.lib-&gt;.dll</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#msvc%E5%88%9B%E5%BB%BA%E4%BD%BF%E7%94%A8%E5%BA%93"><span class="nav-number">1.6.</span> <span class="nav-text">MSVC创建使用库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%B6%E4%BD%9C%E5%8A%A8%E6%80%81%E5%BA%93"><span class="nav-number">1.6.1.</span> <span class="nav-text">制作动态库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%93%BE%E6%8E%A5%E5%AF%BC%E5%85%A5%E5%BA%93"><span class="nav-number">1.6.2.</span> <span class="nav-text">链接导入库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E6%97%B6%E4%BD%BF%E7%94%A8%E5%8A%A8%E6%80%81%E5%BA%93"><span class="nav-number">1.6.3.</span> <span class="nav-text">运行时使用动态库</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#tdm-gcc%E5%88%9B%E5%BB%BA%E4%BD%BF%E7%94%A8%E5%BA%93"><span class="nav-number">1.7.</span> <span class="nav-text">TDM-GCC创建使用库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%B6%E4%BD%9C%E5%8A%A8%E6%80%81%E5%BA%93-1"><span class="nav-number">1.7.1.</span> <span class="nav-text">制作动态库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%93%BE%E6%8E%A5%E5%8A%A8%E6%80%81%E5%BA%93-1"><span class="nav-number">1.7.2.</span> <span class="nav-text">链接动态库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E6%97%B6%E4%BD%BF%E7%94%A8%E5%8A%A8%E6%80%81%E5%BA%93-1"><span class="nav-number">1.7.3.</span> <span class="nav-text">运行时使用动态库</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#dllmain"><span class="nav-number">1.8.</span> <span class="nav-text">DllMain</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%82%E6%95%B0%E6%84%8F%E4%B9%89"><span class="nav-number">1.8.1.</span> <span class="nav-text">参数意义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E6%8B%A3%E6%B6%88%E6%81%AF"><span class="nav-number">1.8.2.</span> <span class="nav-text">分拣消息</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#windows%E6%B6%88%E6%81%AF%E9%92%A9%E5%8F%96dll%E6%B3%A8%E5%85%A5"><span class="nav-number">1.9.</span> <span class="nav-text">Windows消息钩取(Dll注入)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#windows%E6%B6%88%E6%81%AF%E6%B5%81"><span class="nav-number">1.9.1.</span> <span class="nav-text">windows消息流</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#setwindowshookex%E6%95%B0%E6%B3%A8%E5%86%8C%E9%92%A9%E5%AD%90"><span class="nav-number">1.9.2.</span> <span class="nav-text">SetWindowsHookEx数注册钩子</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%82%E6%95%B0%E6%84%8F%E4%B9%89-1"><span class="nav-number">1.9.2.1.</span> <span class="nav-text">参数意义</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#idhook"><span class="nav-number">1.9.2.1.1.</span> <span class="nav-text">idHook</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#lpfn"><span class="nav-number">1.9.2.1.2.</span> <span class="nav-text">lpfn</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#hmod"><span class="nav-number">1.9.2.1.3.</span> <span class="nav-text">hMod</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#dwthreadid"><span class="nav-number">1.9.2.1.4.</span> <span class="nav-text">dwThreadId</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="nav-number">1.9.2.2.</span> <span class="nav-text">返回值</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#unhookwindowshookex%E5%88%A0%E9%99%A4%E9%92%A9%E5%AD%90"><span class="nav-number">1.9.3.</span> <span class="nav-text">UnhookWindowsHookEx删除钩子</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%92%A9%E9%93%BE"><span class="nav-number">1.9.4.</span> <span class="nav-text">钩链</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%92%A9%E5%8F%96notepad.exe%E9%94%AE%E7%9B%98%E6%B6%88%E6%81%AF"><span class="nav-number">1.9.5.</span> <span class="nav-text">钩取notepad.exe键盘消息</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%92%A9%E5%AD%90%E6%A8%A1%E5%9D%97keyhook.dll"><span class="nav-number">1.9.5.1.</span> <span class="nav-text">钩子模块KeyHook.dll</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#ifncode0"><span class="nav-number">1.9.5.1.1.</span> <span class="nav-text">if(nCode&#x3D;&#x3D;0)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#iflparam0x80000000"><span class="nav-number">1.9.5.1.2.</span> <span class="nav-text">if(!(lParam&amp;0x80000000))</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#getmodulefilenameanullszpathmax_path"><span class="nav-number">1.9.5.1.3.</span> <span class="nav-text">GetModuleFileNameA(NULL,szPath,MAX_PATH);</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#pstrrchrszpath"><span class="nav-number">1.9.5.1.4.</span> <span class="nav-text">p&#x3D;strrchr(szPath,&#39;\\&#39;)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#if_stricmpp1def_process_name"><span class="nav-number">1.9.5.1.5.</span> <span class="nav-text">if(!_stricmp(p+1,DEF_PROCESS_NAME))</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#hookmain.exe"><span class="nav-number">1.9.5.2.</span> <span class="nav-text">HookMain.exe</span></a></li></ol></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="dustball"
      src="https://raw.githubusercontent.com/DeutschBall/picbed/main/dustball.png">
  <p class="site-author-name" itemprop="name">dustball</p>
  <div class="site-description" itemprop="description">dustland</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">78</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">30</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">dustball</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        
<div class="busuanzi-count">
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/pjax/pjax.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  
  <script data-pjax>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>




  
<script src="/js/local-search.js"></script>











<script data-pjax>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'dark',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


    <div id="pjax">
  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
          load: ['[tex]/mhchem'],
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
          packages: {'[+]': ['mhchem']},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

    </div>
</body>
</html>
